(()=>{var __webpack_modules__={4371:(R,W,d)=>{var O,I;O=[d(9178),d(1873),d(7800),d(2749),d(4323)],I=d.dj.d(O,function(f,N,b,h,r){"use strict";var o=0,c=1,u=2,g="This deferred has already been fulfilled.",m=Object.freeze||function(){},y=function(T,M,z,Y,X){f("config-deferredInstrumentation")&&M===u&&P.instrumentRejected&&T.length===0&&P.instrumentRejected(z,!1,Y,X);for(var S=0;S<T.length;S++)x(T[S],M,z,Y)},x=function(T,M,z,Y){var X=T[M],S=T.deferred;if(X)try{var F=X(z);if(M===o)typeof F<"u"&&C(S,M,F);else{if(F&&typeof F.then=="function"){T.cancel=F.cancel,F.then(w(S,c),w(S,u),w(S,o));return}C(S,c,F)}}catch(k){C(S,u,k)}else C(S,M,z);f("config-deferredInstrumentation")&&M===u&&P.instrumentRejected&&P.instrumentRejected(z,!!X,Y,S.promise)},w=function(T,M){return function(z){C(T,M,z)}},C=function(T,M,z){if(!T.isCanceled())switch(M){case o:T.progress(z);break;case c:T.resolve(z);break;case u:T.reject(z);break}},P=function(T){var M=this.promise=new h,z=this,Y,X,S,F=!1,k=[];f("config-deferredInstrumentation")&&Error.captureStackTrace&&(Error.captureStackTrace(z,P),Error.captureStackTrace(M,P)),this.isResolved=M.isResolved=function(){return Y===c},this.isRejected=M.isRejected=function(){return Y===u},this.isFulfilled=M.isFulfilled=function(){return!!Y},this.isCanceled=M.isCanceled=function(){return F},this.progress=function(H,q){if(Y){if(q===!0)throw new Error(g);return M}else return y(k,o,H,null,z),M},this.resolve=function(H,q){if(Y){if(q===!0)throw new Error(g);return M}else return y(k,Y=c,X=H,null,z),k=null,M};var G=this.reject=function(H,q){if(Y){if(q===!0)throw new Error(g);return M}else return f("config-deferredInstrumentation")&&Error.captureStackTrace&&Error.captureStackTrace(S={},G),y(k,Y=u,X=H,S,z),k=null,M};this.then=M.then=function(H,q,ce){var Q=[ce,H,q];return Q.cancel=M.cancel,Q.deferred=new P(function(ne){return Q.cancel&&Q.cancel(ne)}),Y&&!k?x(Q,Y,X,S):k.push(Q),Q.deferred.promise},this.cancel=M.cancel=function(H,q){if(Y){if(q===!0)throw new Error(g)}else{if(T){var ce=T(H);H=typeof ce>"u"?H:ce}if(F=!0,Y){if(Y===u&&X===H)return H}else return typeof H>"u"&&(H=new b),G(H),H}},m(M)};return P.prototype.toString=function(){return"[object Deferred]"},r&&r(P),P},R,W),R.exports=I},3543:(R,W,d)=>{var O,I;O=[d(3660),d(1929)],I=d.dj.d(O,function(f,N){"use strict";var b=f.after;function h(){}return h.prototype={on:function(r,o){return N.parse(this,r,o,function(c,u){return b(c,"on"+u,o,!0)})},emit:function(r,o){var c=[this];return c.push.apply(c,arguments),N.emit.apply(N,c)}},h},R,W),R.exports=I},5642:(R,W,d)=>{var O,I;O=[d(9424),d(4371),d(2749),d(7800),d(9178),d(1873),d(1636)],I=d.dj.d(O,function(f,N,b,h,r,o,c){var u=function(){},g=Object.freeze||function(){},m=f.Deferred=function(y){var x,w,C,P,T,M,z,Y=this.promise=new b;function X(k){if(w)throw new Error("This deferred has already been resolved");x=k,w=!0,S()}function S(){for(var k;!k&&z;){var G=z;z=z.next,(k=G.progress==u)&&(w=!1);var H=T?G.error:G.resolved;if(r("config-useDeferredInstrumentation")&&T&&N.instrumentRejected&&N.instrumentRejected(x,!!H),H)try{var q=H(x);if(q&&typeof q.then=="function"){q.then(o.hitch(G.deferred,"resolve"),o.hitch(G.deferred,"reject"),o.hitch(G.deferred,"progress"));continue}var ce=k&&q===void 0;k&&!ce&&(T=q instanceof Error),G.deferred[ce&&T?"reject":"resolve"](ce?x:q)}catch(Q){G.deferred.reject(Q)}else T?G.deferred.reject(x):G.deferred.resolve(x)}}this.isResolved=Y.isResolved=function(){return P==0},this.isRejected=Y.isRejected=function(){return P==1},this.isFulfilled=Y.isFulfilled=function(){return P>=0},this.isCanceled=Y.isCanceled=function(){return C},this.resolve=this.callback=function(k){this.fired=P=0,this.results=[k,null],X(k)},this.reject=this.errback=function(k){T=!0,this.fired=P=1,r("config-useDeferredInstrumentation")&&N.instrumentRejected&&N.instrumentRejected(k,!!z),X(k),this.results=[null,k]},this.progress=function(k){for(var G=z;G;){var H=G.progress;H&&H(k),G=G.next}},this.addCallbacks=function(k,G){return this.then(k,G,u),this},Y.then=this.then=function(k,G,H){var q=H==u?this:new m(Y.cancel),ce={resolved:k,error:G,progress:H,deferred:q};return z?M=M.next=ce:z=M=ce,w&&S(),q.promise};var F=this;Y.cancel=this.cancel=function(){if(!w){var k=y&&y(F);w||(k instanceof Error||(k=new h(k)),k.log=!1,F.reject(k))}C=!0},g(Y)};return o.extend(m,{addCallback:function(y){return this.addCallbacks(o.hitch.apply(f,arguments))},addErrback:function(y){return this.addCallbacks(null,o.hitch.apply(f,arguments))},addBoth:function(y){var x=o.hitch.apply(f,arguments);return this.addCallbacks(x,x)},fired:-1}),m.when=f.when=c,m},R,W),R.exports=I},640:(R,W,d)=>{var O,I;O=[d(9424),d(9178),d(1873)],I=d.dj.d(O,function(f,N,b){var h={},r,o;N("csp-restrictions")||(o=function(m){return h[m]=new Function("item","index","array",m)});function c(m){var y=!m;return function(x,w,C){var P=0,T=x&&x.length||0,M;if(T&&typeof x=="string"&&(x=x.split("")),typeof w=="string"){if(N("csp-restrictions"))throw new TypeError("callback must be a function");w=h[w]||o(w)}if(C){for(;P<T;++P)if(M=!w.call(C,x[P],P,x),m^M)return!M}else for(;P<T;++P)if(M=!w(x[P],P,x),m^M)return!M;return y}}function u(m){var y=1,x=0,w=0;return m||(y=x=w=-1),function(C,P,T,M){if(M&&y>0)return g.lastIndexOf(C,P,T);var z=C&&C.length||0,Y=m?z+w:x,X;for(T===r?X=m?x:z+w:T<0?(X=z+T,X<0&&(X=x)):X=T>=z?z+w:T,z&&typeof C=="string"&&(C=C.split(""));X!=Y;X+=y)if(C[X]==P)return X;return-1}}var g={every:c(!1),some:c(!0),indexOf:u(!0),lastIndexOf:u(!1),forEach:function(m,y,x){var w=0,C=m&&m.length||0;if(C&&typeof m=="string"&&(m=m.split("")),typeof y=="string"){if(N("csp-restrictions"))throw new TypeError("callback must be a function");y=h[y]||o(y)}if(x)for(;w<C;++w)y.call(x,m[w],w,m);else for(;w<C;++w)y(m[w],w,m)},map:function(m,y,x,w){var C=0,P=m&&m.length||0,T=new(w||Array)(P);if(P&&typeof m=="string"&&(m=m.split("")),typeof y=="string"){if(N("csp-restrictions"))throw new TypeError("callback must be a function");y=h[y]||o(y)}if(x)for(;C<P;++C)T[C]=y.call(x,m[C],C,m);else for(;C<P;++C)T[C]=y(m[C],C,m);return T},filter:function(m,y,x){var w=0,C=m&&m.length||0,P=[],T;if(C&&typeof m=="string"&&(m=m.split("")),typeof y=="string"){if(N("csp-restrictions"))throw new TypeError("callback must be a function");y=h[y]||o(y)}if(x)for(;w<C;++w)T=m[w],y.call(x,T,w,m)&&P.push(T);else for(;w<C;++w)T=m[w],y(T,w,m)&&P.push(T);return P},clearCache:function(){h={}}};return N("extend-dojo")&&b.mixin(f,g),g},R,W),R.exports=I},6723:(R,W,d)=>{var O,I;O=[d(8455),d(9178),d.dj.c(R)],I=d.dj.d(O,function(f,N,b){var h={};if(N("dojo-config-api")){var r=b.rawConfig,o;for(o in r)h[o]=r[o]}else{var c=function(g,m,y){for(o in g)o!="has"&&N.add(m+o,g[o],0,y)};h=N("dojo-loader")?b.rawConfig:f.dojoConfig||f.djConfig||{},c(h,"config",1),c(h.has,"",1)}if(h.updateLocale=function(g,m){var y,x,w="en-us";if(g.indexOf(m)>=0&&m!=="zh"){h.locale=m;return}if(y=m.split("-")[0],y==="zh"){h.locale=w.toLocaleLowerCase();return}for(var C=0;C<g.length;C=C+1)if(x=g[C].split("-")[0],y===x){h.locale=g[C];break}h.locale||(h.locale=w.toLowerCase())},!h.locale&&typeof navigator<"u"){var u=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language||navigator.userLanguage;u=h._testLanguageOverride||u,u&&(u=u.toLowerCase(),h.supportedLocales&&h.updateLocale(h.supportedLocales,u))}return h.locale||(h.locale="en-us"),h},R,W),R.exports=I},5135:(R,W,d)=>{var O,I;O=[d(9424),d(1929),d(7505),d(3660),d(4409),d(4905),d(8609),d(1873),d(3720)],I=d.dj.d(O,function(f,N,b,h,r,o,c,u){c.add("events-keypress-typed",function(){var M={charCode:0};try{M=document.createEvent("KeyboardEvent"),(M.initKeyboardEvent||M.initKeyEvent).call(M,"keypress",!0,!0,null,!1,!1,!1,!1,9,3)}catch(z){}return M.charCode==0&&!c("opera")});function g(M,z,Y,X,S){if(X=u.hitch(Y,X),!M||!(M.addEventListener||M.attachEvent))return h.after(M||f.global,z,X,!0);if(typeof z=="string"&&z.substring(0,2)=="on"&&(z=z.substring(2)),M||(M=f.global),!S)switch(z){case"keypress":z=C;break;case"mouseenter":z=o.enter;break;case"mouseleave":z=o.leave;break}return N(M,z,X,S)}var m={106:42,111:47,186:59,187:43,188:44,189:45,190:46,191:47,192:96,219:91,220:92,221:93,222:39,229:113},y=c("mac")?"metaKey":"ctrlKey",x=function(M,z){var Y=u.mixin({},M,z);return w(Y),Y.preventDefault=function(){M.preventDefault()},Y.stopPropagation=function(){M.stopPropagation()},Y};function w(M){M.keyChar=M.charCode?String.fromCharCode(M.charCode):"",M.charOrCode=M.keyChar||M.keyCode}var C;if(c("events-keypress-typed")){var P=function(M,z){try{return M.keyCode=z}catch(Y){return 0}};C=function(M,z){var Y=N(M,"keydown",function(S){var F=S.keyCode,k=F!=13&&F!=32&&(F!=27||!c("ie"))&&(F<48||F>90)&&(F<96||F>111)&&(F<186||F>192)&&(F<219||F>222)&&F!=229;if(k||S.ctrlKey){var G=k?0:F;if(S.ctrlKey){if(F==3||F==13)return z.call(S.currentTarget,S);G>95&&G<106?G-=48:!S.shiftKey&&G>=65&&G<=90?G+=32:G=m[G]||G}var H=x(S,{type:"keypress",faux:!0,charCode:G});z.call(S.currentTarget,H),c("ie")&&P(S,H.keyCode)}}),X=N(M,"keypress",function(S){var F=S.charCode;return F=F>=32?F:0,S=x(S,{charCode:F,faux:!0}),z.call(this,S)});return{remove:function(){Y.remove(),X.remove()}}}}else c("opera")?C=function(M,z){return N(M,"keypress",function(Y){var X=Y.which;return X==3&&(X=99),X=X<32&&!Y.shiftKey?0:X,Y.ctrlKey&&!Y.shiftKey&&X>=65&&X<=90&&(X+=32),z.call(this,x(Y,{charCode:X}))})}:C=function(M,z){return N(M,"keypress",function(Y){return w(Y),z.call(this,Y)})};var T={_keypress:C,connect:function(M,z,Y,X,S){var F=arguments,k=[],G=0;k.push(typeof F[0]=="string"?null:F[G++],F[G++]);var H=F[G+1];k.push(typeof H=="string"||typeof H=="function"?F[G++]:null,F[G++]);for(var q=F.length;G<q;G++)k.push(F[G]);return g.apply(this,k)},disconnect:function(M){M&&M.remove()},subscribe:function(M,z,Y){return b.subscribe(M,u.hitch(z,Y))},publish:function(M,z){return b.publish.apply(b,[M].concat(z))},connectPublisher:function(M,z,Y){var X=function(){T.publish(M,arguments)};return Y?T.connect(z,Y,X):T.connect(z,X)},isCopyKey:function(M){return M[y]}};return T.unsubscribe=T.disconnect,c("extend-dojo")&&u.mixin(f,T),T},R,W),R.exports=I},1203:(R,W,d)=>{var O,I;O=[d(9424),d(9178),d(1873)],I=d.dj.d(O,function(f,N,b){var h=b.mixin,r=Object.prototype,o=r.toString,c,u=0,g="constructor";N("csp-restrictions")?c=function(){}:c=new Function;function m(Q,ne){throw new Error("declare"+(ne?" "+ne:"")+": "+Q)}function y(Q,ne){for(var he=[],ve=[{cls:0,refs:[]}],Ie={},fe=1,Me=Q.length,Ke=0,Ye,je,ot,$e,_t,Ut,qt,oi;Ke<Me;++Ke){for(ot=Q[Ke],ot?o.call(ot)!="[object Function]"&&m("mixin #"+Ke+" is not a callable constructor.",ne):m("mixin #"+Ke+" is unknown. Did you use dojo.require to pull it in?",ne),je=ot._meta?ot._meta.bases:[ot],$e=0,Ye=je.length-1;Ye>=0;--Ye)_t=je[Ye].prototype,_t.hasOwnProperty("declaredClass")||(_t.declaredClass="uniqName_"+u++),qt=_t.declaredClass,Ie.hasOwnProperty(qt)||(Ie[qt]={count:0,refs:[],cls:je[Ye]},++fe),Ut=Ie[qt],$e&&$e!==Ut&&(Ut.refs.push($e),++$e.count),$e=Ut;++$e.count,ve[0].refs.push($e)}for(;ve.length;){for($e=ve.pop(),he.push($e.cls),--fe;oi=$e.refs,oi.length==1;){if($e=oi[0],!$e||--$e.count){$e=0;break}he.push($e.cls),--fe}if($e)for(Ke=0,Me=oi.length;Ke<Me;++Ke)$e=oi[Ke],--$e.count||ve.push($e)}return fe&&m("can't build consistent linearization",ne),ot=Q[0],he[0]=ot?ot._meta&&ot===he[he.length-ot._meta.bases.length]?ot._meta.bases.length:1:0,he}function x(Q,ne,he,ve){var Ie,fe,Me,Ke,Ye,je,ot,$e,_t,Ut=this._inherited=this._inherited||{};if(typeof Q=="string"&&(Ie=Q,Q=ne,ne=he,he=ve),typeof Q=="function")Ke=Q,Q=ne,ne=he;else try{Ke=Q.callee}catch(qt){if(qt instanceof TypeError)m("strict mode inherited() requires the caller function to be passed before arguments",this.declaredClass);else throw qt}if(Ie=Ie||Ke.nom,Ie||m("can't deduce a name to call inherited()",this.declaredClass),he=ve=0,Ye=this.constructor._meta,Me=Ye.bases,_t=Ut.p,Ie!=g){if(Ut.c!==Ke&&(_t=0,je=Me[0],Ye=je._meta,Ye.hidden[Ie]!==Ke)){fe=Ye.chains,fe&&typeof fe[Ie]=="string"&&m("calling chained method with inherited: "+Ie,this.declaredClass);do if(Ye=je._meta,ot=je.prototype,Ye&&(ot[Ie]===Ke&&ot.hasOwnProperty(Ie)||Ye.hidden[Ie]===Ke))break;while(je=Me[++_t]);_t=je?_t:-1}if(je=Me[++_t],je)if(ot=je.prototype,je._meta&&ot.hasOwnProperty(Ie))he=ot[Ie];else{$e=r[Ie];do if(ot=je.prototype,he=ot[Ie],he&&(je._meta?ot.hasOwnProperty(Ie):he!==$e))break;while(je=Me[++_t])}he=je&&he||r[Ie]}else{if(Ut.c!==Ke&&(_t=0,Ye=Me[0]._meta,Ye&&Ye.ctor!==Ke)){for(fe=Ye.chains,(!fe||fe.constructor!=="manual")&&m("calling chained constructor with inherited",this.declaredClass);(je=Me[++_t])&&(Ye=je._meta,!(Ye&&Ye.ctor===Ke)););_t=je?_t:-1}for(;(je=Me[++_t])&&(Ye=je._meta,he=Ye?Ye.ctor:je,!he););he=je&&he}if(Ut.c=he,Ut.p=_t,he)return ne===!0?he:he.apply(this,ne||Q)}function w(Q,ne,he){return typeof Q=="string"?typeof ne=="function"?this.__inherited(Q,ne,he,!0):this.__inherited(Q,ne,!0):typeof Q=="function"?this.__inherited(Q,ne,!0):this.__inherited(Q,!0)}function C(Q,ne,he,ve){var Ie=this.getInherited(Q,ne,he);if(Ie)return Ie.apply(this,ve||he||ne||Q)}var P=f.config.isDebug?C:x;function T(Q){for(var ne=this.constructor._meta.bases,he=0,ve=ne.length;he<ve;++he)if(ne[he]===Q)return!0;return this instanceof Q}function M(Q,ne){for(var he in ne)he!=g&&ne.hasOwnProperty(he)&&(Q[he]=ne[he]);if(N("bug-for-in-skips-shadowed"))for(var ve=b._extraNames,Ie=ve.length;Ie;)he=ve[--Ie],he!=g&&ne.hasOwnProperty(he)&&(Q[he]=ne[he])}function z(Q,ne){var he,ve;for(he in ne)ve=ne[he],(ve!==r[he]||!(he in r))&&he!=g&&(o.call(ve)=="[object Function]"&&(ve.nom=he),Q[he]=ve);if(N("bug-for-in-skips-shadowed")&&ne)for(var Ie=b._extraNames,fe=Ie.length;fe;)he=Ie[--fe],ve=ne[he],(ve!==r[he]||!(he in r))&&he!=g&&(o.call(ve)=="[object Function]"&&(ve.nom=he),Q[he]=ve);return Q}function Y(Q){return ce.safeMixin(this.prototype,Q),this}function X(Q,ne){return Q instanceof Array||typeof Q=="function"||(ne=Q,Q=void 0),ne=ne||{},Q=Q||[],ce([this].concat(Q),ne)}function S(Q,ne){return function(){var he=arguments,ve=he,Ie=he[0],fe,Me,Ke,Ye=Q.length,je;if(!(this instanceof he.callee))return q(he);if(ne&&(Ie&&Ie.preamble||this.preamble))for(je=new Array(Q.length),je[0]=he,Me=0;Ie=he[0],Ie&&(fe=Ie.preamble,fe&&(he=fe.apply(this,he)||he)),fe=Q[Me].prototype,fe=fe.hasOwnProperty("preamble")&&fe.preamble,fe&&(he=fe.apply(this,he)||he),++Me!=Ye;)je[Me]=he;for(Me=Ye-1;Me>=0;--Me)fe=Q[Me],Ke=fe._meta,fe=Ke?Ke.ctor:fe,fe&&fe.apply(this,je?je[Me]:he);fe=this.postscript,fe&&fe.apply(this,ve)}}function F(Q,ne){return function(){var he=arguments,ve=he,Ie=he[0],fe;if(!(this instanceof he.callee))return q(he);ne&&(Ie&&(fe=Ie.preamble,fe&&(ve=fe.apply(this,ve)||ve)),fe=this.preamble,fe&&fe.apply(this,ve)),Q&&Q.apply(this,he),fe=this.postscript,fe&&fe.apply(this,he)}}function k(Q){return function(){var ne=arguments,he=0,ve,Ie;try{if(!(this instanceof ne.callee))return q(ne)}catch(fe){}for(;ve=Q[he];++he)if(Ie=ve._meta,ve=Ie?Ie.ctor:ve,ve){ve.apply(this,ne);break}ve=this.postscript,ve&&ve.apply(this,ne)}}function G(Q,ne,he){return function(){var ve,Ie,fe,Me=0,Ke=1;for(he&&(Me=ne.length-1,Ke=-1);ve=ne[Me];Me+=Ke)Ie=ve._meta,fe=(Ie?Ie.hidden:ve.prototype)[Q],fe&&fe.apply(this,arguments)}}function H(Q){c.prototype=Q.prototype;var ne=new c;return c.prototype=null,ne}function q(Q){var ne=Q.callee,he=H(ne);return ne.apply(he,Q),he}function ce(Q,ne,he){typeof Q!="string"&&(he=ne,ne=Q,Q=""),he=he||{};var ve,Ie,fe,Me,Ke,Ye,je,ot=1,$e=ne;if(o.call(ne)=="[object Array]"?(Ye=y(ne,Q),fe=Ye[0],ot=Ye.length-fe,ne=Ye[ot]):(Ye=[0],ne?o.call(ne)=="[object Function]"?(fe=ne._meta,Ye=Ye.concat(fe?fe.bases:ne)):m("base class is not a callable constructor.",Q):ne!==null&&m("unknown base class. Did you use dojo.require to pull it in?",Q)),ne)for(Ie=ot-1;ve=H(ne),!!Ie;--Ie)fe=Ye[Ie],(fe._meta?M:h)(ve,fe.prototype),N("csp-restrictions")?Me=function(){}:Me=new Function,Me.superclass=ne,Me.prototype=ve,ne=ve.constructor=Me;else ve={};for(ce.safeMixin(ve,he),fe=he.constructor,fe!==r.constructor&&(fe.nom=g,ve.constructor=fe),Ie=ot-1;Ie;--Ie)fe=Ye[Ie]._meta,fe&&fe.chains&&(je=h(je||{},fe.chains));if(ve["-chains-"]&&(je=h(je||{},ve["-chains-"])),ne&&ne.prototype&&ne.prototype["-chains-"]&&(je=h(je||{},ne.prototype["-chains-"])),fe=!je||!je.hasOwnProperty(g),Ye[0]=Me=je&&je.constructor==="manual"?k(Ye):Ye.length==1?F(he.constructor,fe):S(Ye,fe),Me._meta={bases:Ye,hidden:he,chains:je,parents:$e,ctor:he.constructor},Me.superclass=ne&&ne.prototype,Me.extend=Y,Me.createSubclass=X,Me.prototype=ve,ve.constructor=Me,ve.getInherited=w,ve.isInstanceOf=T,ve.inherited=P,ve.__inherited=x,Q&&(ve.declaredClass=Q,b.setObject(Q,Me)),je)for(Ke in je)ve[Ke]&&typeof je[Ke]=="string"&&Ke!=g&&(fe=ve[Ke]=G(Ke,Ye,je[Ke]==="after"),fe.nom=Ke);return Me}return f.safeMixin=ce.safeMixin=z,f.declare=ce,ce},R,W),R.exports=I},4409:(R,W,d)=>{var O,I;O=[d(9424),d(1929),d(9178),d(8771)],I=d.dj.d(O,function(f,N,b,h){if(N._fixEvent){var r=N._fixEvent;N._fixEvent=function(c,u){return c=r(c,u),c&&h.normalizeEvent(c),c}}var o={fix:function(c,u){return N._fixEvent?N._fixEvent(c,u):c},stop:function(c){b("dom-addeventlistener")||c&&c.preventDefault?(c.preventDefault(),c.stopPropagation()):(c=c||window.event,c.cancelBubble=!0,N._preventDefault.call(c))}};return b("extend-dojo")&&(f.fixEvent=o.fix,f.stopEvent=o.stop),o},R,W),R.exports=I},5747:(module,exports,__webpack_require__)=>{var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9424),__webpack_require__(2570)],__WEBPACK_AMD_DEFINE_RESULT__=__webpack_require__.dj.d(__WEBPACK_AMD_DEFINE_ARRAY__,function(dojo,json){return dojo.fromJson=function(js){return eval("("+js+")")},dojo._escapeString=json.stringify,dojo.toJsonIndentStr="	",dojo.toJson=function(R,W){return json.stringify(R,function(d,O){if(O){var I=O.__json__||O.json;if(typeof I=="function")return I.call(O)}return O},W&&dojo.toJsonIndentStr)},dojo},module,exports),module.exports=__WEBPACK_AMD_DEFINE_RESULT__},9424:(R,W,d)=>{var O,I;O=[d(8455),d(9178),d(6723),d.dj.c(R),d.dj.m(R)],I=d.dj.d(O,function(f,N,b,h,r){var o,c,u={},g={},m={config:b,global:f,dijit:u,dojox:g},y={dojo:["dojo",m],dijit:["dijit",u],dojox:["dojox",g]},x=h.map&&h.map[r.id.match(/[^\/]+/)[0]],w;for(c in x)y[c]?y[c][0]=x[c]:y[c]=[x[c],{}];for(c in y)w=y[c],w[1]._scopeName=w[0],b.noGlobals||(f[w[0]]=w[1]);m.scopeMap=y,m.baseUrl=m.config.baseUrl=h.baseUrl,m.isAsync=!N("dojo-loader")||h.async,m.locale=b.locale;var C="$Rev:$".match(/[0-9a-f]{7,}/);if(m.version={major:1,minor:17,patch:1,flag:"",revision:C?C[0]:NaN,toString:function(){var z=m.version;return z.major+"."+z.minor+"."+z.patch+z.flag+" ("+z.revision+")"}},N.add("extend-dojo",1),N("csp-restrictions")||Function("d","d.eval = function(){return d.global.eval ? d.global.eval(arguments[0]) : eval(arguments[0]);}")(m),N("host-rhino")?m.exit=function(z){quit(z)}:m.exit=function(){},N("host-webworker")||N.add("dojo-guarantee-console",1),N("dojo-guarantee-console")){N.add("console-as-object",function(){return Function.prototype.bind&&console&&typeof console.log=="object"}),typeof console<"u"||(console={});var P=["assert","count","debug","dir","dirxml","error","group","groupEnd","info","profile","profileEnd","time","timeEnd","trace","warn","log"],T;for(o=0;T=P[o++];)console[T]?N("console-as-object")&&(console[T]=Function.prototype.bind.call(console[T],console)):function(){var z=T+"";console[z]="log"in console?function(){var Y=Array.prototype.slice.call(arguments);Y.unshift(z+":"),console.log(Y.join(" "))}:function(){},console[z]._fake=!0}()}if(N.add("dojo-debug-messages",!!b.isDebug),m.deprecated=m.experimental=function(){},N("dojo-debug-messages")&&(m.deprecated=function(z,Y,X){var S="DEPRECATED: "+z;Y&&(S+=" "+Y),X&&(S+=" -- will be removed in version: "+X),console.warn(S)},m.experimental=function(z,Y){var X="EXPERIMENTAL: "+z+" -- APIs subject to change without notice.";Y&&(X+=" "+Y),console.warn(X)}),N.add("dojo-modulePaths",1),N("dojo-modulePaths")&&b.modulePaths){m.deprecated("dojo.modulePaths","use paths configuration");var M={};for(c in b.modulePaths)M[c.replace(/\./g,"/")]=b.modulePaths[c];h({paths:M})}return N.add("dojo-moduleUrl",1),N("dojo-moduleUrl")&&(m.moduleUrl=function(z,Y){m.deprecated("dojo.moduleUrl()","use require.toUrl","2.0");var X=null;return z&&(X=h.toUrl(z.replace(/\./g,"/")+(Y?"/"+Y:"")+"/*.*").replace(/\/\*\.\*/,"")+(Y?"":"/")),X}),m._hasResource={},m},R,W),R.exports=I},1873:(R,W,d)=>{var O,I;O=[d(9424),d(9178),d(3994)],I=d.dj.d(O,function(f,N){N.add("bug-for-in-skips-shadowed",function(){for(var m in{toString:1})return 0;return 1});var b=N("bug-for-in-skips-shadowed")?"hasOwnProperty.valueOf.isPrototypeOf.propertyIsEnumerable.toLocaleString.toString.constructor".split("."):[],h=b.length,r=function(m,y,x){x||(m[0]&&f.scopeMap[m[0]]?x=f.scopeMap[m.shift()][1]:x=f.global);try{for(var w=0;w<m.length;w++){var C=m[w];if(C==="__proto__"||C==="constructor")return;if(!(C in x))if(y)x[C]={};else return;x=x[C]}return x}catch(P){}},o=Object.prototype.toString,c=function(m,y,x){return(x||[]).concat(Array.prototype.slice.call(m,y||0))},u=/\{([^\}]+)\}/g,g={_extraNames:b,_mixin:function(m,y,x){var w,C,P,T={};for(w in y)C=y[w],(!(w in m)||m[w]!==C&&(!(w in T)||T[w]!==C))&&(m[w]=x?x(C):C);if(N("bug-for-in-skips-shadowed")&&y)for(P=0;P<h;++P)w=b[P],C=y[w],(!(w in m)||m[w]!==C&&(!(w in T)||T[w]!==C))&&(m[w]=x?x(C):C);return m},mixin:function(m,y){m||(m={});for(var x=1,w=arguments.length;x<w;x++)g._mixin(m,arguments[x]);return m},setObject:function(m,y,x){var w=m.split("."),C=w.pop(),P=r(w,!0,x);return P&&C?P[C]=y:void 0},getObject:function(m,y,x){return m?r(m.split("."),y,x):x},exists:function(m,y){return g.getObject(m,!1,y)!==void 0},isString:function(m){return typeof m=="string"||m instanceof String},isArray:Array.isArray||function(m){return o.call(m)=="[object Array]"},isFunction:function(m){return o.call(m)==="[object Function]"},isObject:function(m){return m!==void 0&&(m===null||typeof m=="object"||g.isArray(m)||g.isFunction(m))},isArrayLike:function(m){return!!m&&!g.isString(m)&&!g.isFunction(m)&&!(m.tagName&&m.tagName.toLowerCase()=="form")&&(g.isArray(m)||isFinite(m.length))},isAlien:function(m){return m&&!g.isFunction(m)&&/\{\s*\[native code\]\s*\}/.test(String(m))},extend:function(m,y){for(var x=1,w=arguments.length;x<w;x++)g._mixin(m.prototype,arguments[x]);return m},_hitchArgs:function(m,y){var x=g._toArray(arguments,2),w=g.isString(y);return function(){var C=g._toArray(arguments),P=w?(m||f.global)[y]:y;return P&&P.apply(m||this,x.concat(C))}},hitch:function(m,y){if(arguments.length>2)return g._hitchArgs.apply(f,arguments);if(y||(y=m,m=null),g.isString(y)){if(m=m||f.global,!m[y])throw['lang.hitch: scope["',y,'"] is null (scope="',m,'")'].join("");return function(){return m[y].apply(m,arguments||[])}}return m?function(){return y.apply(m,arguments||[])}:y},delegate:function(){function m(){}return function(y,x){m.prototype=y;var w=new m;return m.prototype=null,x&&g._mixin(w,x),w}}(),_toArray:N("ie")?function(){function m(y,x,w){for(var C=w||[],P=x||0;P<y.length;P++)C.push(y[P]);return C}return function(y){return(y.item?m:c).apply(this,arguments)}}():c,partial:function(m){var y=[null];return g.hitch.apply(f,y.concat(g._toArray(arguments)))},clone:function(m){if(!m||typeof m!="object"||g.isFunction(m))return m;if(m.nodeType&&"cloneNode"in m)return m.cloneNode(!0);if(m instanceof Date)return new Date(m.getTime());if(m instanceof RegExp)return new RegExp(m);var y,x,w;if(g.isArray(m))for(y=[],x=0,w=m.length;x<w;++x)x in m&&(y[x]=g.clone(m[x]));else y=m.constructor?new m.constructor:{};return g._mixin(y,m,g.clone)},trim:String.prototype.trim?function(m){return m.trim()}:function(m){return m.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},replace:function(m,y,x){return m.replace(x||u,g.isFunction(y)?y:function(w,C){return g.getObject(C,!1,y)})}};return N("extend-dojo")&&g.mixin(f,g),g},R,W),R.exports=I},8609:(R,W,d)=>{var O,I;O=[d(9424),d(1873),d(3994)],I=d.dj.d(O,function(f,N,b){return b("host-browser")&&(f._name="browser",N.mixin(f,{isBrowser:!0,isFF:b("ff"),isIE:b("ie"),isKhtml:b("khtml"),isWebKit:b("webkit"),isMozilla:b("mozilla"),isMoz:b("mozilla"),isOpera:b("opera"),isSafari:b("safari"),isChrome:b("chrome"),isMac:b("mac"),isIos:b("ios"),isAndroid:b("android"),isWii:b("wii"),isQuirks:b("quirks"),isAir:b("air")})),b},R,W),R.exports=I},8145:(R,W,d)=>{var O,I;O=[d(9424),d(1873),d(3994)],I=d.dj.d(O,function(f,N,b){var h={global:f.global,doc:f.global.document||null,body:function(r){return r=r||f.doc,r.body||r.getElementsByTagName("body")[0]},setContext:function(r,o){f.global=h.global=r,f.doc=h.doc=o},withGlobal:function(r,o,c,u){var g=f.global;try{return f.global=h.global=r,h.withDoc.call(null,r.document,o,c,u)}finally{f.global=h.global=g}},withDoc:function(r,o,c,u){var g=h.doc,m=b("quirks"),y=b("ie"),x,w,C;try{return f.doc=h.doc=r,f.isQuirks=b.add("quirks",f.doc.compatMode=="BackCompat",!0,!0),b("ie")&&(C=r.parentWindow)&&C.navigator&&(x=parseFloat(C.navigator.appVersion.split("MSIE ")[1])||void 0,w=r.documentMode,w&&w!=5&&Math.floor(x)!=w&&(x=w),f.isIE=b.add("ie",x,!0,!0)),c&&typeof o=="string"&&(o=c[o]),o.apply(c,u||[])}finally{f.doc=h.doc=g,f.isQuirks=b.add("quirks",m,!0,!0),f.isIE=b.add("ie",y,!0,!0)}}};return b("extend-dojo")&&N.mixin(f,h),h},R,W),R.exports=I},8519:(R,W,d)=>{var O,I;O=[d(9424),d(8609),d.dj.c(R),d(7841),d(3458),d(2693),d(5642),d(6723),d(5747),d(1873),d(640),d(1929),d(3660),d(1563),d(9810),d(3638)],I=d.dj.d(O,function(f,N,b,h,r,o,c,u,g,m,y,x,w,C,P,T){f._xhrObj=P._create;var M=f.config;f.objectToQuery=h.objectToQuery,f.queryToObject=h.queryToObject,f.fieldToObject=o.fieldToObject,f.formToObject=o.toObject,f.formToQuery=o.toQuery,f.formToJson=o.toJson,f._blockAsync=!1;var z=f._contentHandlers=f.contentHandlers={text:function(G){return G.responseText},json:function(G){return g.fromJson(G.responseText||null)},"json-comment-filtered":function(G){u.useCommentedJson||console.warn(`Consider using the standard mimetype:application/json. json-commenting can introduce security issues. To decrease the chances of hijacking, use the standard the 'json' handler and prefix your json with: {}&&
Use djConfig.useCommentedJson=true to turn off this message.`);var H=G.responseText,q=H.indexOf("/*"),ce=H.lastIndexOf("*/");if(q==-1||ce==-1)throw new Error("JSON was not comment filtered");return g.fromJson(H.substring(q+2,ce))},javascript:function(G){return f.eval(G.responseText)},xml:function(G){var H=G.responseXML;if(H&&N("dom-qsa2.1")&&!H.querySelectorAll&&N("dom-parser")&&(H=new DOMParser().parseFromString(G.responseText,"application/xml")),N("ie")&&(!H||!H.documentElement)){var q=function(Q){return"MSXML"+Q+".DOMDocument"},ce=["Microsoft.XMLDOM",q(6),q(4),q(3),q(2)];y.some(ce,function(Q){try{var ne=new ActiveXObject(Q);ne.async=!1,ne.loadXML(G.responseText),H=ne}catch(he){return!1}return!0})}return H},"json-comment-optional":function(G){return G.responseText&&/^[^{\[]*\/\*/.test(G.responseText)?z["json-comment-filtered"](G):z.json(G)}};f._ioSetArgs=function(G,H,q,ce){var Q={args:G,url:G.url},ne=null;if(G.form){var he=r.byId(G.form),ve=he.getAttributeNode("action");Q.url=Q.url||(ve?ve.value:f.doc?f.doc.URL:null),ne=o.toObject(he)}var Ie={};ne&&m.mixin(Ie,ne),G.content&&m.mixin(Ie,G.content),G.preventCache&&(Ie["dojo.preventCache"]=new Date().valueOf()),Q.query=h.objectToQuery(Ie),Q.handleAs=G.handleAs||"text";var fe=new c(function(je){je.canceled=!0,H&&H(je);var ot=je.ioArgs.error;return ot||(ot=new Error("request cancelled"),ot.dojoType="cancel",je.ioArgs.error=ot),ot});fe.addCallback(q);var Me=G.load;Me&&m.isFunction(Me)&&fe.addCallback(function(je){return Me.call(G,je,Q)});var Ke=G.error;Ke&&m.isFunction(Ke)&&fe.addErrback(function(je){return Ke.call(G,je,Q)});var Ye=G.handle;return Ye&&m.isFunction(Ye)&&fe.addBoth(function(je){return Ye.call(G,je,Q)}),fe.addErrback(function(je){return ce(je,fe)}),M.ioPublish&&f.publish&&Q.args.ioPublish!==!1&&(fe.addCallbacks(function(je){return f.publish("/dojo/io/load",[fe,je]),je},function(je){return f.publish("/dojo/io/error",[fe,je]),je}),fe.addBoth(function(je){return f.publish("/dojo/io/done",[fe,je]),je})),fe.ioArgs=Q,fe};var Y=function(G){var H=z[G.ioArgs.handleAs](G.ioArgs.xhr);return H===void 0?null:H},X=function(G,H){return H.ioArgs.args.failOk||console.error(G),G},S=function(G){F<=0&&(F=0,M.ioPublish&&f.publish&&(!G||G&&G.ioArgs.args.ioPublish!==!1)&&f.publish("/dojo/io/stop"))},F=0;w.after(C,"_onAction",function(){F-=1}),w.after(C,"_onInFlight",S),f._ioCancelAll=C.cancelAll,f._ioNotifyStart=function(G){M.ioPublish&&f.publish&&G.ioArgs.args.ioPublish!==!1&&(F||f.publish("/dojo/io/start"),F+=1,f.publish("/dojo/io/send",[G]))},f._ioWatch=function(G,H,q,ce){var Q=G.ioArgs.options=G.ioArgs.args;m.mixin(G,{response:G.ioArgs,isValid:function(ne){return H(G)},isReady:function(ne){return q(G)},handleResponse:function(ne){return ce(G)}}),C(G),S(G)};var k="application/x-www-form-urlencoded";return f._ioAddQueryToUrl=function(G){G.query.length&&(G.url+=(G.url.indexOf("?")==-1?"?":"&")+G.query,G.query=null)},f.xhr=function(G,H,q){var ce,Q=f._ioSetArgs(H,function(ve){ce&&ce.cancel()},Y,X),ne=Q.ioArgs;"postData"in H?ne.query=H.postData:"putData"in H?ne.query=H.putData:"rawBody"in H?ne.query=H.rawBody:(arguments.length>2&&!q||"POST|PUT".indexOf(G.toUpperCase())===-1)&&f._ioAddQueryToUrl(ne);var he={method:G,handleAs:"text",timeout:H.timeout,withCredentials:H.withCredentials,ioArgs:ne};typeof H.headers<"u"&&(he.headers=H.headers),typeof H.contentType<"u"&&(he.headers||(he.headers={}),he.headers["Content-Type"]=H.contentType),typeof ne.query<"u"&&(he.data=ne.query),typeof H.sync<"u"&&(he.sync=H.sync),f._ioNotifyStart(Q);try{ce=P(ne.url,he,!0)}catch(ve){return Q.cancel(),Q}return Q.ioArgs.xhr=ce.response.xhr,ce.then(function(){Q.resolve(Q)}).otherwise(function(ve){ne.error=ve,ve.response&&(ve.status=ve.response.status,ve.responseText=ve.response.text,ve.xhr=ve.response.xhr),Q.reject(ve)}),Q},f.xhrGet=function(G){return f.xhr("GET",G)},f.rawXhrPost=f.xhrPost=function(G){return f.xhr("POST",G,!0)},f.rawXhrPut=f.xhrPut=function(G){return f.xhr("PUT",G,!0)},f.xhrDelete=function(G){return f.xhr("DELETE",G)},f._isDocumentOk=function(G){return T.checkStatus(G.status)},f._getText=function(G){var H;return f.xhrGet({url:G,sync:!0,load:function(q){H=q}}),H},m.mixin(f.xhr,{_xhrObj:f._xhrObj,fieldToObject:o.fieldToObject,formToObject:o.toObject,objectToQuery:h.objectToQuery,formToQuery:o.toQuery,formToJson:o.toJson,queryToObject:h.queryToObject,contentHandlers:z,_ioSetArgs:f._ioSetArgs,_ioCancelAll:f._ioCancelAll,_ioNotifyStart:f._ioNotifyStart,_ioWatch:f._ioWatch,_ioAddQueryToUrl:f._ioAddQueryToUrl,_isDocumentOk:f._isDocumentOk,_getText:f._getText,get:f.xhrGet,post:f.xhrPost,put:f.xhrPut,del:f.xhrDelete}),f.xhr},R,W),R.exports=I},3660:(R,W,d)=>{var O,I;O=[],I=d.dj.d(O,function(){"use strict";var f;function N(c,u,g,m){var y=c[u],x=u=="around",w;if(x){var C=g(function(){return y.advice(this,arguments)});w={remove:function(){C&&(C=c=g=null)},advice:function(P,T){return C?C.apply(P,T):y.advice(P,T)}}}else w={remove:function(){if(w.advice){var P=w.previous,T=w.next;!T&&!P?delete c[u]:(P?P.next=T:c[u]=T,T&&(T.previous=P)),c=g=w.advice=null}},id:c.nextId++,advice:g,receiveArguments:m};if(y&&!x)if(u=="after"){for(;y.next&&(y=y.next););y.next=w,w.previous=y}else u=="before"&&(c[u]=w,w.next=y,y.previous=w);else c[u]=w;return w}function b(c){return function(u,g,m,y){var x=u[g],w;(!x||x.target!=u)&&(u[g]=w=function(){for(var P=w.nextId,T=arguments,M=w.before;M;)M.advice&&(T=M.advice.apply(this,T)||T),M=M.next;if(w.around)var z=w.around.advice(this,T);for(var Y=w.after;Y&&Y.id<P;){if(Y.advice)if(Y.receiveArguments){var X=Y.advice.apply(this,T);z=X===f?z:X}else z=Y.advice.call(this,z,T);Y=Y.next}return z},x&&(w.around={advice:function(P,T){return x.apply(P,T)}}),w.target=u,w.nextId=w.nextId||0);var C=N(w||x,c,m,y);return m=null,C}}var h=b("after"),r=b("before"),o=b("around");return{before:r,around:o,after:h}},R,W),R.exports=I},4348:(R,W,d)=>{var O,I;O=[W,d(3994),d(1873),d(3458),d(2442),d(1502)],I=d.dj.d(O,function(f,N,b,h,r,o){var c={innerHTML:1,textContent:1,className:1,htmlFor:N("ie")?1:0,value:1},u={classname:"class",htmlfor:"for",tabindex:"tabIndex",readonly:"readOnly"};function g(m,y){var x=m.getAttributeNode&&m.getAttributeNode(y);return!!x&&x.specified}f.has=function(y,x){var w=x.toLowerCase();return!!c[o.names[w]||x]||g(h.byId(y),u[w]||x)},f.get=function(y,x){y=h.byId(y);var w=x.toLowerCase(),C=o.names[w]||x,P=c[C],T=y[C];if(P&&typeof T<"u")return T;if(C=="textContent")return o.get(y,C);if(C!="href"&&(typeof T=="boolean"||b.isFunction(T)))return T;var M=u[w]||x;return g(y,M)?y.getAttribute(M):null},f.set=function(y,x,w){if(y=h.byId(y),arguments.length==2){for(var C in x)f.set(y,C,x[C]);return y}var P=x.toLowerCase(),T=o.names[P]||x,M=c[T];return T=="style"&&typeof w!="string"?(r.set(y,w),y):M||typeof w=="boolean"||b.isFunction(w)?o.set(y,x,w):(y.setAttribute(u[P]||x,w),y)},f.remove=function(y,x){h.byId(y).removeAttribute(u[x.toLowerCase()]||x)},f.getNodeProp=function(y,x){y=h.byId(y);var w=x.toLowerCase(),C=o.names[w]||x;if(C in y&&C!="href")return y[C];var P=u[w]||x;return g(y,P)?y.getAttribute(P):null}},R,W),R.exports=I},2490:(R,W,d)=>{var O,I;O=[W,d(9424),d(3994),d(8145),d(3458),d(4348)],I=d.dj.d(O,function(f,N,b,h,r,o){var c={option:["select"],tbody:["table"],thead:["table"],tfoot:["table"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","thead","tr"],legend:["fieldset"],caption:["table"],colgroup:["table"],col:["table","colgroup"],li:["ul"]},u=/<\s*([\w\:]+)/,g={},m=0,y="__"+N._scopeName+"ToDomId";for(var x in c)if(c.hasOwnProperty(x)){var w=c[x];w.pre=x=="option"?'<select multiple="multiple">':"<"+w.join("><")+">",w.post="</"+w.reverse().join("></")+">"}var C;b("ie")<=8&&(C=function(S){S.__dojo_html5_tested="yes";var F=M("div",{innerHTML:"<nav>a</nav>",style:{visibility:"hidden"}},S.body);F.childNodes.length!==1&&"abbr article aside audio canvas details figcaption figure footer header hgroup mark meter nav output progress section summary time video".replace(/\b\w+\b/g,function(k){S.createElement(k)}),X(F)});function P(S,F){var k=F.parentNode;k&&k.insertBefore(S,F)}function T(S,F){var k=F.parentNode;k&&(k.lastChild==F?k.appendChild(S):k.insertBefore(S,F.nextSibling))}f.toDom=function(F,k){k=k||h.doc;var G=k[y];G||(k[y]=G=++m+"",g[G]=k.createElement("div")),b("ie")<=8&&!k.__dojo_html5_tested&&k.body&&C(k),F+="";var H=F.match(u),q=H?H[1].toLowerCase():"",ce=g[G],Q,ne,he,ve;if(H&&c[q])for(Q=c[q],ce.innerHTML=Q.pre+F+Q.post,ne=Q.length;ne;--ne)ce=ce.firstChild;else ce.innerHTML=F;if(ce.childNodes.length==1)return ce.removeChild(ce.firstChild);for(ve=k.createDocumentFragment();he=ce.firstChild;)ve.appendChild(he);return ve},f.place=function(F,k,G){if(k=r.byId(k),typeof F=="string"&&(F=/^\s*</.test(F)?f.toDom(F,k.ownerDocument):r.byId(F)),typeof G=="number"){var H=k.childNodes;!H.length||H.length<=G?k.appendChild(F):P(F,H[G<0?0:G])}else switch(G){case"before":P(F,k);break;case"after":T(F,k);break;case"replace":k.parentNode.replaceChild(F,k);break;case"only":f.empty(k),k.appendChild(F);break;case"first":if(k.firstChild){P(F,k.firstChild);break}default:k.appendChild(F)}return F};var M=f.create=function(F,k,G,H){var q=h.doc;return G&&(G=r.byId(G),q=G.ownerDocument),typeof F=="string"&&(F=q.createElement(F)),k&&o.set(F,k),G&&f.place(F,G,H),F};function z(S){if("innerHTML"in S)try{S.innerHTML="";return}catch(k){}for(var F;F=S.lastChild;)S.removeChild(F)}f.empty=function(F){z(r.byId(F))};function Y(S,F){S.firstChild&&z(S),F&&(b("ie")&&F.canHaveChildren&&"removeNode"in S?S.removeNode(!1):F.removeChild(S))}var X=f.destroy=function(F){F=r.byId(F),F&&Y(F,F.parentNode)}},R,W),R.exports=I},2693:(R,W,d)=>{var O,I;O=[d(1873),d(3458),d(7841),d(2570)],I=d.dj.d(O,function(f,N,b,h){function r(u,g,m){if(m!==null){var y=u[g];typeof y=="string"?u[g]=[y,m]:f.isArray(y)?y.push(m):u[g]=m}}var o="file|submit|image|reset|button",c={fieldToObject:function(g){var m=null;if(g=N.byId(g),g){var y=g.name,x=(g.type||"").toLowerCase();if(y&&x&&!g.disabled)if(x=="radio"||x=="checkbox")g.checked&&(m=g.value);else if(g.multiple){m=[];for(var w=[g.firstChild];w.length;)for(var C=w.pop();C;C=C.nextSibling)if(C.nodeType==1&&C.tagName.toLowerCase()=="option")C.selected&&m.push(C.value);else{C.nextSibling&&w.push(C.nextSibling),C.firstChild&&w.push(C.firstChild);break}}else m=g.value}return m},toObject:function(g){for(var m={},y=N.byId(g).elements,x=0,w=y.length;x<w;++x){var C=y[x],P=C.name,T=(C.type||"").toLowerCase();P&&T&&o.indexOf(T)<0&&!C.disabled&&(r(m,P,c.fieldToObject(C)),T=="image"&&(m[P+".x"]=m[P+".y"]=m[P].x=m[P].y=0))}return m},toQuery:function(g){return b.objectToQuery(c.toObject(g))},toJson:function(g,m){return h.stringify(c.toObject(g),null,m?4:0)}};return c},R,W),R.exports=I},8771:(R,W,d)=>{var O,I;O=[d(3994),d(8145),d(3458),d(2442)],I=d.dj.d(O,function(f,N,b,h){var r={};r.boxModel="content-box",f("ie")&&(r.boxModel=document.compatMode=="BackCompat"?"border-box":"content-box"),r.getPadExtents=function(w,C){w=b.byId(w);var P=C||h.getComputedStyle(w),T=h.toPixelValue,M=T(w,P.paddingLeft),z=T(w,P.paddingTop),Y=T(w,P.paddingRight),X=T(w,P.paddingBottom);return{l:M,t:z,r:Y,b:X,w:M+Y,h:z+X}};var o="none";r.getBorderExtents=function(w,C){w=b.byId(w);var P=h.toPixelValue,T=C||h.getComputedStyle(w),M=T.borderLeftStyle!=o?P(w,T.borderLeftWidth):0,z=T.borderTopStyle!=o?P(w,T.borderTopWidth):0,Y=T.borderRightStyle!=o?P(w,T.borderRightWidth):0,X=T.borderBottomStyle!=o?P(w,T.borderBottomWidth):0;return{l:M,t:z,r:Y,b:X,w:M+Y,h:z+X}},r.getPadBorderExtents=function(w,C){w=b.byId(w);var P=C||h.getComputedStyle(w),T=r.getPadExtents(w,P),M=r.getBorderExtents(w,P);return{l:T.l+M.l,t:T.t+M.t,r:T.r+M.r,b:T.b+M.b,w:T.w+M.w,h:T.h+M.h}},r.getMarginExtents=function(w,C){w=b.byId(w);var P=C||h.getComputedStyle(w),T=h.toPixelValue,M=T(w,P.marginLeft),z=T(w,P.marginTop),Y=T(w,P.marginRight),X=T(w,P.marginBottom);return{l:M,t:z,r:Y,b:X,w:M+Y,h:z+X}},r.getMarginBox=function(w,C){w=b.byId(w);var P=C||h.getComputedStyle(w),T=r.getMarginExtents(w,P),M=w.offsetLeft-T.l,z=w.offsetTop-T.t,Y=w.parentNode,X=h.toPixelValue,S;if(f("mozilla")){var F=parseFloat(P.left),k=parseFloat(P.top);!isNaN(F)&&!isNaN(k)?(M=F,z=k):Y&&Y.style&&(S=h.getComputedStyle(Y),S.overflow!="visible"&&(M+=S.borderLeftStyle!=o?X(w,S.borderLeftWidth):0,z+=S.borderTopStyle!=o?X(w,S.borderTopWidth):0))}else(f("opera")||f("ie")==8&&!f("quirks"))&&Y&&(S=h.getComputedStyle(Y),M-=S.borderLeftStyle!=o?X(w,S.borderLeftWidth):0,z-=S.borderTopStyle!=o?X(w,S.borderTopWidth):0);return{l:M,t:z,w:w.offsetWidth+T.w,h:w.offsetHeight+T.h}},r.getContentBox=function(w,C){w=b.byId(w);var P=C||h.getComputedStyle(w),T=w.clientWidth,M,z=r.getPadExtents(w,P),Y=r.getBorderExtents(w,P);return T?(M=w.clientHeight,Y.w=Y.h=0):(T=w.offsetWidth,M=w.offsetHeight),f("opera")&&(z.l+=Y.l,z.t+=Y.t),{l:z.l,t:z.t,w:T-z.w-Y.w,h:M-z.h-Y.h}};function c(x,w,C,P,T,M){M=M||"px";var z=x.style;isNaN(w)||(z.left=w+M),isNaN(C)||(z.top=C+M),P>=0&&(z.width=P+M),T>=0&&(z.height=T+M)}function u(x){return x.tagName.toLowerCase()=="button"||x.tagName.toLowerCase()=="input"&&(x.getAttribute("type")||"").toLowerCase()=="button"}function g(x){return r.boxModel=="border-box"||x.tagName.toLowerCase()=="table"||u(x)}function m(x){var w={x:0,y:0,width:0,height:0,top:0,right:0,bottom:0,left:0},C;try{C=x.getBoundingClientRect()}catch(P){return w}return typeof C.left>"u"?w:C}r.setContentSize=function(w,C,P){w=b.byId(w);var T=C.w,M=C.h;if(g(w)){var z=r.getPadBorderExtents(w,P);T>=0&&(T+=z.w),M>=0&&(M+=z.h)}c(w,NaN,NaN,T,M)};var y={l:0,t:0,w:0,h:0};return r.setMarginBox=function(w,C,P){w=b.byId(w);var T=P||h.getComputedStyle(w),M=C.w,z=C.h,Y=g(w)?y:r.getPadBorderExtents(w,T),X=r.getMarginExtents(w,T);if(f("webkit")&&u(w)){var S=w.style;M>=0&&!S.width&&(S.width="4px"),z>=0&&!S.height&&(S.height="4px")}M>=0&&(M=Math.max(M-Y.w-X.w,0)),z>=0&&(z=Math.max(z-Y.h-X.h,0)),c(w,C.l,C.t,M,z)},r.isBodyLtr=function(w){return w=w||N.doc,(N.body(w).dir||w.documentElement.dir||"ltr").toLowerCase()=="ltr"},r.docScroll=function(w){w=w||N.doc;var C=w.parentWindow||w.defaultView;return"pageXOffset"in C?{x:C.pageXOffset,y:C.pageYOffset}:(C=f("quirks")?N.body(w):w.documentElement)&&{x:r.fixIeBiDiScrollLeft(C.scrollLeft||0,w),y:C.scrollTop||0}},r.getIeDocumentElementOffset=function(x){return{x:0,y:0}},r.fixIeBiDiScrollLeft=function(w,C){C=C||N.doc;var P=f("ie");if(P&&!r.isBodyLtr(C)){var T=f("quirks"),M=T?N.body(C):C.documentElement,z=N.global;return P==6&&!T&&z.frameElement&&M.scrollHeight>M.clientHeight&&(w+=M.clientLeft),P<8||T?w+M.clientWidth-M.scrollWidth:-w}return w},r.position=function(x,w){x=b.byId(x);var C=N.body(x.ownerDocument),P=m(x);if(P={x:P.left,y:P.top,w:P.right-P.left,h:P.bottom-P.top},f("ie")<9&&(P.x-=f("quirks")?C.clientLeft+C.offsetLeft:0,P.y-=f("quirks")?C.clientTop+C.offsetTop:0),w){var T=r.docScroll(x.ownerDocument);P.x+=T.x,P.y+=T.y}return P},r.getMarginSize=function(w,C){w=b.byId(w);var P=r.getMarginExtents(w,C||h.getComputedStyle(w)),T=m(w);return{w:T.right-T.left+P.w,h:T.bottom-T.top+P.h}},r.normalizeEvent=function(x){if("layerX"in x||(x.layerX=x.offsetX,x.layerY=x.offsetY),!("pageX"in x)){var w=x.target,C=w&&w.ownerDocument||document,P=f("quirks")?C.body:C.documentElement;x.pageX=x.clientX+r.fixIeBiDiScrollLeft(P.scrollLeft||0,C),x.pageY=x.clientY+(P.scrollTop||0)}},r},R,W),R.exports=I},1502:(R,W,d)=>{var O,I;O=[W,d(9424),d(3994),d(1873),d(3458),d(2442),d(2490),d(5135)],I=d.dj.d(O,function(f,N,b,h,r,o,c,u){var g={},m=1,y=N._scopeName+"attrid";b.add("dom-textContent",function(w,C,P){return"textContent"in P}),f.names={class:"className",for:"htmlFor",tabindex:"tabIndex",readonly:"readOnly",colspan:"colSpan",frameborder:"frameBorder",rowspan:"rowSpan",textcontent:"textContent",valuetype:"valueType"};function x(w){for(var C="",P=w.childNodes,T=0,M;M=P[T];T++)M.nodeType!=8&&(M.nodeType==1?C+=x(M):C+=M.nodeValue);return C}f.get=function(C,P){C=r.byId(C);var T=P.toLowerCase(),M=f.names[T]||P;return M=="textContent"&&!b("dom-textContent")?x(C):C[M]},f.set=function(C,P,T){C=r.byId(C);var M=arguments.length;if(M==2&&typeof P!="string"){for(var z in P)f.set(C,z,P[z]);return C}var Y=P.toLowerCase(),X=f.names[Y]||P;if(X=="style"&&typeof T!="string")return o.set(C,T),C;if(X=="innerHTML")return b("ie")&&C.tagName.toLowerCase()in{col:1,colgroup:1,table:1,tbody:1,tfoot:1,thead:1,tr:1,title:1}?(c.empty(C),C.appendChild(c.toDom(T,C.ownerDocument))):C[X]=T,C;if(X=="textContent"&&!b("dom-textContent"))return c.empty(C),C.appendChild(C.ownerDocument.createTextNode(T)),C;if(h.isFunction(T)){var S=C[y];S||(S=m++,C[y]=S),g[S]||(g[S]={});var F=g[S][X];if(F)u.disconnect(F);else try{delete C[X]}catch(k){}return T?g[S][X]=u.connect(C,X,T):C[X]=null,C}return C[X]=T,C}},R,W),R.exports=I},2442:(R,W,d)=>{var O,I;O=[d(3994),d(3458),d(8145)],I=d.dj.d(O,function(f,N,b){var h,r={};f("webkit")?h=function(P){var T;if(P.nodeType==1){var M=P.ownerDocument.defaultView;T=M.getComputedStyle(P,null),!T&&P.style&&(P.style.display="",T=M.getComputedStyle(P,null))}return T||{}}:f("ie")&&(f("ie")<9||f("quirks"))?h=function(P){return P.nodeType==1&&P.currentStyle?P.currentStyle:{}}:h=function(P){if(P.nodeType===1){var T=P.ownerDocument.defaultView,M=T.opener?T:b.global.window;return M.getComputedStyle(P,null)||{}}return{}},r.getComputedStyle=h;var o;f("ie")?o=function(P,T){if(!T)return 0;if(T=="medium")return 4;if(T.slice&&T.slice(-2)=="px")return parseFloat(T);var M=P.style,z=P.runtimeStyle,Y=P.currentStyle,X=M.left,S=z.left;z.left=Y.left;try{M.left=T,T=M.pixelLeft}catch(F){T=0}return M.left=X,z.left=S,T}:o=function(P,T){return parseFloat(T)||0},r.toPixelValue=o;var c="DXImageTransform.Microsoft.Alpha",u=function(P,T){try{return P.filters.item(c)}catch(M){return T?{}:null}},g=f("ie")<9||f("ie")<10&&f("quirks")?function(P){try{return u(P).Opacity/100}catch(T){return 1}}:function(P){return h(P).opacity},m=f("ie")<9||f("ie")<10&&f("quirks")?function(P,T){T===""&&(T=1);var M=T*100,z=T===1;if(z?(P.style.zoom="",u(P)&&(P.style.filter=P.style.filter.replace(new RegExp("\\s*progid:"+c+"\\([^\\)]+?\\)","i"),""))):(P.style.zoom=1,u(P)?u(P,1).Opacity=M:P.style.filter+=" progid:"+c+"(Opacity="+M+")",u(P,1).Enabled=!0),P.tagName.toLowerCase()=="tr")for(var Y=P.firstChild;Y;Y=Y.nextSibling)Y.tagName.toLowerCase()=="td"&&m(Y,T);return T}:function(P,T){return P.style.opacity=T},y={left:!0,top:!0},x=/margin|padding|width|height|max|min|offset/;function w(P,T,M){if(T=T.toLowerCase(),M=="auto"){if(T=="height")return P.offsetHeight;if(T=="width")return P.offsetWidth}if(T=="fontweight")switch(M){case 700:return"bold";case 400:default:return"normal"}return T in y||(y[T]=x.test(T)),y[T]?o(P,M):M}var C={cssFloat:1,styleFloat:1,float:1};return r.get=function(T,M){var z=N.byId(T),Y=arguments.length,X=M=="opacity";if(Y==2&&X)return g(z);M=C[M]?"cssFloat"in z.style?"cssFloat":"styleFloat":M;var S=r.getComputedStyle(z);return Y==1?S:w(z,M,S[M]||z.style[M])},r.set=function(T,M,z){var Y=N.byId(T),X=arguments.length,S=M=="opacity";if(M=C[M]?"cssFloat"in Y.style?"cssFloat":"styleFloat":M,X==3)return S?m(Y,z):Y.style[M]=z;for(var F in M)r.set(T,F,M[F]);return r.getComputedStyle(Y)},r},R,W),R.exports=I},3458:(R,W,d)=>{var O,I;O=[d(3994),d(8145),d(9424)],I=d.dj.d(O,function(f,N,b){if(f("ie")<=7)try{document.execCommand("BackgroundImageCache",!1,!0)}catch(c){}var h={};f("ie")?h.byId=function(c,u){if(typeof c!="string")return c||null;var g=u||N.doc,m=c&&g.getElementById(c);if(m&&(m.attributes.id.value==c||m.id==c))return m;var y=g.all[c];(!y||y.nodeName)&&(y=[y]);for(var x=0;m=y[x++];)if(m.attributes&&m.attributes.id&&m.attributes.id.value==c||m.id==c)return m;return null}:h.byId=function(c,u){return(typeof c=="string"?(u||N.doc).getElementById(c):c)||null};var r=b.global.document||null;f.add("dom-contains",!!(r&&r.contains)),h.isDescendant=function(c,u){try{for(c=h.byId(c),u=h.byId(u);c;){if(c==u)return!0;c=c.parentNode}}catch(g){}return!1},f.add("css-user-select",function(c,u,g){if(!g)return!1;var m=g.style,y=["Khtml","O","Moz","Webkit"],x=y.length,w="userSelect",C;do if(typeof m[w]<"u")return w;while(x--&&(w=y[x]+"UserSelect"));return!1});var o=f("css-user-select");return h.setSelectable=o?function(c,u){h.byId(c).style[o]=u?"":"none"}:function(c,u){c=h.byId(c);var g=c.getElementsByTagName("*"),m=g.length;if(u)for(c.removeAttribute("unselectable");m--;)g[m].removeAttribute("unselectable");else for(c.setAttribute("unselectable","on");m--;)g[m].setAttribute("unselectable","on")},h},R,W),R.exports=I},7207:(R,W,d)=>{var O,I;O=[d(8455),d(9178)],I=d.dj.d(O,function(f,N){var b=document,h={loaded:1,complete:1},r=typeof b.readyState!="string",o=!!h[b.readyState],c=[],u;function g(T){c.push(T),o&&m()}g.load=function(T,M,z){g(z)},g._Q=c,g._onQEmpty=function(){},r&&(b.readyState="loading");function m(){if(!u){for(u=!0;c.length;)try{c.shift()(b)}catch(T){console.error(T,"in domReady callback",T.stack)}u=!1,g._onQEmpty()}}if(!o){var y=[],x=function(T){T=T||f.event,!(o||T.type=="readystatechange"&&!h[b.readyState])&&(r&&(b.readyState="complete"),o=1,m())},w=function(T,M){T.addEventListener(M,x,!1),c.push(function(){T.removeEventListener(M,x,!1)})};if(!N("dom-addeventlistener")){w=function(T,M){M="on"+M,T.attachEvent(M,x),c.push(function(){T.detachEvent(M,x)})};var C=b.createElement("div");try{C.doScroll&&f.frameElement===null&&y.push(function(){try{return C.doScroll("left"),1}catch(T){}})}catch(T){}}if(w(b,"DOMContentLoaded"),w(f,"load"),"onreadystatechange"in b?w(b,"readystatechange"):r||y.push(function(){return h[b.readyState]}),y.length){var P=function(){if(!o){for(var T=y.length;T--;)if(y[T]()){x("poller");return}setTimeout(P,30)}};P()}}return g},R,W),R.exports=I},7800:(R,W,d)=>{var O,I;O=[d(5062)],I=d.dj.d(O,function(f){return f("CancelError",null,null,{dojoType:"cancel",log:!1})},R,W),R.exports=I},5867:(R,W,d)=>{var O,I;O=[d(5062)],I=d.dj.d(O,function(f){return f("RequestError",function(N,b){this.response=b})},R,W),R.exports=I},6930:(R,W,d)=>{var O,I;O=[d(5062),d(5867)],I=d.dj.d(O,function(f,N){return f("RequestTimeoutError",null,N,{dojoType:"timeout"})},R,W),R.exports=I},5062:(R,W,d)=>{var O,I;O=[d(1873)],I=d.dj.d(O,function(f){return function(N,b,h,r){h=h||Error;var o=function(c){if(h===Error){Error.captureStackTrace&&Error.captureStackTrace(this,o);var u=Error.call(this,c),g;for(g in u)u.hasOwnProperty(g)&&(this[g]=u[g]);this.message=c,this.stack=u.stack}else h.apply(this,arguments);b&&b.apply(this,arguments)};return o.prototype=f.delegate(h.prototype,r),o.prototype.name=N,o.prototype.constructor=o,o}},R,W),R.exports=I},8455:(R,W,d)=>{var O;O=function(){return function(){return typeof global<"u"&&typeof global!="function"?global:typeof window<"u"?window:typeof self<"u"?self:this}()}.call(null,d,W,R),O!==void 0&&(R.exports=O)},9178:(R,W,d)=>{var O,I;O=[d(8455),d.dj.c(R),d.dj.m(R)],I=d.dj.d(O,function(f,N,b){var h=N.has||function(){};if(!h("dojo-has-api")){var r=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location==location&&window.document==document,o=r&&document,c=o&&o.createElement("DiV"),u=b.config&&b.config()||{};h=function(m){return typeof u[m]=="function"?u[m]=u[m](f,o,c):u[m]},h.cache=u,h.add=function(m,y,x,w){return(typeof u[m]>"u"||w)&&(u[m]=y),x&&h(m)},h.add("host-browser",r),h.add("host-node",typeof process=="object"&&process.versions&&process.versions.node&&process.versions.v8),h.add("host-rhino",typeof load=="function"&&(typeof Packages=="function"||typeof Packages=="object")),h.add("dom",r),h.add("dojo-dom-ready-api",1),h.add("dojo-sniff",1)}if(h("host-browser")){h.add("dom-addeventlistener",!!document.addEventListener),h.add("touch","ontouchstart"in document||"onpointerdown"in document&&navigator.maxTouchPoints>0||window.navigator.msMaxTouchPoints),h.add("touch-events","ontouchstart"in document),h.add("pointer-events","pointerEnabled"in window.navigator?window.navigator.pointerEnabled:"PointerEvent"in window),h.add("MSPointer",window.navigator.msPointerEnabled),h.add("touch-action",h("touch")&&h("pointer-events")),h.add("device-width",screen.availWidth||innerWidth);var g=document.createElement("form");h.add("dom-attributes-explicit",g.attributes.length==0),h.add("dom-attributes-specified-flag",g.attributes.length>0&&g.attributes.length<40)}return h.clearElement=function(m){return m.innerHTML="",m},h.normalize=function(m,y){var x=m.match(/[\?:]|[^:\?]*/g),w=0,C=function(P){var T=x[w++];return T==":"?0:x[w++]=="?"?!P&&h(T)?C():(C(!0),C(P)):T||0};return m=C(),m&&y(m)},h.load=function(m,y,x){m?y([m],x):x()},h},R,W),R.exports=I},7841:(R,W,d)=>{var O,I;O=[d(1873)],I=d.dj.d(O,function(f){var N={};return{objectToQuery:function(h){var r=encodeURIComponent,o=[];for(var c in h){var u=h[c];if(u!=N[c]){var g=r(c)+"=";if(f.isArray(u))for(var m=0,y=u.length;m<y;++m)o.push(g+r(u[m]));else o.push(g+r(u))}}return o.join("&")},queryToObject:function(h){for(var r=decodeURIComponent,o=h.split("&"),c={},u,g,m=0,y=o.length,x;m<y;++m)if(x=o[m],x.length){var w=x.indexOf("=");w<0?(u=r(x),g=""):(u=r(x.slice(0,w)),g=r(x.slice(w+1))),typeof c[u]=="string"&&(c[u]=[c[u]]),f.isArray(c[u])?c[u].push(g):c[u]=g}return c}}},R,W),R.exports=I},2570:(R,W,d)=>{var O,I;O=[d(9178)],I=d.dj.d(O,function(f){"use strict";var N=typeof JSON<"u";return f.add("json-parse",N),f.add("json-stringify",N&&JSON.stringify({a:0},function(b,h){return h||1})=='{"a":1}'),JSON},R,W),R.exports=I},3720:(R,W,d)=>{var O,I;O=[d(9424),d(3994)],I=d.dj.d(O,function(f,N){return f.keys={BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,META:N("webkit")?91:224,PAUSE:19,CAPS_LOCK:20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,HELP:47,LEFT_WINDOW:91,RIGHT_WINDOW:92,SELECT:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_MULTIPLY:106,NUMPAD_PLUS:107,NUMPAD_ENTER:108,NUMPAD_MINUS:109,NUMPAD_PERIOD:110,NUMPAD_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,NUM_LOCK:144,SCROLL_LOCK:145,UP_DPAD:175,DOWN_DPAD:176,LEFT_DPAD:177,RIGHT_DPAD:178,copyKey:N("mac")&&!N("air")?N("safari")?91:224:17}},R,W),R.exports=I},4905:(R,W,d)=>{var O,I;O=[d(9424),d(1929),d(9178),d(3458),d(8145)],I=d.dj.d(O,function(f,N,b,h,r){b.add("dom-quirks",r.doc&&r.doc.compatMode=="BackCompat"),b.add("events-mouseenter",r.doc&&"onmouseenter"in r.doc.createElement("div")),b.add("events-mousewheel",r.doc&&"onmousewheel"in r.doc);var o;b("dom-quirks")&&b("ie")||!b("dom-addeventlistener")?o={LEFT:1,MIDDLE:4,RIGHT:2,isButton:function(g,m){return g.button&m},isLeft:function(g){return g.button&1},isMiddle:function(g){return g.button&4},isRight:function(g){return g.button&2}}:o={LEFT:0,MIDDLE:1,RIGHT:2,isButton:function(g,m){return g.button==m},isLeft:function(g){return g.button==0},isMiddle:function(g){return g.button==1},isRight:function(g){return g.button==2}},f.mouseButtons=o;function c(g,m){var y=function(x,w){return N(x,g,function(C){if(m)return m(C,w);if(!h.isDescendant(C.relatedTarget,x))return w.call(this,C)})};return y.bubble=function(x){return c(g,function(w,C){var P=x(w.target),T=w.relatedTarget;if(P&&P!=(T&&T.nodeType==1&&x(T)))return C.call(P,w)})},y}var u;return b("events-mousewheel")?u="mousewheel":u=function(g,m){return N(g,"DOMMouseScroll",function(y){y.wheelDelta=-y.detail,m.call(this,y)})},{_eventHandler:c,enter:c("mouseover"),leave:c("mouseout"),wheel:u,isLeft:o.isLeft,isMiddle:o.isMiddle,isRight:o.isRight}},R,W),R.exports=I},1929:(R,W,d)=>{var O,I;O=[d.dj.h("dom-addeventlistener?:3660"),d(9424),d(3994)],I=d.dj.d(O,function(f,N,b){"use strict";if(b("dom")){var h=window.ScriptEngineMajorVersion;b.add("jscript",h&&h()+ScriptEngineMinorVersion()/10),b.add("event-orientationchange",b("touch")&&!b("android")),b.add("event-stopimmediatepropagation",window.Event&&!!window.Event.prototype&&!!window.Event.prototype.stopImmediatePropagation),b.add("event-focusin",function(H,q,ce){return"onfocusin"in ce}),b("touch")&&b.add("touch-can-modify-event-delegate",function(){var H=function(){};H.prototype=document.createEvent("MouseEvents");try{var q=new H;return q.target=null,q.target===null}catch(ce){return!1}})}var r=function(H,q,ce,Q){return typeof H.on=="function"&&typeof q!="function"&&!H.nodeType?H.on(q,ce):r.parse(H,q,ce,c,Q,this)};r.pausable=function(H,q,ce,Q){var ne,he=r(H,q,function(){if(!ne)return ce.apply(this,arguments)},Q);return he.pause=function(){ne=!0},he.resume=function(){ne=!1},he},r.once=function(H,q,ce,Q){var ne=r(H,q,function(){return ne.remove(),ce.apply(this,arguments)});return ne},r.parse=function(H,q,ce,Q,ne,he){var ve;if(q.call)return q.call(he,H,ce);if(q instanceof Array?ve=q:q.indexOf(",")>-1&&(ve=q.split(/\s*,\s*/)),ve){for(var Ie=[],fe=0,Me;Me=ve[fe++];)Ie.push(r.parse(H,Me,ce,Q,ne,he));return Ie.remove=function(){for(var Ke=0;Ke<Ie.length;Ke++)Ie[Ke].remove()},Ie}return Q(H,q,ce,ne,he)};var o=/^touch/;function c(H,q,ce,Q,ne){var he=q.match(/(.*):(.*)/);if(he)return q=he[2],he=he[1],r.selector(he,q).call(ne,H,ce);if(b("touch")&&(o.test(q)&&(ce=G(ce)),!b("event-orientationchange")&&q=="orientationchange"&&(q="resize",H=window,ce=G(ce))),C&&(ce=C(ce)),H.addEventListener){var ve=q in x,Ie=ve?x[q]:q;return H.addEventListener(Ie,ce,ve),{remove:function(){H.removeEventListener(Ie,ce,ve)}}}if(q="on"+q,z&&H.attachEvent)return z(H,q,ce);throw new Error("Target must be an event emitter")}r.matches=function(H,q,ce,Q,ne){for(ne=ne&&typeof ne.matches=="function"?ne:N.query,Q=Q!==!1,H.nodeType!=1&&(H=H.parentNode);!ne.matches(H,q,ce);)if(H==ce||Q===!1||!(H=H.parentNode)||H.nodeType!=1)return!1;return H},r.selector=function(H,q,ce){return function(Q,ne){var he=typeof H=="function"?{matches:H}:this,ve=q.bubble;function Ie(fe){return r.matches(fe,H,Q,ce,he)}return ve?r(Q,ve(Ie),ne):r(Q,q,function(fe){var Me=Ie(fe.target);if(Me)return fe.selectorTarget=Me,ne.call(Me,fe)})}};function u(){this.cancelable=!1,this.defaultPrevented=!0}function g(){this.bubbles=!1}var m=[].slice,y=r.emit=function(H,q,ce){var Q=m.call(arguments,2),ne="on"+q;if("parentNode"in H){var he=Q[0]={};for(var ve in ce)he[ve]=ce[ve];he.preventDefault=u,he.stopPropagation=g,he.target=H,he.type=q,ce=he}do H[ne]&&H[ne].apply(H,Q);while(ce&&ce.bubbles&&(H=H.parentNode));return ce&&ce.cancelable&&ce},x=b("event-focusin")?{}:{focusin:"focus",focusout:"blur"};if(!b("event-stopimmediatepropagation"))var w=function(){this.immediatelyStopped=!0,this.modified=!0},C=function(H){return function(q){if(!q.immediatelyStopped)return q.stopImmediatePropagation=w,H.apply(this,arguments)}};if(b("dom-addeventlistener"))r.emit=function(H,q,ce){if(H.dispatchEvent&&document.createEvent){var Q=H.ownerDocument||document,ne=Q.createEvent("HTMLEvents");ne.initEvent(q,!!ce.bubbles,!!ce.cancelable);for(var he in ce)he in ne||(ne[he]=ce[he]);return H.dispatchEvent(ne)&&ne}return y.apply(r,arguments)};else{r._fixEvent=function(H,q){if(!H){var ce=q&&(q.ownerDocument||q.document||q).parentWindow||window;H=ce.event}if(!H)return H;try{P&&H.type==P.type&&H.srcElement==P.target&&(H=P)}catch(ne){}if(!H.target)switch(H.target=H.srcElement,H.currentTarget=q||H.srcElement,H.type=="mouseover"&&(H.relatedTarget=H.fromElement),H.type=="mouseout"&&(H.relatedTarget=H.toElement),H.stopPropagation||(H.stopPropagation=X,H.preventDefault=S),H.type){case"keypress":var Q="charCode"in H?H.charCode:H.keyCode;Q==10?(Q=0,H.keyCode=13):Q==13||Q==27?Q=0:Q==3&&(Q=99),H.charCode=Q,Y(H);break}return H};var P,T=function(H){this.handle=H};T.prototype.remove=function(){delete _dojoIEListeners_[this.handle]};var M=function(H){return function(q){q=r._fixEvent(q,this);var ce=H.call(this,q);return q.modified&&(P||setTimeout(function(){P=null}),P=q),ce}},z=function(H,q,ce){if(ce=M(ce),((H.ownerDocument?H.ownerDocument.parentWindow:H.parentWindow||H.window||window)!=top||b("jscript")<5.8)&&!b("config-_allow_leaks")){typeof _dojoIEListeners_>"u"&&(_dojoIEListeners_=[]);var Q=H[q];if(!Q||!Q.listeners){var ne=Q;Q=Function("event","var callee = arguments.callee; for(var i = 0; i<callee.listeners.length; i++){var listener = _dojoIEListeners_[callee.listeners[i]]; if(listener){listener.call(this,event);}}"),Q.listeners=[],H[q]=Q,Q.global=this,ne&&Q.listeners.push(_dojoIEListeners_.push(ne)-1)}var he;return Q.listeners.push(he=Q.global._dojoIEListeners_.push(ce)-1),new T(he)}return f.after(H,q,ce,!0)},Y=function(H){H.keyChar=H.charCode?String.fromCharCode(H.charCode):"",H.charOrCode=H.keyChar||H.keyCode},X=function(){this.cancelBubble=!0},S=r._preventDefault=function(){if(this.bubbledKeyCode=this.keyCode,this.ctrlKey)try{this.keyCode=0}catch(H){}this.defaultPrevented=!0,this.returnValue=!1,this.modified=!0}}if(b("touch"))var F=function(){},k=window.orientation,G=function(H){return function(q){var ce=q.corrected;if(!ce){var Q=q.type;try{delete q.type}catch(Ie){}if(q.type){if(b("touch-can-modify-event-delegate"))F.prototype=q,ce=new F;else{ce={};for(var ne in q)ce[ne]=q[ne]}ce.preventDefault=function(){q.preventDefault()},ce.stopPropagation=function(){q.stopPropagation()}}else ce=q,ce.type=Q;if(q.corrected=ce,Q=="resize")return k==window.orientation?null:(k=window.orientation,ce.type="orientationchange",H.call(this,ce));if("rotation"in ce||(ce.rotation=0,ce.scale=1),window.TouchEvent&&q instanceof TouchEvent){var he=ce.changedTouches[0];for(var ve in he)delete ce[ve],ce[ve]=he[ve]}}return H.call(this,ce)}};return r},R,W),R.exports=I},2749:(R,W,d)=>{var O,I;O=[d(1873)],I=d.dj.d(O,function(f){"use strict";function N(){throw new TypeError("abstract")}return f.extend(function(){},{then:function(b,h,r){N()},cancel:function(b,h){N()},isResolved:function(){N()},isRejected:function(){N()},isFulfilled:function(){N()},isCanceled:function(){N()},finally:function(b){return this.then(function(h){var r=b();return r&&typeof r.then=="function"?r.then(function(){return h}):h},function(h){var r=b();if(r&&typeof r.then=="function")return r.then(function(){throw h});throw h})},always:function(b){return this.then(b,b)},catch:function(b){return this.then(null,b)},otherwise:function(b){return this.then(null,b)},trace:function(){return this},traceRejected:function(){return this},toString:function(){return"[object Promise]"}})},R,W),R.exports=I},819:(R,W,d)=>{var O,I;O=[d(2570),d(9424),d(640),d(9178)],I=d.dj.d(O,function(f,N,b,h){h.add("activex",typeof ActiveXObject<"u"),h.add("dom-parser",function(g){return"DOMParser"in g});let r;if(h("activex")){const g=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML.DOMDocument"];let m;r=function(y){let x=y.data;const w=y.text;x&&!x.querySelectorAll&&h("dom-parser")&&(x=new DOMParser().parseFromString(w,"application/xml"));function C(P){try{const T=new ActiveXObject(P);T.async=!1,T.loadXML(w),x=T,m=P}catch(T){return!1}return!0}return(!x||!x.documentElement)&&(!m||!C(m))&&b.some(g,C),x}}const o=function(g){return!h("native-xhr2-blob")&&g.options.handleAs==="blob"&&typeof Blob<"u"?new Blob([g.xhr.response],{type:g.xhr.getResponseHeader("Content-Type")}):g.xhr.response},c={javascript:function(g){return N.eval(g.text||"")},json:function(g){return f.parse(g.text||null)},xml:r,blob:o,arraybuffer:o,document:o};function u(g){const m=c[g.options.handleAs];return g.data=m?m(g):g.data||g.text,g}return u.register=function(g,m){c[g]=m},u},R,W),R.exports=I},5665:(module,exports,__webpack_require__)=>{var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__.dj.m(module),__webpack_require__(1563),__webpack_require__(3638),__webpack_require__(9424),__webpack_require__(640),__webpack_require__(1873),__webpack_require__(1929),__webpack_require__(3458),__webpack_require__(2490),__webpack_require__(9178),__webpack_require__(8145)],__WEBPACK_AMD_DEFINE_RESULT__=__webpack_require__.dj.d(__WEBPACK_AMD_DEFINE_ARRAY__,function(module,watch,util,kernel,array,lang,on,dom,domConstruct,has,win){has.add("script-readystatechange",function(R,W){var d=W.createElement("script");return typeof d.onreadystatechange<"u"&&(typeof R.opera>"u"||R.opera.toString()!=="[object Opera]")});var mid=module.id.replace(/[\/\.\-]/g,"_"),counter=0,loadEvent=has("script-readystatechange")?"readystatechange":"load",readyRegExp=/complete|loaded/,callbacks=kernel.global[mid+"_callbacks"]={},deadScripts=[];function attach(R,W,d,O){var I=d||win.doc,f=I.createElement("script");O&&on.once(f,"error",O),f.type="text/javascript";try{f.src=W}catch(N){O&&O(f)}return f.id=R,f.async=!0,f.charset="utf-8",I.getElementsByTagName("head")[0].appendChild(f)}function remove(R,W,d){domConstruct.destroy(dom.byId(R,W)),callbacks[R]&&(d?callbacks[R]=function(){delete callbacks[R]}:delete callbacks[R])}function _addDeadScript(R){var W=R.response.options,d=W.ioArgs?W.ioArgs.frameDoc:W.frameDoc;deadScripts.push({id:R.id,frameDoc:d}),W.ioArgs&&(W.ioArgs.frameDoc=null),W.frameDoc=null}function canceler(R,W){R.canDelete&&script._remove(R.id,W.options.frameDoc,!0)}function isValid(R){return deadScripts&&deadScripts.length&&(array.forEach(deadScripts,function(W){script._remove(W.id,W.frameDoc),W.frameDoc=null}),deadScripts=[]),R.options.jsonp?!R.data:!0}function isReadyScript(R){return!!this.scriptLoaded}function isReadyCheckString(response){var checkString=response.options.checkString;return checkString&&eval("typeof("+checkString+') !== "undefined"')}function handleResponse(R,W){this.canDelete&&_addDeadScript(this),W?this.reject(W):this.resolve(R)}function script(R,W,d){var O=util.parseArgs(R,util.deepCopy({},W));R=O.url,W=O.options;var I=util.deferred(O,canceler,isValid,W.jsonp?null:W.checkString?isReadyCheckString:isReadyScript,handleResponse);if(lang.mixin(I,{id:mid+counter++,canDelete:!1}),W.jsonp){var f=new RegExp("[?&]"+W.jsonp+"=");f.test(R)||(R+=(~R.indexOf("?")?"&":"?")+W.jsonp+"="+(W.frameDoc?"parent.":"")+mid+"_callbacks."+I.id),I.canDelete=!0,callbacks[I.id]=function(h){O.data=h,I.handleResponse(O)}}if(util.notify&&util.notify.emit("send",O,I.promise.cancel),!W.canAttach||W.canAttach(I)){var N=script._attach(I.id,R,W.frameDoc,function(h){if(!(h instanceof Error)){var r=new Error("Error loading "+(h.target?h.target.src:"script"));r.source=h,h=r}I.reject(h),script._remove(I.id,W.frameDoc,!0)});if(!W.jsonp&&!W.checkString)var b=on(N,loadEvent,function(h){(h.type==="load"||readyRegExp.test(N.readyState))&&(b.remove(),I.scriptLoaded=h)})}return watch(I),d?I:I.promise}return script.get=script,script._attach=attach,script._remove=remove,script._callbacksProperty=mid+"_callbacks",script},module,exports),module.exports=__WEBPACK_AMD_DEFINE_RESULT__},3638:(R,W,d)=>{var O,I;O=[W,d(5867),d(7800),d(4371),d(7841),d(640),d(1873),d(2749),d(9178)],I=d.dj.d(O,function(f,N,b,h,r,o,c,u,g){function m(z){return g("native-arraybuffer")&&z instanceof ArrayBuffer}function y(z){return g("native-blob")&&z instanceof Blob}function x(z){return typeof Element<"u"?z instanceof Element:z.nodeType===1}function w(z){return g("native-formdata")&&z instanceof FormData}function C(z){return z&&typeof z=="object"&&!w(z)&&!x(z)&&!y(z)&&!m(z)}f.deepCopy=function(z,Y){for(var X in Y){var S=z[X],F=Y[X];X!=="__proto__"&&S!==F&&(C(F)?Object.prototype.toString.call(F)==="[object Date]"?z[X]=new Date(F):c.isArray(F)?z[X]=f.deepCopyArray(F):S&&typeof S=="object"?f.deepCopy(S,F):z[X]=f.deepCopy({},F):z[X]=F)}return z},f.deepCopyArray=function(z){for(var Y=[],X=0,S=z.length;X<S;X++){var F=z[X];typeof F=="object"?Y.push(f.deepCopy({},F)):Y.push(F)}return Y},f.deepCreate=function(Y,X){X=X||{};var S=c.delegate(Y),F,k;for(F in Y)k=Y[F],k&&typeof k=="object"&&(S[F]=f.deepCreate(k,X[F]));return f.deepCopy(S,X)};var P=Object.freeze||function(z){return z};function T(z){return P(z)}function M(z){return z.data!==void 0?z.data:z.text}f.deferred=function(Y,X,S,F,k,G){var H=new h(function(ve){return X&&X(H,Y),!ve||!(ve instanceof N)&&!(ve instanceof b)?new b("Request canceled",Y):ve});H.response=Y,H.isValid=S,H.isReady=F,H.handleResponse=k;function q(ve){throw ve.response=Y,ve}var ce=H.then(T).otherwise(q);f.notify&&ce.then(c.hitch(f.notify,"emit","load"),c.hitch(f.notify,"emit","error"));var Q=ce.then(M),ne=new u;for(var he in Q)Q.hasOwnProperty(he)&&(ne[he]=Q[he]);return ne.response=ce,P(ne),G&&H.then(function(ve){G.call(H,ve)},function(ve){G.call(H,Y,ve)}),H.promise=ne,H.then=ne.then,H},f.addCommonMethods=function(Y,X){o.forEach(X||["GET","POST","PUT","DELETE"],function(S){Y[(S==="DELETE"?"DEL":S).toLowerCase()]=function(F,k){return k=c.delegate(k||{}),k.method=S,Y(F,k)}})},f.parseArgs=function(Y,X,S){var F=X.data,k=X.query;return F&&!S&&typeof F=="object"&&(!g("native-xhr2")||!(m(F)||y(F)))&&(X.data=r.objectToQuery(F)),k?(typeof k=="object"&&(k=r.objectToQuery(k)),X.preventCache&&(k+=(k?"&":"")+"request.preventCache="+ +new Date)):X.preventCache&&(k="request.preventCache="+ +new Date),Y&&k&&(Y+=(~Y.indexOf("?")?"&":"?")+k),{url:Y,options:X,getHeader:function(G){return null}}},f.checkStatus=function(z){return z=z||0,z>=200&&z<300||z===304||z===1223||!z}},R,W),R.exports=I},1563:(R,W,d)=>{var O,I;O=[d(3638),d(6930),d(7800),d(640),d(8145)],I=d.dj.d(O,function(f,N,b,h,r){let o=null;const c=[];function u(){const m=+new Date;for(var y=0,x;y<c.length&&(x=c[y]);y++){const w=x.response,C=w.options;x.isCanceled&&x.isCanceled()||x.isValid&&!x.isValid(w)?(c.splice(y--,1),g._onAction&&g._onAction()):x.isReady&&x.isReady(w)?(c.splice(y--,1),x.handleResponse(w),g._onAction&&g._onAction()):x.startTime&&x.startTime+(C.timeout||0)<m&&(c.splice(y--,1),x.cancel(new N("Timeout exceeded",w)),g._onAction&&g._onAction())}g._onInFlight&&g._onInFlight(x),c.length||(clearInterval(o),o=null)}function g(m){m.response.options.timeout&&(m.startTime=+new Date),!m.isFulfilled()&&(c.push(m),o||(o=setInterval(u,50)),m.response.options.sync&&u())}return g.cancelAll=function(){try{h.forEach(c,function(y){try{y.cancel(new b("All requests canceled."))}catch(x){}})}catch(y){}},g},R,W),R.exports=I},9810:(R,W,d)=>{var O,I;O=[d(5867),d(1563),d(819),d(3638),d(9178)],I=d.dj.d(O,function(f,N,b,h,r){r.add("native-xhr",function(){return typeof XMLHttpRequest<"u"}),r.add("dojo-force-activex-xhr",function(){return r("activex")&&window.location.protocol==="file:"}),r.add("native-xhr2",function(){if(!(!r("native-xhr")||r("dojo-force-activex-xhr"))){var T=new XMLHttpRequest;return typeof T.addEventListener<"u"&&(typeof opera>"u"||typeof T.upload<"u")}}),r.add("native-formdata",function(){return typeof FormData<"u"}),r.add("native-blob",function(){return typeof Blob<"u"}),r.add("native-arraybuffer",function(){return typeof ArrayBuffer<"u"}),r.add("native-response-type",function(){return r("native-xhr")&&typeof new XMLHttpRequest().responseType<"u"}),r.add("native-xhr2-blob",function(){if(r("native-response-type"))return!0});var o={blob:r("native-xhr2-blob")?"blob":"arraybuffer",document:"document",arraybuffer:"arraybuffer"};function c(T,M){var z=T.xhr;T.status=T.xhr.status;try{T.text=z.responseText}catch(X){}T.options.handleAs==="xml"&&(T.data=z.responseXML);var Y;if(M)this.reject(M);else{try{b(T)}catch(X){Y=X}h.checkStatus(z.status)?Y?this.reject(Y):this.resolve(T):Y?(M=new f("Unable to load "+T.url+" status: "+z.status+" and an error in handleAs: transformation of response",T),this.reject(M)):(M=new f("Unable to load "+T.url+" status: "+z.status,T),this.reject(M))}}var u,g,m,y;r("native-xhr2")?(u=function(T){return!this.isFulfilled()},y=function(T,M){M.xhr.abort()},m=function(T,M,z,Y){function X(H){M.handleResponse(z)}function S(H){var q=H.target,ce=new f("Unable to load "+z.url+" status: "+q.status,z);M.handleResponse(z,ce)}function F(H,q){z.transferType=H,q.lengthComputable?(z.loaded=q.loaded,z.total=q.total,M.progress(z)):z.xhr.readyState===3&&(z.loaded="loaded"in q?q.loaded:q.position,M.progress(z))}function k(H){return F("download",H)}function G(H){return F("upload",H)}return T.addEventListener("load",X,!1),T.addEventListener("error",S,!1),T.addEventListener("progress",k,!1),Y&&T.upload&&T.upload.addEventListener("progress",G,!1),function(){T.removeEventListener("load",X,!1),T.removeEventListener("error",S,!1),T.removeEventListener("progress",k,!1),T.upload.removeEventListener("progress",G,!1),T=null}}):(u=function(T){return T.xhr.readyState},g=function(T){return T.xhr.readyState===4},y=function(T,M){var z=M.xhr,Y=typeof z.abort;(Y==="function"||Y==="object"||Y==="unknown")&&z.abort()});function x(T){return this.xhr.getResponseHeader(T)}var w,C={data:null,query:null,sync:!1,method:"GET"};function P(T,M,z){var Y=r("native-formdata")&&M&&M.data&&M.data instanceof FormData,X=h.parseArgs(T,h.deepCreate(C,M),Y);T=X.url,M=X.options;var S=!M.data&&M.method!=="POST"&&M.method!=="PUT";r("ie")<=10&&(T=T.split("#")[0]);var F,k=function(){F&&F()},G=h.deferred(X,y,u,g,c,k),H=X.xhr=P._create();if(!H)return G.cancel(new f("XHR was not created")),z?G:G.promise;X.getHeader=x,m&&(F=m(H,G,X,M.uploadProgress));var q=typeof M.data>"u"?null:M.data,ce=!M.sync,Q=M.method;try{H.open(Q,T,ce,M.user||w,M.password||w),M.withCredentials&&(H.withCredentials=M.withCredentials),r("native-response-type")&&M.handleAs in o&&(H.responseType=o[M.handleAs]);var ne=M.headers,he=Y||S?!1:"application/x-www-form-urlencoded";if(ne)for(var ve in ne)ve.toLowerCase()==="content-type"?he=ne[ve]:ne[ve]&&H.setRequestHeader(ve,ne[ve]);he&&he!==!1&&H.setRequestHeader("Content-Type",he),(!ne||!("X-Requested-With"in ne))&&H.setRequestHeader("X-Requested-With","XMLHttpRequest"),h.notify&&h.notify.emit("send",X,G.promise.cancel),H.send(q)}catch(Ie){G.reject(Ie)}return N(G),H=null,z?G:G.promise}if(P._create=function(){throw new Error("XMLHTTP not available")},r("native-xhr")&&!r("dojo-force-activex-xhr"))P._create=function(){return new XMLHttpRequest};else if(r("activex"))try{new ActiveXObject("Msxml2.XMLHTTP"),P._create=function(){return new ActiveXObject("Msxml2.XMLHTTP")}}catch(T){try{new ActiveXObject("Microsoft.XMLHTTP"),P._create=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}catch(M){}}return h.addCommonMethods(P),P},R,W),R.exports=I},3994:(R,W,d)=>{var O,I;O=[d(9178)],I=d.dj.d(O,function(f){if(f("host-browser")){var N=navigator,b=N.userAgent,h=N.appVersion,r=parseFloat(h);if(f.add("air",b.indexOf("AdobeAIR")>=0),f.add("wp",parseFloat(b.split("Windows Phone")[1])||void 0),f.add("msapp",parseFloat(b.split("MSAppHost/")[1])||void 0),f.add("khtml",h.indexOf("Konqueror")>=0?r:void 0),f.add("edge",parseFloat(b.split("Edge/")[1])||void 0),f.add("opr",parseFloat(b.split("OPR/")[1])||void 0),f.add("webkit",!f("wp")&&!f("edge")&&parseFloat(b.split("WebKit/")[1])||void 0),f.add("chrome",!f("edge")&&!f("opr")&&parseFloat(b.split("Chrome/")[1])||void 0),f.add("android",!f("wp")&&parseFloat(b.split("Android ")[1])||void 0),f.add("safari",h.indexOf("Safari")>=0&&!f("wp")&&!f("chrome")&&!f("android")&&!f("edge")&&!f("opr")?parseFloat(h.split("Version/")[1]):void 0),f.add("mac",h.indexOf("Macintosh")>=0),f.add("quirks",document.compatMode=="BackCompat"),!f("wp")&&b.match(/(iPhone|iPod|iPad)/)){var o=RegExp.$1.replace(/P/,"p"),c=b.match(/OS ([\d_]+)/)?RegExp.$1:"1",u=parseFloat(c.replace(/_/,".").replace(/_/g,""));f.add(o,u),f.add("ios",u)}if(f.add("bb",(b.indexOf("BlackBerry")>=0||b.indexOf("BB10")>=0)&&parseFloat(b.split("Version/")[1])||void 0),f.add("trident",parseFloat(h.split("Trident/")[1])||void 0),f.add("svg",typeof SVGAngle<"u"),!f("webkit")){if(b.indexOf("Opera")>=0&&f.add("opera",r>=9.8&&parseFloat(b.split("Version/")[1])||r),b.indexOf("Gecko")>=0&&!f("wp")&&!f("khtml")&&!f("trident")&&!f("edge")&&f.add("mozilla",r),f("mozilla")&&f.add("ff",parseFloat(b.split("Firefox/")[1]||b.split("Minefield/")[1])||void 0),document.all&&!f("opera")){var g=parseFloat(h.split("MSIE ")[1])||void 0,m=document.documentMode;m&&m!=5&&Math.floor(g)!=m&&(g=m),f.add("ie",g)}f.add("wii",typeof opera<"u"&&opera.wiiremote)}}return f},R,W),R.exports=I},7505:(R,W,d)=>{var O,I;O=[d(3543)],I=d.dj.d(O,function(f){var N=new f;return{publish:function(b,h){return N.emit.apply(N,arguments)},subscribe:function(b,h){return N.on.apply(N,arguments)}}},R,W),R.exports=I},1636:(R,W,d)=>{var O,I;O=[d(4371),d(2749)],I=d.dj.d(O,function(f,N){"use strict";return function(h,r,o,c){var u=h&&typeof h.then=="function",g=u&&h instanceof N;if(u){if(!g){var m=new f(h.cancel);h.then(m.resolve,m.reject,m.progress),h=m.promise}}else return arguments.length>1?r?r(h):h:new f().resolve(h);return r||o||c?h.then(r,o,c):h}},R,W),R.exports=I},4405:R=>{R.exports=function(W,d,O,I){this.loaderVersion="1.17.1",function(f,N){var b=function(){return typeof T<"u"&&typeof T!="function"?T:typeof I<"u"?this&&this.dojoConfig&&!I.dojoConfig?this:I:typeof self<"u"?self:this}(),h=function(){},r=function(Ne){for(var it in Ne)return 0;return 1},o={}.toString,c=function(Ne){return o.call(Ne)=="[object Function]"},u=function(Ne){return o.call(Ne)=="[object String]"},g=function(Ne){return o.call(Ne)=="[object Array]"},m=function(Ne,it){if(Ne)for(var Ge=0;Ge<Ne.length;)it(Ne[Ge++])},y=function(Ne,it){for(var Ge in it)Ne[Ge]=it[Ge];return Ne},x=function(Ne,it){return y(new Error(Ne),{src:"dojoLoader",info:it})},w=1,C=function(){return"_"+w++},P=function(Ne,it,Ge){return ui(Ne,it,Ge,0,P)},T=b,M=T.document,z=M&&M.createElement("DiV"),Y=P.has=function(Ne){return c(X[Ne])?X[Ne]=X[Ne](T,M,z):X[Ne]},X=Y.cache=N.hasCache;if(c(f)&&(f=f(b)),Y.add=function(Ne,it,Ge,vt){return(X[Ne]===void 0||vt)&&(X[Ne]=it),Ge&&Y(Ne)},0)var S,F,k,G;for(var H in f.has)Y.add(H,f.has[H],0,1);var q=1,ce=2,Q=3,ne=4,he=5,ve=0,Ie="sync",fe="xd",Me=[],Ke=0,Ye=h,je=h,ot;if(0)var $e,_t,G,Ut,qt;else P.async=1;var oi=function(){};P.eval=function(Ne,it){return oi(Ne+`\r
//# sourceURL=`+it)};var Nt={},Wn="error",_i=P.signal=function(Ne,it){var Ge=Nt[Ne];m(Ge&&Ge.slice(0),function(vt){vt.apply(null,g(it)?it:[it])})},Vn=P.on=function(Ne,it){var Ge=Nt[Ne]||(Nt[Ne]=[]);return Ge.push(it),{remove:function(){for(var vt=0;vt<Ge.length;vt++)if(Ge[vt]===it){Ge.splice(vt,1);return}}}},Gn=[],mr={},In=[],bt={},wn=P.map={},ji=[],un={},Wi="",Hn={},kr="url:",jr={},gi={},Be=0;if(0)var Vi;var bi=function(Ne){return Ne.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,function(it){return"\\"+it})},Kn=function(Ne,it){it.splice(0,it.length);for(var Ge in Ne)it.push([Ge,Ne[Ge],new RegExp("^"+bi(Ge)+"(/|$)"),Ge.length]);return it.sort(function(vt,$n){return $n[3]-vt[3]}),it},fs=function(Ne,it){m(Ne,function(Ge){it.push([u(Ge[0])?new RegExp("^"+bi(Ge[0])+"$"):Ge[0],Ge[1]])})},wi=function(Ne){var it=Ne.name;it||(it=Ne,Ne={name:it}),Ne=y({main:"main"},Ne),Ne.location=Ne.location?Ne.location:it,Ne.packageMap&&(wn[it]=Ne.packageMap),Ne.main.indexOf("./")||(Ne.main=Ne.main.substring(2)),bt[it]=Ne},Ct=[],en=function(Ne,it,Ge){for(var vt in Ne){if(vt=="waitSeconds"&&(P.waitms=(Ne[vt]||0)*1e3),vt=="cacheBust"&&(Wi=Ne[vt]?u(Ne[vt])?Ne[vt]:new Date().getTime()+"":""),(vt=="baseUrl"||vt=="combo")&&(P[vt]=Ne[vt]),0)var $n;Ne[vt]!==X&&(P.rawConfig[vt]=Ne[vt],vt!="has"&&Y.add("config-"+vt,Ne[vt],0,it))}P.baseUrl||(P.baseUrl="./"),/\/$/.test(P.baseUrl)||(P.baseUrl+="/");for(vt in Ne.has)Y.add(vt,Ne.has[vt],0,it);m(Ne.packages,wi);for(var Nn in Ne.packagePaths)m(Ne.packagePaths[Nn],function(Zt){var Fi=Nn+"/"+Zt;u(Zt)&&(Zt={name:Zt}),Zt.location=Fi,wi(Zt)});if(Kn(y(wn,Ne.map),ji),m(ji,function(Zt){Zt[1]=Kn(Zt[1],[]),Zt[0]=="*"&&(ji.star=Zt)}),Kn(y(mr,Ne.paths),In),fs(Ne.aliases,Gn),0)var Oi;_i("config",[Ne,P.rawConfig])};if(0)var Yn,G,dt,Ve,Gi,Vt;if(0)var Hi;if(P.rawConfig={},en(N,1),en(f,1),en(gi,1),0)var fa,ui,_r,Ft,tn,Xn,ni,te,qn,Wr,xi,Li;var li=function(Ne,it){if(it){for(var Ge=0;Ge<it.length;Ge++)if(it[Ge][2].test(Ne))return it[Ge]}return 0},Bn=function(Ne){var it=[],Ge,vt;for(Ne=Ne.replace(/\\/g,"/").split("/");Ne.length;)Ge=Ne.shift(),Ge==".."&&it.length&&vt!=".."?(it.pop(),vt=it[it.length-1]):Ge!="."&&it.push(vt=Ge);return it.join("/")},Ki=function(Ne,it,Ge,vt){if(0)var $n;else return{pid:Ne,mid:it,pack:Ge,url:vt,executed:0,def:0}},Yi=function(Ne,it,Ge,vt,$n,Nn,Oi,Zt,Fi,gs){var Ai,Xi,Fn,Ti,ln,Tn,er,Si;if(Si=Ne,er=/^\./.test(Ne),/(^\/)|(\:)|(\.js$)/.test(Ne)||er&&!it)return Ki(0,Ne,0,Ne);if(Ne=Bn(er?it.mid+"/../"+Ne:Ne),/^\./.test(Ne))throw x("irrationalPath",Ne);!gs&&!er&&Nn.star&&(Ti=li(Ne,Nn.star[1])),!Ti&&it&&(Ti=li(it.mid,Nn),Ti=Ti&&li(Ne,Ti[1])),Ti&&(Ne=Ti[1]+Ne.substring(Ti[3])),Vt=Ne.match(/^([^\/]+)(\/(.+))?$/),Ai=Vt?Vt[1]:"",(Xi=Ge[Ai])?Ne=Ai+"/"+(Fn=Vt[3]||Xi.main):Ai="";var Ro=0,Gt=0;return m(Zt,function(tr){var zi=Ne.match(tr[0]);zi&&zi.length>Ro&&(Gt=c(tr[1])?Ne.replace(tr[0],tr[1]):tr[1])}),Gt?Yi(Gt,0,Ge,vt,$n,Nn,Oi,Zt,Fi):(Tn=vt[Ne],Tn?Fi?Ki(Tn.pid,Tn.mid,Tn.pack,Tn.url):vt[Ne]:(Ti=li(Ne,Oi),Ti?ln=Ti[1]+Ne.substring(Ti[3]):Ai?ln=(Xi.location.slice(-1)==="/"?Xi.location.slice(0,-1):Xi.location)+"/"+Fn:ln=Ne,/(^\/)|(\:)/.test(ln)||(ln=$n+ln),ln+=".js",Ki(Ai,Ne,Xi,Bn(ln))))},dn=function(Ne,it,Ge){return Yi(Ne,it,bt,un,P.baseUrl,ji,In,Gn,void 0,Ge)};if(0)var pn,nn,fn;var Zn=P.toAbsMid=function(Ne,it){return dn(Ne,it).mid},gr=P.toUrl=function(Ne,it){var Ge=dn(Ne+"/x",it),vt=Ge.url;return Z(Ge.pid===0?Ne:vt.substring(0,vt.length-5))};if(0)var Qn,En,Vr,ms,mn,rn,vr,yr,_n,Jn,br,Gr,sn,ht,An,Pi;var Z=typeof f.fixupUrl=="function"?f.fixupUrl:function(Ne){return Ne+="",Ne+(Wi?(/\?/.test(Ne)?"&":"?")+Wi:"")};if(0)var me,xe,De,We,Je,lt,pt,Bt;var Di=0,Ri=h,an=h;if(0)var Yn,G,dt,Ei,_s;if(P.log=h,0)var Hr;else P.trace=h;if(0)var ma;else var ma=h;if(y(y(P,N.loaderPatch),f.loaderPatch),Vn(Wn,function(Ne){try{if(console.error(Ne),Ne instanceof Error){for(var it in Ne)console.log(it+":",Ne[it]);console.log(".")}}catch(Ge){}}),y(P,{uid:C,cache:Hn,packs:bt}),!T.define){if(T.define=ma,T.require=P,0)var Xl,Lo;if(0)var Po,Do}}.call(this,W,d)}},4323:R=>{R.exports=void 0},5880:(R,W,d)=>{var O,I;O=[d(7207),d(192),d(4323)],I=d.dj.d(O,function(f,N){return N(f,"",d.dj.c(),!0)},R,W),R.exports=I},2084:(R,W,d)=>{var O,I;O=[d(8787),d(192),d(4323)],I=d.dj.d(O,function(f,N){return N(f,"",d.dj.c(),!0)},R,W),R.exports=I},192:(R,W,d)=>{var O,I;O=[],I=d.dj.d(O,function(){return function(f,N,b,h){var r,o,c;if(f.load(N,b,function(u){o=u,c=!0,r&&r(u)},{isBuild:!0}),c)return o;if(!h)throw new Error(N+" unavailable");return o=new Promise(function(u){r=u}),o.__DOJO_WEBPACK_DEFINE_PROMISE__=!0,o}},R,W),R.exports=I},5094:(R,W,d)=>{var O,I;O=[d(792)],I=d.dj.d(O,function(f){"use strict";var N={};return N.default=f.AckExtension=function(){let b,h=!1,r;function o(c,u){b._debug(c,u)}this.registered=(c,u)=>{b=u,o("AckExtension: executing registration callback")},this.unregistered=()=>{o("AckExtension: executing unregistration callback"),b=null},this.incoming=c=>{const u=c.channel,g=c.ext;if(u==="/meta/handshake"){if(g){const m=g.ack;if(typeof m=="object"){h=m.enabled===!0;const y=m.batch;typeof y=="number"&&(r=y)}else h=m===!0}o("AckExtension: server supports acknowledgements",h)}else u==="/meta/connect"&&c.successful&&h&&g&&typeof g.ack=="number"&&(r=g.ack,o("AckExtension: server sent batch",r));return c},this.outgoing=c=>{const u=c.channel;return c.ext||(c.ext={}),u==="/meta/handshake"?(c.ext.ack=b&&b.ackEnabled!==!1,h=!1,r=0):u==="/meta/connect"&&h&&(c.ext.ack=r,o("AckExtension: client sending batch",r)),c}},N.default},R,W),R.exports=I},792:(R,W,d)=>{var O,I;O=[],I=d.dj.d(O,function(){"use strict";var f={};function N(){let P=0;const T={};this.register=M=>{const z=++P;return T[z]=M,z},this.unregister=M=>{const z=T[M];return delete T[M],z},this.setTimeout=(M,z)=>window.setTimeout(M,z),this.clearTimeout=M=>{window.clearTimeout(M)}}function b(){const P={};self.onmessage=T=>{const M=T.data,z=P[M.id];switch(M.type){case"setTimeout":P[M.id]=self.setTimeout(()=>{delete P[M.id],self.postMessage({id:M.id})},M.delay);break;case"clearTimeout":delete P[M.id],z&&self.clearTimeout(z);break;default:throw"Unknown command "+M.type}}}const h={isString:P=>P==null?!1:typeof P=="string"||P instanceof String};function r(){let P=[],T={};this.getTransportTypes=()=>P.slice(0),this.findTransportTypes=(M,z,Y)=>{const X=[];for(let S=0;S<P.length;++S){const F=P[S];T[F].accept(M,z,Y)===!0&&X.push(F)}return X},this.negotiateTransport=(M,z,Y,X)=>{for(let S=0;S<P.length;++S){const F=P[S];for(let k=0;k<M.length;++k)if(F===M[k]){const G=T[F];if(G.accept(z,Y,X)===!0)return G}}return null},this.add=(M,z,Y)=>{let X=!1;for(let S=0;S<P.length;++S)if(P[S]===M){X=!0;break}return X||(typeof Y!="number"?P.push(M):P.splice(Y,0,M),T[M]=z),!X},this.find=M=>{for(let z=0;z<P.length;++z)if(P[z]===M)return T[M];return null},this.remove=M=>{for(let z=0;z<P.length;++z)if(P[z]===M){P.splice(z,1);const Y=T[M];return delete T[M],Y}return null},this.clear=()=>{P=[],T={}},this.reset=M=>{for(let z=0;z<P.length;++z)T[P[z]].reset(M)}}function o(){let P,T,M;this.registered=(z,Y)=>{P=z,T=Y},this.unregistered=()=>{P=null,T=null},this._notifyTransportTimeout=function(z){const Y=T._getTransportListeners("timeout");if(Y)for(let X=0;X<Y.length;++X){const S=Y[X];try{const F=S.call(this,z);if(typeof F=="number"&&F>0)return F}catch(F){this._info("Exception during execution of transport listener",S,F)}}return 0},this._debug=function(){T._debug.apply(T,arguments)},this._info=function(){T._info.apply(T,arguments)},this._mixin=function(){return T._mixin.apply(T,arguments)},this.getConfiguration=()=>T.getConfiguration(),this.getAdvice=()=>T.getAdvice(),this.setTimeout=(z,Y)=>T.setTimeout(z,Y),this.clearTimeout=z=>{T.clearTimeout(z)},this.convertToJSON=function(z){const Y=this.getConfiguration().maxSendBayeuxMessageSize;let X="[";for(let S=0;S<z.length;++S){S>0&&(X+=",");const F=z[S],k=JSON.stringify(F);if(k.length>Y)throw"maxSendBayeuxMessageSize "+Y+" exceeded";X+=k}return X+="]",X},this.convertToMessages=function(z){if(h.isString(z))try{return JSON.parse(z)}catch(Y){throw this._debug("Could not convert to JSON the following string",'"'+z+'"'),Y}if(Array.isArray(z))return z;if(z==null)return[];if(z instanceof Object)return[z];throw"Conversion Error "+z+", typeof "+typeof z},this.accept=(z,Y,X)=>{throw"Abstract"},this.getType=()=>P,this.getURL=()=>M,this.setURL=z=>{M=z},this.send=(z,Y)=>{throw"Abstract"},this.reset=function(z){this._debug("Transport",P,"reset",z?"initial":"retry")},this.abort=function(){this._debug("Transport",P,"aborted")},this.toString=function(){return this.getType()}}o.derive=P=>{function T(){}return T.prototype=P,new T};function c(){const P=new o,T=o.derive(P);let M=0,z=null,Y=[],X=[];function S(Q){for(;X.length>0;){const ne=X[0],he=ne[0],ve=ne[1];if(he.url===Q.url&&he.sync===Q.sync){X.shift(),Q.messages=Q.messages.concat(he.messages),this._debug("Coalesced",he.messages.length,"messages from request",ve.id);continue}break}}function F(Q,ne,he){const ve=this._notifyTransportTimeout(Q.messages);if(ve>0)this._debug("Transport",this.getType(),"extended waiting for message replies of request",ne.id,":",ve,"ms"),ne.timeout=this.setTimeout(()=>{F.call(this,Q,ne,he+ve)},ve);else{ne.expired=!0;const Ie="Transport "+this.getType()+" expired waiting for message replies of request "+ne.id+": "+he+" ms",fe={reason:Ie},Me=ne.xhr;fe.httpCode=this.xhrStatus(Me),this.abortXHR(Me),this._debug(Ie),this.complete(ne,!1,ne.metaConnect),Q.onFailure(Me,Q.messages,fe)}}function k(Q,ne){if(this.transportSend(Q,ne)&&(ne.expired=!1,!Q.sync)){let he=this.getConfiguration().maxNetworkDelay;ne.metaConnect===!0&&(he+=this.getAdvice().timeout),this._debug("Transport",this.getType(),"started waiting for message replies of request",ne.id,":",he,"ms"),ne.timeout=this.setTimeout(()=>{F.call(this,Q,ne,he)},he)}}function G(Q){const ne=++M,he={id:ne,metaConnect:!1,envelope:Q};Y.length<this.getConfiguration().maxConnections-1?(Y.push(he),k.call(this,Q,he)):(this._debug("Transport",this.getType(),"queueing request",ne,"envelope",Q),X.push([Q,he]))}function H(Q){const ne=Q.id;if(this._debug("Transport",this.getType(),"/meta/connect complete, request",ne),z!==null&&z.id!==ne)throw"/meta/connect request mismatch, completing request "+ne;z=null}function q(Q,ne){const he=Y.indexOf(Q);if(he>=0&&Y.splice(he,1),X.length>0){const ve=X.shift(),Ie=ve[0],fe=ve[1];this._debug("Transport dequeued request",fe.id),ne?(this.getConfiguration().autoBatch&&S.call(this,Ie),G.call(this,Ie),this._debug("Transport completed request",Q.id,Ie)):this.setTimeout(()=>{this.complete(fe,!1,fe.metaConnect);const Me={reason:"Previous request failed"},Ke=fe.xhr;Me.httpCode=this.xhrStatus(Ke),Ie.onFailure(Ke,Ie.messages,Me)},0)}}T.complete=function(Q,ne,he){he?H.call(this,Q):q.call(this,Q,ne)},T.transportSend=(Q,ne)=>{throw"Abstract"},T.transportSuccess=function(Q,ne,he){ne.expired||(this.clearTimeout(ne.timeout),this._debug("Transport",this.getType(),"cancelled waiting for message replies"),this.complete(ne,!0,ne.metaConnect),he&&he.length>0?Q.onSuccess(he):Q.onFailure(ne.xhr,Q.messages,{httpCode:204}))},T.transportFailure=function(Q,ne,he){ne.expired||(this.clearTimeout(ne.timeout),this._debug("Transport",this.getType(),"cancelled waiting for failed message replies"),this.complete(ne,!1,ne.metaConnect),Q.onFailure(ne.xhr,Q.messages,he))};function ce(Q){if(z!==null)throw"Concurrent /meta/connect requests not allowed, request id="+z.id+" not yet completed";const ne=++M;this._debug("Transport",this.getType(),"/meta/connect send, request",ne,"envelope",Q);const he={id:ne,metaConnect:!0,envelope:Q};k.call(this,Q,he),z=he}return T.send=function(Q,ne){ne?ce.call(this,Q):G.call(this,Q)},T.abort=function(){P.abort();for(let ne=0;ne<Y.length;++ne){const he=Y[ne];he&&(this._debug("Aborting request",he),this.abortXHR(he.xhr)||this.transportFailure(he.envelope,he,{reason:"abort"}))}const Q=z;Q&&(this._debug("Aborting /meta/connect request",Q),this.abortXHR(Q.xhr)||this.transportFailure(Q.envelope,Q,{reason:"abort"})),this.reset(!0)},T.reset=Q=>{P.reset(Q),z=null,Y=[],X=[]},T.abortXHR=function(Q){if(Q)try{const ne=Q.readyState;return Q.abort(),ne!==window.XMLHttpRequest.UNSENT}catch(ne){this._debug(ne)}return!1},T.xhrStatus=function(Q){if(Q)try{return Q.status}catch(ne){this._debug(ne)}return-1},T}function u(){const P=new c,T=o.derive(P);let M=!0;T.accept=(Y,X,S)=>M||!X,T.newXMLHttpRequest=()=>new window.XMLHttpRequest;function z(Y){try{Y.context=T.context}catch(X){T._debug("Could not copy transport context into XHR",X)}}return T.xhrSend=Y=>{const X=T.newXMLHttpRequest();z(X),X.withCredentials=!0,X.open("POST",Y.url,Y.sync!==!0);const S=Y.headers;if(S)for(let F in S)S.hasOwnProperty(F)&&X.setRequestHeader(F,S[F]);return X.setRequestHeader("Content-Type","application/json;charset=UTF-8"),X.onload=()=>{X.status===200?Y.onSuccess(X.responseText):Y.onError(X.statusText)},X.onabort=X.onerror=()=>{Y.onError(X.statusText)},X.send(Y.body),X},T.transportSend=function(Y,X){this._debug("Transport",this.getType(),"sending request",X.id,"envelope",Y);try{let S=!0;return X.xhr=this.xhrSend({transport:this,url:Y.url,sync:Y.sync,headers:this.getConfiguration().requestHeaders,body:this.convertToJSON(Y.messages),onSuccess:F=>{this._debug("Transport",this.getType(),"received response",F);let k=!1;try{const G=this.convertToMessages(F);G.length===0?(M=!1,this.transportFailure(Y,X,{httpCode:204})):(k=!0,this.transportSuccess(Y,X,G))}catch(G){if(this._debug(G),!k){M=!1;const H={exception:G};H.httpCode=this.xhrStatus(X.xhr),this.transportFailure(Y,X,H)}}},onError:(F,k)=>{this._debug("Transport",this.getType(),"received error",F,k),M=!1;const G={reason:F,exception:k};G.httpCode=this.xhrStatus(X.xhr),S?this.setTimeout(()=>{this.transportFailure(Y,X,G)},0):this.transportFailure(Y,X,G)}}),S=!1,!0}catch(S){return this._debug("Transport",this.getType(),"exception:",S),M=!1,this.setTimeout(()=>{this.transportFailure(Y,X,{exception:S})},0),!1}},T.reset=Y=>{P.reset(Y),M=!0},T}function g(){const P=new c,T=o.derive(P);let M=0;T.accept=(Y,X,S)=>!0,T.jsonpSend=Y=>{const X=document.getElementsByTagName("head")[0],S=document.createElement("script"),F="_cometd_jsonp_"+M++;window[F]=G=>{X.removeChild(S),delete window[F],Y.onSuccess(G)};let k=Y.url;k+=k.indexOf("?")<0?"?":"&",k+="jsonp="+F,k+="&message="+encodeURIComponent(Y.body),S.src=k,S.async=Y.sync!==!0,S.type="application/javascript",S.onerror=G=>{Y.onError("jsonp "+G.type)},X.appendChild(S)};function z(Y,X,S){return()=>{this.transportFailure(Y,X,"error",S)}}return T.transportSend=function(Y,X){let S=0,F=Y.messages.length;const k=[];for(;F>0;){const H=JSON.stringify(Y.messages.slice(S,S+F)),q=Y.url.length+encodeURI(H).length,ce=this.getConfiguration().maxURILength;if(q>ce){if(F===1){const Q="Bayeux message too big ("+q+" bytes, max is "+ce+") for transport "+this.getType();this.setTimeout(z.call(this,Y,X,Q),0);return}--F;continue}k.push(F),S+=F,F=Y.messages.length-S}let G=Y;if(k.length>1){let H=0,q=k[0];this._debug("Transport",this.getType(),"split",Y.messages.length,"messages into",k.join(" + ")),G=this._mixin(!1,{},Y),G.messages=Y.messages.slice(H,q),G.onSuccess=Y.onSuccess,G.onFailure=Y.onFailure;for(let ce=1;ce<k.length;++ce){const Q=this._mixin(!1,{},Y);H=q,q+=k[ce],Q.messages=Y.messages.slice(H,q),Q.onSuccess=Y.onSuccess,Q.onFailure=Y.onFailure,this.send(Q,X.metaConnect)}}this._debug("Transport",this.getType(),"sending request",X.id,"envelope",G);try{let H=!0;return this.jsonpSend({transport:this,url:G.url,sync:G.sync,headers:this.getConfiguration().requestHeaders,body:JSON.stringify(G.messages),onSuccess:q=>{let ce=!1;try{const Q=this.convertToMessages(q);Q.length===0?this.transportFailure(G,X,{httpCode:204}):(ce=!0,this.transportSuccess(G,X,Q))}catch(Q){this._debug(Q),ce||this.transportFailure(G,X,{exception:Q})}},onError:(q,ce)=>{const Q={reason:q,exception:ce};H?this.setTimeout(()=>{this.transportFailure(G,X,Q)},0):this.transportFailure(G,X,Q)}}),H=!1,!0}catch(H){return this.setTimeout(()=>{this.transportFailure(G,X,{exception:H})},0),!1}},T}function m(){const P=new o,T=o.derive(P);let M,z=!0,Y=!1,X=!0,S=null,F=null,k=!1,G=null;T.reset=fe=>{P.reset(fe),z=!0,fe&&(Y=!1),X=!0,fe&&(S=null),F=null,k=!1};function H(fe,Me){fe&&(this.webSocketClose(fe,Me.code,Me.reason),this.onClose(fe,Me))}function q(fe){return fe===F||fe===S}function ce(fe,Me,Ke){const Ye=[];for(let je=0;je<Me.messages.length;++je){const ot=Me.messages[je];ot.id&&Ye.push(ot.id)}fe.envelopes[Ye.join(",")]=[Me,Ke],this._debug("Transport",this.getType(),"stored envelope, envelopes",fe.envelopes)}function Q(fe,Me){let Ke=!1;const Ye=fe.envelopes;for(let je=0;je<Me.length;++je){const ot=Me[je];for(let $e in Ye)if(Ye.hasOwnProperty($e)){const _t=$e.split(","),Ut=_t.indexOf(ot);if(Ut>=0){Ke=!0,_t.splice(Ut,1);const qt=Ye[$e][0],oi=Ye[$e][1];delete Ye[$e],_t.length>0&&(Ye[_t.join(",")]=[qt,oi]);break}}}Ke&&this._debug("Transport",this.getType(),"removed envelope, envelopes",Ye)}function ne(fe){if(F)return;const Me=M.getURL().replace(/^http/,"ws");this._debug("Transport",this.getType(),"connecting to URL",Me);try{const $e=M.getConfiguration().protocol;fe.webSocket=$e?new window.WebSocket(Me,$e):new window.WebSocket(Me),F=fe}catch($e){throw z=!1,this._debug("Exception while creating WebSocket object",$e),$e}X=M.getConfiguration().stickyReconnect!==!1;const Ke=M.getConfiguration().connectTimeout;Ke>0&&(fe.connectTimer=this.setTimeout(()=>{M._debug("Transport",this.getType(),"timed out while connecting to URL",Me,":",Ke,"ms"),H.call(this,fe,{code:1e3,reason:"Connect Timeout"})},Ke));const Ye=()=>{M._debug("WebSocket onopen",fe),fe.connectTimer&&this.clearTimeout(fe.connectTimer),q(fe)?(F=null,S=fe,Y=!0,this.onOpen(fe)):(M._warn("Closing extra WebSocket connection",this,"active connection",S),H.call(this,fe,{code:1e3,reason:"Extra Connection"}))},je=$e=>{$e=$e||{code:1e3},M._debug("WebSocket onclose",fe,$e,"connecting",F,"current",S),fe.connectTimer&&this.clearTimeout(fe.connectTimer),this.onClose(fe,$e)},ot=$e=>{M._debug("WebSocket onmessage",$e,fe),this.onMessage(fe,$e)};fe.webSocket.onopen=Ye,fe.webSocket.onclose=je,fe.webSocket.onerror=()=>{je({code:1e3,reason:"Error"})},fe.webSocket.onmessage=ot,this._debug("Transport",this.getType(),"configured callbacks on",fe)}function he(fe,Me,Ke){const Ye=this._notifyTransportTimeout([Me]);Ye>0?(this._debug("Transport",this.getType(),"extended waiting for message replies:",Ye,"ms"),fe.timeouts[Me.id]=this.setTimeout(()=>{he.call(this,fe,Me,Ke+Ye)},Ye)):(this._debug("Transport",this.getType(),"expired waiting for message reply",Me.id,":",Ke,"ms"),H.call(this,fe,{code:1e3,reason:"Message Timeout"}))}function ve(fe,Me,Ke){let Ye;try{Ye=this.convertToJSON(Me.messages)}catch($e){this._debug("Transport",this.getType(),"exception:",$e);const _t=[];for(let Ut=0;Ut<Me.messages.length;++Ut){const qt=Me.messages[Ut];_t.push(qt.id)}Q.call(this,fe,_t),this.setTimeout(()=>{this._notifyFailure(Me.onFailure,fe,Me.messages,{exception:$e})},0);return}fe.webSocket.send(Ye),this._debug("Transport",this.getType(),"sent",Me,"/meta/connect =",Ke);let je=this.getConfiguration().maxNetworkDelay;Ke&&(je+=this.getAdvice().timeout,k=!0);const ot=[];for(let $e=0;$e<Me.messages.length;++$e){const _t=Me.messages[$e];_t.id&&(ot.push(_t.id),fe.timeouts[_t.id]=this.setTimeout(()=>{he.call(this,fe,_t,je)},je))}this._debug("Transport",this.getType(),"started waiting for message replies",je,"ms, messageIds:",ot,", timeouts:",fe.timeouts)}T._notifySuccess=function(fe,Me){fe.call(this,Me)},T._notifyFailure=function(fe,Me,Ke,Ye){fe.call(this,Me,Ke,Ye)};function Ie(fe,Me,Ke){try{fe===null?(fe=F||{envelopes:{},timeouts:{}},ce.call(this,fe,Me,Ke),ne.call(this,fe)):(ce.call(this,fe,Me,Ke),ve.call(this,fe,Me,Ke))}catch(Ye){this.setTimeout(()=>{H.call(this,fe,{code:1e3,reason:"Exception",exception:Ye})},0)}}return T.onOpen=function(fe){const Me=fe.envelopes;this._debug("Transport",this.getType(),"opened",fe,"pending messages",Me);for(let Ke in Me)if(Me.hasOwnProperty(Ke)){const Ye=Me[Ke],je=Ye[0],ot=Ye[1];G=je.onSuccess,ve.call(this,fe,je,ot)}},T.onMessage=function(fe,Me){this._debug("Transport",this.getType(),"received websocket message",Me,fe);let Ke=!1;const Ye=this.convertToMessages(Me.data),je=[];for(let ot=0;ot<Ye.length;++ot){const $e=Ye[ot];if((/^\/meta\//.test($e.channel)||$e.data===void 0)&&$e.id){je.push($e.id);const _t=fe.timeouts[$e.id];_t&&(this.clearTimeout(_t),delete fe.timeouts[$e.id],this._debug("Transport",this.getType(),"removed timeout for message",$e.id,", timeouts",fe.timeouts))}$e.channel==="/meta/connect"&&(k=!1),$e.channel==="/meta/disconnect"&&!k&&(Ke=!0)}Q.call(this,fe,je),this._notifySuccess(G,Ye),Ke&&this.webSocketClose(fe,1e3,"Disconnect")},T.onClose=function(fe,Me){this._debug("Transport",this.getType(),"closed",fe,Me),q(fe)&&(z=X&&Y,F=null,S=null);const Ke=fe.timeouts;fe.timeouts={};for(let je in Ke)Ke.hasOwnProperty(je)&&this.clearTimeout(Ke[je]);const Ye=fe.envelopes;fe.envelopes={};for(let je in Ye)if(Ye.hasOwnProperty(je)){const ot=Ye[je][0];Ye[je][1]&&(k=!1);const _t={websocketCode:Me.code,reason:Me.reason};Me.exception&&(_t.exception=Me.exception),this._notifyFailure(ot.onFailure,fe,ot.messages,_t)}},T.registered=(fe,Me)=>{P.registered(fe,Me),M=Me},T.accept=function(fe,Me,Ke){return this._debug("Transport",this.getType(),"accept, supported:",z),z&&!!window.WebSocket&&M.websocketEnabled!==!1},T.send=function(fe,Me){this._debug("Transport",this.getType(),"sending",fe,"/meta/connect =",Me),Ie.call(this,S,fe,Me)},T.webSocketClose=function(fe,Me,Ke){try{fe.webSocket&&fe.webSocket.close(Me,Ke)}catch(Ye){this._debug(Ye)}},T.abort=function(){P.abort(),H.call(this,S,{code:1e3,reason:"Abort"}),this.reset(!0)},T}function y(P){const T=new N,M=this,z=P||"default";let Y=!1;const X=new r;let S,F="disconnected",k=0,G=null,H=0,q=[],ce=!1,Q=0,ne={};const he={};let ve=0,Ie=null;const fe=[];let Me={},Ke,Ye;const je={},ot={};let $e=!1,_t=!1,Ut=0,qt=0,oi=null,Nt={useWorkerScheduler:!0,protocol:null,stickyReconnect:!0,connectTimeout:0,maxConnections:2,backoffIncrement:1e3,maxBackoff:6e4,logLevel:"info",maxNetworkDelay:1e4,requestHeaders:{},appendMessageTypeToURL:!0,autoBatch:!1,urls:{},maxURILength:2e3,maxSendBayeuxMessageSize:8192,advice:{timeout:6e4,interval:0,reconnect:void 0,maxInterval:0}};function Wn(Z,me){try{return Z[me]}catch(xe){return}}this._mixin=function(Z,me,xe){const De=me||{};for(let We=2;We<arguments.length;++We){const Je=arguments[We];if(Je!=null){for(let lt in Je)if(Je.hasOwnProperty(lt)){const pt=Wn(Je,lt),Bt=Wn(De,lt);if(pt===me||pt===void 0)continue;if(Z&&typeof pt=="object"&&pt!==null)if(pt instanceof Array)De[lt]=this._mixin(Z,Bt instanceof Array?Bt:[],pt);else{const Di=typeof Bt=="object"&&!(Bt instanceof Array)?Bt:{};De[lt]=this._mixin(Z,Di,pt)}else De[lt]=pt}}}return De};function _i(Z){return h.isString(Z)}function Vn(Z){return Z>="A"&&Z<="Z"?!0:Z>="a"&&Z<="z"}function Gn(Z){return Z>="0"&&Z<="9"}function mr(Z){switch(Z){case" ":case"!":case"#":case"$":case"(":case")":case"*":case"+":case"-":case".":case"/":case"@":case"_":case"{":case"~":case"}":case":":case"\\":case",":return!0;default:return!1}}function In(Z){if(!_i(Z)||Z.length<2||Z.charAt(0)!=="/")return!1;for(let me=1;me<Z.length;++me){const xe=Z.charAt(me);if(!(Vn(xe)||Gn(xe)||mr(xe)))return!1}return!0}function bt(Z){return Z==null?!1:typeof Z=="function"}function wn(Z,me){let xe="";for(;--me>0&&!(Z>=Math.pow(10,me));)xe+="0";return xe+=Z,xe}function ji(Z,me){if(window.console){const xe=window.console[Z];if(bt(xe)){const De=new Date;[].splice.call(me,0,0,wn(De.getHours(),2)+":"+wn(De.getMinutes(),2)+":"+wn(De.getSeconds(),2)+"."+wn(De.getMilliseconds(),3)),xe.apply(window.console,me)}}}this._warn=function(){ji("warn",arguments)},this._info=function(){Nt.logLevel!=="warn"&&ji("info",arguments)},this._debug=function(){Nt.logLevel==="debug"&&ji("debug",arguments)};function un(Z){return new RegExp("(^https?://)?(((\\[[^\\]]+])|([^:/?#]+))(:(\\d+))?)?([^?#]*)(.*)?").exec(Z)}this._isCrossDomain=Z=>window.location&&window.location.host&&Z?Z!==window.location.host:!1;function Wi(Z){M._debug("Configuring cometd object with",Z),_i(Z)&&(Z={url:Z}),Z||(Z={}),Nt=M._mixin(!1,Nt,Z);const me=M.getURL();if(!me)throw"Missing required configuration parameter 'url' specifying the Bayeux server URL";const xe=un(me),De=xe[2],We=xe[8],Je=xe[9];if(Y=M._isCrossDomain(De),Nt.appendMessageTypeToURL)if(Je!==void 0&&Je.length>0)M._info("Appending message type to URI "+We+Je+" is not supported, disabling 'appendMessageTypeToURL' configuration"),Nt.appendMessageTypeToURL=!1;else{const lt=We.split("/");let pt=lt.length-1;We.match(/\/$/)&&(pt-=1),lt[pt].indexOf(".")>=0&&(M._info("Appending message type to URI "+We+" is not supported, disabling 'appendMessageTypeToURL' configuration"),Nt.appendMessageTypeToURL=!1)}if(window.Worker&&window.Blob&&window.URL&&Nt.useWorkerScheduler){let lt=b.toString();lt=lt.substring(lt.indexOf("{")+1,lt.lastIndexOf("}"));const pt=new window.Blob([lt],{type:"application/json"}),Bt=window.URL.createObjectURL(pt),Di=new window.Worker(Bt);T.setTimeout=(Ri,an)=>{const Ei=T.register(Ri);return Di.postMessage({id:Ei,type:"setTimeout",delay:an}),Ei},T.clearTimeout=Ri=>{T.unregister(Ri),Di.postMessage({id:Ri,type:"clearTimeout"})},Di.onmessage=Ri=>{const an=Ri.data.id,Ei=T.unregister(an);Ei&&Ei()}}}function Hn(Z){if(Z){const me=ne[Z.channel];me&&me[Z.id]&&(delete me[Z.id],M._debug("Removed",Z.listener?"listener":"subscription",Z))}}function kr(Z){Z&&!Z.listener&&Hn(Z)}function jr(){for(let Z in ne)if(ne.hasOwnProperty(Z)){const me=ne[Z];if(me)for(let xe in me)me.hasOwnProperty(xe)&&kr(me[xe])}}function gi(Z){F!==Z&&(M._debug("Status",F,"->",Z),F=Z)}function Be(){return F==="disconnecting"||F==="disconnected"}function Vi(){return""+ ++k}function bi(Z,me,xe,De,We){try{return me.call(Z,De)}catch(Je){const lt=M.onExtensionException;if(bt(lt)){M._debug("Invoking extension exception handler",xe,Je);try{lt.call(M,Je,xe,We,De)}catch(pt){M._info("Exception during execution of extension exception handler",xe,pt)}}else M._info("Exception during execution of extension",xe,Je);return De}}function Kn(Z){for(let me=0;me<fe.length&&Z!=null;++me){const xe=fe[me],De=xe.extension.incoming;if(bt(De)){const We=bi(xe.extension,De,xe.name,Z,!1);Z=We===void 0?Z:We}}return Z}function fs(Z){for(let me=fe.length-1;me>=0&&Z!=null;--me){const xe=fe[me],De=xe.extension.outgoing;if(bt(De)){const We=bi(xe.extension,De,xe.name,Z,!0);Z=We===void 0?Z:We}}return Z}function wi(Z,me){const xe=ne[Z];if(xe){for(let De in xe)if(xe.hasOwnProperty(De)){const We=xe[De];if(We)try{We.callback.call(We.scope,me)}catch(Je){const lt=M.onListenerException;if(bt(lt)){M._debug("Invoking listener exception handler",We,Je);try{lt.call(M,Je,We,We.listener,me)}catch(pt){M._info("Exception during execution of listener exception handler",We,pt)}}else M._info("Exception during execution of listener",We,me,Je)}}}}function Ct(Z,me){wi(Z,me);const xe=Z.split("/"),De=xe.length-1;for(let We=De;We>0;--We){let Je=xe.slice(0,We).join("/")+"/*";We===De&&wi(Je,me),Je+="*",wi(Je,me)}}function en(){Ie!==null&&M.clearTimeout(Ie),Ie=null}function Yn(Z,me){en();const xe=Me.interval+me;M._debug("Function scheduled in",xe,"ms, interval =",Me.interval,"backoff =",ve,Z),Ie=M.setTimeout(Z,xe)}let dt,Ve;function Gi(Z,me,xe){for(let Je=0;Je<Z.length;++Je){let lt=Z[Je];const pt=lt.id;G&&(lt.clientId=G),lt=fs(lt),lt!=null?(lt.id=pt,Z[Je]=lt):(delete je[pt],Z.splice(Je--,1))}if(Z.length===0)return;me&&(oi=Z[0]);let De=M.getURL();Nt.appendMessageTypeToURL&&(De.match(/\/$/)||(De=De+"/"),xe&&(De=De+xe));const We={url:De,sync:!1,messages:Z,onSuccess:Je=>{try{dt.call(M,Je)}catch(lt){M._info("Exception during handling of messages",lt)}},onFailure:(Je,lt,pt)=>{try{const Bt=M.getTransport();pt.connectionType=Bt?Bt.getType():"unknown",Ve.call(M,Je,lt,pt)}catch(Bt){M._info("Exception during handling of failure",Bt)}}};M._debug("Send",We),S.send(We,me)}function Vt(Z){H>0||ce===!0?q.push(Z):Gi([Z],!1)}this.send=Vt;function Hi(){ve=0}function fa(){return ve<Nt.maxBackoff&&(ve+=Nt.backoffIncrement),ve}function ui(){++H,M._debug("Starting batch, depth",H)}function _r(){const Z=q;q=[],Z.length>0&&Gi(Z,!1)}function Ft(){if(--H,M._debug("Ending batch, depth",H),H<0)throw"Calls to startBatch() and endBatch() are not paired";H===0&&!Be()&&!ce&&_r()}function tn(){if(!Be()){const Z={id:Vi(),channel:"/meta/connect",connectionType:S.getType()};_t||(Z.advice={timeout:0}),gi("connecting"),M._debug("Connect sent",Z),Gi([Z],!0,"connect"),gi("connected")}}function Xn(Z){gi("connecting"),Yn(()=>{tn()},Z)}function ni(Z){Z&&(Me=M._mixin(!1,{},Nt.advice,Z),M._debug("New advice",Me))}function te(Z){if(en(),Z&&S&&S.abort(),Y=!1,S=null,gi("disconnected"),G=null,H=0,Hi(),$e=!1,_t=!1,Ut=0,oi=null,q.length>0){const me=q;q=[],Ve.call(M,void 0,me,{reason:"Disconnected"})}}function qn(Z,me,xe){const De=M.onTransportException;if(bt(De)){M._debug("Invoking transport exception handler",Z,me,xe);try{De.call(M,xe,Z,me)}catch(We){M._info("Exception during execution of transport exception handler",We)}}}function Wr(Z,me){bt(Z)&&(me=Z,Z=void 0),G=null,jr(),Be()&&X.reset(!0),ni({}),H=0,ce=!0,Ke=Z,Ye=me;const xe="1.0",De=M.getURL(),We=X.findTransportTypes(xe,Y,De),Je={id:Vi(),version:xe,minimumVersion:xe,channel:"/meta/handshake",supportedConnectionTypes:We,advice:{timeout:Me.timeout,interval:Me.interval}},lt=M._mixin(!1,{},Ke,Je);if(M._putCallback(lt.id,me),!S&&(S=X.negotiateTransport(We,xe,Y,De),!S)){const pt="Could not find initial transport among: "+X.getTransportTypes();throw M._warn(pt),pt}M._debug("Initial transport is",S.getType()),gi("handshaking"),M._debug("Handshake sent",lt),Gi([lt],!1,"handshake")}function xi(Z){gi("handshaking"),ce=!0,Yn(()=>{Wr(Ke,Ye)},Z)}function Li(Z,me){try{Z.call(M,me)}catch(xe){const De=M.onCallbackException;if(bt(De)){M._debug("Invoking callback exception handler",xe);try{De.call(M,xe,me)}catch(We){M._info("Exception during execution of callback exception handler",We)}}else M._info("Exception during execution of message callback",xe)}}this._getCallback=Z=>je[Z],this._putCallback=function(Z,me){const xe=this._getCallback(Z);return bt(me)&&(je[Z]=me),xe};function li(Z){const me=M._getCallback([Z.id]);bt(me)&&(delete je[Z.id],Li(me,Z))}function Bn(Z){const me=ot[Z.id];if(delete ot[Z.id],me){M._debug("Handling remote call response for",Z,"with context",me);const xe=me.timeout;xe&&M.clearTimeout(xe);const De=me.callback;if(bt(De))return Li(De,Z),!0}return!1}this.onTransportFailure=function(Z,me,xe){this._debug("Transport failure",me,"for",Z);const De=this.getTransportRegistry(),We=this.getURL(),Je=this._isCrossDomain(un(We)[2]),lt="1.0",pt=De.findTransportTypes(lt,Je,We);if(me.action==="none"){if(Z.channel==="/meta/handshake"&&!me.transport){const Bt="Could not negotiate transport, client=["+pt+"], server=["+Z.supportedConnectionTypes+"]";this._warn(Bt),qn(S.getType(),null,{reason:Bt,connectionType:S.getType(),transport:S})}}else if(me.delay=this.getBackoffPeriod(),Z.channel==="/meta/handshake"){if(!me.transport){const Bt=S?S.getType():null,Di=De.negotiateTransport(pt,lt,Je,We);if(!Di)this._warn("Could not negotiate transport, client=["+pt+"]"),qn(Bt,null,Z.failure),me.action="none";else{const Ri=Di.getType();this._debug("Transport",Bt,"->",Ri),qn(Bt,Ri,Z.failure),me.action="handshake",me.transport=Di}}me.action!=="none"&&this.increaseBackoffPeriod()}else{const Bt=new Date().getTime();if(Ut===0&&(Ut=Bt),me.action==="retry"){me.delay=this.increaseBackoffPeriod();const Di=Me.maxInterval;if(Di>0){const Ri=Me.timeout+Me.interval+Di;Bt-Ut+ve>Ri&&(me.action="handshake")}}me.action==="handshake"&&(me.delay=0,De.reset(!1),this.resetBackoffPeriod())}xe.call(M,me)};function Ki(Z){M._debug("Transport failure handling",Z),Z.transport&&(S=Z.transport),Z.url&&S.setURL(Z.url);const me=Z.action,xe=Z.delay||0;switch(me){case"handshake":xi(xe);break;case"retry":Xn(xe);break;case"none":te(!0);break;default:throw"Unknown action "+me}}function Yi(Z,me){li(Z),Ct("/meta/handshake",Z),Ct("/meta/unsuccessful",Z),Be()&&(me.action="none"),M.onTransportFailure.call(M,Z,me,Ki)}function dn(Z){const me=M.getURL();if(Z.successful){const xe=M._isCrossDomain(un(me)[2]),De=X.negotiateTransport(Z.supportedConnectionTypes,Z.version,xe,me);if(De===null){Z.successful=!1,Yi(Z,{cause:"negotiation",action:"none",transport:null});return}else S!==De&&(M._debug("Transport",S.getType(),"->",De.getType()),S=De);G=Z.clientId,ce=!1,_r(),Z.reestablish=$e,$e=!0,li(Z),Ct("/meta/handshake",Z),qt=Z["x-messages"]||0;const We=Be()?"none":Me.reconnect||"retry";switch(We){case"retry":Hi(),qt===0?Xn(0):M._debug("Processing",qt,"handshake-delivered messages");break;case"none":te(!0);break;default:throw"Unrecognized advice action "+We}}else Yi(Z,{cause:"unsuccessful",action:Me.reconnect||"handshake",transport:S})}function pn(Z){Yi(Z,{cause:"failure",action:"handshake",transport:null})}function nn(Z){return F==="disconnected"?!0:oi&&oi.id===Z.id?(oi=null,!0):!1}function fn(Z,me){Ct("/meta/connect",Z),Ct("/meta/unsuccessful",Z),Be()&&(me.action="none"),M.onTransportFailure.call(M,Z,me,Ki)}function Zn(Z){if(nn(Z))if(_t=Z.successful,_t){Ct("/meta/connect",Z);const me=Be()?"none":Me.reconnect||"retry";switch(me){case"retry":Hi(),Xn(ve);break;case"none":te(!1);break;default:throw"Unrecognized advice action "+me}}else fn(Z,{cause:"unsuccessful",action:Me.reconnect||"retry",transport:S});else M._debug("Mismatched /meta/connect reply",Z)}function gr(Z){nn(Z)?(_t=!1,fn(Z,{cause:"failure",action:"retry",transport:null})):M._debug("Mismatched /meta/connect failure",Z)}function Qn(Z){te(!0),li(Z),Ct("/meta/disconnect",Z),Ct("/meta/unsuccessful",Z)}function En(Z){Z.successful?(te(!1),li(Z),Ct("/meta/disconnect",Z)):Qn(Z)}function Vr(Z){Qn(Z)}function ms(Z){const me=ne[Z.subscription];if(me){for(let xe in me)if(me.hasOwnProperty(xe)){const De=me[xe];De&&!De.listener&&(delete me[xe],M._debug("Removed failed subscription",De))}}li(Z),Ct("/meta/subscribe",Z),Ct("/meta/unsuccessful",Z)}function mn(Z){Z.successful?(li(Z),Ct("/meta/subscribe",Z)):ms(Z)}function rn(Z){ms(Z)}function vr(Z){li(Z),Ct("/meta/unsubscribe",Z),Ct("/meta/unsuccessful",Z)}function yr(Z){Z.successful?(li(Z),Ct("/meta/unsubscribe",Z)):vr(Z)}function _n(Z){vr(Z)}function Jn(Z){Bn(Z)||(li(Z),Ct("/meta/publish",Z),Ct("/meta/unsuccessful",Z))}function br(Z){Z.data!==void 0?Bn(Z)||(Ct(Z.channel,Z),qt>0&&(--qt,qt===0&&(M._debug("Processed last handshake-delivered message"),Xn(0)))):Z.successful===void 0?M._warn("Unknown Bayeux Message",Z):Z.successful?(li(Z),Ct("/meta/publish",Z)):Jn(Z)}function Gr(Z){Jn(Z)}function sn(Z){if(Ut=0,Z=Kn(Z),Z==null)return;switch(ni(Z.advice),Z.channel){case"/meta/handshake":dn(Z);break;case"/meta/connect":Zn(Z);break;case"/meta/disconnect":En(Z);break;case"/meta/subscribe":mn(Z);break;case"/meta/unsubscribe":yr(Z);break;default:br(Z);break}}this.receive=sn,dt=Z=>{M._debug("Received",Z);for(let me=0;me<Z.length;++me){const xe=Z[me];sn(xe)}},Ve=(Z,me,xe)=>{M._debug("handleFailure",Z,me,xe),xe.transport=Z;for(let De=0;De<me.length;++De){const We=me[De],Je={id:We.id,successful:!1,channel:We.channel,failure:xe};switch(xe.message=We,We.channel){case"/meta/handshake":pn(Je);break;case"/meta/connect":gr(Je);break;case"/meta/disconnect":Vr(Je);break;case"/meta/subscribe":Je.subscription=We.subscription,rn(Je);break;case"/meta/unsubscribe":Je.subscription=We.subscription,_n(Je);break;default:Gr(Je);break}}};function ht(Z){const me=ne[Z];if(me){for(let xe in me)if(me.hasOwnProperty(xe)&&me[xe])return!0}return!1}function An(Z,me){const xe={scope:Z,method:me};if(bt(Z))xe.scope=void 0,xe.method=Z;else if(_i(me)){if(!Z)throw"Invalid scope "+Z;if(xe.method=Z[me],!bt(xe.method))throw"Invalid callback "+me+" for scope "+Z}else if(!bt(me))throw"Invalid callback "+me;return xe}function Pi(Z,me,xe,De){const We=An(me,xe);M._debug("Adding",De?"listener":"subscription","on",Z,"with scope",We.scope,"and callback",We.method);const Je=++Q,lt={id:Je,channel:Z,scope:We.scope,callback:We.method,listener:De};let pt=ne[Z];return pt||(pt={},ne[Z]=pt),pt[Je]=lt,M._debug("Added",De?"listener":"subscription",lt),lt}this.registerTransport=function(Z,me,xe){const De=X.add(Z,me,xe);return De&&(this._debug("Registered transport",Z),bt(me.registered)&&me.registered(Z,this)),De},this.unregisterTransport=function(Z){const me=X.remove(Z);return me!==null&&(this._debug("Unregistered transport",Z),bt(me.unregistered)&&me.unregistered()),me},this.unregisterTransports=()=>{X.clear()},this.getTransportTypes=()=>X.getTransportTypes(),this.findTransport=Z=>X.find(Z),this.getTransportRegistry=()=>X,this.configure=function(Z){Wi.call(this,Z)},this.init=function(Z,me){this.configure(Z),this.handshake(me)},this.handshake=(Z,me)=>{if(F!=="disconnected")throw"Illegal state: handshaken";Wr(Z,me)},this.disconnect=function(Z,me){if(Be())return;bt(Z)&&(me=Z,Z=void 0);const xe={id:Vi(),channel:"/meta/disconnect"},De=this._mixin(!1,{},Z,xe);M._putCallback(De.id,me),gi("disconnecting"),Gi([De],!1,"disconnect")},this.startBatch=()=>{ui()},this.endBatch=()=>{Ft()},this.batch=function(Z,me){const xe=An(Z,me);this.startBatch();try{xe.method.call(xe.scope),this.endBatch()}catch(De){throw this._info("Exception during execution of batch",De),this.endBatch(),De}},this.addTransportListener=(Z,me)=>{if(Z!=="timeout")throw"Unsupported event "+Z;let xe=he[Z];xe||(he[Z]=xe=[]),xe.push(me)},this.removeTransportListener=(Z,me)=>{const xe=he[Z];if(xe){const De=xe.indexOf(me);if(De>=0)return xe.splice(De,1),!0}return!1},this._getTransportListeners=Z=>he[Z],this.addListener=function(Z,me,xe){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!_i(Z))throw"Illegal argument type: channel must be a string";return Pi(Z,me,xe,!0)},this.removeListener=Z=>{if(!Z||!Z.channel||!("id"in Z))throw"Invalid argument: expected subscription, not "+Z;Hn(Z)},this.clearListeners=()=>{ne={}},this.subscribe=function(Z,me,xe,De,We){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!In(Z))throw"Illegal argument: invalid channel "+Z;if(Be())throw"Illegal state: disconnected";bt(me)&&(We=De,De=xe,xe=me,me=void 0),bt(De)&&(We=De,De=void 0);const Je=!ht(Z),lt=Pi(Z,me,xe,!1);if(Je){const pt={id:Vi(),channel:"/meta/subscribe",subscription:Z},Bt=this._mixin(!1,{},De,pt);M._putCallback(Bt.id,We),Vt(Bt)}else bt(We)&&M.setTimeout(()=>{Li(We,{id:Vi(),successful:!0,channel:"/meta/subscribe",subscription:Z})},0);return lt},this.unsubscribe=function(Z,me,xe){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(Be())throw"Illegal state: disconnected";bt(me)&&(xe=me,me=void 0),this.removeListener(Z);const De=Z.channel;if(ht(De))bt(xe)&&M.setTimeout(()=>{Li(xe,{id:Vi(),successful:!0,channel:"/meta/unsubscribe",subscription:De})},0);else{const We={id:Vi(),channel:"/meta/unsubscribe",subscription:De},Je=this._mixin(!1,{},me,We);M._putCallback(Je.id,xe),Vt(Je)}},this.resubscribe=function(Z,me){if(kr(Z),Z)return this.subscribe(Z.channel,Z.scope,Z.callback,me)},this.clearSubscriptions=()=>{jr()},this.publish=function(Z,me,xe,De){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!In(Z))throw"Illegal argument: invalid channel "+Z;if(/^\/meta\//.test(Z))throw"Illegal argument: cannot publish to meta channels";if(Be())throw"Illegal state: disconnected";bt(me)?(De=me,me={},xe=void 0):bt(xe)&&(De=xe,xe=void 0);const We={id:Vi(),channel:Z,data:me},Je=this._mixin(!1,{},xe,We);M._putCallback(Je.id,De),Vt(Je)},this.publishBinary=function(Z,me,xe,De,We,Je){bt(me)?(Je=me,me=new ArrayBuffer(0),xe=!0,De=void 0,We=void 0):bt(xe)?(Je=xe,xe=!0,De=void 0,We=void 0):bt(De)?(Je=De,De=void 0,We=void 0):bt(We)&&(Je=We,We=void 0);const lt={meta:De,data:me,last:xe},pt=this._mixin(!1,We,{ext:{binary:{}}});this.publish(Z,lt,pt,Je)},this.remoteCall=function(Z,me,xe,De,We){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!_i(Z))throw"Illegal argument type: target must be a string";if(Be())throw"Illegal state: disconnected";if(bt(me)?(We=me,me={},xe=Nt.maxNetworkDelay,De=void 0):bt(xe)?(We=xe,xe=Nt.maxNetworkDelay,De=void 0):bt(De)&&(We=De,De=void 0),typeof xe!="number")throw"Illegal argument type: timeout must be a number";Z.match(/^\//)||(Z="/"+Z);const Je="/service"+Z;if(!In(Je))throw"Illegal argument: invalid target "+Z;const lt={id:Vi(),channel:Je,data:me},pt=this._mixin(!1,{},De,lt),Bt={callback:We};xe>0&&(Bt.timeout=M.setTimeout(()=>{M._debug("Timing out remote call",pt,"after",xe,"ms"),Jn({id:pt.id,error:"406::timeout",successful:!1,failure:{message:pt,reason:"Remote Call Timeout"}})},xe),M._debug("Scheduled remote call timeout",pt,"in",xe,"ms")),ot[pt.id]=Bt,Vt(pt)},this.remoteCallBinary=function(Z,me,xe,De,We,Je,lt){bt(me)?(lt=me,me=new ArrayBuffer(0),xe=!0,De=void 0,We=Nt.maxNetworkDelay,Je=void 0):bt(xe)?(lt=xe,xe=!0,De=void 0,We=Nt.maxNetworkDelay,Je=void 0):bt(De)?(lt=De,De=void 0,We=Nt.maxNetworkDelay,Je=void 0):bt(We)?(lt=We,We=Nt.maxNetworkDelay,Je=void 0):bt(Je)&&(lt=Je,Je=void 0);const pt={meta:De,data:me,last:xe},Bt=this._mixin(!1,Je,{ext:{binary:{}}});this.remoteCall(Z,pt,We,Bt,lt)},this.getStatus=()=>F,this.isDisconnected=Be,this.setBackoffIncrement=Z=>{Nt.backoffIncrement=Z},this.getBackoffIncrement=()=>Nt.backoffIncrement,this.getBackoffPeriod=()=>ve,this.increaseBackoffPeriod=()=>fa(),this.resetBackoffPeriod=()=>{Hi()},this.setLogLevel=Z=>{Nt.logLevel=Z},this.registerExtension=function(Z,me){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!_i(Z))throw"Illegal argument type: extension name must be a string";let xe=!1;for(let De=0;De<fe.length;++De)if(fe[De].name===Z){xe=!0;break}return xe?(this._info("Could not register extension with name",Z,"since another extension with the same name already exists"),!1):(fe.push({name:Z,extension:me}),this._debug("Registered extension",Z),bt(me.registered)&&me.registered(Z,this),!0)},this.unregisterExtension=function(Z){if(!_i(Z))throw"Illegal argument type: extension name must be a string";let me=!1;for(let xe=0;xe<fe.length;++xe){const De=fe[xe];if(De.name===Z){fe.splice(xe,1),me=!0,this._debug("Unregistered extension",Z);const We=De.extension;bt(We.unregistered)&&We.unregistered();break}}return me},this.getExtension=Z=>{for(let me=0;me<fe.length;++me){const xe=fe[me];if(xe.name===Z)return xe.extension}return null},this.getName=()=>z,this.getClientId=()=>G,this.getURL=()=>{if(S){let Z=S.getURL();if(Z||(Z=Nt.urls[S.getType()],Z))return Z}return Nt.url},this.getTransport=()=>S,this.getConfiguration=function(){return this._mixin(!0,{},Nt)},this.getAdvice=function(){return this._mixin(!0,{},Me)},this.setTimeout=(Z,me)=>T.setTimeout(()=>{try{M._debug("Invoking timed function",Z),Z()}catch(xe){M._debug("Exception invoking timed function",Z,xe)}},me),this.clearTimeout=Z=>{T.clearTimeout(Z)},window.WebSocket&&this.registerTransport("websocket",new m),this.registerTransport("long-polling",new u),this.registerTransport("callback-polling",new g)}const x=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z",".","-",":","+","=","^","!","/","*","?","&","<",">","(",")","[","]","{","}","@","%","$","#"],w=[0,68,0,84,83,82,72,0,75,76,70,65,0,63,62,69,0,1,2,3,4,5,6,7,8,9,64,0,73,66,74,71,81,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,77,0,78,67,0,0,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,79,0,80,0,0],C={encode:P=>{let T=null;if(P instanceof ArrayBuffer?T=P:P.buffer instanceof ArrayBuffer?T=P.buffer:Array.isArray(P)&&(T=new Uint8Array(P).buffer),T==null)throw"Cannot Z85 encode "+P;const M=T.byteLength,z=M%4,Y=4-(z===0?4:z),X=new DataView(T);let S="",F=0;for(let k=0;k<M+Y;++k){const G=k>=M;if(F=F*256+(G?0:X.getUint8(k)),(k+1)%4===0){let H=52200625;for(let q=5;q>0;--q){if(!G||q>Y){const ce=Math.floor(F/H)%85;S+=x[ce]}H/=85}F=0}}return S},decode:P=>{const T=P.length%5,M=5-(T===0?5:T);for(let G=0;G<M;++G)P+=x[x.length-1];const z=P.length,Y=new ArrayBuffer(z*4/5-M),X=new DataView(Y);let S=0,F=0,k=0;for(let G=0;G<z;++G){const H=P.charCodeAt(F++)-32;if(S=S*85+w[H],F%5===0){let q=16777216;for(;q>=1;)k<X.byteLength&&X.setUint8(k++,Math.floor(S/q)%256),q/=256;S=0}}return Y}};return f.default={CometD:y,Transport:o,RequestTransport:c,LongPollingTransport:u,CallbackPollingTransport:g,WebSocketTransport:m,Utils:h,Z85:C},f.default},R,W),R.exports=I},40:(R,W)=>{"use strict";(function(d,O){O(W)})(void 0,function(d){"use strict";var O=function(a){var i,t=Object.prototype,e=t.hasOwnProperty,n=typeof Symbol=="function"?Symbol:{},s=n.iterator||"@@iterator",l=n.asyncIterator||"@@asyncIterator",p=n.toStringTag||"@@toStringTag";function _(le,_e,Ae){return Object.defineProperty(le,_e,{value:Ae,enumerable:!0,configurable:!0,writable:!0}),le[_e]}try{_({},"")}catch(le){_=function(Ae,be,ge){return Ae[be]=ge}}function v(le,_e,Ae,be){var ge=_e&&_e.prototype instanceof V?_e:V,Te=Object.create(ge.prototype),Fe=new Ee(be||[]);return Te._invoke=function(tt,at,oe){var ue=E;return function(Oe,Pe){if(ue===D)throw new Error("Generator is already running");if(ue===B){if(Oe==="throw")throw Pe;return Le()}for(oe.method=Oe,oe.arg=Pe;;){var Ue=oe.delegate;if(Ue){var we=pe(Ue,oe);if(we){if(we===U)continue;return we}}if(oe.method==="next")oe.sent=oe._sent=oe.arg;else if(oe.method==="throw"){if(ue===E)throw ue=B,oe.arg;oe.dispatchException(oe.arg)}else oe.method==="return"&&oe.abrupt("return",oe.arg);ue=D;var Se=A(tt,at,oe);if(Se.type==="normal"){if(ue=oe.done?B:L,Se.arg===U)continue;return{value:Se.arg,done:oe.done}}Se.type==="throw"&&(ue=B,oe.method="throw",oe.arg=Se.arg)}}}(le,Ae,Fe),Te}function A(le,_e,Ae){try{return{type:"normal",arg:le.call(_e,Ae)}}catch(be){return{type:"throw",arg:be}}}a.wrap=v;var E="suspendedStart",L="suspendedYield",D="executing",B="completed",U={};function V(){}function j(){}function K(){}var ee={};ee[s]=function(){return this};var J=Object.getPrototypeOf,$=J&&J(J(Re([])));$&&$!==t&&e.call($,s)&&(ee=$);var se=K.prototype=V.prototype=Object.create(ee);function re(le){["next","throw","return"].forEach(function(_e){_(le,_e,function(Ae){return this._invoke(_e,Ae)})})}function ie(le,_e){function Ae(ge,Te,Fe,tt){var at=A(le[ge],le,Te);if(at.type!=="throw"){var oe=at.arg,ue=oe.value;return ue&&typeof ue=="object"&&e.call(ue,"__await")?_e.resolve(ue.__await).then(function(Oe){Ae("next",Oe,Fe,tt)},function(Oe){Ae("throw",Oe,Fe,tt)}):_e.resolve(ue).then(function(Oe){oe.value=Oe,Fe(oe)},function(Oe){return Ae("throw",Oe,Fe,tt)})}tt(at.arg)}var be;this._invoke=function(ge,Te){function Fe(){return new _e(function(tt,at){Ae(ge,Te,tt,at)})}return be=be?be.then(Fe,Fe):Fe()}}function pe(le,_e){var Ae=le.iterator[_e.method];if(Ae===i){if(_e.delegate=null,_e.method==="throw"){if(le.iterator.return&&(_e.method="return",_e.arg=i,pe(le,_e),_e.method==="throw"))return U;_e.method="throw",_e.arg=new TypeError("The iterator does not provide a 'throw' method")}return U}var be=A(Ae,le.iterator,_e.arg);if(be.type==="throw")return _e.method="throw",_e.arg=be.arg,_e.delegate=null,U;var ge=be.arg;return ge?ge.done?(_e[le.resultName]=ge.value,_e.next=le.nextLoc,_e.method!=="return"&&(_e.method="next",_e.arg=i),_e.delegate=null,U):ge:(_e.method="throw",_e.arg=new TypeError("iterator result is not an object"),_e.delegate=null,U)}function de(le){var _e={tryLoc:le[0]};1 in le&&(_e.catchLoc=le[1]),2 in le&&(_e.finallyLoc=le[2],_e.afterLoc=le[3]),this.tryEntries.push(_e)}function ye(le){var _e=le.completion||{};_e.type="normal",delete _e.arg,le.completion=_e}function Ee(le){this.tryEntries=[{tryLoc:"root"}],le.forEach(de,this),this.reset(!0)}function Re(le){if(le){var _e=le[s];if(_e)return _e.call(le);if(typeof le.next=="function")return le;if(!isNaN(le.length)){var Ae=-1,be=function ge(){for(;++Ae<le.length;)if(e.call(le,Ae))return ge.value=le[Ae],ge.done=!1,ge;return ge.value=i,ge.done=!0,ge};return be.next=be}}return{next:Le}}function Le(){return{value:i,done:!0}}return j.prototype=se.constructor=K,K.constructor=j,j.displayName=_(K,p,"GeneratorFunction"),a.isGeneratorFunction=function(le){var _e=typeof le=="function"&&le.constructor;return!!_e&&(_e===j||(_e.displayName||_e.name)==="GeneratorFunction")},a.mark=function(le){return Object.setPrototypeOf?Object.setPrototypeOf(le,K):(le.__proto__=K,_(le,p,"GeneratorFunction")),le.prototype=Object.create(se),le},a.awrap=function(le){return{__await:le}},re(ie.prototype),ie.prototype[l]=function(){return this},a.AsyncIterator=ie,a.async=function(le,_e,Ae,be,ge){ge===void 0&&(ge=Promise);var Te=new ie(v(le,_e,Ae,be),ge);return a.isGeneratorFunction(_e)?Te:Te.next().then(function(Fe){return Fe.done?Fe.value:Te.next()})},re(se),_(se,p,"Generator"),se[s]=function(){return this},se.toString=function(){return"[object Generator]"},a.keys=function(le){var _e=[];for(var Ae in le)_e.push(Ae);return _e.reverse(),function be(){for(;_e.length;){var ge=_e.pop();if(ge in le)return be.value=ge,be.done=!1,be}return be.done=!0,be}},a.values=Re,Ee.prototype={constructor:Ee,reset:function(_e){if(this.prev=0,this.next=0,this.sent=this._sent=i,this.done=!1,this.delegate=null,this.method="next",this.arg=i,this.tryEntries.forEach(ye),!_e)for(var Ae in this)Ae.charAt(0)==="t"&&e.call(this,Ae)&&!isNaN(+Ae.slice(1))&&(this[Ae]=i)},stop:function(){this.done=!0;var _e=this.tryEntries[0].completion;if(_e.type==="throw")throw _e.arg;return this.rval},dispatchException:function(_e){if(this.done)throw _e;var Ae=this;function be(oe,ue){return Fe.type="throw",Fe.arg=_e,Ae.next=oe,ue&&(Ae.method="next",Ae.arg=i),!!ue}for(var ge=this.tryEntries.length-1;ge>=0;--ge){var Te=this.tryEntries[ge],Fe=Te.completion;if(Te.tryLoc==="root")return be("end");if(Te.tryLoc<=this.prev){var tt=e.call(Te,"catchLoc"),at=e.call(Te,"finallyLoc");if(tt&&at){if(this.prev<Te.catchLoc)return be(Te.catchLoc,!0);if(this.prev<Te.finallyLoc)return be(Te.finallyLoc)}else if(tt){if(this.prev<Te.catchLoc)return be(Te.catchLoc,!0)}else{if(!at)throw new Error("try statement without catch or finally");if(this.prev<Te.finallyLoc)return be(Te.finallyLoc)}}}},abrupt:function(_e,Ae){for(var be=this.tryEntries.length-1;be>=0;--be){var ge=this.tryEntries[be];if(ge.tryLoc<=this.prev&&e.call(ge,"finallyLoc")&&this.prev<ge.finallyLoc){var Te=ge;break}}Te&&(_e==="break"||_e==="continue")&&Te.tryLoc<=Ae&&Ae<=Te.finallyLoc&&(Te=null);var Fe=Te?Te.completion:{};return Fe.type=_e,Fe.arg=Ae,Te?(this.method="next",this.next=Te.finallyLoc,U):this.complete(Fe)},complete:function(_e,Ae){if(_e.type==="throw")throw _e.arg;return _e.type==="break"||_e.type==="continue"?this.next=_e.arg:_e.type==="return"?(this.rval=this.arg=_e.arg,this.method="return",this.next="end"):_e.type==="normal"&&Ae&&(this.next=Ae),U},finish:function(_e){for(var Ae=this.tryEntries.length-1;Ae>=0;--Ae){var be=this.tryEntries[Ae];if(be.finallyLoc===_e)return this.complete(be.completion,be.afterLoc),ye(be),U}},catch:function(_e){for(var Ae=this.tryEntries.length-1;Ae>=0;--Ae){var be=this.tryEntries[Ae];if(be.tryLoc===_e){var ge=be.completion;if(ge.type==="throw"){var Te=ge.arg;ye(be)}return Te}}throw new Error("illegal catch attempt")},delegateYield:function(_e,Ae,be){return this.delegate={iterator:Re(_e),resultName:Ae,nextLoc:be},this.method==="next"&&(this.arg=i),U}},a}(R.exports);try{regeneratorRuntime=O}catch(a){Function("r","regeneratorRuntime = r")(O)}var I="126",f=100,N=300,b=301,h=302,r=303,o=304,c=306,u=307,g=1e3,m=1001,y=1002,x=1003,w=1004,C=1005,P=1006,T=1007,M=1008,z=1009,Y=1012,X=1014,S=1015,F=1016,k=1020,G=1022,H=1023,q=1026,ce=1027,Q=33776,ne=33777,he=33778,ve=33779,Ie=35840,fe=35841,Me=35842,Ke=35843,Ye=37492,je=37496,ot=2300,$e=2301,_t=2302,Ut=2400,qt=2401,oi=2402,Nt=2500,Wn=2501,_i=3e3,Vn=3001,Gn=3007,mr=3002,In=3004,bt=3005,wn=3006,ji=7680,un=35044,Wi=35048,Hn="300 es";function kr(a,i,t,e,n,s,l){try{var p=a[s](l),_=p.value}catch(v){return void t(v)}p.done?i(_):Promise.resolve(_).then(e,n)}function jr(a,i){for(var t=0;t<i.length;t++){var e=i[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(a,e.key,e)}}function gi(a,i,t){return i&&jr(a.prototype,i),t&&jr(a,t),a}function Be(a,i){a.prototype=Object.create(i.prototype),a.prototype.constructor=a,Vi(a,i)}function Vi(a,i){return(Vi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(a,i)}function bi(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function Kn(a,i){(i==null||i>a.length)&&(i=a.length);for(var t=0,e=new Array(i);t<i;t++)e[t]=a[t];return e}function fs(a,i){var t;if(typeof Symbol>"u"||a[Symbol.iterator]==null){if(Array.isArray(a)||(t=function(n,s){if(n){if(typeof n=="string")return Kn(n,s);var l=Object.prototype.toString.call(n).slice(8,-1);return l==="Object"&&n.constructor&&(l=n.constructor.name),l==="Map"||l==="Set"?Array.from(n):l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l)?Kn(n,s):void 0}}(a))||i&&a&&typeof a.length=="number"){t&&(a=t);var e=0;return function(){return e>=a.length?{done:!0}:{done:!1,value:a[e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}return(t=a[Symbol.iterator]()).next.bind(t)}function wi(){}Object.assign(wi.prototype,{addEventListener:function(i,t){this._listeners===void 0&&(this._listeners={});var e=this._listeners;e[i]===void 0&&(e[i]=[]),e[i].indexOf(t)===-1&&e[i].push(t)},hasEventListener:function(i,t){if(this._listeners===void 0)return!1;var e=this._listeners;return e[i]!==void 0&&e[i].indexOf(t)!==-1},removeEventListener:function(i,t){if(this._listeners!==void 0){var e=this._listeners[i];if(e!==void 0){var n=e.indexOf(t);n!==-1&&e.splice(n,1)}}},dispatchEvent:function(i){if(this._listeners!==void 0){var t=this._listeners[i.type];if(t!==void 0){i.target=this;for(var e=t.slice(0),n=0,s=e.length;n<s;n++)e[n].call(this,i)}}}});for(var Ct=[],en=0;en<256;en++)Ct[en]=(en<16?"0":"")+en.toString(16);var Yn=1234567,dt={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var i=4294967295*Math.random()|0,t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(Ct[255&i]+Ct[i>>8&255]+Ct[i>>16&255]+Ct[i>>24&255]+"-"+Ct[255&t]+Ct[t>>8&255]+"-"+Ct[t>>16&15|64]+Ct[t>>24&255]+"-"+Ct[63&e|128]+Ct[e>>8&255]+"-"+Ct[e>>16&255]+Ct[e>>24&255]+Ct[255&n]+Ct[n>>8&255]+Ct[n>>16&255]+Ct[n>>24&255]).toUpperCase()},clamp:function(i,t,e){return Math.max(t,Math.min(e,i))},euclideanModulo:function(i,t){return(i%t+t)%t},mapLinear:function(i,t,e,n,s){return n+(i-t)*(s-n)/(e-t)},lerp:function(i,t,e){return(1-e)*i+e*t},damp:function(i,t,e,n){return dt.lerp(i,t,1-Math.exp(-e*n))},pingpong:function(i,t){return t===void 0&&(t=1),t-Math.abs(dt.euclideanModulo(i,2*t)-t)},smoothstep:function(i,t,e){return i<=t?0:i>=e?1:(i=(i-t)/(e-t))*i*(3-2*i)},smootherstep:function(i,t,e){return i<=t?0:i>=e?1:(i=(i-t)/(e-t))*i*i*(i*(6*i-15)+10)},randInt:function(i,t){return i+Math.floor(Math.random()*(t-i+1))},randFloat:function(i,t){return i+Math.random()*(t-i)},randFloatSpread:function(i){return i*(.5-Math.random())},seededRandom:function(i){return i!==void 0&&(Yn=i%2147483647),((Yn=16807*Yn%2147483647)-1)/2147483646},degToRad:function(i){return i*dt.DEG2RAD},radToDeg:function(i){return i*dt.RAD2DEG},isPowerOfTwo:function(i){return(i&i-1)==0&&i!==0},ceilPowerOfTwo:function(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},floorPowerOfTwo:function(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},setQuaternionFromProperEuler:function(i,t,e,n,s){var l=Math.cos,p=Math.sin,_=l(e/2),v=p(e/2),A=l((t+n)/2),E=p((t+n)/2),L=l((t-n)/2),D=p((t-n)/2),B=l((n-t)/2),U=p((n-t)/2);switch(s){case"XYX":i.set(_*E,v*L,v*D,_*A);break;case"YZY":i.set(v*D,_*E,v*L,_*A);break;case"ZXZ":i.set(v*L,v*D,_*E,_*A);break;case"XZX":i.set(_*E,v*U,v*B,_*A);break;case"YXY":i.set(v*B,_*E,v*U,_*A);break;case"ZYZ":i.set(v*U,v*B,_*E,_*A);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}},Ve=function(){function a(t,e){t===void 0&&(t=0),e===void 0&&(e=0),this.x=t,this.y=e}var i=a.prototype;return i.set=function(t,e){return this.x=t,this.y=e,this},i.setScalar=function(t){return this.x=t,this.y=t,this},i.setX=function(t){return this.x=t,this},i.setY=function(t){return this.y=t,this},i.setComponent=function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},i.getComponent=function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},i.clone=function(){return new this.constructor(this.x,this.y)},i.copy=function(t){return this.x=t.x,this.y=t.y,this},i.add=function(t,e){return e!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},i.addScalar=function(t){return this.x+=t,this.y+=t,this},i.addVectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},i.addScaledVector=function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},i.sub=function(t,e){return e!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},i.subScalar=function(t){return this.x-=t,this.y-=t,this},i.subVectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},i.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},i.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},i.divide=function(t){return this.x/=t.x,this.y/=t.y,this},i.divideScalar=function(t){return this.multiplyScalar(1/t)},i.applyMatrix3=function(t){var e=this.x,n=this.y,s=t.elements;return this.x=s[0]*e+s[3]*n+s[6],this.y=s[1]*e+s[4]*n+s[7],this},i.min=function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},i.max=function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},i.clamp=function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},i.clampScalar=function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this},i.clampLength=function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},i.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},i.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},i.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},i.roundToZero=function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},i.negate=function(){return this.x=-this.x,this.y=-this.y,this},i.dot=function(t){return this.x*t.x+this.y*t.y},i.cross=function(t){return this.x*t.y-this.y*t.x},i.lengthSq=function(){return this.x*this.x+this.y*this.y},i.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)},i.normalize=function(){return this.divideScalar(this.length()||1)},i.angle=function(){var t=Math.atan2(-this.y,-this.x)+Math.PI;return t},i.distanceTo=function(t){return Math.sqrt(this.distanceToSquared(t))},i.distanceToSquared=function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n},i.manhattanDistanceTo=function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},i.setLength=function(t){return this.normalize().multiplyScalar(t)},i.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},i.lerpVectors=function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this},i.equals=function(t){return t.x===this.x&&t.y===this.y},i.fromArray=function(t,e){return e===void 0&&(e=0),this.x=t[e],this.y=t[e+1],this},i.toArray=function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this.x,t[e+1]=this.y,t},i.fromBufferAttribute=function(t,e,n){return n!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},i.rotateAround=function(t,e){var n=Math.cos(e),s=Math.sin(e),l=this.x-t.x,p=this.y-t.y;return this.x=l*n-p*s+t.x,this.y=l*s+p*n+t.y,this},i.random=function(){return this.x=Math.random(),this.y=Math.random(),this},gi(a,[{key:"width",get:function(){return this.x},set:function(e){this.x=e}},{key:"height",get:function(){return this.y},set:function(e){this.y=e}}]),a}();Ve.prototype.isVector2=!0;var Gi,Vt=function(){function a(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}var i=a.prototype;return i.set=function(t,e,n,s,l,p,_,v,A){var E=this.elements;return E[0]=t,E[1]=s,E[2]=_,E[3]=e,E[4]=l,E[5]=v,E[6]=n,E[7]=p,E[8]=A,this},i.identity=function(){return this.set(1,0,0,0,1,0,0,0,1),this},i.copy=function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this},i.extractBasis=function(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this},i.setFromMatrix4=function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},i.multiply=function(t){return this.multiplyMatrices(this,t)},i.premultiply=function(t){return this.multiplyMatrices(t,this)},i.multiplyMatrices=function(t,e){var n=t.elements,s=e.elements,l=this.elements,p=n[0],_=n[3],v=n[6],A=n[1],E=n[4],L=n[7],D=n[2],B=n[5],U=n[8],V=s[0],j=s[3],K=s[6],ee=s[1],J=s[4],$=s[7],se=s[2],re=s[5],ie=s[8];return l[0]=p*V+_*ee+v*se,l[3]=p*j+_*J+v*re,l[6]=p*K+_*$+v*ie,l[1]=A*V+E*ee+L*se,l[4]=A*j+E*J+L*re,l[7]=A*K+E*$+L*ie,l[2]=D*V+B*ee+U*se,l[5]=D*j+B*J+U*re,l[8]=D*K+B*$+U*ie,this},i.multiplyScalar=function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},i.determinant=function(){var t=this.elements,e=t[0],n=t[1],s=t[2],l=t[3],p=t[4],_=t[5],v=t[6],A=t[7],E=t[8];return e*p*E-e*_*A-n*l*E+n*_*v+s*l*A-s*p*v},i.invert=function(){var t=this.elements,e=t[0],n=t[1],s=t[2],l=t[3],p=t[4],_=t[5],v=t[6],A=t[7],E=t[8],L=E*p-_*A,D=_*v-E*l,B=A*l-p*v,U=e*L+n*D+s*B;if(U===0)return this.set(0,0,0,0,0,0,0,0,0);var V=1/U;return t[0]=L*V,t[1]=(s*A-E*n)*V,t[2]=(_*n-s*p)*V,t[3]=D*V,t[4]=(E*e-s*v)*V,t[5]=(s*l-_*e)*V,t[6]=B*V,t[7]=(n*v-A*e)*V,t[8]=(p*e-n*l)*V,this},i.transpose=function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},i.getNormalMatrix=function(t){return this.setFromMatrix4(t).invert().transpose()},i.transposeIntoArray=function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},i.setUvTransform=function(t,e,n,s,l,p,_){var v=Math.cos(l),A=Math.sin(l);return this.set(n*v,n*A,-n*(v*p+A*_)+p+t,-s*A,s*v,-s*(-A*p+v*_)+_+e,0,0,1),this},i.scale=function(t,e){var n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this},i.rotate=function(t){var e=Math.cos(t),n=Math.sin(t),s=this.elements,l=s[0],p=s[3],_=s[6],v=s[1],A=s[4],E=s[7];return s[0]=e*l+n*v,s[3]=e*p+n*A,s[6]=e*_+n*E,s[1]=-n*l+e*v,s[4]=-n*p+e*A,s[7]=-n*_+e*E,this},i.translate=function(t,e){var n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this},i.equals=function(t){for(var e=this.elements,n=t.elements,s=0;s<9;s++)if(e[s]!==n[s])return!1;return!0},i.fromArray=function(t,e){e===void 0&&(e=0);for(var n=0;n<9;n++)this.elements[n]=t[n+e];return this},i.toArray=function(t,e){t===void 0&&(t=[]),e===void 0&&(e=0);var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t},i.clone=function(){return new this.constructor().fromArray(this.elements)},a}();Vt.prototype.isMatrix3=!0;var Hi={getDataURL:function(i){if(/^data:/i.test(i.src)||typeof HTMLCanvasElement>"u")return i.src;var t;if(i instanceof HTMLCanvasElement)t=i;else{Gi===void 0&&(Gi=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Gi.width=i.width,Gi.height=i.height;var e=Gi.getContext("2d");i instanceof ImageData?e.putImageData(i,0,0):e.drawImage(i,0,0,i.width,i.height),t=Gi}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},fa=0,ui=function(a){function i(e,n,s,l,p,_,v,A,E,L){var D;return e===void 0&&(e=i.DEFAULT_IMAGE),n===void 0&&(n=i.DEFAULT_MAPPING),s===void 0&&(s=m),l===void 0&&(l=m),p===void 0&&(p=P),_===void 0&&(_=M),v===void 0&&(v=H),A===void 0&&(A=z),E===void 0&&(E=1),L===void 0&&(L=_i),D=a.call(this)||this,Object.defineProperty(bi(D),"id",{value:fa++}),D.uuid=dt.generateUUID(),D.name="",D.image=e,D.mipmaps=[],D.mapping=n,D.wrapS=s,D.wrapT=l,D.magFilter=p,D.minFilter=_,D.anisotropy=E,D.format=v,D.internalFormat=null,D.type=A,D.offset=new Ve(0,0),D.repeat=new Ve(1,1),D.center=new Ve(0,0),D.rotation=0,D.matrixAutoUpdate=!0,D.matrix=new Vt,D.generateMipmaps=!0,D.premultiplyAlpha=!1,D.flipY=!0,D.unpackAlignment=4,D.encoding=L,D.version=0,D.onUpdate=null,D}Be(i,a);var t=i.prototype;return t.updateMatrix=function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},t.clone=function(){return new this.constructor().copy(this)},t.copy=function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},t.toJSON=function(e){var n=e===void 0||typeof e=="string";if(!n&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];var s={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){var l=this.image;if(l.uuid===void 0&&(l.uuid=dt.generateUUID()),!n&&e.images[l.uuid]===void 0){var p;if(Array.isArray(l)){p=[];for(var _=0,v=l.length;_<v;_++)l[_].isDataTexture?p.push(_r(l[_].image)):p.push(_r(l[_]))}else p=_r(l);e.images[l.uuid]={uuid:l.uuid,url:p}}s.image=l.uuid}return n||(e.textures[this.uuid]=s),s},t.dispose=function(){this.dispatchEvent({type:"dispose"})},t.transformUv=function(e){if(this.mapping!==N)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case g:e.x=e.x-Math.floor(e.x);break;case m:e.x=e.x<0?0:1;break;case y:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case g:e.y=e.y-Math.floor(e.y);break;case m:e.y=e.y<0?0:1;break;case y:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e},gi(i,[{key:"needsUpdate",set:function(n){n===!0&&this.version++}}]),i}(wi);function _r(a){return typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&a instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&a instanceof ImageBitmap?Hi.getDataURL(a):a.data?{data:Array.prototype.slice.call(a.data),width:a.width,height:a.height,type:a.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}ui.DEFAULT_IMAGE=void 0,ui.DEFAULT_MAPPING=N,ui.prototype.isTexture=!0;var Ft=function(){function a(t,e,n,s){t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0),s===void 0&&(s=1),this.x=t,this.y=e,this.z=n,this.w=s}var i=a.prototype;return i.set=function(t,e,n,s){return this.x=t,this.y=e,this.z=n,this.w=s,this},i.setScalar=function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},i.setX=function(t){return this.x=t,this},i.setY=function(t){return this.y=t,this},i.setZ=function(t){return this.z=t,this},i.setW=function(t){return this.w=t,this},i.setComponent=function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},i.getComponent=function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},i.clone=function(){return new this.constructor(this.x,this.y,this.z,this.w)},i.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this},i.add=function(t,e){return e!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},i.addScalar=function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},i.addVectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},i.addScaledVector=function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},i.sub=function(t,e){return e!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},i.subScalar=function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},i.subVectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},i.multiply=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},i.multiplyScalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},i.applyMatrix4=function(t){var e=this.x,n=this.y,s=this.z,l=this.w,p=t.elements;return this.x=p[0]*e+p[4]*n+p[8]*s+p[12]*l,this.y=p[1]*e+p[5]*n+p[9]*s+p[13]*l,this.z=p[2]*e+p[6]*n+p[10]*s+p[14]*l,this.w=p[3]*e+p[7]*n+p[11]*s+p[15]*l,this},i.divideScalar=function(t){return this.multiplyScalar(1/t)},i.setAxisAngleFromQuaternion=function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},i.setAxisAngleFromRotationMatrix=function(t){var e,n,s,l,p=.01,_=.1,v=t.elements,A=v[0],E=v[4],L=v[8],D=v[1],B=v[5],U=v[9],V=v[2],j=v[6],K=v[10];if(Math.abs(E-D)<p&&Math.abs(L-V)<p&&Math.abs(U-j)<p){if(Math.abs(E+D)<_&&Math.abs(L+V)<_&&Math.abs(U+j)<_&&Math.abs(A+B+K-3)<_)return this.set(1,0,0,0),this;e=Math.PI;var ee=(A+1)/2,J=(B+1)/2,$=(K+1)/2,se=(E+D)/4,re=(L+V)/4,ie=(U+j)/4;return ee>J&&ee>$?ee<p?(n=0,s=.707106781,l=.707106781):(s=se/(n=Math.sqrt(ee)),l=re/n):J>$?J<p?(n=.707106781,s=0,l=.707106781):(n=se/(s=Math.sqrt(J)),l=ie/s):$<p?(n=.707106781,s=.707106781,l=0):(n=re/(l=Math.sqrt($)),s=ie/l),this.set(n,s,l,e),this}var pe=Math.sqrt((j-U)*(j-U)+(L-V)*(L-V)+(D-E)*(D-E));return Math.abs(pe)<.001&&(pe=1),this.x=(j-U)/pe,this.y=(L-V)/pe,this.z=(D-E)/pe,this.w=Math.acos((A+B+K-1)/2),this},i.min=function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},i.max=function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},i.clamp=function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},i.clampScalar=function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this},i.clampLength=function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},i.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},i.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},i.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},i.roundToZero=function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},i.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},i.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},i.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},i.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},i.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},i.normalize=function(){return this.divideScalar(this.length()||1)},i.setLength=function(t){return this.normalize().multiplyScalar(t)},i.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},i.lerpVectors=function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this},i.equals=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},i.fromArray=function(t,e){return e===void 0&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},i.toArray=function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},i.fromBufferAttribute=function(t,e,n){return n!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this},i.random=function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this},gi(a,[{key:"width",get:function(){return this.z},set:function(e){this.z=e}},{key:"height",get:function(){return this.w},set:function(e){this.w=e}}]),a}();Ft.prototype.isVector4=!0;var tn=function(a){function i(e,n,s){var l;return(l=a.call(this)||this).width=e,l.height=n,l.depth=1,l.scissor=new Ft(0,0,e,n),l.scissorTest=!1,l.viewport=new Ft(0,0,e,n),s=s||{},l.texture=new ui(void 0,s.mapping,s.wrapS,s.wrapT,s.magFilter,s.minFilter,s.format,s.type,s.anisotropy,s.encoding),l.texture.image={},l.texture.image.width=e,l.texture.image.height=n,l.texture.image.depth=1,l.texture.generateMipmaps=s.generateMipmaps!==void 0&&s.generateMipmaps,l.texture.minFilter=s.minFilter!==void 0?s.minFilter:P,l.depthBuffer=s.depthBuffer===void 0||s.depthBuffer,l.stencilBuffer=s.stencilBuffer!==void 0&&s.stencilBuffer,l.depthTexture=s.depthTexture!==void 0?s.depthTexture:null,l}Be(i,a);var t=i.prototype;return t.setTexture=function(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e},t.setSize=function(e,n,s){s===void 0&&(s=1),this.width===e&&this.height===n&&this.depth===s||(this.width=e,this.height=n,this.depth=s,this.texture.image.width=e,this.texture.image.height=n,this.texture.image.depth=s,this.dispose()),this.viewport.set(0,0,e,n),this.scissor.set(0,0,e,n)},t.clone=function(){return new this.constructor().copy(this)},t.copy=function(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},t.dispose=function(){this.dispatchEvent({type:"dispose"})},i}(wi);tn.prototype.isWebGLRenderTarget=!0;var Xn=function(a){function i(t,e,n){var s;return(s=a.call(this,t,e,n)||this).samples=4,s}return Be(i,a),i.prototype.copy=function(t){return a.prototype.copy.call(this,t),this.samples=t.samples,this},i}(tn);Xn.prototype.isWebGLMultisampleRenderTarget=!0;var ni=function(){function a(t,e,n,s){t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0),s===void 0&&(s=1),this._x=t,this._y=e,this._z=n,this._w=s}a.slerp=function(t,e,n,s){return n.copy(t).slerp(e,s)},a.slerpFlat=function(t,e,n,s,l,p,_){var v=n[s+0],A=n[s+1],E=n[s+2],L=n[s+3],D=l[p+0],B=l[p+1],U=l[p+2],V=l[p+3];if(_===0)return t[e+0]=v,t[e+1]=A,t[e+2]=E,void(t[e+3]=L);if(_===1)return t[e+0]=D,t[e+1]=B,t[e+2]=U,void(t[e+3]=V);if(L!==V||v!==D||A!==B||E!==U){var j=1-_,K=v*D+A*B+E*U+L*V,ee=K>=0?1:-1,J=1-K*K;if(J>Number.EPSILON){var $=Math.sqrt(J),se=Math.atan2($,K*ee);j=Math.sin(j*se)/$,_=Math.sin(_*se)/$}var re=_*ee;if(v=v*j+D*re,A=A*j+B*re,E=E*j+U*re,L=L*j+V*re,j===1-_){var ie=1/Math.sqrt(v*v+A*A+E*E+L*L);v*=ie,A*=ie,E*=ie,L*=ie}}t[e]=v,t[e+1]=A,t[e+2]=E,t[e+3]=L},a.multiplyQuaternionsFlat=function(t,e,n,s,l,p){var _=n[s],v=n[s+1],A=n[s+2],E=n[s+3],L=l[p],D=l[p+1],B=l[p+2],U=l[p+3];return t[e]=_*U+E*L+v*B-A*D,t[e+1]=v*U+E*D+A*L-_*B,t[e+2]=A*U+E*B+_*D-v*L,t[e+3]=E*U-_*L-v*D-A*B,t};var i=a.prototype;return i.set=function(t,e,n,s){return this._x=t,this._y=e,this._z=n,this._w=s,this._onChangeCallback(),this},i.clone=function(){return new this.constructor(this._x,this._y,this._z,this._w)},i.copy=function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this},i.setFromEuler=function(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=t._x,s=t._y,l=t._z,p=t._order,_=Math.cos,v=Math.sin,A=_(n/2),E=_(s/2),L=_(l/2),D=v(n/2),B=v(s/2),U=v(l/2);switch(p){case"XYZ":this._x=D*E*L+A*B*U,this._y=A*B*L-D*E*U,this._z=A*E*U+D*B*L,this._w=A*E*L-D*B*U;break;case"YXZ":this._x=D*E*L+A*B*U,this._y=A*B*L-D*E*U,this._z=A*E*U-D*B*L,this._w=A*E*L+D*B*U;break;case"ZXY":this._x=D*E*L-A*B*U,this._y=A*B*L+D*E*U,this._z=A*E*U+D*B*L,this._w=A*E*L-D*B*U;break;case"ZYX":this._x=D*E*L-A*B*U,this._y=A*B*L+D*E*U,this._z=A*E*U-D*B*L,this._w=A*E*L+D*B*U;break;case"YZX":this._x=D*E*L+A*B*U,this._y=A*B*L+D*E*U,this._z=A*E*U-D*B*L,this._w=A*E*L-D*B*U;break;case"XZY":this._x=D*E*L-A*B*U,this._y=A*B*L-D*E*U,this._z=A*E*U+D*B*L,this._w=A*E*L+D*B*U;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+p)}return e!==!1&&this._onChangeCallback(),this},i.setFromAxisAngle=function(t,e){var n=e/2,s=Math.sin(n);return this._x=t.x*s,this._y=t.y*s,this._z=t.z*s,this._w=Math.cos(n),this._onChangeCallback(),this},i.setFromRotationMatrix=function(t){var e=t.elements,n=e[0],s=e[4],l=e[8],p=e[1],_=e[5],v=e[9],A=e[2],E=e[6],L=e[10],D=n+_+L;if(D>0){var B=.5/Math.sqrt(D+1);this._w=.25/B,this._x=(E-v)*B,this._y=(l-A)*B,this._z=(p-s)*B}else if(n>_&&n>L){var U=2*Math.sqrt(1+n-_-L);this._w=(E-v)/U,this._x=.25*U,this._y=(s+p)/U,this._z=(l+A)/U}else if(_>L){var V=2*Math.sqrt(1+_-n-L);this._w=(l-A)/V,this._x=(s+p)/V,this._y=.25*V,this._z=(v+E)/V}else{var j=2*Math.sqrt(1+L-n-_);this._w=(p-s)/j,this._x=(l+A)/j,this._y=(v+E)/j,this._z=.25*j}return this._onChangeCallback(),this},i.setFromUnitVectors=function(t,e){var n=t.dot(e)+1;return n<1e-6?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()},i.angleTo=function(t){return 2*Math.acos(Math.abs(dt.clamp(this.dot(t),-1,1)))},i.rotateTowards=function(t,e){var n=this.angleTo(t);if(n===0)return this;var s=Math.min(1,e/n);return this.slerp(t,s),this},i.identity=function(){return this.set(0,0,0,1)},i.invert=function(){return this.conjugate()},i.conjugate=function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},i.dot=function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},i.lengthSq=function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},i.length=function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},i.normalize=function(){var t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this},i.multiply=function(t,e){return e!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},i.premultiply=function(t){return this.multiplyQuaternions(t,this)},i.multiplyQuaternions=function(t,e){var n=t._x,s=t._y,l=t._z,p=t._w,_=e._x,v=e._y,A=e._z,E=e._w;return this._x=n*E+p*_+s*A-l*v,this._y=s*E+p*v+l*_-n*A,this._z=l*E+p*A+n*v-s*_,this._w=p*E-n*_-s*v-l*A,this._onChangeCallback(),this},i.slerp=function(t,e){if(e===0)return this;if(e===1)return this.copy(t);var n=this._x,s=this._y,l=this._z,p=this._w,_=p*t._w+n*t._x+s*t._y+l*t._z;if(_<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,_=-_):this.copy(t),_>=1)return this._w=p,this._x=n,this._y=s,this._z=l,this;var v=1-_*_;if(v<=Number.EPSILON){var A=1-e;return this._w=A*p+e*this._w,this._x=A*n+e*this._x,this._y=A*s+e*this._y,this._z=A*l+e*this._z,this.normalize(),this._onChangeCallback(),this}var E=Math.sqrt(v),L=Math.atan2(E,_),D=Math.sin((1-e)*L)/E,B=Math.sin(e*L)/E;return this._w=p*D+this._w*B,this._x=n*D+this._x*B,this._y=s*D+this._y*B,this._z=l*D+this._z*B,this._onChangeCallback(),this},i.equals=function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},i.fromArray=function(t,e){return e===void 0&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this},i.toArray=function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},i.fromBufferAttribute=function(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this},i._onChange=function(t){return this._onChangeCallback=t,this},i._onChangeCallback=function(){},gi(a,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}}]),a}();ni.prototype.isQuaternion=!0;var te=function(){function a(t,e,n){t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0),this.x=t,this.y=e,this.z=n}var i=a.prototype;return i.set=function(t,e,n){return n===void 0&&(n=this.z),this.x=t,this.y=e,this.z=n,this},i.setScalar=function(t){return this.x=t,this.y=t,this.z=t,this},i.setX=function(t){return this.x=t,this},i.setY=function(t){return this.y=t,this},i.setZ=function(t){return this.z=t,this},i.setComponent=function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},i.getComponent=function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},i.clone=function(){return new this.constructor(this.x,this.y,this.z)},i.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},i.add=function(t,e){return e!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},i.addScalar=function(t){return this.x+=t,this.y+=t,this.z+=t,this},i.addVectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},i.addScaledVector=function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},i.sub=function(t,e){return e!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},i.subScalar=function(t){return this.x-=t,this.y-=t,this.z-=t,this},i.subVectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},i.multiply=function(t,e){return e!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},i.multiplyScalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this},i.multiplyVectors=function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},i.applyEuler=function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Wr.setFromEuler(t))},i.applyAxisAngle=function(t,e){return this.applyQuaternion(Wr.setFromAxisAngle(t,e))},i.applyMatrix3=function(t){var e=this.x,n=this.y,s=this.z,l=t.elements;return this.x=l[0]*e+l[3]*n+l[6]*s,this.y=l[1]*e+l[4]*n+l[7]*s,this.z=l[2]*e+l[5]*n+l[8]*s,this},i.applyNormalMatrix=function(t){return this.applyMatrix3(t).normalize()},i.applyMatrix4=function(t){var e=this.x,n=this.y,s=this.z,l=t.elements,p=1/(l[3]*e+l[7]*n+l[11]*s+l[15]);return this.x=(l[0]*e+l[4]*n+l[8]*s+l[12])*p,this.y=(l[1]*e+l[5]*n+l[9]*s+l[13])*p,this.z=(l[2]*e+l[6]*n+l[10]*s+l[14])*p,this},i.applyQuaternion=function(t){var e=this.x,n=this.y,s=this.z,l=t.x,p=t.y,_=t.z,v=t.w,A=v*e+p*s-_*n,E=v*n+_*e-l*s,L=v*s+l*n-p*e,D=-l*e-p*n-_*s;return this.x=A*v+D*-l+E*-_-L*-p,this.y=E*v+D*-p+L*-l-A*-_,this.z=L*v+D*-_+A*-p-E*-l,this},i.project=function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},i.unproject=function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},i.transformDirection=function(t){var e=this.x,n=this.y,s=this.z,l=t.elements;return this.x=l[0]*e+l[4]*n+l[8]*s,this.y=l[1]*e+l[5]*n+l[9]*s,this.z=l[2]*e+l[6]*n+l[10]*s,this.normalize()},i.divide=function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},i.divideScalar=function(t){return this.multiplyScalar(1/t)},i.min=function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},i.max=function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},i.clamp=function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},i.clampScalar=function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this},i.clampLength=function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},i.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},i.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},i.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},i.roundToZero=function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},i.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},i.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},i.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z},i.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},i.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},i.normalize=function(){return this.divideScalar(this.length()||1)},i.setLength=function(t){return this.normalize().multiplyScalar(t)},i.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},i.lerpVectors=function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this},i.cross=function(t,e){return e!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},i.crossVectors=function(t,e){var n=t.x,s=t.y,l=t.z,p=e.x,_=e.y,v=e.z;return this.x=s*v-l*_,this.y=l*p-n*v,this.z=n*_-s*p,this},i.projectOnVector=function(t){var e=t.lengthSq();if(e===0)return this.set(0,0,0);var n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)},i.projectOnPlane=function(t){return qn.copy(this).projectOnVector(t),this.sub(qn)},i.reflect=function(t){return this.sub(qn.copy(t).multiplyScalar(2*this.dot(t)))},i.angleTo=function(t){var e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;var n=this.dot(t)/e;return Math.acos(dt.clamp(n,-1,1))},i.distanceTo=function(t){return Math.sqrt(this.distanceToSquared(t))},i.distanceToSquared=function(t){var e=this.x-t.x,n=this.y-t.y,s=this.z-t.z;return e*e+n*n+s*s},i.manhattanDistanceTo=function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},i.setFromSpherical=function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},i.setFromSphericalCoords=function(t,e,n){var s=Math.sin(e)*t;return this.x=s*Math.sin(n),this.y=Math.cos(e)*t,this.z=s*Math.cos(n),this},i.setFromCylindrical=function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},i.setFromCylindricalCoords=function(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this},i.setFromMatrixPosition=function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},i.setFromMatrixScale=function(t){var e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=s,this},i.setFromMatrixColumn=function(t,e){return this.fromArray(t.elements,4*e)},i.setFromMatrix3Column=function(t,e){return this.fromArray(t.elements,3*e)},i.equals=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},i.fromArray=function(t,e){return e===void 0&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},i.toArray=function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},i.fromBufferAttribute=function(t,e,n){return n!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this},i.random=function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this},a}();te.prototype.isVector3=!0;var qn=new te,Wr=new ni,xi=function(){function a(t,e){t===void 0&&(t=new te(1/0,1/0,1/0)),e===void 0&&(e=new te(-1/0,-1/0,-1/0)),this.min=t,this.max=e}var i=a.prototype;return i.set=function(t,e){return this.min.copy(t),this.max.copy(e),this},i.setFromArray=function(t){for(var e=1/0,n=1/0,s=1/0,l=-1/0,p=-1/0,_=-1/0,v=0,A=t.length;v<A;v+=3){var E=t[v],L=t[v+1],D=t[v+2];E<e&&(e=E),L<n&&(n=L),D<s&&(s=D),E>l&&(l=E),L>p&&(p=L),D>_&&(_=D)}return this.min.set(e,n,s),this.max.set(l,p,_),this},i.setFromBufferAttribute=function(t){for(var e=1/0,n=1/0,s=1/0,l=-1/0,p=-1/0,_=-1/0,v=0,A=t.count;v<A;v++){var E=t.getX(v),L=t.getY(v),D=t.getZ(v);E<e&&(e=E),L<n&&(n=L),D<s&&(s=D),E>l&&(l=E),L>p&&(p=L),D>_&&(_=D)}return this.min.set(e,n,s),this.max.set(l,p,_),this},i.setFromPoints=function(t){this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},i.setFromCenterAndSize=function(t,e){var n=li.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this},i.setFromObject=function(t){return this.makeEmpty(),this.expandByObject(t)},i.clone=function(){return new this.constructor().copy(this)},i.copy=function(t){return this.min.copy(t.min),this.max.copy(t.max),this},i.makeEmpty=function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},i.isEmpty=function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},i.getCenter=function(t){return t===void 0&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new te),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},i.getSize=function(t){return t===void 0&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new te),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},i.expandByPoint=function(t){return this.min.min(t),this.max.max(t),this},i.expandByVector=function(t){return this.min.sub(t),this.max.add(t),this},i.expandByScalar=function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},i.expandByObject=function(t){t.updateWorldMatrix(!1,!1);var e=t.geometry;e!==void 0&&(e.boundingBox===null&&e.computeBoundingBox(),Bn.copy(e.boundingBox),Bn.applyMatrix4(t.matrixWorld),this.union(Bn));for(var n=t.children,s=0,l=n.length;s<l;s++)this.expandByObject(n[s]);return this},i.containsPoint=function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},i.containsBox=function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},i.getParameter=function(t,e){return e===void 0&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new te),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},i.intersectsBox=function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},i.intersectsSphere=function(t){return this.clampPoint(t.center,li),li.distanceToSquared(t.center)<=t.radius*t.radius},i.intersectsPlane=function(t){var e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant},i.intersectsTriangle=function(t){if(this.isEmpty())return!1;this.getCenter(Zn),gr.subVectors(this.max,Zn),Ki.subVectors(t.a,Zn),Yi.subVectors(t.b,Zn),dn.subVectors(t.c,Zn),pn.subVectors(Yi,Ki),nn.subVectors(dn,Yi),fn.subVectors(Ki,dn);var e=[0,-pn.z,pn.y,0,-nn.z,nn.y,0,-fn.z,fn.y,pn.z,0,-pn.x,nn.z,0,-nn.x,fn.z,0,-fn.x,-pn.y,pn.x,0,-nn.y,nn.x,0,-fn.y,fn.x,0];return!!Vr(e,Ki,Yi,dn,gr)&&!!Vr(e=[1,0,0,0,1,0,0,0,1],Ki,Yi,dn,gr)&&(Qn.crossVectors(pn,nn),Vr(e=[Qn.x,Qn.y,Qn.z],Ki,Yi,dn,gr))},i.clampPoint=function(t,e){return e===void 0&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new te),e.copy(t).clamp(this.min,this.max)},i.distanceToPoint=function(t){return li.copy(t).clamp(this.min,this.max).sub(t).length()},i.getBoundingSphere=function(t){return t===void 0&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(li).length(),t},i.intersect=function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},i.union=function(t){return this.min.min(t.min),this.max.max(t.max),this},i.applyMatrix4=function(t){return this.isEmpty()||(Li[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Li[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Li[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Li[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Li[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Li[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Li[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Li[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Li)),this},i.translate=function(t){return this.min.add(t),this.max.add(t),this},i.equals=function(t){return t.min.equals(this.min)&&t.max.equals(this.max)},a}();xi.prototype.isBox3=!0;var Li=[new te,new te,new te,new te,new te,new te,new te,new te],li=new te,Bn=new xi,Ki=new te,Yi=new te,dn=new te,pn=new te,nn=new te,fn=new te,Zn=new te,gr=new te,Qn=new te,En=new te;function Vr(a,i,t,e,n){for(var s=0,l=a.length-3;s<=l;s+=3){En.fromArray(a,s);var p=n.x*Math.abs(En.x)+n.y*Math.abs(En.y)+n.z*Math.abs(En.z),_=i.dot(En),v=t.dot(En),A=e.dot(En);if(Math.max(-Math.max(_,v,A),Math.min(_,v,A))>p)return!1}return!0}var ms=new xi,mn=function(){function a(t,e){t===void 0&&(t=new te),e===void 0&&(e=-1),this.center=t,this.radius=e}var i=a.prototype;return i.set=function(t,e){return this.center.copy(t),this.radius=e,this},i.setFromPoints=function(t,e){var n=this.center;e!==void 0?n.copy(e):ms.setFromPoints(t).getCenter(n);for(var s=0,l=0,p=t.length;l<p;l++)s=Math.max(s,n.distanceToSquared(t[l]));return this.radius=Math.sqrt(s),this},i.copy=function(t){return this.center.copy(t.center),this.radius=t.radius,this},i.isEmpty=function(){return this.radius<0},i.makeEmpty=function(){return this.center.set(0,0,0),this.radius=-1,this},i.containsPoint=function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},i.distanceToPoint=function(t){return t.distanceTo(this.center)-this.radius},i.intersectsSphere=function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},i.intersectsBox=function(t){return t.intersectsSphere(this)},i.intersectsPlane=function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},i.clampPoint=function(t,e){var n=this.center.distanceToSquared(t);return e===void 0&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new te),e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},i.getBoundingBox=function(t){return t===void 0&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new xi),this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)},i.applyMatrix4=function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},i.translate=function(t){return this.center.add(t),this},i.equals=function(t){return t.center.equals(this.center)&&t.radius===this.radius},i.clone=function(){return new this.constructor().copy(this)},a}(),rn=new te,vr=new te,yr=new te,_n=new te,Jn=new te,br=new te,Gr=new te,sn=function(){function a(t,e){t===void 0&&(t=new te),e===void 0&&(e=new te(0,0,-1)),this.origin=t,this.direction=e}var i=a.prototype;return i.set=function(t,e){return this.origin.copy(t),this.direction.copy(e),this},i.copy=function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},i.at=function(t,e){return e===void 0&&(console.warn("THREE.Ray: .at() target is now required"),e=new te),e.copy(this.direction).multiplyScalar(t).add(this.origin)},i.lookAt=function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},i.recast=function(t){return this.origin.copy(this.at(t,rn)),this},i.closestPointToPoint=function(t,e){e===void 0&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new te),e.subVectors(t,this.origin);var n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)},i.distanceToPoint=function(t){return Math.sqrt(this.distanceSqToPoint(t))},i.distanceSqToPoint=function(t){var e=rn.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(rn.copy(this.direction).multiplyScalar(e).add(this.origin),rn.distanceToSquared(t))},i.distanceSqToSegment=function(t,e,n,s){vr.copy(t).add(e).multiplyScalar(.5),yr.copy(e).sub(t).normalize(),_n.copy(this.origin).sub(vr);var l,p,_,v,A=.5*t.distanceTo(e),E=-this.direction.dot(yr),L=_n.dot(this.direction),D=-_n.dot(yr),B=_n.lengthSq(),U=Math.abs(1-E*E);if(U>0)if(p=E*L-D,v=A*U,(l=E*D-L)>=0)if(p>=-v)if(p<=v){var V=1/U;_=(l*=V)*(l+E*(p*=V)+2*L)+p*(E*l+p+2*D)+B}else p=A,_=-(l=Math.max(0,-(E*p+L)))*l+p*(p+2*D)+B;else p=-A,_=-(l=Math.max(0,-(E*p+L)))*l+p*(p+2*D)+B;else p<=-v?_=-(l=Math.max(0,-(-E*A+L)))*l+(p=l>0?-A:Math.min(Math.max(-A,-D),A))*(p+2*D)+B:p<=v?(l=0,_=(p=Math.min(Math.max(-A,-D),A))*(p+2*D)+B):_=-(l=Math.max(0,-(E*A+L)))*l+(p=l>0?A:Math.min(Math.max(-A,-D),A))*(p+2*D)+B;else p=E>0?-A:A,_=-(l=Math.max(0,-(E*p+L)))*l+p*(p+2*D)+B;return n&&n.copy(this.direction).multiplyScalar(l).add(this.origin),s&&s.copy(yr).multiplyScalar(p).add(vr),_},i.intersectSphere=function(t,e){rn.subVectors(t.center,this.origin);var n=rn.dot(this.direction),s=rn.dot(rn)-n*n,l=t.radius*t.radius;if(s>l)return null;var p=Math.sqrt(l-s),_=n-p,v=n+p;return _<0&&v<0?null:_<0?this.at(v,e):this.at(_,e)},i.intersectsSphere=function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius},i.distanceToPlane=function(t){var e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;var n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null},i.intersectPlane=function(t,e){var n=this.distanceToPlane(t);return n===null?null:this.at(n,e)},i.intersectsPlane=function(t){var e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0},i.intersectBox=function(t,e){var n,s,l,p,_,v,A=1/this.direction.x,E=1/this.direction.y,L=1/this.direction.z,D=this.origin;return A>=0?(n=(t.min.x-D.x)*A,s=(t.max.x-D.x)*A):(n=(t.max.x-D.x)*A,s=(t.min.x-D.x)*A),E>=0?(l=(t.min.y-D.y)*E,p=(t.max.y-D.y)*E):(l=(t.max.y-D.y)*E,p=(t.min.y-D.y)*E),n>p||l>s?null:((l>n||n!=n)&&(n=l),(p<s||s!=s)&&(s=p),L>=0?(_=(t.min.z-D.z)*L,v=(t.max.z-D.z)*L):(_=(t.max.z-D.z)*L,v=(t.min.z-D.z)*L),n>v||_>s?null:((_>n||n!=n)&&(n=_),(v<s||s!=s)&&(s=v),s<0?null:this.at(n>=0?n:s,e)))},i.intersectsBox=function(t){return this.intersectBox(t,rn)!==null},i.intersectTriangle=function(t,e,n,s,l){Jn.subVectors(e,t),br.subVectors(n,t),Gr.crossVectors(Jn,br);var p,_=this.direction.dot(Gr);if(_>0){if(s)return null;p=1}else{if(!(_<0))return null;p=-1,_=-_}_n.subVectors(this.origin,t);var v=p*this.direction.dot(br.crossVectors(_n,br));if(v<0)return null;var A=p*this.direction.dot(Jn.cross(_n));if(A<0||v+A>_)return null;var E=-p*_n.dot(Gr);return E<0?null:this.at(E/_,l)},i.applyMatrix4=function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},i.equals=function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)},i.clone=function(){return new this.constructor().copy(this)},a}(),ht=function(){function a(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}var i=a.prototype;return i.set=function(t,e,n,s,l,p,_,v,A,E,L,D,B,U,V,j){var K=this.elements;return K[0]=t,K[4]=e,K[8]=n,K[12]=s,K[1]=l,K[5]=p,K[9]=_,K[13]=v,K[2]=A,K[6]=E,K[10]=L,K[14]=D,K[3]=B,K[7]=U,K[11]=V,K[15]=j,this},i.identity=function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},i.clone=function(){return new a().fromArray(this.elements)},i.copy=function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this},i.copyPosition=function(t){var e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this},i.setFromMatrix3=function(t){var e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this},i.extractBasis=function(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},i.makeBasis=function(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this},i.extractRotation=function(t){var e=this.elements,n=t.elements,s=1/An.setFromMatrixColumn(t,0).length(),l=1/An.setFromMatrixColumn(t,1).length(),p=1/An.setFromMatrixColumn(t,2).length();return e[0]=n[0]*s,e[1]=n[1]*s,e[2]=n[2]*s,e[3]=0,e[4]=n[4]*l,e[5]=n[5]*l,e[6]=n[6]*l,e[7]=0,e[8]=n[8]*p,e[9]=n[9]*p,e[10]=n[10]*p,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},i.makeRotationFromEuler=function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,n=t.x,s=t.y,l=t.z,p=Math.cos(n),_=Math.sin(n),v=Math.cos(s),A=Math.sin(s),E=Math.cos(l),L=Math.sin(l);if(t.order==="XYZ"){var D=p*E,B=p*L,U=_*E,V=_*L;e[0]=v*E,e[4]=-v*L,e[8]=A,e[1]=B+U*A,e[5]=D-V*A,e[9]=-_*v,e[2]=V-D*A,e[6]=U+B*A,e[10]=p*v}else if(t.order==="YXZ"){var j=v*E,K=v*L,ee=A*E,J=A*L;e[0]=j+J*_,e[4]=ee*_-K,e[8]=p*A,e[1]=p*L,e[5]=p*E,e[9]=-_,e[2]=K*_-ee,e[6]=J+j*_,e[10]=p*v}else if(t.order==="ZXY"){var $=v*E,se=v*L,re=A*E,ie=A*L;e[0]=$-ie*_,e[4]=-p*L,e[8]=re+se*_,e[1]=se+re*_,e[5]=p*E,e[9]=ie-$*_,e[2]=-p*A,e[6]=_,e[10]=p*v}else if(t.order==="ZYX"){var pe=p*E,de=p*L,ye=_*E,Ee=_*L;e[0]=v*E,e[4]=ye*A-de,e[8]=pe*A+Ee,e[1]=v*L,e[5]=Ee*A+pe,e[9]=de*A-ye,e[2]=-A,e[6]=_*v,e[10]=p*v}else if(t.order==="YZX"){var Re=p*v,Le=p*A,le=_*v,_e=_*A;e[0]=v*E,e[4]=_e-Re*L,e[8]=le*L+Le,e[1]=L,e[5]=p*E,e[9]=-_*E,e[2]=-A*E,e[6]=Le*L+le,e[10]=Re-_e*L}else if(t.order==="XZY"){var Ae=p*v,be=p*A,ge=_*v,Te=_*A;e[0]=v*E,e[4]=-L,e[8]=A*E,e[1]=Ae*L+Te,e[5]=p*E,e[9]=be*L-ge,e[2]=ge*L-be,e[6]=_*E,e[10]=Te*L+Ae}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},i.makeRotationFromQuaternion=function(t){return this.compose(Z,t,me)},i.lookAt=function(t,e,n){var s=this.elements;return We.subVectors(t,e),We.lengthSq()===0&&(We.z=1),We.normalize(),xe.crossVectors(n,We),xe.lengthSq()===0&&(Math.abs(n.z)===1?We.x+=1e-4:We.z+=1e-4,We.normalize(),xe.crossVectors(n,We)),xe.normalize(),De.crossVectors(We,xe),s[0]=xe.x,s[4]=De.x,s[8]=We.x,s[1]=xe.y,s[5]=De.y,s[9]=We.y,s[2]=xe.z,s[6]=De.z,s[10]=We.z,this},i.multiply=function(t,e){return e!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},i.premultiply=function(t){return this.multiplyMatrices(t,this)},i.multiplyMatrices=function(t,e){var n=t.elements,s=e.elements,l=this.elements,p=n[0],_=n[4],v=n[8],A=n[12],E=n[1],L=n[5],D=n[9],B=n[13],U=n[2],V=n[6],j=n[10],K=n[14],ee=n[3],J=n[7],$=n[11],se=n[15],re=s[0],ie=s[4],pe=s[8],de=s[12],ye=s[1],Ee=s[5],Re=s[9],Le=s[13],le=s[2],_e=s[6],Ae=s[10],be=s[14],ge=s[3],Te=s[7],Fe=s[11],tt=s[15];return l[0]=p*re+_*ye+v*le+A*ge,l[4]=p*ie+_*Ee+v*_e+A*Te,l[8]=p*pe+_*Re+v*Ae+A*Fe,l[12]=p*de+_*Le+v*be+A*tt,l[1]=E*re+L*ye+D*le+B*ge,l[5]=E*ie+L*Ee+D*_e+B*Te,l[9]=E*pe+L*Re+D*Ae+B*Fe,l[13]=E*de+L*Le+D*be+B*tt,l[2]=U*re+V*ye+j*le+K*ge,l[6]=U*ie+V*Ee+j*_e+K*Te,l[10]=U*pe+V*Re+j*Ae+K*Fe,l[14]=U*de+V*Le+j*be+K*tt,l[3]=ee*re+J*ye+$*le+se*ge,l[7]=ee*ie+J*Ee+$*_e+se*Te,l[11]=ee*pe+J*Re+$*Ae+se*Fe,l[15]=ee*de+J*Le+$*be+se*tt,this},i.multiplyScalar=function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},i.determinant=function(){var t=this.elements,e=t[0],n=t[4],s=t[8],l=t[12],p=t[1],_=t[5],v=t[9],A=t[13],E=t[2],L=t[6],D=t[10],B=t[14];return t[3]*(+l*v*L-s*A*L-l*_*D+n*A*D+s*_*B-n*v*B)+t[7]*(+e*v*B-e*A*D+l*p*D-s*p*B+s*A*E-l*v*E)+t[11]*(+e*A*L-e*_*B-l*p*L+n*p*B+l*_*E-n*A*E)+t[15]*(-s*_*E-e*v*L+e*_*D+s*p*L-n*p*D+n*v*E)},i.transpose=function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},i.setPosition=function(t,e,n){var s=this.elements;return t.isVector3?(s[12]=t.x,s[13]=t.y,s[14]=t.z):(s[12]=t,s[13]=e,s[14]=n),this},i.invert=function(){var t=this.elements,e=t[0],n=t[1],s=t[2],l=t[3],p=t[4],_=t[5],v=t[6],A=t[7],E=t[8],L=t[9],D=t[10],B=t[11],U=t[12],V=t[13],j=t[14],K=t[15],ee=L*j*A-V*D*A+V*v*B-_*j*B-L*v*K+_*D*K,J=U*D*A-E*j*A-U*v*B+p*j*B+E*v*K-p*D*K,$=E*V*A-U*L*A+U*_*B-p*V*B-E*_*K+p*L*K,se=U*L*v-E*V*v-U*_*D+p*V*D+E*_*j-p*L*j,re=e*ee+n*J+s*$+l*se;if(re===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var ie=1/re;return t[0]=ee*ie,t[1]=(V*D*l-L*j*l-V*s*B+n*j*B+L*s*K-n*D*K)*ie,t[2]=(_*j*l-V*v*l+V*s*A-n*j*A-_*s*K+n*v*K)*ie,t[3]=(L*v*l-_*D*l-L*s*A+n*D*A+_*s*B-n*v*B)*ie,t[4]=J*ie,t[5]=(E*j*l-U*D*l+U*s*B-e*j*B-E*s*K+e*D*K)*ie,t[6]=(U*v*l-p*j*l-U*s*A+e*j*A+p*s*K-e*v*K)*ie,t[7]=(p*D*l-E*v*l+E*s*A-e*D*A-p*s*B+e*v*B)*ie,t[8]=$*ie,t[9]=(U*L*l-E*V*l-U*n*B+e*V*B+E*n*K-e*L*K)*ie,t[10]=(p*V*l-U*_*l+U*n*A-e*V*A-p*n*K+e*_*K)*ie,t[11]=(E*_*l-p*L*l-E*n*A+e*L*A+p*n*B-e*_*B)*ie,t[12]=se*ie,t[13]=(E*V*s-U*L*s+U*n*D-e*V*D-E*n*j+e*L*j)*ie,t[14]=(U*_*s-p*V*s-U*n*v+e*V*v+p*n*j-e*_*j)*ie,t[15]=(p*L*s-E*_*s+E*n*v-e*L*v-p*n*D+e*_*D)*ie,this},i.scale=function(t){var e=this.elements,n=t.x,s=t.y,l=t.z;return e[0]*=n,e[4]*=s,e[8]*=l,e[1]*=n,e[5]*=s,e[9]*=l,e[2]*=n,e[6]*=s,e[10]*=l,e[3]*=n,e[7]*=s,e[11]*=l,this},i.getMaxScaleOnAxis=function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],s=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,s))},i.makeTranslation=function(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this},i.makeRotationX=function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this},i.makeRotationY=function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this},i.makeRotationZ=function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this},i.makeRotationAxis=function(t,e){var n=Math.cos(e),s=Math.sin(e),l=1-n,p=t.x,_=t.y,v=t.z,A=l*p,E=l*_;return this.set(A*p+n,A*_-s*v,A*v+s*_,0,A*_+s*v,E*_+n,E*v-s*p,0,A*v-s*_,E*v+s*p,l*v*v+n,0,0,0,0,1),this},i.makeScale=function(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this},i.makeShear=function(t,e,n){return this.set(1,e,n,0,t,1,n,0,t,e,1,0,0,0,0,1),this},i.compose=function(t,e,n){var s=this.elements,l=e._x,p=e._y,_=e._z,v=e._w,A=l+l,E=p+p,L=_+_,D=l*A,B=l*E,U=l*L,V=p*E,j=p*L,K=_*L,ee=v*A,J=v*E,$=v*L,se=n.x,re=n.y,ie=n.z;return s[0]=(1-(V+K))*se,s[1]=(B+$)*se,s[2]=(U-J)*se,s[3]=0,s[4]=(B-$)*re,s[5]=(1-(D+K))*re,s[6]=(j+ee)*re,s[7]=0,s[8]=(U+J)*ie,s[9]=(j-ee)*ie,s[10]=(1-(D+V))*ie,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,this},i.decompose=function(t,e,n){var s=this.elements,l=An.set(s[0],s[1],s[2]).length(),p=An.set(s[4],s[5],s[6]).length(),_=An.set(s[8],s[9],s[10]).length();this.determinant()<0&&(l=-l),t.x=s[12],t.y=s[13],t.z=s[14],Pi.copy(this);var v=1/l,A=1/p,E=1/_;return Pi.elements[0]*=v,Pi.elements[1]*=v,Pi.elements[2]*=v,Pi.elements[4]*=A,Pi.elements[5]*=A,Pi.elements[6]*=A,Pi.elements[8]*=E,Pi.elements[9]*=E,Pi.elements[10]*=E,e.setFromRotationMatrix(Pi),n.x=l,n.y=p,n.z=_,this},i.makePerspective=function(t,e,n,s,l,p){p===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var _=this.elements,v=2*l/(e-t),A=2*l/(n-s),E=(e+t)/(e-t),L=(n+s)/(n-s),D=-(p+l)/(p-l),B=-2*p*l/(p-l);return _[0]=v,_[4]=0,_[8]=E,_[12]=0,_[1]=0,_[5]=A,_[9]=L,_[13]=0,_[2]=0,_[6]=0,_[10]=D,_[14]=B,_[3]=0,_[7]=0,_[11]=-1,_[15]=0,this},i.makeOrthographic=function(t,e,n,s,l,p){var _=this.elements,v=1/(e-t),A=1/(n-s),E=1/(p-l),L=(e+t)*v,D=(n+s)*A,B=(p+l)*E;return _[0]=2*v,_[4]=0,_[8]=0,_[12]=-L,_[1]=0,_[5]=2*A,_[9]=0,_[13]=-D,_[2]=0,_[6]=0,_[10]=-2*E,_[14]=-B,_[3]=0,_[7]=0,_[11]=0,_[15]=1,this},i.equals=function(t){for(var e=this.elements,n=t.elements,s=0;s<16;s++)if(e[s]!==n[s])return!1;return!0},i.fromArray=function(t,e){e===void 0&&(e=0);for(var n=0;n<16;n++)this.elements[n]=t[n+e];return this},i.toArray=function(t,e){t===void 0&&(t=[]),e===void 0&&(e=0);var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t},a}();ht.prototype.isMatrix4=!0;var An=new te,Pi=new ht,Z=new te(0,0,0),me=new te(1,1,1),xe=new te,De=new te,We=new te,Je=new ht,lt=new ni,pt=function(){function a(t,e,n,s){t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0),s===void 0&&(s=a.DefaultOrder),this._x=t,this._y=e,this._z=n,this._order=s}var i=a.prototype;return i.set=function(t,e,n,s){return this._x=t,this._y=e,this._z=n,this._order=s||this._order,this._onChangeCallback(),this},i.clone=function(){return new this.constructor(this._x,this._y,this._z,this._order)},i.copy=function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this},i.setFromRotationMatrix=function(t,e,n){var s=dt.clamp,l=t.elements,p=l[0],_=l[4],v=l[8],A=l[1],E=l[5],L=l[9],D=l[2],B=l[6],U=l[10];switch(e=e||this._order){case"XYZ":this._y=Math.asin(s(v,-1,1)),Math.abs(v)<.9999999?(this._x=Math.atan2(-L,U),this._z=Math.atan2(-_,p)):(this._x=Math.atan2(B,E),this._z=0);break;case"YXZ":this._x=Math.asin(-s(L,-1,1)),Math.abs(L)<.9999999?(this._y=Math.atan2(v,U),this._z=Math.atan2(A,E)):(this._y=Math.atan2(-D,p),this._z=0);break;case"ZXY":this._x=Math.asin(s(B,-1,1)),Math.abs(B)<.9999999?(this._y=Math.atan2(-D,U),this._z=Math.atan2(-_,E)):(this._y=0,this._z=Math.atan2(A,p));break;case"ZYX":this._y=Math.asin(-s(D,-1,1)),Math.abs(D)<.9999999?(this._x=Math.atan2(B,U),this._z=Math.atan2(A,p)):(this._x=0,this._z=Math.atan2(-_,E));break;case"YZX":this._z=Math.asin(s(A,-1,1)),Math.abs(A)<.9999999?(this._x=Math.atan2(-L,E),this._y=Math.atan2(-D,p)):(this._x=0,this._y=Math.atan2(v,U));break;case"XZY":this._z=Math.asin(-s(_,-1,1)),Math.abs(_)<.9999999?(this._x=Math.atan2(B,E),this._y=Math.atan2(v,p)):(this._x=Math.atan2(-L,U),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,n!==!1&&this._onChangeCallback(),this},i.setFromQuaternion=function(t,e,n){return Je.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Je,e,n)},i.setFromVector3=function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},i.reorder=function(t){return lt.setFromEuler(this),this.setFromQuaternion(lt,t)},i.equals=function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},i.fromArray=function(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this},i.toArray=function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},i.toVector3=function(t){return t?t.set(this._x,this._y,this._z):new te(this._x,this._y,this._z)},i._onChange=function(t){return this._onChangeCallback=t,this},i._onChangeCallback=function(){},gi(a,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"order",get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}}]),a}();pt.prototype.isEuler=!0,pt.DefaultOrder="XYZ",pt.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var Bt=function(){function a(){this.mask=1}var i=a.prototype;return i.set=function(t){this.mask=1<<t|0},i.enable=function(t){this.mask|=1<<t|0},i.enableAll=function(){this.mask=-1},i.toggle=function(t){this.mask^=1<<t|0},i.disable=function(t){this.mask&=~(1<<t|0)},i.disableAll=function(){this.mask=0},i.test=function(t){return(this.mask&t.mask)!=0},a}(),Di=0,Ri=new te,an=new ni,Ei=new ht,_s=new te,Hr=new te,ma=new te,Xl=new ni,Lo=new te(1,0,0),Po=new te(0,1,0),Do=new te(0,0,1),Ne={type:"added"},it={type:"removed"};function Ge(){Object.defineProperty(this,"id",{value:Di++}),this.uuid=dt.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ge.DefaultUp.clone();var a=new te,i=new pt,t=new ni,e=new te(1,1,1);i._onChange(function(){t.setFromEuler(i,!1)}),t._onChange(function(){i.setFromQuaternion(t,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:a},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:t},scale:{configurable:!0,enumerable:!0,value:e},modelViewMatrix:{value:new ht},normalMatrix:{value:new Vt}}),this.matrix=new ht,this.matrixWorld=new ht,this.matrixAutoUpdate=Ge.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Bt,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}Ge.DefaultUp=new te(0,1,0),Ge.DefaultMatrixAutoUpdate=!0,Ge.prototype=Object.assign(Object.create(wi.prototype),{constructor:Ge,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(i){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(i),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(i){return this.quaternion.premultiply(i),this},setRotationFromAxisAngle:function(i,t){this.quaternion.setFromAxisAngle(i,t)},setRotationFromEuler:function(i){this.quaternion.setFromEuler(i,!0)},setRotationFromMatrix:function(i){this.quaternion.setFromRotationMatrix(i)},setRotationFromQuaternion:function(i){this.quaternion.copy(i)},rotateOnAxis:function(i,t){return an.setFromAxisAngle(i,t),this.quaternion.multiply(an),this},rotateOnWorldAxis:function(i,t){return an.setFromAxisAngle(i,t),this.quaternion.premultiply(an),this},rotateX:function(i){return this.rotateOnAxis(Lo,i)},rotateY:function(i){return this.rotateOnAxis(Po,i)},rotateZ:function(i){return this.rotateOnAxis(Do,i)},translateOnAxis:function(i,t){return Ri.copy(i).applyQuaternion(this.quaternion),this.position.add(Ri.multiplyScalar(t)),this},translateX:function(i){return this.translateOnAxis(Lo,i)},translateY:function(i){return this.translateOnAxis(Po,i)},translateZ:function(i){return this.translateOnAxis(Do,i)},localToWorld:function(i){return i.applyMatrix4(this.matrixWorld)},worldToLocal:function(i){return i.applyMatrix4(Ei.copy(this.matrixWorld).invert())},lookAt:function(i,t,e){i.isVector3?_s.copy(i):_s.set(i,t,e);var n=this.parent;this.updateWorldMatrix(!0,!1),Hr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ei.lookAt(Hr,_s,this.up):Ei.lookAt(_s,Hr,this.up),this.quaternion.setFromRotationMatrix(Ei),n&&(Ei.extractRotation(n.matrixWorld),an.setFromRotationMatrix(Ei),this.quaternion.premultiply(an.invert()))},add:function(i){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return i===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",i),this):(i&&i.isObject3D?(i.parent!==null&&i.parent.remove(i),i.parent=this,this.children.push(i),i.dispatchEvent(Ne)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",i),this)},remove:function(i){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var e=this.children.indexOf(i);return e!==-1&&(i.parent=null,this.children.splice(e,1),i.dispatchEvent(it)),this},clear:function(){for(var i=0;i<this.children.length;i++){var t=this.children[i];t.parent=null,t.dispatchEvent(it)}return this.children.length=0,this},attach:function(i){return this.updateWorldMatrix(!0,!1),Ei.copy(this.matrixWorld).invert(),i.parent!==null&&(i.parent.updateWorldMatrix(!0,!1),Ei.multiply(i.parent.matrixWorld)),i.applyMatrix4(Ei),this.add(i),i.updateWorldMatrix(!1,!0),this},getObjectById:function(i){return this.getObjectByProperty("id",i)},getObjectByName:function(i){return this.getObjectByProperty("name",i)},getObjectByProperty:function(i,t){if(this[i]===t)return this;for(var e=0,n=this.children.length;e<n;e++){var s=this.children[e].getObjectByProperty(i,t);if(s!==void 0)return s}},getWorldPosition:function(i){return i===void 0&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),i=new te),this.updateWorldMatrix(!0,!1),i.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(i){return i===void 0&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),i=new ni),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Hr,i,ma),i},getWorldScale:function(i){return i===void 0&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),i=new te),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Hr,Xl,i),i},getWorldDirection:function(i){i===void 0&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),i=new te),this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return i.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(i){i(this);for(var t=this.children,e=0,n=t.length;e<n;e++)t[e].traverse(i)},traverseVisible:function(i){if(this.visible!==!1){i(this);for(var t=this.children,e=0,n=t.length;e<n;e++)t[e].traverseVisible(i)}},traverseAncestors:function(i){var t=this.parent;t!==null&&(i(t),t.traverseAncestors(i))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(i){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||i)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,i=!0);for(var t=this.children,e=0,n=t.length;e<n;e++)t[e].updateMatrixWorld(i)},updateWorldMatrix:function(i,t){var e=this.parent;if(i===!0&&e!==null&&e.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0)for(var n=this.children,s=0,l=n.length;s<l;s++)n[s].updateWorldMatrix(!1,!0)},toJSON:function(i){var t=i===void 0||typeof i=="string",e={};t&&(i={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},e.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var n={};function s(pe,de){return pe[de.uuid]===void 0&&(pe[de.uuid]=de.toJSON(i)),de.uuid}if(n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){n.geometry=s(i.geometries,this.geometry);var l=this.geometry.parameters;if(l!==void 0&&l.shapes!==void 0){var p=l.shapes;if(Array.isArray(p))for(var _=0,v=p.length;_<v;_++){var A=p[_];s(i.shapes,A)}else s(i.shapes,p)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(i.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){for(var E=[],L=0,D=this.material.length;L<D;L++)E.push(s(i.materials,this.material[L]));n.material=E}else n.material=s(i.materials,this.material);if(this.children.length>0){n.children=[];for(var B=0;B<this.children.length;B++)n.children.push(this.children[B].toJSON(i).object)}if(this.animations.length>0){n.animations=[];for(var U=0;U<this.animations.length;U++){var V=this.animations[U];n.animations.push(s(i.animations,V))}}if(t){var j=ie(i.geometries),K=ie(i.materials),ee=ie(i.textures),J=ie(i.images),$=ie(i.shapes),se=ie(i.skeletons),re=ie(i.animations);j.length>0&&(e.geometries=j),K.length>0&&(e.materials=K),ee.length>0&&(e.textures=ee),J.length>0&&(e.images=J),$.length>0&&(e.shapes=$),se.length>0&&(e.skeletons=se),re.length>0&&(e.animations=re)}return e.object=n,e;function ie(pe){var de=[];for(var ye in pe){var Ee=pe[ye];delete Ee.metadata,de.push(Ee)}return de}},clone:function(i){return new this.constructor().copy(this,i)},copy:function(i,t){if(t===void 0&&(t=!0),this.name=i.name,this.up.copy(i.up),this.position.copy(i.position),this.rotation.order=i.rotation.order,this.quaternion.copy(i.quaternion),this.scale.copy(i.scale),this.matrix.copy(i.matrix),this.matrixWorld.copy(i.matrixWorld),this.matrixAutoUpdate=i.matrixAutoUpdate,this.matrixWorldNeedsUpdate=i.matrixWorldNeedsUpdate,this.layers.mask=i.layers.mask,this.visible=i.visible,this.castShadow=i.castShadow,this.receiveShadow=i.receiveShadow,this.frustumCulled=i.frustumCulled,this.renderOrder=i.renderOrder,this.userData=JSON.parse(JSON.stringify(i.userData)),t===!0)for(var e=0;e<i.children.length;e++){var n=i.children[e];this.add(n.clone())}return this}});var vt=new te,$n=new te,Nn=new Vt,Oi=function(){function a(t,e){t===void 0&&(t=new te(1,0,0)),e===void 0&&(e=0),this.normal=t,this.constant=e}var i=a.prototype;return i.set=function(t,e){return this.normal.copy(t),this.constant=e,this},i.setComponents=function(t,e,n,s){return this.normal.set(t,e,n),this.constant=s,this},i.setFromNormalAndCoplanarPoint=function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},i.setFromCoplanarPoints=function(t,e,n){var s=vt.subVectors(n,e).cross($n.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(s,t),this},i.copy=function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},i.normalize=function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},i.negate=function(){return this.constant*=-1,this.normal.negate(),this},i.distanceToPoint=function(t){return this.normal.dot(t)+this.constant},i.distanceToSphere=function(t){return this.distanceToPoint(t.center)-t.radius},i.projectPoint=function(t,e){return e===void 0&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new te),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},i.intersectLine=function(t,e){e===void 0&&(console.warn("THREE.Plane: .intersectLine() target is now required"),e=new te);var n=t.delta(vt),s=this.normal.dot(n);if(s===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):void 0;var l=-(t.start.dot(this.normal)+this.constant)/s;return l<0||l>1?void 0:e.copy(n).multiplyScalar(l).add(t.start)},i.intersectsLine=function(t){var e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0},i.intersectsBox=function(t){return t.intersectsPlane(this)},i.intersectsSphere=function(t){return t.intersectsPlane(this)},i.coplanarPoint=function(t){return t===void 0&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new te),t.copy(this.normal).multiplyScalar(-this.constant)},i.applyMatrix4=function(t,e){var n=e||Nn.getNormalMatrix(t),s=this.coplanarPoint(vt).applyMatrix4(t),l=this.normal.applyMatrix3(n).normalize();return this.constant=-s.dot(l),this},i.translate=function(t){return this.constant-=t.dot(this.normal),this},i.equals=function(t){return t.normal.equals(this.normal)&&t.constant===this.constant},i.clone=function(){return new this.constructor().copy(this)},a}();Oi.prototype.isPlane=!0;var Zt=new te,Fi=new te,gs=new te,Ai=new te,Xi=new te,Fn=new te,Ti=new te,ln=new te,Tn=new te,er=new te,Si=function(){function a(t,e,n){t===void 0&&(t=new te),e===void 0&&(e=new te),n===void 0&&(n=new te),this.a=t,this.b=e,this.c=n}a.getNormal=function(t,e,n,s){s===void 0&&(console.warn("THREE.Triangle: .getNormal() target is now required"),s=new te),s.subVectors(n,e),Zt.subVectors(t,e),s.cross(Zt);var l=s.lengthSq();return l>0?s.multiplyScalar(1/Math.sqrt(l)):s.set(0,0,0)},a.getBarycoord=function(t,e,n,s,l){Zt.subVectors(s,e),Fi.subVectors(n,e),gs.subVectors(t,e);var p=Zt.dot(Zt),_=Zt.dot(Fi),v=Zt.dot(gs),A=Fi.dot(Fi),E=Fi.dot(gs),L=p*A-_*_;if(l===void 0&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),l=new te),L===0)return l.set(-2,-1,-1);var D=1/L,B=(A*v-_*E)*D,U=(p*E-_*v)*D;return l.set(1-B-U,U,B)},a.containsPoint=function(t,e,n,s){return this.getBarycoord(t,e,n,s,Ai),Ai.x>=0&&Ai.y>=0&&Ai.x+Ai.y<=1},a.getUV=function(t,e,n,s,l,p,_,v){return this.getBarycoord(t,e,n,s,Ai),v.set(0,0),v.addScaledVector(l,Ai.x),v.addScaledVector(p,Ai.y),v.addScaledVector(_,Ai.z),v},a.isFrontFacing=function(t,e,n,s){return Zt.subVectors(n,e),Fi.subVectors(t,e),Zt.cross(Fi).dot(s)<0};var i=a.prototype;return i.set=function(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this},i.setFromPointsAndIndices=function(t,e,n,s){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[s]),this},i.clone=function(){return new this.constructor().copy(this)},i.copy=function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},i.getArea=function(){return Zt.subVectors(this.c,this.b),Fi.subVectors(this.a,this.b),.5*Zt.cross(Fi).length()},i.getMidpoint=function(t){return t===void 0&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new te),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},i.getNormal=function(t){return a.getNormal(this.a,this.b,this.c,t)},i.getPlane=function(t){return t===void 0&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new Oi),t.setFromCoplanarPoints(this.a,this.b,this.c)},i.getBarycoord=function(t,e){return a.getBarycoord(t,this.a,this.b,this.c,e)},i.getUV=function(t,e,n,s,l){return a.getUV(t,this.a,this.b,this.c,e,n,s,l)},i.containsPoint=function(t){return a.containsPoint(t,this.a,this.b,this.c)},i.isFrontFacing=function(t){return a.isFrontFacing(this.a,this.b,this.c,t)},i.intersectsBox=function(t){return t.intersectsTriangle(this)},i.closestPointToPoint=function(t,e){e===void 0&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),e=new te);var n,s,l=this.a,p=this.b,_=this.c;Xi.subVectors(p,l),Fn.subVectors(_,l),ln.subVectors(t,l);var v=Xi.dot(ln),A=Fn.dot(ln);if(v<=0&&A<=0)return e.copy(l);Tn.subVectors(t,p);var E=Xi.dot(Tn),L=Fn.dot(Tn);if(E>=0&&L<=E)return e.copy(p);var D=v*L-E*A;if(D<=0&&v>=0&&E<=0)return n=v/(v-E),e.copy(l).addScaledVector(Xi,n);er.subVectors(t,_);var B=Xi.dot(er),U=Fn.dot(er);if(U>=0&&B<=U)return e.copy(_);var V=B*A-v*U;if(V<=0&&A>=0&&U<=0)return s=A/(A-U),e.copy(l).addScaledVector(Fn,s);var j=E*U-B*L;if(j<=0&&L-E>=0&&B-U>=0)return Ti.subVectors(_,p),s=(L-E)/(L-E+(B-U)),e.copy(p).addScaledVector(Ti,s);var K=1/(j+V+D);return n=V*K,s=D*K,e.copy(l).addScaledVector(Xi,n).addScaledVector(Fn,s)},i.equals=function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)},a}(),Ro=0;function Gt(){Object.defineProperty(this,"id",{value:Ro++}),this.uuid=dt.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=f,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ji,this.stencilZFail=ji,this.stencilZPass=ji,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}Gt.prototype=Object.assign(Object.create(wi.prototype),{constructor:Gt,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(i){if(i!==void 0)for(var t in i){var e=i[t];if(e!==void 0)if(t!=="shading"){var n=this[t];n!==void 0?n&&n.isColor?n.set(e):n&&n.isVector3&&e&&e.isVector3?n.copy(e):this[t]=e:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===1;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(i){var t=i===void 0||typeof i=="string";t&&(i={textures:{},images:{}});var e={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(p){var _=[];for(var v in p){var A=p[v];delete A.metadata,_.push(A)}return _}if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.color&&this.color.isColor&&(e.color=this.color.getHex()),this.roughness!==void 0&&(e.roughness=this.roughness),this.metalness!==void 0&&(e.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(e.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(e.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(e.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(e.specular=this.specular.getHex()),this.shininess!==void 0&&(e.shininess=this.shininess),this.clearcoat!==void 0&&(e.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(e.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(e.clearcoatMap=this.clearcoatMap.toJSON(i).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(e.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(i).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(e.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(i).uuid,e.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(e.map=this.map.toJSON(i).uuid),this.matcap&&this.matcap.isTexture&&(e.matcap=this.matcap.toJSON(i).uuid),this.alphaMap&&this.alphaMap.isTexture&&(e.alphaMap=this.alphaMap.toJSON(i).uuid),this.lightMap&&this.lightMap.isTexture&&(e.lightMap=this.lightMap.toJSON(i).uuid,e.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(e.aoMap=this.aoMap.toJSON(i).uuid,e.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(e.bumpMap=this.bumpMap.toJSON(i).uuid,e.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(e.normalMap=this.normalMap.toJSON(i).uuid,e.normalMapType=this.normalMapType,e.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(e.displacementMap=this.displacementMap.toJSON(i).uuid,e.displacementScale=this.displacementScale,e.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(e.roughnessMap=this.roughnessMap.toJSON(i).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(e.metalnessMap=this.metalnessMap.toJSON(i).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(e.emissiveMap=this.emissiveMap.toJSON(i).uuid),this.specularMap&&this.specularMap.isTexture&&(e.specularMap=this.specularMap.toJSON(i).uuid),this.envMap&&this.envMap.isTexture&&(e.envMap=this.envMap.toJSON(i).uuid,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,this.combine!==void 0&&(e.combine=this.combine),this.envMapIntensity!==void 0&&(e.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(e.gradientMap=this.gradientMap.toJSON(i).uuid),this.size!==void 0&&(e.size=this.size),this.sizeAttenuation!==void 0&&(e.sizeAttenuation=this.sizeAttenuation),this.blending!==1&&(e.blending=this.blending),this.side!==0&&(e.side=this.side),this.vertexColors&&(e.vertexColors=!0),this.opacity<1&&(e.opacity=this.opacity),this.transparent===!0&&(e.transparent=this.transparent),e.depthFunc=this.depthFunc,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.stencilWrite=this.stencilWrite,e.stencilWriteMask=this.stencilWriteMask,e.stencilFunc=this.stencilFunc,e.stencilRef=this.stencilRef,e.stencilFuncMask=this.stencilFuncMask,e.stencilFail=this.stencilFail,e.stencilZFail=this.stencilZFail,e.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(e.rotation=this.rotation),this.polygonOffset===!0&&(e.polygonOffset=!0),this.polygonOffsetFactor!==0&&(e.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(e.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(e.linewidth=this.linewidth),this.dashSize!==void 0&&(e.dashSize=this.dashSize),this.gapSize!==void 0&&(e.gapSize=this.gapSize),this.scale!==void 0&&(e.scale=this.scale),this.dithering===!0&&(e.dithering=!0),this.alphaTest>0&&(e.alphaTest=this.alphaTest),this.premultipliedAlpha===!0&&(e.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(e.wireframe=this.wireframe),this.wireframeLinewidth>1&&(e.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(e.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(e.wireframeLinejoin=this.wireframeLinejoin),this.morphTargets===!0&&(e.morphTargets=!0),this.morphNormals===!0&&(e.morphNormals=!0),this.skinning===!0&&(e.skinning=!0),this.flatShading===!0&&(e.flatShading=this.flatShading),this.visible===!1&&(e.visible=!1),this.toneMapped===!1&&(e.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(e.userData=this.userData),t){var s=n(i.textures),l=n(i.images);s.length>0&&(e.textures=s),l.length>0&&(e.images=l)}return e},clone:function(){return new this.constructor().copy(this)},copy:function(i){this.name=i.name,this.fog=i.fog,this.blending=i.blending,this.side=i.side,this.vertexColors=i.vertexColors,this.opacity=i.opacity,this.transparent=i.transparent,this.blendSrc=i.blendSrc,this.blendDst=i.blendDst,this.blendEquation=i.blendEquation,this.blendSrcAlpha=i.blendSrcAlpha,this.blendDstAlpha=i.blendDstAlpha,this.blendEquationAlpha=i.blendEquationAlpha,this.depthFunc=i.depthFunc,this.depthTest=i.depthTest,this.depthWrite=i.depthWrite,this.stencilWriteMask=i.stencilWriteMask,this.stencilFunc=i.stencilFunc,this.stencilRef=i.stencilRef,this.stencilFuncMask=i.stencilFuncMask,this.stencilFail=i.stencilFail,this.stencilZFail=i.stencilZFail,this.stencilZPass=i.stencilZPass,this.stencilWrite=i.stencilWrite;var t=i.clippingPlanes,e=null;if(t!==null){var n=t.length;e=new Array(n);for(var s=0;s!==n;++s)e[s]=t[s].clone()}return this.clippingPlanes=e,this.clipIntersection=i.clipIntersection,this.clipShadows=i.clipShadows,this.shadowSide=i.shadowSide,this.colorWrite=i.colorWrite,this.precision=i.precision,this.polygonOffset=i.polygonOffset,this.polygonOffsetFactor=i.polygonOffsetFactor,this.polygonOffsetUnits=i.polygonOffsetUnits,this.dithering=i.dithering,this.alphaTest=i.alphaTest,this.premultipliedAlpha=i.premultipliedAlpha,this.visible=i.visible,this.toneMapped=i.toneMapped,this.userData=JSON.parse(JSON.stringify(i.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Gt.prototype,"needsUpdate",{set:function(i){i===!0&&this.version++}});var tr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},zi={h:0,s:0,l:0},_a={h:0,s:0,l:0};function Oo(a,i,t){return t<0&&(t+=1),t>1&&(t-=1),t<.16666666666666666?a+6*(i-a)*t:t<.5?i:t<.6666666666666666?a+6*(i-a)*(.6666666666666666-t):a}function Io(a){return a<.04045?.0773993808*a:Math.pow(.9478672986*a+.0521327014,2.4)}function Bo(a){return a<.0031308?12.92*a:1.055*Math.pow(a,.41666)-.055}var nt=function(){function a(t,e,n){return e===void 0&&n===void 0?this.set(t):this.setRGB(t,e,n)}var i=a.prototype;return i.set=function(t){return t&&t.isColor?this.copy(t):typeof t=="number"?this.setHex(t):typeof t=="string"&&this.setStyle(t),this},i.setScalar=function(t){return this.r=t,this.g=t,this.b=t,this},i.setHex=function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},i.setRGB=function(t,e,n){return this.r=t,this.g=e,this.b=n,this},i.setHSL=function(t,e,n){if(t=dt.euclideanModulo(t,1),e=dt.clamp(e,0,1),n=dt.clamp(n,0,1),e===0)this.r=this.g=this.b=n;else{var s=n<=.5?n*(1+e):n+e-n*e,l=2*n-s;this.r=Oo(l,s,t+1/3),this.g=Oo(l,s,t),this.b=Oo(l,s,t-1/3)}return this},i.setStyle=function(t){function e(D){D!==void 0&&parseFloat(D)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){var s,l=n[1],p=n[2];switch(l){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(p))return this.r=Math.min(255,parseInt(s[1],10))/255,this.g=Math.min(255,parseInt(s[2],10))/255,this.b=Math.min(255,parseInt(s[3],10))/255,e(s[4]),this;if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(p))return this.r=Math.min(100,parseInt(s[1],10))/100,this.g=Math.min(100,parseInt(s[2],10))/100,this.b=Math.min(100,parseInt(s[3],10))/100,e(s[4]),this;break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(p)){var _=parseFloat(s[1])/360,v=parseInt(s[2],10)/100,A=parseInt(s[3],10)/100;return e(s[4]),this.setHSL(_,v,A)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){var E=n[1],L=E.length;if(L===3)return this.r=parseInt(E.charAt(0)+E.charAt(0),16)/255,this.g=parseInt(E.charAt(1)+E.charAt(1),16)/255,this.b=parseInt(E.charAt(2)+E.charAt(2),16)/255,this;if(L===6)return this.r=parseInt(E.charAt(0)+E.charAt(1),16)/255,this.g=parseInt(E.charAt(2)+E.charAt(3),16)/255,this.b=parseInt(E.charAt(4)+E.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this},i.setColorName=function(t){var e=tr[t];return e!==void 0?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this},i.clone=function(){return new this.constructor(this.r,this.g,this.b)},i.copy=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},i.copyGammaToLinear=function(t,e){return e===void 0&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},i.copyLinearToGamma=function(t,e){e===void 0&&(e=2);var n=e>0?1/e:1;return this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this},i.convertGammaToLinear=function(t){return this.copyGammaToLinear(this,t),this},i.convertLinearToGamma=function(t){return this.copyLinearToGamma(this,t),this},i.copySRGBToLinear=function(t){return this.r=Io(t.r),this.g=Io(t.g),this.b=Io(t.b),this},i.copyLinearToSRGB=function(t){return this.r=Bo(t.r),this.g=Bo(t.g),this.b=Bo(t.b),this},i.convertSRGBToLinear=function(){return this.copySRGBToLinear(this),this},i.convertLinearToSRGB=function(){return this.copyLinearToSRGB(this),this},i.getHex=function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},i.getHexString=function(){return("000000"+this.getHex().toString(16)).slice(-6)},i.getHSL=function(t){t===void 0&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var e,n,s=this.r,l=this.g,p=this.b,_=Math.max(s,l,p),v=Math.min(s,l,p),A=(v+_)/2;if(v===_)e=0,n=0;else{var E=_-v;switch(n=A<=.5?E/(_+v):E/(2-_-v),_){case s:e=(l-p)/E+(l<p?6:0);break;case l:e=(p-s)/E+2;break;case p:e=(s-l)/E+4}e/=6}return t.h=e,t.s=n,t.l=A,t},i.getStyle=function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},i.offsetHSL=function(t,e,n){return this.getHSL(zi),zi.h+=t,zi.s+=e,zi.l+=n,this.setHSL(zi.h,zi.s,zi.l),this},i.add=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},i.addColors=function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},i.addScalar=function(t){return this.r+=t,this.g+=t,this.b+=t,this},i.sub=function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},i.multiply=function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},i.multiplyScalar=function(t){return this.r*=t,this.g*=t,this.b*=t,this},i.lerp=function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},i.lerpColors=function(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this},i.lerpHSL=function(t,e){this.getHSL(zi),t.getHSL(_a);var n=dt.lerp(zi.h,_a.h,e),s=dt.lerp(zi.s,_a.s,e),l=dt.lerp(zi.l,_a.l,e);return this.setHSL(n,s,l),this},i.equals=function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},i.fromArray=function(t,e){return e===void 0&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},i.toArray=function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},i.fromBufferAttribute=function(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),t.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this},i.toJSON=function(){return this.getHex()},a}();nt.NAMES=tr,nt.prototype.isColor=!0,nt.prototype.r=1,nt.prototype.g=1,nt.prototype.b=1;var zn=function(a){function i(t){var e;return(e=a.call(this)||this).type="MeshBasicMaterial",e.color=new nt(16777215),e.map=null,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=null,e.aoMapIntensity=1,e.specularMap=null,e.alphaMap=null,e.envMap=null,e.combine=0,e.reflectivity=1,e.refractionRatio=.98,e.wireframe=!1,e.wireframeLinewidth=1,e.wireframeLinecap="round",e.wireframeLinejoin="round",e.skinning=!1,e.morphTargets=!1,e.setValues(t),e}return Be(i,a),i.prototype.copy=function(t){return a.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this},i}(Gt);zn.prototype.isMeshBasicMaterial=!0;var Qt=new te,ga=new Ve;function ft(a,i,t){if(Array.isArray(a))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=a,this.itemSize=i,this.count=a!==void 0?a.length/i:0,this.normalized=t===!0,this.usage=un,this.updateRange={offset:0,count:-1},this.version=0}function vs(a,i,t){ft.call(this,new Int8Array(a),i,t)}function ys(a,i,t){ft.call(this,new Uint8Array(a),i,t)}function bs(a,i,t){ft.call(this,new Uint8ClampedArray(a),i,t)}function xs(a,i,t){ft.call(this,new Int16Array(a),i,t)}function xr(a,i,t){ft.call(this,new Uint16Array(a),i,t)}function Ss(a,i,t){ft.call(this,new Int32Array(a),i,t)}function Sr(a,i,t){ft.call(this,new Uint32Array(a),i,t)}function ws(a,i,t){ft.call(this,new Uint16Array(a),i,t)}function st(a,i,t){ft.call(this,new Float32Array(a),i,t)}function Es(a,i,t){ft.call(this,new Float64Array(a),i,t)}function ql(a){if(a.length===0)return-1/0;for(var i=a[0],t=1,e=a.length;t<e;++t)a[t]>i&&(i=a[t]);return i}Object.defineProperty(ft.prototype,"needsUpdate",{set:function(i){i===!0&&this.version++}}),Object.assign(ft.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(i){return this.usage=i,this},copy:function(i){return this.name=i.name,this.array=new i.array.constructor(i.array),this.itemSize=i.itemSize,this.count=i.count,this.normalized=i.normalized,this.usage=i.usage,this},copyAt:function(i,t,e){i*=this.itemSize,e*=t.itemSize;for(var n=0,s=this.itemSize;n<s;n++)this.array[i+n]=t.array[e+n];return this},copyArray:function(i){return this.array.set(i),this},copyColorsArray:function(i){for(var t=this.array,e=0,n=0,s=i.length;n<s;n++){var l=i[n];l===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),l=new nt),t[e++]=l.r,t[e++]=l.g,t[e++]=l.b}return this},copyVector2sArray:function(i){for(var t=this.array,e=0,n=0,s=i.length;n<s;n++){var l=i[n];l===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),l=new Ve),t[e++]=l.x,t[e++]=l.y}return this},copyVector3sArray:function(i){for(var t=this.array,e=0,n=0,s=i.length;n<s;n++){var l=i[n];l===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),l=new te),t[e++]=l.x,t[e++]=l.y,t[e++]=l.z}return this},copyVector4sArray:function(i){for(var t=this.array,e=0,n=0,s=i.length;n<s;n++){var l=i[n];l===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),l=new Ft),t[e++]=l.x,t[e++]=l.y,t[e++]=l.z,t[e++]=l.w}return this},applyMatrix3:function(i){if(this.itemSize===2)for(var t=0,e=this.count;t<e;t++)ga.fromBufferAttribute(this,t),ga.applyMatrix3(i),this.setXY(t,ga.x,ga.y);else if(this.itemSize===3)for(var n=0,s=this.count;n<s;n++)Qt.fromBufferAttribute(this,n),Qt.applyMatrix3(i),this.setXYZ(n,Qt.x,Qt.y,Qt.z);return this},applyMatrix4:function(i){for(var t=0,e=this.count;t<e;t++)Qt.x=this.getX(t),Qt.y=this.getY(t),Qt.z=this.getZ(t),Qt.applyMatrix4(i),this.setXYZ(t,Qt.x,Qt.y,Qt.z);return this},applyNormalMatrix:function(i){for(var t=0,e=this.count;t<e;t++)Qt.x=this.getX(t),Qt.y=this.getY(t),Qt.z=this.getZ(t),Qt.applyNormalMatrix(i),this.setXYZ(t,Qt.x,Qt.y,Qt.z);return this},transformDirection:function(i){for(var t=0,e=this.count;t<e;t++)Qt.x=this.getX(t),Qt.y=this.getY(t),Qt.z=this.getZ(t),Qt.transformDirection(i),this.setXYZ(t,Qt.x,Qt.y,Qt.z);return this},set:function(i,t){return t===void 0&&(t=0),this.array.set(i,t),this},getX:function(i){return this.array[i*this.itemSize]},setX:function(i,t){return this.array[i*this.itemSize]=t,this},getY:function(i){return this.array[i*this.itemSize+1]},setY:function(i,t){return this.array[i*this.itemSize+1]=t,this},getZ:function(i){return this.array[i*this.itemSize+2]},setZ:function(i,t){return this.array[i*this.itemSize+2]=t,this},getW:function(i){return this.array[i*this.itemSize+3]},setW:function(i,t){return this.array[i*this.itemSize+3]=t,this},setXY:function(i,t,e){return i*=this.itemSize,this.array[i+0]=t,this.array[i+1]=e,this},setXYZ:function(i,t,e,n){return i*=this.itemSize,this.array[i+0]=t,this.array[i+1]=e,this.array[i+2]=n,this},setXYZW:function(i,t,e,n,s){return i*=this.itemSize,this.array[i+0]=t,this.array[i+1]=e,this.array[i+2]=n,this.array[i+3]=s,this},onUpload:function(i){return this.onUploadCallback=i,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),vs.prototype=Object.create(ft.prototype),vs.prototype.constructor=vs,ys.prototype=Object.create(ft.prototype),ys.prototype.constructor=ys,bs.prototype=Object.create(ft.prototype),bs.prototype.constructor=bs,xs.prototype=Object.create(ft.prototype),xs.prototype.constructor=xs,xr.prototype=Object.create(ft.prototype),xr.prototype.constructor=xr,Ss.prototype=Object.create(ft.prototype),Ss.prototype.constructor=Ss,Sr.prototype=Object.create(ft.prototype),Sr.prototype.constructor=Sr,ws.prototype=Object.create(ft.prototype),ws.prototype.constructor=ws,ws.prototype.isFloat16BufferAttribute=!0,st.prototype=Object.create(ft.prototype),st.prototype.constructor=st,Es.prototype=Object.create(ft.prototype),Es.prototype.constructor=Es;var ou={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function As(a,i){return new ou[a](i)}var lu=0,Mn=new ht,No=new Ge,Kr=new te,qi=new xi,Ts=new xi,vi=new te;function ct(){Object.defineProperty(this,"id",{value:lu++}),this.uuid=dt.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}ct.prototype=Object.assign(Object.create(wi.prototype),{constructor:ct,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(i){return Array.isArray(i)?this.index=new(ql(i)>65535?Sr:xr)(i,1):this.index=i,this},getAttribute:function(i){return this.attributes[i]},setAttribute:function(i,t){return this.attributes[i]=t,this},deleteAttribute:function(i){return delete this.attributes[i],this},hasAttribute:function(i){return this.attributes[i]!==void 0},addGroup:function(i,t,e){e===void 0&&(e=0),this.groups.push({start:i,count:t,materialIndex:e})},clearGroups:function(){this.groups=[]},setDrawRange:function(i,t){this.drawRange.start=i,this.drawRange.count=t},applyMatrix4:function(i){var t=this.attributes.position;t!==void 0&&(t.applyMatrix4(i),t.needsUpdate=!0);var e=this.attributes.normal;if(e!==void 0){var n=new Vt().getNormalMatrix(i);e.applyNormalMatrix(n),e.needsUpdate=!0}var s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(i),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this},rotateX:function(i){return Mn.makeRotationX(i),this.applyMatrix4(Mn),this},rotateY:function(i){return Mn.makeRotationY(i),this.applyMatrix4(Mn),this},rotateZ:function(i){return Mn.makeRotationZ(i),this.applyMatrix4(Mn),this},translate:function(i,t,e){return Mn.makeTranslation(i,t,e),this.applyMatrix4(Mn),this},scale:function(i,t,e){return Mn.makeScale(i,t,e),this.applyMatrix4(Mn),this},lookAt:function(i){return No.lookAt(i),No.updateMatrix(),this.applyMatrix4(No.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Kr).negate(),this.translate(Kr.x,Kr.y,Kr.z),this},setFromPoints:function(i){for(var t=[],e=0,n=i.length;e<n;e++){var s=i[e];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new st(t,3)),this},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new xi);var i=this.attributes.position,t=this.morphAttributes.position;if(i&&i.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new te(-1/0,-1/0,-1/0),new te(1/0,1/0,1/0));if(i!==void 0){if(this.boundingBox.setFromBufferAttribute(i),t)for(var e=0,n=t.length;e<n;e++){var s=t[e];qi.setFromBufferAttribute(s),this.morphTargetsRelative?(vi.addVectors(this.boundingBox.min,qi.min),this.boundingBox.expandByPoint(vi),vi.addVectors(this.boundingBox.max,qi.max),this.boundingBox.expandByPoint(vi)):(this.boundingBox.expandByPoint(qi.min),this.boundingBox.expandByPoint(qi.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new mn);var i=this.attributes.position,t=this.morphAttributes.position;if(i&&i.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new te,1/0);if(i){var e=this.boundingSphere.center;if(qi.setFromBufferAttribute(i),t)for(var n=0,s=t.length;n<s;n++){var l=t[n];Ts.setFromBufferAttribute(l),this.morphTargetsRelative?(vi.addVectors(qi.min,Ts.min),qi.expandByPoint(vi),vi.addVectors(qi.max,Ts.max),qi.expandByPoint(vi)):(qi.expandByPoint(Ts.min),qi.expandByPoint(Ts.max))}qi.getCenter(e);for(var p=0,_=0,v=i.count;_<v;_++)vi.fromBufferAttribute(i,_),p=Math.max(p,e.distanceToSquared(vi));if(t)for(var A=0,E=t.length;A<E;A++)for(var L=t[A],D=this.morphTargetsRelative,B=0,U=L.count;B<U;B++)vi.fromBufferAttribute(L,B),D&&(Kr.fromBufferAttribute(i,B),vi.add(Kr)),p=Math.max(p,e.distanceToSquared(vi));this.boundingSphere.radius=Math.sqrt(p),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeTangents:function(){var i=this.index,t=this.attributes;if(i!==null&&t.position!==void 0&&t.normal!==void 0&&t.uv!==void 0){var e=i.array,n=t.position.array,s=t.normal.array,l=t.uv.array,p=n.length/3;t.tangent===void 0&&this.setAttribute("tangent",new ft(new Float32Array(4*p),4));for(var _=t.tangent.array,v=[],A=[],E=0;E<p;E++)v[E]=new te,A[E]=new te;var L=new te,D=new te,B=new te,U=new Ve,V=new Ve,j=new Ve,K=new te,ee=new te,J=this.groups;J.length===0&&(J=[{start:0,count:e.length}]);for(var $=0,se=J.length;$<se;++$)for(var re=J[$],ie=re.start,pe=ie,de=ie+re.count;pe<de;pe+=3)Fe(e[pe+0],e[pe+1],e[pe+2]);for(var ye=new te,Ee=new te,Re=new te,Le=new te,le=0,_e=J.length;le<_e;++le)for(var Ae=J[le],be=Ae.start,ge=be,Te=be+Ae.count;ge<Te;ge+=3)tt(e[ge+0]),tt(e[ge+1]),tt(e[ge+2])}else console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");function Fe(at,oe,ue){L.fromArray(n,3*at),D.fromArray(n,3*oe),B.fromArray(n,3*ue),U.fromArray(l,2*at),V.fromArray(l,2*oe),j.fromArray(l,2*ue),D.sub(L),B.sub(L),V.sub(U),j.sub(U);var Oe=1/(V.x*j.y-j.x*V.y);isFinite(Oe)&&(K.copy(D).multiplyScalar(j.y).addScaledVector(B,-V.y).multiplyScalar(Oe),ee.copy(B).multiplyScalar(V.x).addScaledVector(D,-j.x).multiplyScalar(Oe),v[at].add(K),v[oe].add(K),v[ue].add(K),A[at].add(ee),A[oe].add(ee),A[ue].add(ee))}function tt(at){Re.fromArray(s,3*at),Le.copy(Re);var oe=v[at];ye.copy(oe),ye.sub(Re.multiplyScalar(Re.dot(oe))).normalize(),Ee.crossVectors(Le,oe);var ue=Ee.dot(A[at])<0?-1:1;_[4*at]=ye.x,_[4*at+1]=ye.y,_[4*at+2]=ye.z,_[4*at+3]=ue}},computeVertexNormals:function(){var i=this.index,t=this.getAttribute("position");if(t!==void 0){var e=this.getAttribute("normal");if(e===void 0)e=new ft(new Float32Array(3*t.count),3),this.setAttribute("normal",e);else for(var n=0,s=e.count;n<s;n++)e.setXYZ(n,0,0,0);var l=new te,p=new te,_=new te,v=new te,A=new te,E=new te,L=new te,D=new te;if(i)for(var B=0,U=i.count;B<U;B+=3){var V=i.getX(B+0),j=i.getX(B+1),K=i.getX(B+2);l.fromBufferAttribute(t,V),p.fromBufferAttribute(t,j),_.fromBufferAttribute(t,K),L.subVectors(_,p),D.subVectors(l,p),L.cross(D),v.fromBufferAttribute(e,V),A.fromBufferAttribute(e,j),E.fromBufferAttribute(e,K),v.add(L),A.add(L),E.add(L),e.setXYZ(V,v.x,v.y,v.z),e.setXYZ(j,A.x,A.y,A.z),e.setXYZ(K,E.x,E.y,E.z)}else for(var ee=0,J=t.count;ee<J;ee+=3)l.fromBufferAttribute(t,ee+0),p.fromBufferAttribute(t,ee+1),_.fromBufferAttribute(t,ee+2),L.subVectors(_,p),D.subVectors(l,p),L.cross(D),e.setXYZ(ee+0,L.x,L.y,L.z),e.setXYZ(ee+1,L.x,L.y,L.z),e.setXYZ(ee+2,L.x,L.y,L.z);this.normalizeNormals(),e.needsUpdate=!0}},merge:function(i,t){if(i&&i.isBufferGeometry){t===void 0&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var e=this.attributes;for(var n in e)if(i.attributes[n]!==void 0)for(var s=e[n].array,l=i.attributes[n],p=l.array,_=l.itemSize*t,v=Math.min(p.length,s.length-_),A=0,E=_;A<v;A++,E++)s[E]=p[A];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",i)},normalizeNormals:function(){for(var i=this.attributes.normal,t=0,e=i.count;t<e;t++)vi.fromBufferAttribute(i,t),vi.normalize(),i.setXYZ(t,vi.x,vi.y,vi.z)},toNonIndexed:function(){function i(K,ee){for(var J=K.array,$=K.itemSize,se=K.normalized,re=new J.constructor(ee.length*$),ie=0,pe=0,de=0,ye=ee.length;de<ye;de++){ie=ee[de]*$;for(var Ee=0;Ee<$;Ee++)re[pe++]=J[ie++]}return new ft(re,$,se)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;var t=new ct,e=this.index.array,n=this.attributes;for(var s in n){var l=i(n[s],e);t.setAttribute(s,l)}var p=this.morphAttributes;for(var _ in p){for(var v=[],A=p[_],E=0,L=A.length;E<L;E++){var D=i(A[E],e);v.push(D)}t.morphAttributes[_]=v}t.morphTargetsRelative=this.morphTargetsRelative;for(var B=this.groups,U=0,V=B.length;U<V;U++){var j=B[U];t.addGroup(j.start,j.count,j.materialIndex)}return t},toJSON:function(){var i={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),Object.keys(this.userData).length>0&&(i.userData=this.userData),this.parameters!==void 0){var t=this.parameters;for(var e in t)t[e]!==void 0&&(i[e]=t[e]);return i}i.data={attributes:{}};var n=this.index;n!==null&&(i.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});var s=this.attributes;for(var l in s){var p=s[l],_=p.toJSON(i.data);p.name!==""&&(_.name=p.name),i.data.attributes[l]=_}var v={},A=!1;for(var E in this.morphAttributes){for(var L=this.morphAttributes[E],D=[],B=0,U=L.length;B<U;B++){var V=L[B],j=V.toJSON(i.data);V.name!==""&&(j.name=V.name),D.push(j)}D.length>0&&(v[E]=D,A=!0)}A&&(i.data.morphAttributes=v,i.data.morphTargetsRelative=this.morphTargetsRelative);var K=this.groups;K.length>0&&(i.data.groups=JSON.parse(JSON.stringify(K)));var ee=this.boundingSphere;return ee!==null&&(i.data.boundingSphere={center:ee.center.toArray(),radius:ee.radius}),i},clone:function(){return new ct().copy(this)},copy:function(i){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var t={};this.name=i.name;var e=i.index;e!==null&&this.setIndex(e.clone(t));var n=i.attributes;for(var s in n){var l=n[s];this.setAttribute(s,l.clone(t))}var p=i.morphAttributes;for(var _ in p){for(var v=[],A=p[_],E=0,L=A.length;E<L;E++)v.push(A[E].clone(t));this.morphAttributes[_]=v}this.morphTargetsRelative=i.morphTargetsRelative;for(var D=i.groups,B=0,U=D.length;B<U;B++){var V=D[B];this.addGroup(V.start,V.count,V.materialIndex)}var j=i.boundingBox;j!==null&&(this.boundingBox=j.clone());var K=i.boundingSphere;return K!==null&&(this.boundingSphere=K.clone()),this.drawRange.start=i.drawRange.start,this.drawRange.count=i.drawRange.count,this.userData=i.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Zl=new ht,Yr=new sn,Fo=new mn,ir=new te,nr=new te,rr=new te,zo=new te,Uo=new te,ko=new te,va=new te,ya=new te,ba=new te,xa=new Ve,Sa=new Ve,wa=new Ve,jo=new te,Ea=new te;function Jt(a,i){a===void 0&&(a=new ct),i===void 0&&(i=new zn),Ge.call(this),this.type="Mesh",this.geometry=a,this.material=i,this.updateMorphTargets()}function Aa(a,i,t,e,n,s,l,p,_,v,A,E){ir.fromBufferAttribute(n,v),nr.fromBufferAttribute(n,A),rr.fromBufferAttribute(n,E);var L=a.morphTargetInfluences;if(i.morphTargets&&s&&L){va.set(0,0,0),ya.set(0,0,0),ba.set(0,0,0);for(var D=0,B=s.length;D<B;D++){var U=L[D],V=s[D];U!==0&&(zo.fromBufferAttribute(V,v),Uo.fromBufferAttribute(V,A),ko.fromBufferAttribute(V,E),l?(va.addScaledVector(zo,U),ya.addScaledVector(Uo,U),ba.addScaledVector(ko,U)):(va.addScaledVector(zo.sub(ir),U),ya.addScaledVector(Uo.sub(nr),U),ba.addScaledVector(ko.sub(rr),U)))}ir.add(va),nr.add(ya),rr.add(ba)}a.isSkinnedMesh&&i.skinning&&(a.boneTransform(v,ir),a.boneTransform(A,nr),a.boneTransform(E,rr));var j=function(ee,J,$,se,re,ie,pe,de){if((J.side===1?se.intersectTriangle(pe,ie,re,!0,de):se.intersectTriangle(re,ie,pe,J.side!==2,de))===null)return null;Ea.copy(de),Ea.applyMatrix4(ee.matrixWorld);var ye=$.ray.origin.distanceTo(Ea);return ye<$.near||ye>$.far?null:{distance:ye,point:Ea.clone(),object:ee}}(a,i,t,e,ir,nr,rr,jo);if(j){p&&(xa.fromBufferAttribute(p,v),Sa.fromBufferAttribute(p,A),wa.fromBufferAttribute(p,E),j.uv=Si.getUV(jo,ir,nr,rr,xa,Sa,wa,new Ve)),_&&(xa.fromBufferAttribute(_,v),Sa.fromBufferAttribute(_,A),wa.fromBufferAttribute(_,E),j.uv2=Si.getUV(jo,ir,nr,rr,xa,Sa,wa,new Ve));var K={a:v,b:A,c:E,normal:new te,materialIndex:0};Si.getNormal(ir,nr,rr,K.normal),j.face=K}return j}Jt.prototype=Object.assign(Object.create(Ge.prototype),{constructor:Jt,isMesh:!0,copy:function(i){return Ge.prototype.copy.call(this,i),i.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=i.morphTargetInfluences.slice()),i.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},i.morphTargetDictionary)),this.material=i.material,this.geometry=i.geometry,this},updateMorphTargets:function(){var i=this.geometry;if(i.isBufferGeometry){var t=i.morphAttributes,e=Object.keys(t);if(e.length>0){var n=t[e[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var s=0,l=n.length;s<l;s++){var p=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[p]=s}}}}else{var _=i.morphTargets;_!==void 0&&_.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(i,t){var e,n=this.geometry,s=this.material,l=this.matrixWorld;if(s!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),Fo.copy(n.boundingSphere),Fo.applyMatrix4(l),i.ray.intersectsSphere(Fo)!==!1&&(Zl.copy(l).invert(),Yr.copy(i.ray).applyMatrix4(Zl),n.boundingBox===null||Yr.intersectsBox(n.boundingBox)!==!1)))if(n.isBufferGeometry){var p=n.index,_=n.attributes.position,v=n.morphAttributes.position,A=n.morphTargetsRelative,E=n.attributes.uv,L=n.attributes.uv2,D=n.groups,B=n.drawRange;if(p!==null)if(Array.isArray(s))for(var U=0,V=D.length;U<V;U++)for(var j=D[U],K=s[j.materialIndex],ee=Math.max(j.start,B.start),J=Math.min(j.start+j.count,B.start+B.count);ee<J;ee+=3){var $=p.getX(ee),se=p.getX(ee+1),re=p.getX(ee+2);(e=Aa(this,K,i,Yr,_,v,A,E,L,$,se,re))&&(e.faceIndex=Math.floor(ee/3),e.face.materialIndex=j.materialIndex,t.push(e))}else for(var ie=Math.max(0,B.start),pe=Math.min(p.count,B.start+B.count);ie<pe;ie+=3){var de=p.getX(ie),ye=p.getX(ie+1),Ee=p.getX(ie+2);(e=Aa(this,s,i,Yr,_,v,A,E,L,de,ye,Ee))&&(e.faceIndex=Math.floor(ie/3),t.push(e))}else if(_!==void 0)if(Array.isArray(s))for(var Re=0,Le=D.length;Re<Le;Re++)for(var le=D[Re],_e=s[le.materialIndex],Ae=Math.max(le.start,B.start),be=Math.min(le.start+le.count,B.start+B.count);Ae<be;Ae+=3)(e=Aa(this,_e,i,Yr,_,v,A,E,L,Ae,Ae+1,Ae+2))&&(e.faceIndex=Math.floor(Ae/3),e.face.materialIndex=le.materialIndex,t.push(e));else for(var ge=Math.max(0,B.start),Te=Math.min(_.count,B.start+B.count);ge<Te;ge+=3)(e=Aa(this,s,i,Yr,_,v,A,E,L,ge,ge+1,ge+2))&&(e.faceIndex=Math.floor(ge/3),t.push(e))}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}});var wr=function(a){function i(t,e,n,s,l,p){var _;t===void 0&&(t=1),e===void 0&&(e=1),n===void 0&&(n=1),s===void 0&&(s=1),l===void 0&&(l=1),p===void 0&&(p=1),(_=a.call(this)||this).type="BoxGeometry",_.parameters={width:t,height:e,depth:n,widthSegments:s,heightSegments:l,depthSegments:p};var v=bi(_);s=Math.floor(s),l=Math.floor(l),p=Math.floor(p);var A=[],E=[],L=[],D=[],B=0,U=0;function V(j,K,ee,J,$,se,re,ie,pe,de,ye){for(var Ee=se/pe,Re=re/de,Le=se/2,le=re/2,_e=ie/2,Ae=pe+1,be=de+1,ge=0,Te=0,Fe=new te,tt=0;tt<be;tt++)for(var at=tt*Re-le,oe=0;oe<Ae;oe++){var ue=oe*Ee-Le;Fe[j]=ue*J,Fe[K]=at*$,Fe[ee]=_e,E.push(Fe.x,Fe.y,Fe.z),Fe[j]=0,Fe[K]=0,Fe[ee]=ie>0?1:-1,L.push(Fe.x,Fe.y,Fe.z),D.push(oe/pe),D.push(1-tt/de),ge+=1}for(var Oe=0;Oe<de;Oe++)for(var Pe=0;Pe<pe;Pe++){var Ue=B+Pe+Ae*Oe,we=B+Pe+Ae*(Oe+1),Se=B+(Pe+1)+Ae*(Oe+1),qe=B+(Pe+1)+Ae*Oe;A.push(Ue,we,qe),A.push(we,Se,qe),Te+=6}v.addGroup(U,Te,ye),U+=Te,B+=ge}return V("z","y","x",-1,-1,n,e,t,p,l,0),V("z","y","x",1,-1,n,e,-t,p,l,1),V("x","z","y",1,1,t,n,e,s,p,2),V("x","z","y",1,-1,t,n,-e,s,p,3),V("x","y","z",1,-1,t,e,n,s,l,4),V("x","y","z",-1,-1,t,e,-n,s,l,5),_.setIndex(A),_.setAttribute("position",new st(E,3)),_.setAttribute("normal",new st(L,3)),_.setAttribute("uv",new st(D,2)),_}return Be(i,a),i}(ct);function Xr(a){var i={};for(var t in a)for(var e in i[t]={},a[t]){var n=a[t][e];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?i[t][e]=n.clone():Array.isArray(n)?i[t][e]=n.slice():i[t][e]=n}return i}function Mi(a){for(var i={},t=0;t<a.length;t++){var e=Xr(a[t]);for(var n in e)i[n]=e[n]}return i}var Ql={clone:Xr,merge:Mi};function Ui(a){Gt.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,a!==void 0&&(a.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(a))}function sr(){Ge.call(this),this.type="Camera",this.matrixWorldInverse=new ht,this.projectionMatrix=new ht,this.projectionMatrixInverse=new ht}function di(a,i,t,e){a===void 0&&(a=50),i===void 0&&(i=1),t===void 0&&(t=.1),e===void 0&&(e=2e3),sr.call(this),this.type="PerspectiveCamera",this.fov=a,this.zoom=1,this.near=t,this.far=e,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}Ui.prototype=Object.create(Gt.prototype),Ui.prototype.constructor=Ui,Ui.prototype.isShaderMaterial=!0,Ui.prototype.copy=function(a){return Gt.prototype.copy.call(this,a),this.fragmentShader=a.fragmentShader,this.vertexShader=a.vertexShader,this.uniforms=Xr(a.uniforms),this.defines=Object.assign({},a.defines),this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.lights=a.lights,this.clipping=a.clipping,this.skinning=a.skinning,this.morphTargets=a.morphTargets,this.morphNormals=a.morphNormals,this.extensions=Object.assign({},a.extensions),this.glslVersion=a.glslVersion,this},Ui.prototype.toJSON=function(a){var i=Gt.prototype.toJSON.call(this,a);for(var t in i.glslVersion=this.glslVersion,i.uniforms={},this.uniforms){var e=this.uniforms[t].value;e&&e.isTexture?i.uniforms[t]={type:"t",value:e.toJSON(a).uuid}:e&&e.isColor?i.uniforms[t]={type:"c",value:e.getHex()}:e&&e.isVector2?i.uniforms[t]={type:"v2",value:e.toArray()}:e&&e.isVector3?i.uniforms[t]={type:"v3",value:e.toArray()}:e&&e.isVector4?i.uniforms[t]={type:"v4",value:e.toArray()}:e&&e.isMatrix3?i.uniforms[t]={type:"m3",value:e.toArray()}:e&&e.isMatrix4?i.uniforms[t]={type:"m4",value:e.toArray()}:i.uniforms[t]={value:e}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader;var n={};for(var s in this.extensions)this.extensions[s]===!0&&(n[s]=!0);return Object.keys(n).length>0&&(i.extensions=n),i},sr.prototype=Object.assign(Object.create(Ge.prototype),{constructor:sr,isCamera:!0,copy:function(i,t){return Ge.prototype.copy.call(this,i,t),this.matrixWorldInverse.copy(i.matrixWorldInverse),this.projectionMatrix.copy(i.projectionMatrix),this.projectionMatrixInverse.copy(i.projectionMatrixInverse),this},getWorldDirection:function(i){i===void 0&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),i=new te),this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return i.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(i){Ge.prototype.updateMatrixWorld.call(this,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()},updateWorldMatrix:function(i,t){Ge.prototype.updateWorldMatrix.call(this,i,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()},clone:function(){return new this.constructor().copy(this)}}),di.prototype=Object.assign(Object.create(sr.prototype),{constructor:di,isPerspectiveCamera:!0,copy:function(i,t){return sr.prototype.copy.call(this,i,t),this.fov=i.fov,this.zoom=i.zoom,this.near=i.near,this.far=i.far,this.focus=i.focus,this.aspect=i.aspect,this.view=i.view===null?null:Object.assign({},i.view),this.filmGauge=i.filmGauge,this.filmOffset=i.filmOffset,this},setFocalLength:function(i){var t=.5*this.getFilmHeight()/i;this.fov=2*dt.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var i=Math.tan(.5*dt.DEG2RAD*this.fov);return .5*this.getFilmHeight()/i},getEffectiveFOV:function(){return 2*dt.RAD2DEG*Math.atan(Math.tan(.5*dt.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(i,t,e,n,s,l){this.aspect=i/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=i,this.view.fullHeight=t,this.view.offsetX=e,this.view.offsetY=n,this.view.width=s,this.view.height=l,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var i=this.near,t=i*Math.tan(.5*dt.DEG2RAD*this.fov)/this.zoom,e=2*t,n=this.aspect*e,s=-.5*n,l=this.view;if(this.view!==null&&this.view.enabled){var p=l.fullWidth,_=l.fullHeight;s+=l.offsetX*n/p,t-=l.offsetY*e/_,n*=l.width/p,e*=l.height/_}var v=this.filmOffset;v!==0&&(s+=i*v/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+n,t,t-e,i,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(i){var t=Ge.prototype.toJSON.call(this,i);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});var qr=90,Ta=function(a){function i(t,e,n){var s;if((s=a.call(this)||this).type="CubeCamera",n.isWebGLCubeRenderTarget!==!0)return console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter."),bi(s);s.renderTarget=n;var l=new di(qr,1,t,e);l.layers=s.layers,l.up.set(0,-1,0),l.lookAt(new te(1,0,0)),s.add(l);var p=new di(qr,1,t,e);p.layers=s.layers,p.up.set(0,-1,0),p.lookAt(new te(-1,0,0)),s.add(p);var _=new di(qr,1,t,e);_.layers=s.layers,_.up.set(0,0,1),_.lookAt(new te(0,1,0)),s.add(_);var v=new di(qr,1,t,e);v.layers=s.layers,v.up.set(0,0,-1),v.lookAt(new te(0,-1,0)),s.add(v);var A=new di(qr,1,t,e);A.layers=s.layers,A.up.set(0,-1,0),A.lookAt(new te(0,0,1)),s.add(A);var E=new di(qr,1,t,e);return E.layers=s.layers,E.up.set(0,-1,0),E.lookAt(new te(0,0,-1)),s.add(E),s}return Be(i,a),i.prototype.update=function(t,e){this.parent===null&&this.updateMatrixWorld();var n=this.renderTarget,s=this.children,l=s[0],p=s[1],_=s[2],v=s[3],A=s[4],E=s[5],L=t.xr.enabled,D=t.getRenderTarget();t.xr.enabled=!1;var B=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,l),t.setRenderTarget(n,1),t.render(e,p),t.setRenderTarget(n,2),t.render(e,_),t.setRenderTarget(n,3),t.render(e,v),t.setRenderTarget(n,4),t.render(e,A),n.texture.generateMipmaps=B,t.setRenderTarget(n,5),t.render(e,E),t.setRenderTarget(D),t.xr.enabled=L},i}(Ge),Zr=function(a){function i(t,e,n,s,l,p,_,v,A,E){var L;return t=t!==void 0?t:[],e=e!==void 0?e:b,_=_!==void 0?_:G,(L=a.call(this,t,e,n,s,l,p,_,v,A,E)||this)._needsFlipEnvMap=!0,L.flipY=!1,L}return Be(i,a),gi(i,[{key:"images",get:function(){return this.image},set:function(e){this.image=e}}]),i}(ui);Zr.prototype.isCubeTexture=!0;var Ma=function(a){function i(e,n,s){var l;return Number.isInteger(n)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),n=s),l=a.call(this,e,e,n)||this,n=n||{},l.texture=new Zr(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),l.texture.generateMipmaps=n.generateMipmaps!==void 0&&n.generateMipmaps,l.texture.minFilter=n.minFilter!==void 0?n.minFilter:P,l.texture._needsFlipEnvMap=!1,l}Be(i,a);var t=i.prototype;return t.fromEquirectangularTexture=function(e,n){this.texture.type=n.type,this.texture.format=H,this.texture.encoding=n.encoding,this.texture.generateMipmaps=n.generateMipmaps,this.texture.minFilter=n.minFilter,this.texture.magFilter=n.magFilter;var s={tEquirect:{value:null}},l=`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,p=`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`,_=new wr(5,5,5),v=new Ui({name:"CubemapFromEquirect",uniforms:Xr(s),vertexShader:l,fragmentShader:p,side:1,blending:0});v.uniforms.tEquirect.value=n;var A=new Jt(_,v),E=n.minFilter;return n.minFilter===M&&(n.minFilter=P),new Ta(1,10,this).update(e,A),n.minFilter=E,A.geometry.dispose(),A.material.dispose(),this},t.clear=function(e,n,s,l){for(var p=e.getRenderTarget(),_=0;_<6;_++)e.setRenderTarget(this,_),e.clear(n,s,l);e.setRenderTarget(p)},i}(tn);Ma.prototype.isWebGLCubeRenderTarget=!0;var Qr=function(a){function i(t,e,n,s,l,p,_,v,A,E,L,D){var B;return(B=a.call(this,null,p,_,v,A,E,s,l,L,D)||this).image={data:t||null,width:e||1,height:n||1},B.magFilter=A!==void 0?A:x,B.minFilter=E!==void 0?E:x,B.generateMipmaps=!1,B.flipY=!1,B.unpackAlignment=1,B.needsUpdate=!0,B}return Be(i,a),i}(ui);Qr.prototype.isDataTexture=!0;var Jr=new mn,Ca=new te,Ms=function(){function a(t,e,n,s,l,p){t===void 0&&(t=new Oi),e===void 0&&(e=new Oi),n===void 0&&(n=new Oi),s===void 0&&(s=new Oi),l===void 0&&(l=new Oi),p===void 0&&(p=new Oi),this.planes=[t,e,n,s,l,p]}var i=a.prototype;return i.set=function(t,e,n,s,l,p){var _=this.planes;return _[0].copy(t),_[1].copy(e),_[2].copy(n),_[3].copy(s),_[4].copy(l),_[5].copy(p),this},i.copy=function(t){for(var e=this.planes,n=0;n<6;n++)e[n].copy(t.planes[n]);return this},i.setFromProjectionMatrix=function(t){var e=this.planes,n=t.elements,s=n[0],l=n[1],p=n[2],_=n[3],v=n[4],A=n[5],E=n[6],L=n[7],D=n[8],B=n[9],U=n[10],V=n[11],j=n[12],K=n[13],ee=n[14],J=n[15];return e[0].setComponents(_-s,L-v,V-D,J-j).normalize(),e[1].setComponents(_+s,L+v,V+D,J+j).normalize(),e[2].setComponents(_+l,L+A,V+B,J+K).normalize(),e[3].setComponents(_-l,L-A,V-B,J-K).normalize(),e[4].setComponents(_-p,L-E,V-U,J-ee).normalize(),e[5].setComponents(_+p,L+E,V+U,J+ee).normalize(),this},i.intersectsObject=function(t){var e=t.geometry;return e.boundingSphere===null&&e.computeBoundingSphere(),Jr.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Jr)},i.intersectsSprite=function(t){return Jr.center.set(0,0,0),Jr.radius=.7071067811865476,Jr.applyMatrix4(t.matrixWorld),this.intersectsSphere(Jr)},i.intersectsSphere=function(t){for(var e=this.planes,n=t.center,s=-t.radius,l=0;l<6;l++)if(e[l].distanceToPoint(n)<s)return!1;return!0},i.intersectsBox=function(t){for(var e=this.planes,n=0;n<6;n++){var s=e[n];if(Ca.x=s.normal.x>0?t.max.x:t.min.x,Ca.y=s.normal.y>0?t.max.y:t.min.y,Ca.z=s.normal.z>0?t.max.z:t.min.z,s.distanceToPoint(Ca)<0)return!1}return!0},i.containsPoint=function(t){for(var e=this.planes,n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0},i.clone=function(){return new this.constructor().copy(this)},a}();function Jl(){var a=null,i=!1,t=null,e=null;function n(s,l){t(s,l),e=a.requestAnimationFrame(n)}return{start:function(){i!==!0&&t!==null&&(e=a.requestAnimationFrame(n),i=!0)},stop:function(){a.cancelAnimationFrame(e),i=!1},setAnimationLoop:function(l){t=l},setContext:function(l){a=l}}}function hu(a,i){var t=i.isWebGL2,e=new WeakMap;return{get:function(s){return s.isInterleavedBufferAttribute&&(s=s.data),e.get(s)},remove:function(s){s.isInterleavedBufferAttribute&&(s=s.data);var l=e.get(s);l&&(a.deleteBuffer(l.buffer),e.delete(s))},update:function(s,l){if(s.isGLBufferAttribute){var p=e.get(s);(!p||p.version<s.version)&&e.set(s,{buffer:s.buffer,type:s.type,bytesPerElement:s.elementSize,version:s.version})}else{s.isInterleavedBufferAttribute&&(s=s.data);var _=e.get(s);_===void 0?e.set(s,function(v,A){var E=v.array,L=v.usage,D=a.createBuffer();a.bindBuffer(A,D),a.bufferData(A,E,L),v.onUploadCallback();var B=5126;return E instanceof Float32Array?B=5126:E instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):E instanceof Uint16Array?v.isFloat16BufferAttribute?t?B=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):B=5123:E instanceof Int16Array?B=5122:E instanceof Uint32Array?B=5125:E instanceof Int32Array?B=5124:E instanceof Int8Array?B=5120:E instanceof Uint8Array&&(B=5121),{buffer:D,type:B,bytesPerElement:E.BYTES_PER_ELEMENT,version:v.version}}(s,l)):_.version<s.version&&(function(v,A,E){var L=A.array,D=A.updateRange;a.bindBuffer(E,v),D.count===-1?a.bufferSubData(E,0,L):(t?a.bufferSubData(E,D.offset*L.BYTES_PER_ELEMENT,L,D.offset,D.count):a.bufferSubData(E,D.offset*L.BYTES_PER_ELEMENT,L.subarray(D.offset,D.offset+D.count)),D.count=-1)}(_.buffer,s,l),_.version=s.version)}}}}var Cs=function(a){function i(t,e,n,s){var l;t===void 0&&(t=1),e===void 0&&(e=1),n===void 0&&(n=1),s===void 0&&(s=1),(l=a.call(this)||this).type="PlaneGeometry",l.parameters={width:t,height:e,widthSegments:n,heightSegments:s};for(var p=t/2,_=e/2,v=Math.floor(n),A=Math.floor(s),E=v+1,L=A+1,D=t/v,B=e/A,U=[],V=[],j=[],K=[],ee=0;ee<L;ee++)for(var J=ee*B-_,$=0;$<E;$++){var se=$*D-p;V.push(se,-J,0),j.push(0,0,1),K.push($/v),K.push(1-ee/A)}for(var re=0;re<A;re++)for(var ie=0;ie<v;ie++){var pe=ie+E*re,de=ie+E*(re+1),ye=ie+1+E*(re+1),Ee=ie+1+E*re;U.push(pe,de,Ee),U.push(de,ye,Ee)}return l.setIndex(U),l.setAttribute("position",new st(V,3)),l.setAttribute("normal",new st(j,3)),l.setAttribute("uv",new st(K,2)),l}return Be(i,a),i}(ct),Lt={alphamap_fragment:`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,alphamap_pars_fragment:`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment:`#ifdef ALPHATEST
	if ( diffuseColor.a < ALPHATEST ) discard;
#endif`,aomap_fragment:`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );
	#endif
#endif`,aomap_pars_fragment:`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs:`vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	return vec2( -1.04, 1.04 ) * a004 + r.zw;
}
float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
#if defined ( PHYSICALLY_CORRECT_LIGHTS )
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
#else
	if( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
		return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );
	}
	return 1.0;
#endif
}
vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {
	float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );
	return ( 1.0 - specularColor ) * fresnel + specularColor;
}
vec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {
	float fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );
	vec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;
	return Fr * fresnel + F0;
}
float G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	return 1.0 / ( gl * gv );
}
float G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( incidentLight.direction + viewDir );
	float dotNL = saturate( dot( normal, incidentLight.direction ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( G * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
vec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	return specularColor * brdf.x + brdf.y;
}
void BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
	vec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	vec3 FssEss = F * brdf.x + brdf.y;
	float Ess = brdf.x + brdf.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
float GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {
	return ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );
}
float BlinnExponentToGGXRoughness( const in float blinnExponent ) {
	return sqrt( 2.0 / ( blinnExponent + 2.0 ) );
}
#if defined( USE_SHEEN )
float D_Charlie(float roughness, float NoH) {
	float invAlpha = 1.0 / roughness;
	float cos2h = NoH * NoH;
	float sin2h = max(1.0 - cos2h, 0.0078125);	return (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);
}
float V_Neubelt(float NoV, float NoL) {
	return saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));
}
vec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {
	vec3 N = geometry.normal;
	vec3 V = geometry.viewDir;
	vec3 H = normalize( V + L );
	float dotNH = saturate( dot( N, H ) );
	return specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );
}
#endif`,bumpmap_pars_fragment:`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment:`#ifdef USE_COLOR
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment:`#ifdef USE_COLOR
	varying vec3 vColor;
#endif`,color_pars_vertex:`#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex:`#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor.xyz *= color.xyz;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,common:`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement(a) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract(sin(sn) * c);
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
vec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	float distance = dot( planeNormal, point - pointOnPlane );
	return - distance * planeNormal + point;
}
float sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return sign( dot( point - pointOnPlane, planeNormal ) );
}
vec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,cube_uv_reflection_fragment:`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_maxMipLevel 8.0
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_maxTileSize 256.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		float texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );
		vec2 f = fract( uv );
		uv += 0.5 - f;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		if ( mipInt < cubeUV_maxMipLevel ) {
			uv.y += 2.0 * cubeUV_maxTileSize;
		}
		uv.y += filterInt * 2.0 * cubeUV_minTileSize;
		uv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );
		uv *= texelSize;
		vec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x += texelSize;
		vec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.y += texelSize;
		vec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x -= texelSize;
		vec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		vec3 tm = mix( tl, tr, f.x );
		vec3 bm = mix( bl, br, f.x );
		return mix( tm, bm, f.y );
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex:`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex:`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex:`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment:`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment:`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value ) {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,envmap_fragment:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifndef ENVMAP_TYPE_CUBE_UV
		envColor = envMapTexelToLinear( envColor );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment:`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,envmap_pars_fragment:`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex:`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_physical_pars_fragment:`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {
		vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );
			#else
				vec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
		#else
			vec4 envMapColor = vec4( 0.0 );
		#endif
		return PI * envMapColor.rgb * envMapIntensity;
	}
	float getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {
		float maxMIPLevelScalar = float( maxMIPLevel );
		float sigma = PI * roughness * roughness / ( 1.0 + roughness );
		float desiredMIPLevel = maxMIPLevelScalar + log2( sigma );
		return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );
	}
	vec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( -viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
		#else
			vec3 reflectVec = refract( -viewDir, normal, refractionRatio );
		#endif
		reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
		float specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );
			#else
				vec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
		#endif
		return envMapColor.rgb * envMapIntensity;
	}
#endif`,envmap_vertex:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex:`#ifdef USE_FOG
	fogDepth = - mvPosition.z;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
	varying float fogDepth;
#endif`,fog_fragment:`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, fogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment:`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float fogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment:`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,lightmap_fragment:`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel= texture2D( lightMap, vUv2 );
	reflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
#endif`,lightmap_pars_fragment:`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_vertex:`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );
		#endif
	}
	#pragma unroll_loop_end
#endif`,lights_pars_begin:`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {
	vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	return irradiance;
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		directLight.color = directionalLight.color;
		directLight.direction = directionalLight.direction;
		directLight.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = pointLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		directLight.color = pointLight.color;
		directLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );
		directLight.visible = ( directLight.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = spotLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		float angleCos = dot( directLight.direction, spotLight.direction );
		if ( angleCos > spotLight.coneCos ) {
			float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );
			directLight.color = spotLight.color;
			directLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );
			directLight.visible = true;
		} else {
			directLight.color = vec3( 0.0 );
			directLight.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {
		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			irradiance *= PI;
		#endif
		return irradiance;
	}
#endif`,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;
material.specularRoughness = min( material.specularRoughness, 1.0 );
#ifdef REFLECTIVITY
	material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );
#endif
#ifdef CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheen;
#endif`,lights_physical_pars_fragment:`struct PhysicalMaterial {
	vec3 diffuseColor;
	float specularRoughness;
	vec3 specularColor;
#ifdef CLEARCOAT
	float clearcoat;
	float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	vec3 sheenColor;
#endif
};
#define MAXIMUM_SPECULAR_COEFFICIENT 0.16
#define DEFAULT_SPECULAR_COEFFICIENT 0.04
float clearcoatDHRApprox( const in float roughness, const in float dotNL ) {
	return DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.specularRoughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(		0, 1,		0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	#ifdef CLEARCOAT
		float ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = ccDotNL * directLight.color;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			ccIrradiance *= PI;
		#endif
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
		reflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
	#else
		float clearcoatDHR = 0.0;
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(
			material.specularRoughness,
			directLight.direction,
			geometry,
			material.sheenColor
		);
	#else
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);
	#endif
	reflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef CLEARCOAT
		float ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		reflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
		float ccDotNL = ccDotNV;
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
	#else
		float clearcoatDHR = 0.0;
	#endif
	float clearcoatInv = 1.0 - clearcoatDHR;
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	BRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointDirectLightIrradiance( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotDirectLightIrradiance( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );
	#ifdef CLEARCOAT
		clearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment:`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
	objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
	objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
	objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifndef USE_MORPHNORMALS
		uniform float morphTargetInfluences[ 8 ];
	#else
		uniform float morphTargetInfluences[ 4 ];
	#endif
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	transformed += morphTarget0 * morphTargetInfluences[ 0 ];
	transformed += morphTarget1 * morphTargetInfluences[ 1 ];
	transformed += morphTarget2 * morphTargetInfluences[ 2 ];
	transformed += morphTarget3 * morphTargetInfluences[ 3 ];
	#ifndef USE_MORPHNORMALS
		transformed += morphTarget4 * morphTargetInfluences[ 4 ];
		transformed += morphTarget5 * morphTargetInfluences[ 5 ];
		transformed += morphTarget6 * morphTargetInfluences[ 6 ];
		transformed += morphTarget7 * morphTargetInfluences[ 7 ];
	#endif
#endif`,normal_fragment_begin:`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps:`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,clearcoat_pars_fragment:`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return (( near + viewZ ) * far ) / (( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
							texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
							f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
							texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
							f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex:`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(	1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,	1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,	1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmissionmap_fragment:`#ifdef USE_TRANSMISSIONMAP
	totalTransmission *= texture2D( transmissionMap, vUv ).r;
#endif`,transmissionmap_pars_fragment:`#ifdef USE_TRANSMISSIONMAP
	uniform sampler2D transmissionMap;
#endif`,uv_pars_fragment:`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,uv_pars_vertex:`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,uv_vertex:`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,uv2_pars_fragment:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,uv2_pars_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,uv2_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_frag:`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,cube_frag:`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
	
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <skinbase_vertex>
	#ifdef USE_ENVMAP
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#ifndef FLAT_SHADED
		vNormal = normalize( transformedNormal );
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define REFLECTIVITY
	#define CLEARCOAT
	#define TRANSMISSION
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef TRANSMISSION
	uniform float transmission;
#endif
#ifdef REFLECTIVITY
	uniform float reflectivity;
#endif
#ifdef CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheen;
#endif
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <transmissionmap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <lights_physical_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#ifdef TRANSMISSION
		float totalTransmission = transmission;
	#endif
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <transmissionmap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#ifdef TRANSMISSION
		diffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );
	#endif
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,normal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <packing>
#include <uv_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,normal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,shadow_vert:`#include <common>
#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`},et={common:{diffuse:{value:new nt(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Vt},uv2Transform:{value:new Vt},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Ve(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new nt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new nt(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Vt}},sprite:{diffuse:{value:new nt(15658734)},opacity:{value:1},center:{value:new Ve(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Vt}}},gn={basic:{uniforms:Mi([et.common,et.specularmap,et.envmap,et.aomap,et.lightmap,et.fog]),vertexShader:Lt.meshbasic_vert,fragmentShader:Lt.meshbasic_frag},lambert:{uniforms:Mi([et.common,et.specularmap,et.envmap,et.aomap,et.lightmap,et.emissivemap,et.fog,et.lights,{emissive:{value:new nt(0)}}]),vertexShader:Lt.meshlambert_vert,fragmentShader:Lt.meshlambert_frag},phong:{uniforms:Mi([et.common,et.specularmap,et.envmap,et.aomap,et.lightmap,et.emissivemap,et.bumpmap,et.normalmap,et.displacementmap,et.fog,et.lights,{emissive:{value:new nt(0)},specular:{value:new nt(1118481)},shininess:{value:30}}]),vertexShader:Lt.meshphong_vert,fragmentShader:Lt.meshphong_frag},standard:{uniforms:Mi([et.common,et.envmap,et.aomap,et.lightmap,et.emissivemap,et.bumpmap,et.normalmap,et.displacementmap,et.roughnessmap,et.metalnessmap,et.fog,et.lights,{emissive:{value:new nt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Lt.meshphysical_vert,fragmentShader:Lt.meshphysical_frag},toon:{uniforms:Mi([et.common,et.aomap,et.lightmap,et.emissivemap,et.bumpmap,et.normalmap,et.displacementmap,et.gradientmap,et.fog,et.lights,{emissive:{value:new nt(0)}}]),vertexShader:Lt.meshtoon_vert,fragmentShader:Lt.meshtoon_frag},matcap:{uniforms:Mi([et.common,et.bumpmap,et.normalmap,et.displacementmap,et.fog,{matcap:{value:null}}]),vertexShader:Lt.meshmatcap_vert,fragmentShader:Lt.meshmatcap_frag},points:{uniforms:Mi([et.points,et.fog]),vertexShader:Lt.points_vert,fragmentShader:Lt.points_frag},dashed:{uniforms:Mi([et.common,et.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Lt.linedashed_vert,fragmentShader:Lt.linedashed_frag},depth:{uniforms:Mi([et.common,et.displacementmap]),vertexShader:Lt.depth_vert,fragmentShader:Lt.depth_frag},normal:{uniforms:Mi([et.common,et.bumpmap,et.normalmap,et.displacementmap,{opacity:{value:1}}]),vertexShader:Lt.normal_vert,fragmentShader:Lt.normal_frag},sprite:{uniforms:Mi([et.sprite,et.fog]),vertexShader:Lt.sprite_vert,fragmentShader:Lt.sprite_frag},background:{uniforms:{uvTransform:{value:new Vt},t2D:{value:null}},vertexShader:Lt.background_vert,fragmentShader:Lt.background_frag},cube:{uniforms:Mi([et.envmap,{opacity:{value:1}}]),vertexShader:Lt.cube_vert,fragmentShader:Lt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Lt.equirect_vert,fragmentShader:Lt.equirect_frag},distanceRGBA:{uniforms:Mi([et.common,et.displacementmap,{referencePosition:{value:new te},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Lt.distanceRGBA_vert,fragmentShader:Lt.distanceRGBA_frag},shadow:{uniforms:Mi([et.lights,et.fog,{color:{value:new nt(0)},opacity:{value:1}}]),vertexShader:Lt.shadow_vert,fragmentShader:Lt.shadow_frag}};function cu(a,i,t,e,n){var s,l,p=new nt(0),_=0,v=null,A=0,E=null;function L(D,B){t.buffers.color.setClear(D.r,D.g,D.b,B,n)}return{getClearColor:function(){return p},setClearColor:function(B,U){U===void 0&&(U=1),p.set(B),L(p,_=U)},getClearAlpha:function(){return _},setClearAlpha:function(B){L(p,_=B)},render:function(B,U,V,j){var K=U.isScene===!0?U.background:null;K&&K.isTexture&&(K=i.get(K));var ee=a.xr,J=ee.getSession&&ee.getSession();J&&J.environmentBlendMode==="additive"&&(K=null),K===null?L(p,_):K&&K.isColor&&(L(K,1),j=!0),(a.autoClear||j)&&a.clear(a.autoClearColor,a.autoClearDepth,a.autoClearStencil),K&&(K.isCubeTexture||K.isWebGLCubeRenderTarget||K.mapping===c)?(l===void 0&&((l=new Jt(new wr(1,1,1),new Ui({name:"BackgroundCubeMaterial",uniforms:Xr(gn.cube.uniforms),vertexShader:gn.cube.vertexShader,fragmentShader:gn.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function($,se,re){this.matrixWorld.copyPosition(re.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),e.update(l)),K.isWebGLCubeRenderTarget&&(K=K.texture),l.material.uniforms.envMap.value=K,l.material.uniforms.flipEnvMap.value=K.isCubeTexture&&K._needsFlipEnvMap?-1:1,v===K&&A===K.version&&E===a.toneMapping||(l.material.needsUpdate=!0,v=K,A=K.version,E=a.toneMapping),B.unshift(l,l.geometry,l.material,0,0,null)):K&&K.isTexture&&(s===void 0&&((s=new Jt(new Cs(2,2),new Ui({name:"BackgroundMaterial",uniforms:Xr(gn.background.uniforms),vertexShader:gn.background.vertexShader,fragmentShader:gn.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(s.material,"map",{get:function(){return this.uniforms.t2D.value}}),e.update(s)),s.material.uniforms.t2D.value=K,K.matrixAutoUpdate===!0&&K.updateMatrix(),s.material.uniforms.uvTransform.value.copy(K.matrix),v===K&&A===K.version&&E===a.toneMapping||(s.material.needsUpdate=!0,v=K,A=K.version,E=a.toneMapping),B.unshift(s,s.geometry,s.material,0,0,null))}}}function uu(a,i,t,e){var n=a.getParameter(34921),s=e.isWebGL2?null:i.get("OES_vertex_array_object"),l=e.isWebGL2||s!==null,p={},_=L(null),v=_;function A(J){return e.isWebGL2?a.bindVertexArray(J):s.bindVertexArrayOES(J)}function E(J){return e.isWebGL2?a.deleteVertexArray(J):s.deleteVertexArrayOES(J)}function L(J){for(var $=[],se=[],re=[],ie=0;ie<n;ie++)$[ie]=0,se[ie]=0,re[ie]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:$,enabledAttributes:se,attributeDivisors:re,object:J,attributes:{},index:null}}function D(){for(var J=v.newAttributes,$=0,se=J.length;$<se;$++)J[$]=0}function B(J){U(J,0)}function U(J,$){var se=v.newAttributes,re=v.enabledAttributes,ie=v.attributeDivisors;se[J]=1,re[J]===0&&(a.enableVertexAttribArray(J),re[J]=1),ie[J]!==$&&((e.isWebGL2?a:i.get("ANGLE_instanced_arrays"))[e.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](J,$),ie[J]=$)}function V(){for(var J=v.newAttributes,$=v.enabledAttributes,se=0,re=$.length;se<re;se++)$[se]!==J[se]&&(a.disableVertexAttribArray(se),$[se]=0)}function j(J,$,se,re,ie,pe){e.isWebGL2!==!0||se!==5124&&se!==5125?a.vertexAttribPointer(J,$,se,re,ie,pe):a.vertexAttribIPointer(J,$,se,ie,pe)}function K(){ee(),v!==_&&A((v=_).object)}function ee(){_.geometry=null,_.program=null,_.wireframe=!1}return{setup:function($,se,re,ie,pe){var de=!1;if(l){var ye=function(Re,Le,le){var _e=le.wireframe===!0,Ae=p[Re.id];Ae===void 0&&(Ae={},p[Re.id]=Ae);var be=Ae[Le.id];be===void 0&&(be={},Ae[Le.id]=be);var ge=be[_e];return ge===void 0&&(ge=L(e.isWebGL2?a.createVertexArray():s.createVertexArrayOES()),be[_e]=ge),ge}(ie,re,se);v!==ye&&A((v=ye).object),(de=function(Re,Le){var le=v.attributes,_e=Re.attributes,Ae=0;for(var be in _e){var ge=le[be],Te=_e[be];if(ge===void 0||ge.attribute!==Te||ge.data!==Te.data)return!0;Ae++}return v.attributesNum!==Ae||v.index!==Le}(ie,pe))&&function(Re,Le){var le={},_e=Re.attributes,Ae=0;for(var be in _e){var ge=_e[be],Te={};Te.attribute=ge,ge.data&&(Te.data=ge.data),le[be]=Te,Ae++}v.attributes=le,v.attributesNum=Ae,v.index=Le}(ie,pe)}else{var Ee=se.wireframe===!0;v.geometry===ie.id&&v.program===re.id&&v.wireframe===Ee||(v.geometry=ie.id,v.program=re.id,v.wireframe=Ee,de=!0)}$.isInstancedMesh===!0&&(de=!0),pe!==null&&t.update(pe,34963),de&&(function(Re,Le,le,_e){if(!(e.isWebGL2===!1&&(Re.isInstancedMesh||_e.isInstancedBufferGeometry)&&i.get("ANGLE_instanced_arrays")===null)){D();var Ae=_e.attributes,be=le.getAttributes(),ge=Le.defaultAttributeValues;for(var Te in be){var Fe=be[Te];if(Fe>=0){var tt=Ae[Te];if(tt!==void 0){var at=tt.normalized,oe=tt.itemSize,ue=t.get(tt);if(ue===void 0)continue;var Oe=ue.buffer,Pe=ue.type,Ue=ue.bytesPerElement;if(tt.isInterleavedBufferAttribute){var we=tt.data,Se=we.stride,qe=tt.offset;we&&we.isInstancedInterleavedBuffer?(U(Fe,we.meshPerAttribute),_e._maxInstanceCount===void 0&&(_e._maxInstanceCount=we.meshPerAttribute*we.count)):B(Fe),a.bindBuffer(34962,Oe),j(Fe,oe,Pe,at,Se*Ue,qe*Ue)}else tt.isInstancedBufferAttribute?(U(Fe,tt.meshPerAttribute),_e._maxInstanceCount===void 0&&(_e._maxInstanceCount=tt.meshPerAttribute*tt.count)):B(Fe),a.bindBuffer(34962,Oe),j(Fe,oe,Pe,at,0,0)}else if(Te==="instanceMatrix"){var Ze=t.get(Re.instanceMatrix);if(Ze===void 0)continue;var rt=Ze.buffer,Xe=Ze.type;U(Fe+0,1),U(Fe+1,1),U(Fe+2,1),U(Fe+3,1),a.bindBuffer(34962,rt),a.vertexAttribPointer(Fe+0,4,Xe,!1,64,0),a.vertexAttribPointer(Fe+1,4,Xe,!1,64,16),a.vertexAttribPointer(Fe+2,4,Xe,!1,64,32),a.vertexAttribPointer(Fe+3,4,Xe,!1,64,48)}else if(Te==="instanceColor"){var gt=t.get(Re.instanceColor);if(gt===void 0)continue;var Rt=gt.buffer,Ot=gt.type;U(Fe,1),a.bindBuffer(34962,Rt),a.vertexAttribPointer(Fe,3,Ot,!1,12,0)}else if(ge!==void 0){var St=ge[Te];if(St!==void 0)switch(St.length){case 2:a.vertexAttrib2fv(Fe,St);break;case 3:a.vertexAttrib3fv(Fe,St);break;case 4:a.vertexAttrib4fv(Fe,St);break;default:a.vertexAttrib1fv(Fe,St)}}}}V()}}($,se,re,ie),pe!==null&&a.bindBuffer(34963,t.get(pe).buffer))},reset:K,resetDefaultState:ee,dispose:function(){for(var $ in K(),p){var se=p[$];for(var re in se){var ie=se[re];for(var pe in ie)E(ie[pe].object),delete ie[pe];delete se[re]}delete p[$]}},releaseStatesOfGeometry:function($){if(p[$.id]!==void 0){var se=p[$.id];for(var re in se){var ie=se[re];for(var pe in ie)E(ie[pe].object),delete ie[pe];delete se[re]}delete p[$.id]}},releaseStatesOfProgram:function($){for(var se in p){var re=p[se];if(re[$.id]!==void 0){var ie=re[$.id];for(var pe in ie)E(ie[pe].object),delete ie[pe];delete re[$.id]}}},initAttributes:D,enableAttribute:B,disableUnusedAttributes:V}}function du(a,i,t,e){var n,s=e.isWebGL2;this.setMode=function(l){n=l},this.render=function(l,p){a.drawArrays(n,l,p),t.update(p,n,1)},this.renderInstances=function(l,p,_){if(_!==0){var v,A;if(s)v=a,A="drawArraysInstanced";else if(A="drawArraysInstancedANGLE",(v=i.get("ANGLE_instanced_arrays"))===null)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");v[A](n,l,p,_),t.update(p,n,_)}}}function pu(a,i,t){var e;function n(ee){if(ee==="highp"){if(a.getShaderPrecisionFormat(35633,36338).precision>0&&a.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";ee="mediump"}return ee==="mediump"&&a.getShaderPrecisionFormat(35633,36337).precision>0&&a.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var s=typeof WebGL2RenderingContext<"u"&&a instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&a instanceof WebGL2ComputeRenderingContext,l=t.precision!==void 0?t.precision:"highp",p=n(l);p!==l&&(console.warn("THREE.WebGLRenderer:",l,"not supported, using",p,"instead."),l=p);var _=t.logarithmicDepthBuffer===!0,v=a.getParameter(34930),A=a.getParameter(35660),E=a.getParameter(3379),L=a.getParameter(34076),D=a.getParameter(34921),B=a.getParameter(36347),U=a.getParameter(36348),V=a.getParameter(36349),j=A>0,K=s||i.has("OES_texture_float");return{isWebGL2:s,getMaxAnisotropy:function(){if(e!==void 0)return e;if(i.has("EXT_texture_filter_anisotropic")===!0){var J=i.get("EXT_texture_filter_anisotropic");e=a.getParameter(J.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else e=0;return e},getMaxPrecision:n,precision:l,logarithmicDepthBuffer:_,maxTextures:v,maxVertexTextures:A,maxTextureSize:E,maxCubemapSize:L,maxAttributes:D,maxVertexUniforms:B,maxVaryings:U,maxFragmentUniforms:V,vertexTextures:j,floatFragmentTextures:K,floatVertexTextures:j&&K,maxSamples:s?a.getParameter(36183):0}}function fu(a){var i=this,t=null,e=0,n=!1,s=!1,l=new Oi,p=new Vt,_={value:null,needsUpdate:!1};function v(){_.value!==t&&(_.value=t,_.needsUpdate=e>0),i.numPlanes=e,i.numIntersection=0}function A(E,L,D,B){var U=E!==null?E.length:0,V=null;if(U!==0){if(V=_.value,B!==!0||V===null){var j=D+4*U,K=L.matrixWorldInverse;p.getNormalMatrix(K),(V===null||V.length<j)&&(V=new Float32Array(j));for(var ee=0,J=D;ee!==U;++ee,J+=4)l.copy(E[ee]).applyMatrix4(K,p),l.normal.toArray(V,J),V[J+3]=l.constant}_.value=V,_.needsUpdate=!0}return i.numPlanes=U,i.numIntersection=0,V}this.uniform=_,this.numPlanes=0,this.numIntersection=0,this.init=function(E,L,D){var B=E.length!==0||L||e!==0||n;return n=L,t=A(E,D,0),e=E.length,B},this.beginShadows=function(){s=!0,A(null)},this.endShadows=function(){s=!1,v()},this.setState=function(E,L,D){var B=E.clippingPlanes,U=E.clipIntersection,V=E.clipShadows,j=a.get(E);if(!n||B===null||B.length===0||s&&!V)s?A(null):v();else{var K=s?0:e,ee=4*K,J=j.clippingState||null;_.value=J,J=A(B,L,ee,D);for(var $=0;$!==ee;++$)J[$]=t[$];j.clippingState=J,this.numIntersection=U?this.numPlanes:0,this.numPlanes+=K}}}function mu(a){var i=new WeakMap;function t(n,s){return s===r?n.mapping=b:s===o&&(n.mapping=h),n}function e(n){var s=n.target;s.removeEventListener("dispose",e);var l=i.get(s);l!==void 0&&(i.delete(s),l.dispose())}return{get:function(s){if(s&&s.isTexture){var l=s.mapping;if(l===r||l===o){if(i.has(s))return t(i.get(s).texture,s.mapping);var p=s.image;if(p&&p.height>0){var _=a.getRenderTarget(),v=new Ma(p.height/2);return v.fromEquirectangularTexture(a,s),i.set(s,v),a.setRenderTarget(_),s.addEventListener("dispose",e),t(v.texture,s.mapping)}return null}}return s},dispose:function(){i=new WeakMap}}}function _u(a){var i={};function t(e){if(i[e]!==void 0)return i[e];var n;switch(e){case"WEBGL_depth_texture":n=a.getExtension("WEBGL_depth_texture")||a.getExtension("MOZ_WEBGL_depth_texture")||a.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=a.getExtension("WEBGL_compressed_texture_s3tc")||a.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=a.getExtension("WEBGL_compressed_texture_pvrtc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=a.getExtension(e)}return i[e]=n,n}return{has:function(n){return t(n)!==null},init:function(n){n.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float")},get:function(n){var s=t(n);return s===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),s}}}function gu(a,i,t,e){var n={},s=new WeakMap;function l(_){var v=_.target;for(var A in v.index!==null&&i.remove(v.index),v.attributes)i.remove(v.attributes[A]);v.removeEventListener("dispose",l),delete n[v.id];var E=s.get(v);E&&(i.remove(E),s.delete(v)),e.releaseStatesOfGeometry(v),v.isInstancedBufferGeometry===!0&&delete v._maxInstanceCount,t.memory.geometries--}function p(_){var v=[],A=_.index,E=_.attributes.position,L=0;if(A!==null){var D=A.array;L=A.version;for(var B=0,U=D.length;B<U;B+=3){var V=D[B+0],j=D[B+1],K=D[B+2];v.push(V,j,j,K,K,V)}}else{var ee=E.array;L=E.version;for(var J=0,$=ee.length/3-1;J<$;J+=3){var se=J+0,re=J+1,ie=J+2;v.push(se,re,re,ie,ie,se)}}var pe=new(ql(v)>65535?Sr:xr)(v,1);pe.version=L;var de=s.get(_);de&&i.remove(de),s.set(_,pe)}return{get:function(v,A){return n[A.id]===!0||(A.addEventListener("dispose",l),n[A.id]=!0,t.memory.geometries++),A},update:function(v){var A=v.attributes;for(var E in A)i.update(A[E],34962);var L=v.morphAttributes;for(var D in L)for(var B=L[D],U=0,V=B.length;U<V;U++)i.update(B[U],34962)},getWireframeAttribute:function(v){var A=s.get(v);if(A){var E=v.index;E!==null&&A.version<E.version&&p(v)}else p(v);return s.get(v)}}}function vu(a,i,t,e){var n,s,l,p=e.isWebGL2;this.setMode=function(_){n=_},this.setIndex=function(_){s=_.type,l=_.bytesPerElement},this.render=function(_,v){a.drawElements(n,v,s,_*l),t.update(v,n,1)},this.renderInstances=function(_,v,A){if(A!==0){var E,L;if(p)E=a,L="drawElementsInstanced";else if(L="drawElementsInstancedANGLE",(E=i.get("ANGLE_instanced_arrays"))===null)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");E[L](n,v,s,_*l,A),t.update(v,n,A)}}}function yu(a){var i={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:i,programs:null,autoReset:!0,reset:function(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0},update:function(e,n,s){switch(i.calls++,n){case 4:i.triangles+=s*(e/3);break;case 1:i.lines+=s*(e/2);break;case 3:i.lines+=s*(e-1);break;case 2:i.lines+=s*e;break;case 0:i.points+=s*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function bu(a,i){return a[0]-i[0]}function xu(a,i){return Math.abs(i[1])-Math.abs(a[1])}function Su(a){for(var i={},t=new Float32Array(8),e=[],n=0;n<8;n++)e[n]=[n,0];return{update:function(l,p,_,v){var A=l.morphTargetInfluences,E=A===void 0?0:A.length,L=i[p.id];if(L===void 0){L=[];for(var D=0;D<E;D++)L[D]=[D,0];i[p.id]=L}for(var B=0;B<E;B++){var U=L[B];U[0]=B,U[1]=A[B]}L.sort(xu);for(var V=0;V<8;V++)V<E&&L[V][1]?(e[V][0]=L[V][0],e[V][1]=L[V][1]):(e[V][0]=Number.MAX_SAFE_INTEGER,e[V][1]=0);e.sort(bu);for(var j=_.morphTargets&&p.morphAttributes.position,K=_.morphNormals&&p.morphAttributes.normal,ee=0,J=0;J<8;J++){var $=e[J],se=$[0],re=$[1];se!==Number.MAX_SAFE_INTEGER&&re?(j&&p.getAttribute("morphTarget"+J)!==j[se]&&p.setAttribute("morphTarget"+J,j[se]),K&&p.getAttribute("morphNormal"+J)!==K[se]&&p.setAttribute("morphNormal"+J,K[se]),t[J]=re,ee+=re):(j&&p.hasAttribute("morphTarget"+J)===!0&&p.deleteAttribute("morphTarget"+J),K&&p.hasAttribute("morphNormal"+J)===!0&&p.deleteAttribute("morphNormal"+J),t[J]=0)}var ie=p.morphTargetsRelative?1:1-ee;v.getUniforms().setValue(a,"morphTargetBaseInfluence",ie),v.getUniforms().setValue(a,"morphTargetInfluences",t)}}}function wu(a,i,t,e){var n=new WeakMap;function s(l){var p=l.target;p.removeEventListener("dispose",s),t.remove(p.instanceMatrix),p.instanceColor!==null&&t.remove(p.instanceColor)}return{update:function(p){var _=e.render.frame,v=p.geometry,A=i.get(p,v);return n.get(A)!==_&&(i.update(A),n.set(A,_)),p.isInstancedMesh&&(p.hasEventListener("dispose",s)===!1&&p.addEventListener("dispose",s),t.update(p.instanceMatrix,34962),p.instanceColor!==null&&t.update(p.instanceColor,34962)),A},dispose:function(){n=new WeakMap}}}gn.physical={uniforms:Mi([gn.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Ve(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new nt(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:Lt.meshphysical_vert,fragmentShader:Lt.meshphysical_frag};var Wo=function(a){function i(t,e,n,s){var l;return t===void 0&&(t=null),e===void 0&&(e=1),n===void 0&&(n=1),s===void 0&&(s=1),(l=a.call(this,null)||this).image={data:t,width:e,height:n,depth:s},l.magFilter=x,l.minFilter=x,l.wrapR=m,l.generateMipmaps=!1,l.flipY=!1,l.needsUpdate=!0,l}return Be(i,a),i}(ui);Wo.prototype.isDataTexture2DArray=!0;var Vo=function(a){function i(t,e,n,s){var l;return t===void 0&&(t=null),e===void 0&&(e=1),n===void 0&&(n=1),s===void 0&&(s=1),(l=a.call(this,null)||this).image={data:t,width:e,height:n,depth:s},l.magFilter=x,l.minFilter=x,l.wrapR=m,l.generateMipmaps=!1,l.flipY=!1,l.needsUpdate=!0,l}return Be(i,a),i}(ui);Vo.prototype.isDataTexture3D=!0;var $l=new ui,Eu=new Wo,Au=new Vo,eh=new Zr,th=[],ih=[],nh=new Float32Array(16),rh=new Float32Array(9),sh=new Float32Array(4);function $r(a,i,t){var e=a[0];if(e<=0||e>0)return a;var n=i*t,s=th[n];if(s===void 0&&(s=new Float32Array(n),th[n]=s),i!==0){e.toArray(s,0);for(var l=1,p=0;l!==i;++l)p+=t,a[l].toArray(s,p)}return s}function hn(a,i){if(a.length!==i.length)return!1;for(var t=0,e=a.length;t<e;t++)if(a[t]!==i[t])return!1;return!0}function Zi(a,i){for(var t=0,e=i.length;t<e;t++)a[t]=i[t]}function ah(a,i){var t=ih[i];t===void 0&&(t=new Int32Array(i),ih[i]=t);for(var e=0;e!==i;++e)t[e]=a.allocateTextureUnit();return t}function Tu(a,i){var t=this.cache;t[0]!==i&&(a.uniform1f(this.addr,i),t[0]=i)}function Mu(a,i){var t=this.cache;if(i.x!==void 0)t[0]===i.x&&t[1]===i.y||(a.uniform2f(this.addr,i.x,i.y),t[0]=i.x,t[1]=i.y);else{if(hn(t,i))return;a.uniform2fv(this.addr,i),Zi(t,i)}}function Cu(a,i){var t=this.cache;if(i.x!==void 0)t[0]===i.x&&t[1]===i.y&&t[2]===i.z||(a.uniform3f(this.addr,i.x,i.y,i.z),t[0]=i.x,t[1]=i.y,t[2]=i.z);else if(i.r!==void 0)t[0]===i.r&&t[1]===i.g&&t[2]===i.b||(a.uniform3f(this.addr,i.r,i.g,i.b),t[0]=i.r,t[1]=i.g,t[2]=i.b);else{if(hn(t,i))return;a.uniform3fv(this.addr,i),Zi(t,i)}}function Lu(a,i){var t=this.cache;if(i.x!==void 0)t[0]===i.x&&t[1]===i.y&&t[2]===i.z&&t[3]===i.w||(a.uniform4f(this.addr,i.x,i.y,i.z,i.w),t[0]=i.x,t[1]=i.y,t[2]=i.z,t[3]=i.w);else{if(hn(t,i))return;a.uniform4fv(this.addr,i),Zi(t,i)}}function Pu(a,i){var t=this.cache,e=i.elements;if(e===void 0){if(hn(t,i))return;a.uniformMatrix2fv(this.addr,!1,i),Zi(t,i)}else{if(hn(t,e))return;sh.set(e),a.uniformMatrix2fv(this.addr,!1,sh),Zi(t,e)}}function Du(a,i){var t=this.cache,e=i.elements;if(e===void 0){if(hn(t,i))return;a.uniformMatrix3fv(this.addr,!1,i),Zi(t,i)}else{if(hn(t,e))return;rh.set(e),a.uniformMatrix3fv(this.addr,!1,rh),Zi(t,e)}}function Ru(a,i){var t=this.cache,e=i.elements;if(e===void 0){if(hn(t,i))return;a.uniformMatrix4fv(this.addr,!1,i),Zi(t,i)}else{if(hn(t,e))return;nh.set(e),a.uniformMatrix4fv(this.addr,!1,nh),Zi(t,e)}}function Ou(a,i,t){var e=this.cache,n=t.allocateTextureUnit();e[0]!==n&&(a.uniform1i(this.addr,n),e[0]=n),t.safeSetTexture2D(i||$l,n)}function Iu(a,i,t){var e=this.cache,n=t.allocateTextureUnit();e[0]!==n&&(a.uniform1i(this.addr,n),e[0]=n),t.setTexture2DArray(i||Eu,n)}function Bu(a,i,t){var e=this.cache,n=t.allocateTextureUnit();e[0]!==n&&(a.uniform1i(this.addr,n),e[0]=n),t.setTexture3D(i||Au,n)}function Nu(a,i,t){var e=this.cache,n=t.allocateTextureUnit();e[0]!==n&&(a.uniform1i(this.addr,n),e[0]=n),t.safeSetTextureCube(i||eh,n)}function Fu(a,i){var t=this.cache;t[0]!==i&&(a.uniform1i(this.addr,i),t[0]=i)}function zu(a,i){var t=this.cache;hn(t,i)||(a.uniform2iv(this.addr,i),Zi(t,i))}function Uu(a,i){var t=this.cache;hn(t,i)||(a.uniform3iv(this.addr,i),Zi(t,i))}function ku(a,i){var t=this.cache;hn(t,i)||(a.uniform4iv(this.addr,i),Zi(t,i))}function ju(a,i){var t=this.cache;t[0]!==i&&(a.uniform1ui(this.addr,i),t[0]=i)}function Wu(a,i){a.uniform1fv(this.addr,i)}function Vu(a,i){a.uniform1iv(this.addr,i)}function Gu(a,i){a.uniform2iv(this.addr,i)}function Hu(a,i){a.uniform3iv(this.addr,i)}function Ku(a,i){a.uniform4iv(this.addr,i)}function Yu(a,i){var t=$r(i,this.size,2);a.uniform2fv(this.addr,t)}function Xu(a,i){var t=$r(i,this.size,3);a.uniform3fv(this.addr,t)}function qu(a,i){var t=$r(i,this.size,4);a.uniform4fv(this.addr,t)}function Zu(a,i){var t=$r(i,this.size,4);a.uniformMatrix2fv(this.addr,!1,t)}function Qu(a,i){var t=$r(i,this.size,9);a.uniformMatrix3fv(this.addr,!1,t)}function Ju(a,i){var t=$r(i,this.size,16);a.uniformMatrix4fv(this.addr,!1,t)}function $u(a,i,t){var e=i.length,n=ah(t,e);a.uniform1iv(this.addr,n);for(var s=0;s!==e;++s)t.safeSetTexture2D(i[s]||$l,n[s])}function ed(a,i,t){var e=i.length,n=ah(t,e);a.uniform1iv(this.addr,n);for(var s=0;s!==e;++s)t.safeSetTextureCube(i[s]||eh,n[s])}function td(a,i,t){this.id=a,this.addr=t,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Tu;case 35664:return Mu;case 35665:return Cu;case 35666:return Lu;case 35674:return Pu;case 35675:return Du;case 35676:return Ru;case 5124:case 35670:return Fu;case 35667:case 35671:return zu;case 35668:case 35672:return Uu;case 35669:case 35673:return ku;case 5125:return ju;case 35678:case 36198:case 36298:case 36306:case 35682:return Ou;case 35679:case 36299:case 36307:return Bu;case 35680:case 36300:case 36308:case 36293:return Nu;case 36289:case 36303:case 36311:case 36292:return Iu}}(i.type)}function oh(a,i,t){this.id=a,this.addr=t,this.cache=[],this.size=i.size,this.setValue=function(e){switch(e){case 5126:return Wu;case 35664:return Yu;case 35665:return Xu;case 35666:return qu;case 35674:return Zu;case 35675:return Qu;case 35676:return Ju;case 5124:case 35670:return Vu;case 35667:case 35671:return Gu;case 35668:case 35672:return Hu;case 35669:case 35673:return Ku;case 35678:case 36198:case 36298:case 36306:case 35682:return $u;case 35680:case 36300:case 36308:case 36293:return ed}}(i.type)}function lh(a){this.id=a,this.seq=[],this.map={}}oh.prototype.updateCache=function(a){var i=this.cache;a instanceof Float32Array&&i.length!==a.length&&(this.cache=new Float32Array(a.length)),Zi(i,a)},lh.prototype.setValue=function(a,i,t){for(var e=this.seq,n=0,s=e.length;n!==s;++n){var l=e[n];l.setValue(a,i[l.id],t)}};var Go=/(\w+)(\])?(\[|\.)?/g;function hh(a,i){a.seq.push(i),a.map[i.id]=i}function id(a,i,t){var e=a.name,n=e.length;for(Go.lastIndex=0;;){var s=Go.exec(e),l=Go.lastIndex,p=s[1],_=s[2]==="]",v=s[3];if(_&&(p|=0),v===void 0||v==="["&&l+2===n){hh(t,v===void 0?new td(p,a,i):new oh(p,a,i));break}var A=t.map[p];A===void 0&&hh(t,A=new lh(p)),t=A}}function ar(a,i){this.seq=[],this.map={};for(var t=a.getProgramParameter(i,35718),e=0;e<t;++e){var n=a.getActiveUniform(i,e);id(n,a.getUniformLocation(i,n.name),this)}}function ch(a,i,t){var e=a.createShader(i);return a.shaderSource(e,t),a.compileShader(e),e}ar.prototype.setValue=function(a,i,t,e){var n=this.map[i];n!==void 0&&n.setValue(a,t,e)},ar.prototype.setOptional=function(a,i,t){var e=i[t];e!==void 0&&this.setValue(a,t,e)},ar.upload=function(a,i,t,e){for(var n=0,s=i.length;n!==s;++n){var l=i[n],p=t[l.id];p.needsUpdate!==!1&&l.setValue(a,p.value,e)}},ar.seqWithValue=function(a,i){for(var t=[],e=0,n=a.length;e!==n;++e){var s=a[e];s.id in i&&t.push(s)}return t};var nd=0;function uh(a){switch(a){case _i:return["Linear","( value )"];case Vn:return["sRGB","( value )"];case mr:return["RGBE","( value )"];case In:return["RGBM","( value, 7.0 )"];case bt:return["RGBM","( value, 16.0 )"];case wn:return["RGBD","( value, 256.0 )"];case Gn:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",a),["Linear","( value )"]}}function dh(a,i,t){var e=a.getShaderParameter(i,35713),n=a.getShaderInfoLog(i).trim();return e&&n===""?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+t+`
`+n+function(s){for(var l=s.split(`
`),p=0;p<l.length;p++)l[p]=p+1+": "+l[p];return l.join(`
`)}(a.getShaderSource(i))}function Ls(a,i){var t=uh(i);return"vec4 "+a+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function rd(a,i){var t;switch(i){case 1:t="Linear";break;case 2:t="Reinhard";break;case 3:t="OptimizedCineon";break;case 4:t="ACESFilmic";break;case 5:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",i),t="Linear"}return"vec3 "+a+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function Ps(a){return a!==""}function ph(a,i){return a.replace(/NUM_DIR_LIGHTS/g,i.numDirLights).replace(/NUM_SPOT_LIGHTS/g,i.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,i.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,i.numPointLights).replace(/NUM_HEMI_LIGHTS/g,i.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,i.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,i.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,i.numPointLightShadows)}function fh(a,i){return a.replace(/NUM_CLIPPING_PLANES/g,i.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,i.numClippingPlanes-i.numClipIntersection)}var sd=/^[ \t]*#include +<([\w\d./]+)>/gm;function Ho(a){return a.replace(sd,ad)}function ad(a,i){var t=Lt[i];if(t===void 0)throw new Error("Can not resolve #include <"+i+">");return Ho(t)}var od=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,ld=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function mh(a){return a.replace(ld,_h).replace(od,hd)}function hd(a,i,t,e){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),_h(a,i,t,e)}function _h(a,i,t,e){for(var n="",s=parseInt(i);s<parseInt(t);s++)n+=e.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return n}function gh(a){var i="precision "+a.precision+` float;
precision `+a.precision+" int;";return a.precision==="highp"?i+=`
#define HIGH_PRECISION`:a.precision==="mediump"?i+=`
#define MEDIUM_PRECISION`:a.precision==="lowp"&&(i+=`
#define LOW_PRECISION`),i}function cd(a,i,t,e){var n,s,l,p,_,v=a.getContext(),A=t.defines,E=t.vertexShader,L=t.fragmentShader,D=function(be){var ge="SHADOWMAP_TYPE_BASIC";return be.shadowMapType===1?ge="SHADOWMAP_TYPE_PCF":be.shadowMapType===2?ge="SHADOWMAP_TYPE_PCF_SOFT":be.shadowMapType===3&&(ge="SHADOWMAP_TYPE_VSM"),ge}(t),B=function(be){var ge="ENVMAP_TYPE_CUBE";if(be.envMap)switch(be.envMapMode){case b:case h:ge="ENVMAP_TYPE_CUBE";break;case c:case u:ge="ENVMAP_TYPE_CUBE_UV"}return ge}(t),U=function(be){var ge="ENVMAP_MODE_REFLECTION";if(be.envMap)switch(be.envMapMode){case h:case u:ge="ENVMAP_MODE_REFRACTION"}return ge}(t),V=function(be){var ge="ENVMAP_BLENDING_NONE";if(be.envMap)switch(be.combine){case 0:ge="ENVMAP_BLENDING_MULTIPLY";break;case 1:ge="ENVMAP_BLENDING_MIX";break;case 2:ge="ENVMAP_BLENDING_ADD"}return ge}(t),j=a.gammaFactor>0?a.gammaFactor:1,K=t.isWebGL2?"":function(be){return[be.extensionDerivatives||be.envMapCubeUV||be.bumpMap||be.tangentSpaceNormalMap||be.clearcoatNormalMap||be.flatShading||be.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(be.extensionFragDepth||be.logarithmicDepthBuffer)&&be.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",be.extensionDrawBuffers&&be.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(be.extensionShaderTextureLOD||be.envMap)&&be.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Ps).join(`
`)}(t),ee=function(be){var ge=[];for(var Te in be){var Fe=be[Te];Fe!==!1&&ge.push("#define "+Te+" "+Fe)}return ge.join(`
`)}(A),J=v.createProgram(),$=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?((n=[ee].filter(Ps).join(`
`)).length>0&&(n+=`
`),(s=[K,ee].filter(Ps).join(`
`)).length>0&&(s+=`
`)):(n=[gh(t),"#define SHADER_NAME "+t.shaderName,ee,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+j,"#define MAX_BONES "+t.maxBones,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+U:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.useVertexTexture?"#define BONE_TEXTURE":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+D:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Ps).join(`
`),s=[K,gh(t),"#define SHADER_NAME "+t.shaderName,ee,t.alphaTest?"#define ALPHATEST "+t.alphaTest+(t.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+j,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+B:"",t.envMap?"#define "+U:"",t.envMap?"#define "+V:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.sheen?"#define USE_SHEEN":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+D:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==0?"#define TONE_MAPPING":"",t.toneMapping!==0?Lt.tonemapping_pars_fragment:"",t.toneMapping!==0?rd("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",Lt.encodings_pars_fragment,t.map?Ls("mapTexelToLinear",t.mapEncoding):"",t.matcap?Ls("matcapTexelToLinear",t.matcapEncoding):"",t.envMap?Ls("envMapTexelToLinear",t.envMapEncoding):"",t.emissiveMap?Ls("emissiveMapTexelToLinear",t.emissiveMapEncoding):"",t.lightMap?Ls("lightMapTexelToLinear",t.lightMapEncoding):"",(l="linearToOutputTexel",p=t.outputEncoding,_=uh(p),"vec4 "+l+"( vec4 value ) { return LinearTo"+_[0]+_[1]+"; }"),t.depthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Ps).join(`
`)),E=fh(E=ph(E=Ho(E),t),t),L=fh(L=ph(L=Ho(L),t),t),E=mh(E),L=mh(L),t.isWebGL2&&t.isRawShaderMaterial!==!0&&($=`#version 300 es
`,n=["#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+n,s=["#define varying in",t.glslVersion===Hn?"":"out highp vec4 pc_fragColor;",t.glslVersion===Hn?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+s);var se,re,ie=$+s+L,pe=ch(v,35633,$+n+E),de=ch(v,35632,ie);if(v.attachShader(J,pe),v.attachShader(J,de),t.index0AttributeName!==void 0?v.bindAttribLocation(J,0,t.index0AttributeName):t.morphTargets===!0&&v.bindAttribLocation(J,0,"position"),v.linkProgram(J),a.debug.checkShaderErrors){var ye=v.getProgramInfoLog(J).trim(),Ee=v.getShaderInfoLog(pe).trim(),Re=v.getShaderInfoLog(de).trim(),Le=!0,le=!0;if(v.getProgramParameter(J,35714)===!1){Le=!1;var _e=dh(v,pe,"vertex"),Ae=dh(v,de,"fragment");console.error("THREE.WebGLProgram: shader error: ",v.getError(),"35715",v.getProgramParameter(J,35715),"gl.getProgramInfoLog",ye,_e,Ae)}else ye!==""?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",ye):Ee!==""&&Re!==""||(le=!1);le&&(this.diagnostics={runnable:Le,programLog:ye,vertexShader:{log:Ee,prefix:n},fragmentShader:{log:Re,prefix:s}})}return v.deleteShader(pe),v.deleteShader(de),this.getUniforms=function(){return se===void 0&&(se=new ar(v,J)),se},this.getAttributes=function(){return re===void 0&&(re=function(be,ge){for(var Te={},Fe=be.getProgramParameter(ge,35721),tt=0;tt<Fe;tt++){var at=be.getActiveAttrib(ge,tt).name;Te[at]=be.getAttribLocation(ge,at)}return Te}(v,J)),re},this.destroy=function(){e.releaseStatesOfProgram(this),v.deleteProgram(J),this.program=void 0},this.name=t.shaderName,this.id=nd++,this.cacheKey=i,this.usedTimes=1,this.program=J,this.vertexShader=pe,this.fragmentShader=de,this}function ud(a,i,t,e,n,s){var l=[],p=e.isWebGL2,_=e.logarithmicDepthBuffer,v=e.floatVertexTextures,A=e.maxVertexUniforms,E=e.vertexTextures,L=e.precision,D={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},B=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function U(V){var j;return V&&V.isTexture?j=V.encoding:V&&V.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),j=V.texture.encoding):j=_i,j}return{getParameters:function(j,K,ee,J,$){var se,re,ie=J.fog,pe=j.isMeshStandardMaterial?J.environment:null,de=i.get(j.envMap||pe),ye=D[j.type],Ee=$.isSkinnedMesh?function(le){var _e=le.skeleton.bones;if(v)return 1024;var Ae=A,be=Math.floor((Ae-20)/4),ge=Math.min(be,_e.length);return ge<_e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+_e.length+" bones. This GPU supports "+ge+"."),0):ge}($):0;if(j.precision!==null&&(L=e.getMaxPrecision(j.precision))!==j.precision&&console.warn("THREE.WebGLProgram.getParameters:",j.precision,"not supported, using",L,"instead."),ye){var Re=gn[ye];se=Re.vertexShader,re=Re.fragmentShader}else se=j.vertexShader,re=j.fragmentShader;var Le=a.getRenderTarget();return{isWebGL2:p,shaderID:ye,shaderName:j.type,vertexShader:se,fragmentShader:re,defines:j.defines,isRawShaderMaterial:j.isRawShaderMaterial===!0,glslVersion:j.glslVersion,precision:L,instancing:$.isInstancedMesh===!0,instancingColor:$.isInstancedMesh===!0&&$.instanceColor!==null,supportsVertexTextures:E,outputEncoding:Le!==null?U(Le.texture):a.outputEncoding,map:!!j.map,mapEncoding:U(j.map),matcap:!!j.matcap,matcapEncoding:U(j.matcap),envMap:!!de,envMapMode:de&&de.mapping,envMapEncoding:U(de),envMapCubeUV:!!de&&(de.mapping===c||de.mapping===u),lightMap:!!j.lightMap,lightMapEncoding:U(j.lightMap),aoMap:!!j.aoMap,emissiveMap:!!j.emissiveMap,emissiveMapEncoding:U(j.emissiveMap),bumpMap:!!j.bumpMap,normalMap:!!j.normalMap,objectSpaceNormalMap:j.normalMapType===1,tangentSpaceNormalMap:j.normalMapType===0,clearcoatMap:!!j.clearcoatMap,clearcoatRoughnessMap:!!j.clearcoatRoughnessMap,clearcoatNormalMap:!!j.clearcoatNormalMap,displacementMap:!!j.displacementMap,roughnessMap:!!j.roughnessMap,metalnessMap:!!j.metalnessMap,specularMap:!!j.specularMap,alphaMap:!!j.alphaMap,gradientMap:!!j.gradientMap,sheen:!!j.sheen,transmissionMap:!!j.transmissionMap,combine:j.combine,vertexTangents:j.normalMap&&j.vertexTangents,vertexColors:j.vertexColors,vertexUvs:!!(j.map||j.bumpMap||j.normalMap||j.specularMap||j.alphaMap||j.emissiveMap||j.roughnessMap||j.metalnessMap||j.clearcoatMap||j.clearcoatRoughnessMap||j.clearcoatNormalMap||j.displacementMap||j.transmissionMap),uvsVertexOnly:!(j.map||j.bumpMap||j.normalMap||j.specularMap||j.alphaMap||j.emissiveMap||j.roughnessMap||j.metalnessMap||j.clearcoatNormalMap||j.transmissionMap||!j.displacementMap),fog:!!ie,useFog:j.fog,fogExp2:ie&&ie.isFogExp2,flatShading:!!j.flatShading,sizeAttenuation:j.sizeAttenuation,logarithmicDepthBuffer:_,skinning:j.skinning&&Ee>0,maxBones:Ee,useVertexTexture:v,morphTargets:j.morphTargets,morphNormals:j.morphNormals,maxMorphTargets:a.maxMorphTargets,maxMorphNormals:a.maxMorphNormals,numDirLights:K.directional.length,numPointLights:K.point.length,numSpotLights:K.spot.length,numRectAreaLights:K.rectArea.length,numHemiLights:K.hemi.length,numDirLightShadows:K.directionalShadowMap.length,numPointLightShadows:K.pointShadowMap.length,numSpotLightShadows:K.spotShadowMap.length,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:j.dithering,shadowMapEnabled:a.shadowMap.enabled&&ee.length>0,shadowMapType:a.shadowMap.type,toneMapping:j.toneMapped?a.toneMapping:0,physicallyCorrectLights:a.physicallyCorrectLights,premultipliedAlpha:j.premultipliedAlpha,alphaTest:j.alphaTest,doubleSided:j.side===2,flipSided:j.side===1,depthPacking:j.depthPacking!==void 0&&j.depthPacking,index0AttributeName:j.index0AttributeName,extensionDerivatives:j.extensions&&j.extensions.derivatives,extensionFragDepth:j.extensions&&j.extensions.fragDepth,extensionDrawBuffers:j.extensions&&j.extensions.drawBuffers,extensionShaderTextureLOD:j.extensions&&j.extensions.shaderTextureLOD,rendererExtensionFragDepth:p||t.has("EXT_frag_depth"),rendererExtensionDrawBuffers:p||t.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:p||t.has("EXT_shader_texture_lod"),customProgramCacheKey:j.customProgramCacheKey()}},getProgramCacheKey:function(j){var K=[];if(j.shaderID?K.push(j.shaderID):(K.push(j.fragmentShader),K.push(j.vertexShader)),j.defines!==void 0)for(var ee in j.defines)K.push(ee),K.push(j.defines[ee]);if(j.isRawShaderMaterial===!1){for(var J=0;J<B.length;J++)K.push(j[B[J]]);K.push(a.outputEncoding),K.push(a.gammaFactor)}return K.push(j.customProgramCacheKey),K.join()},getUniforms:function(j){var K,ee=D[j.type];if(ee){var J=gn[ee];K=Ql.clone(J.uniforms)}else K=j.uniforms;return K},acquireProgram:function(j,K){for(var ee,J=0,$=l.length;J<$;J++){var se=l[J];if(se.cacheKey===K){++(ee=se).usedTimes;break}}return ee===void 0&&(ee=new cd(a,K,j,n),l.push(ee)),ee},releaseProgram:function(j){if(--j.usedTimes==0){var K=l.indexOf(j);l[K]=l[l.length-1],l.pop(),j.destroy()}},programs:l}}function dd(){var a=new WeakMap;return{get:function(t){var e=a.get(t);return e===void 0&&(e={},a.set(t,e)),e},remove:function(t){a.delete(t)},update:function(t,e,n){a.get(t)[e]=n},dispose:function(){a=new WeakMap}}}function pd(a,i){return a.groupOrder!==i.groupOrder?a.groupOrder-i.groupOrder:a.renderOrder!==i.renderOrder?a.renderOrder-i.renderOrder:a.program!==i.program?a.program.id-i.program.id:a.material.id!==i.material.id?a.material.id-i.material.id:a.z!==i.z?a.z-i.z:a.id-i.id}function fd(a,i){return a.groupOrder!==i.groupOrder?a.groupOrder-i.groupOrder:a.renderOrder!==i.renderOrder?a.renderOrder-i.renderOrder:a.z!==i.z?i.z-a.z:a.id-i.id}function vh(a){var i=[],t=0,e=[],n=[],s={id:-1};function l(p,_,v,A,E,L){var D=i[t],B=a.get(v);return D===void 0?(D={id:p.id,object:p,geometry:_,material:v,program:B.program||s,groupOrder:A,renderOrder:p.renderOrder,z:E,group:L},i[t]=D):(D.id=p.id,D.object=p,D.geometry=_,D.material=v,D.program=B.program||s,D.groupOrder=A,D.renderOrder=p.renderOrder,D.z=E,D.group=L),t++,D}return{opaque:e,transparent:n,init:function(){t=0,e.length=0,n.length=0},push:function(_,v,A,E,L,D){var B=l(_,v,A,E,L,D);(A.transparent===!0?n:e).push(B)},unshift:function(_,v,A,E,L,D){var B=l(_,v,A,E,L,D);(A.transparent===!0?n:e).unshift(B)},finish:function(){for(var _=t,v=i.length;_<v;_++){var A=i[_];if(A.id===null)break;A.id=null,A.object=null,A.geometry=null,A.material=null,A.program=null,A.group=null}},sort:function(_,v){e.length>1&&e.sort(_||pd),n.length>1&&n.sort(v||fd)}}}function md(a){var i=new WeakMap;return{get:function(e,n){var s;return i.has(e)===!1?(s=new vh(a),i.set(e,[s])):n>=i.get(e).length?(s=new vh(a),i.get(e).push(s)):s=i.get(e)[n],s},dispose:function(){i=new WeakMap}}}function _d(){var a={};return{get:function(t){if(a[t.id]!==void 0)return a[t.id];var e;switch(t.type){case"DirectionalLight":e={direction:new te,color:new nt};break;case"SpotLight":e={position:new te,direction:new te,color:new nt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":e={position:new te,color:new nt,distance:0,decay:0};break;case"HemisphereLight":e={direction:new te,skyColor:new nt,groundColor:new nt};break;case"RectAreaLight":e={color:new nt,position:new te,halfWidth:new te,halfHeight:new te}}return a[t.id]=e,e}}}var gd=0;function vd(a,i){return(i.castShadow?1:0)-(a.castShadow?1:0)}function yd(a,i){for(var t,e=new _d,n=(t={},{get:function(E){if(t[E.id]!==void 0)return t[E.id];var L;switch(E.type){case"DirectionalLight":case"SpotLight":L={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ve};break;case"PointLight":L={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ve,shadowCameraNear:1,shadowCameraFar:1e3}}return t[E.id]=L,L}}),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},l=0;l<9;l++)s.probe.push(new te);var p=new te,_=new ht,v=new ht;return{setup:function(E){for(var L=0,D=0,B=0,U=0;U<9;U++)s.probe[U].set(0,0,0);var V=0,j=0,K=0,ee=0,J=0,$=0,se=0,re=0;E.sort(vd);for(var ie=0,pe=E.length;ie<pe;ie++){var de=E[ie],ye=de.color,Ee=de.intensity,Re=de.distance,Le=de.shadow&&de.shadow.map?de.shadow.map.texture:null;if(de.isAmbientLight)L+=ye.r*Ee,D+=ye.g*Ee,B+=ye.b*Ee;else if(de.isLightProbe)for(var le=0;le<9;le++)s.probe[le].addScaledVector(de.sh.coefficients[le],Ee);else if(de.isDirectionalLight){var _e=e.get(de);if(_e.color.copy(de.color).multiplyScalar(de.intensity),de.castShadow){var Ae=de.shadow,be=n.get(de);be.shadowBias=Ae.bias,be.shadowNormalBias=Ae.normalBias,be.shadowRadius=Ae.radius,be.shadowMapSize=Ae.mapSize,s.directionalShadow[V]=be,s.directionalShadowMap[V]=Le,s.directionalShadowMatrix[V]=de.shadow.matrix,$++}s.directional[V]=_e,V++}else if(de.isSpotLight){var ge=e.get(de);if(ge.position.setFromMatrixPosition(de.matrixWorld),ge.color.copy(ye).multiplyScalar(Ee),ge.distance=Re,ge.coneCos=Math.cos(de.angle),ge.penumbraCos=Math.cos(de.angle*(1-de.penumbra)),ge.decay=de.decay,de.castShadow){var Te=de.shadow,Fe=n.get(de);Fe.shadowBias=Te.bias,Fe.shadowNormalBias=Te.normalBias,Fe.shadowRadius=Te.radius,Fe.shadowMapSize=Te.mapSize,s.spotShadow[K]=Fe,s.spotShadowMap[K]=Le,s.spotShadowMatrix[K]=de.shadow.matrix,re++}s.spot[K]=ge,K++}else if(de.isRectAreaLight){var tt=e.get(de);tt.color.copy(ye).multiplyScalar(Ee),tt.halfWidth.set(.5*de.width,0,0),tt.halfHeight.set(0,.5*de.height,0),s.rectArea[ee]=tt,ee++}else if(de.isPointLight){var at=e.get(de);if(at.color.copy(de.color).multiplyScalar(de.intensity),at.distance=de.distance,at.decay=de.decay,de.castShadow){var oe=de.shadow,ue=n.get(de);ue.shadowBias=oe.bias,ue.shadowNormalBias=oe.normalBias,ue.shadowRadius=oe.radius,ue.shadowMapSize=oe.mapSize,ue.shadowCameraNear=oe.camera.near,ue.shadowCameraFar=oe.camera.far,s.pointShadow[j]=ue,s.pointShadowMap[j]=Le,s.pointShadowMatrix[j]=de.shadow.matrix,se++}s.point[j]=at,j++}else if(de.isHemisphereLight){var Oe=e.get(de);Oe.skyColor.copy(de.color).multiplyScalar(Ee),Oe.groundColor.copy(de.groundColor).multiplyScalar(Ee),s.hemi[J]=Oe,J++}}ee>0&&(i.isWebGL2||a.has("OES_texture_float_linear")===!0?(s.rectAreaLTC1=et.LTC_FLOAT_1,s.rectAreaLTC2=et.LTC_FLOAT_2):a.has("OES_texture_half_float_linear")===!0?(s.rectAreaLTC1=et.LTC_HALF_1,s.rectAreaLTC2=et.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),s.ambient[0]=L,s.ambient[1]=D,s.ambient[2]=B;var Pe=s.hash;Pe.directionalLength===V&&Pe.pointLength===j&&Pe.spotLength===K&&Pe.rectAreaLength===ee&&Pe.hemiLength===J&&Pe.numDirectionalShadows===$&&Pe.numPointShadows===se&&Pe.numSpotShadows===re||(s.directional.length=V,s.spot.length=K,s.rectArea.length=ee,s.point.length=j,s.hemi.length=J,s.directionalShadow.length=$,s.directionalShadowMap.length=$,s.pointShadow.length=se,s.pointShadowMap.length=se,s.spotShadow.length=re,s.spotShadowMap.length=re,s.directionalShadowMatrix.length=$,s.pointShadowMatrix.length=se,s.spotShadowMatrix.length=re,Pe.directionalLength=V,Pe.pointLength=j,Pe.spotLength=K,Pe.rectAreaLength=ee,Pe.hemiLength=J,Pe.numDirectionalShadows=$,Pe.numPointShadows=se,Pe.numSpotShadows=re,s.version=gd++)},setupView:function(E,L){for(var D=0,B=0,U=0,V=0,j=0,K=L.matrixWorldInverse,ee=0,J=E.length;ee<J;ee++){var $=E[ee];if($.isDirectionalLight){var se=s.directional[D];se.direction.setFromMatrixPosition($.matrixWorld),p.setFromMatrixPosition($.target.matrixWorld),se.direction.sub(p),se.direction.transformDirection(K),D++}else if($.isSpotLight){var re=s.spot[U];re.position.setFromMatrixPosition($.matrixWorld),re.position.applyMatrix4(K),re.direction.setFromMatrixPosition($.matrixWorld),p.setFromMatrixPosition($.target.matrixWorld),re.direction.sub(p),re.direction.transformDirection(K),U++}else if($.isRectAreaLight){var ie=s.rectArea[V];ie.position.setFromMatrixPosition($.matrixWorld),ie.position.applyMatrix4(K),v.identity(),_.copy($.matrixWorld),_.premultiply(K),v.extractRotation(_),ie.halfWidth.set(.5*$.width,0,0),ie.halfHeight.set(0,.5*$.height,0),ie.halfWidth.applyMatrix4(v),ie.halfHeight.applyMatrix4(v),V++}else if($.isPointLight){var pe=s.point[B];pe.position.setFromMatrixPosition($.matrixWorld),pe.position.applyMatrix4(K),B++}else if($.isHemisphereLight){var de=s.hemi[j];de.direction.setFromMatrixPosition($.matrixWorld),de.direction.transformDirection(K),de.direction.normalize(),j++}}},state:s}}function yh(a,i){var t=new yd(a,i),e=[],n=[];return{init:function(){e.length=0,n.length=0},state:{lightsArray:e,shadowsArray:n,lights:t},setupLights:function(){t.setup(e)},setupLightsView:function(l){t.setupView(e,l)},pushLight:function(l){e.push(l)},pushShadow:function(l){n.push(l)}}}function bd(a,i){var t=new WeakMap;return{get:function(n,s){var l;return s===void 0&&(s=0),t.has(n)===!1?(l=new yh(a,i),t.set(n,[l])):s>=t.get(n).length?(l=new yh(a,i),t.get(n).push(l)):l=t.get(n)[s],l},dispose:function(){t=new WeakMap}}}var La=function(a){function i(t){var e;return(e=a.call(this)||this).type="MeshDepthMaterial",e.depthPacking=3200,e.skinning=!1,e.morphTargets=!1,e.map=null,e.alphaMap=null,e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.wireframe=!1,e.wireframeLinewidth=1,e.fog=!1,e.setValues(t),e}return Be(i,a),i.prototype.copy=function(t){return a.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},i}(Gt);La.prototype.isMeshDepthMaterial=!0;var Pa=function(a){function i(t){var e;return(e=a.call(this)||this).type="MeshDistanceMaterial",e.referencePosition=new te,e.nearDistance=1,e.farDistance=1e3,e.skinning=!1,e.morphTargets=!1,e.map=null,e.alphaMap=null,e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.fog=!1,e.setValues(t),e}return Be(i,a),i.prototype.copy=function(t){return a.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this},i}(Gt);Pa.prototype.isMeshDistanceMaterial=!0;function bh(a,i,t){var e=new Ms,n=new Ve,s=new Ve,l=new Ft,p=[],_=[],v={},A={0:1,1:0,2:2},E=new Ui({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ve},radius:{value:4}},vertexShader:`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragmentShader:`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	float mean = 0.0;
	float squared_mean = 0.0;
	float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );
	for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean * HALF_SAMPLE_RATE;
	squared_mean = squared_mean * HALF_SAMPLE_RATE;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`}),L=E.clone();L.defines.HORIZONTAL_PASS=1;var D=new ct;D.setAttribute("position",new ft(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var B=new Jt(D,E),U=this;function V($,se){var re=i.update(B);E.uniforms.shadow_pass.value=$.map.texture,E.uniforms.resolution.value=$.mapSize,E.uniforms.radius.value=$.radius,a.setRenderTarget($.mapPass),a.clear(),a.renderBufferDirect(se,null,re,E,B,null),L.uniforms.shadow_pass.value=$.mapPass.texture,L.uniforms.resolution.value=$.mapSize,L.uniforms.radius.value=$.radius,a.setRenderTarget($.map),a.clear(),a.renderBufferDirect(se,null,re,L,B,null)}function j($,se,re){var ie=$<<0|se<<1|re<<2,pe=p[ie];return pe===void 0&&(pe=new La({depthPacking:3201,morphTargets:$,skinning:se}),p[ie]=pe),pe}function K($,se,re){var ie=$<<0|se<<1|re<<2,pe=_[ie];return pe===void 0&&(pe=new Pa({morphTargets:$,skinning:se}),_[ie]=pe),pe}function ee($,se,re,ie,pe,de,ye){var Ee=null,Re=j,Le=$.customDepthMaterial;if(ie.isPointLight===!0&&(Re=K,Le=$.customDistanceMaterial),Le===void 0){var le=!1;re.morphTargets===!0&&(le=se.morphAttributes&&se.morphAttributes.position&&se.morphAttributes.position.length>0);var _e=!1;$.isSkinnedMesh===!0&&(re.skinning===!0?_e=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",$)),Ee=Re(le,_e,$.isInstancedMesh===!0)}else Ee=Le;if(a.localClippingEnabled&&re.clipShadows===!0&&re.clippingPlanes.length!==0){var Ae=Ee.uuid,be=re.uuid,ge=v[Ae];ge===void 0&&(ge={},v[Ae]=ge);var Te=ge[be];Te===void 0&&(Te=Ee.clone(),ge[be]=Te),Ee=Te}return Ee.visible=re.visible,Ee.wireframe=re.wireframe,Ee.side=ye===3?re.shadowSide!==null?re.shadowSide:re.side:re.shadowSide!==null?re.shadowSide:A[re.side],Ee.clipShadows=re.clipShadows,Ee.clippingPlanes=re.clippingPlanes,Ee.clipIntersection=re.clipIntersection,Ee.wireframeLinewidth=re.wireframeLinewidth,Ee.linewidth=re.linewidth,ie.isPointLight===!0&&Ee.isMeshDistanceMaterial===!0&&(Ee.referencePosition.setFromMatrixPosition(ie.matrixWorld),Ee.nearDistance=pe,Ee.farDistance=de),Ee}function J($,se,re,ie,pe){if($.visible!==!1){if($.layers.test(se.layers)&&($.isMesh||$.isLine||$.isPoints)&&($.castShadow||$.receiveShadow&&pe===3)&&(!$.frustumCulled||e.intersectsObject($))){$.modelViewMatrix.multiplyMatrices(re.matrixWorldInverse,$.matrixWorld);var de=i.update($),ye=$.material;if(Array.isArray(ye))for(var Ee=de.groups,Re=0,Le=Ee.length;Re<Le;Re++){var le=Ee[Re],_e=ye[le.materialIndex];if(_e&&_e.visible){var Ae=ee($,de,_e,ie,re.near,re.far,pe);a.renderBufferDirect(re,null,de,Ae,$,le)}}else if(ye.visible){var be=ee($,de,ye,ie,re.near,re.far,pe);a.renderBufferDirect(re,null,de,be,$,null)}}for(var ge=$.children,Te=0,Fe=ge.length;Te<Fe;Te++)J(ge[Te],se,re,ie,pe)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function($,se,re){if(U.enabled!==!1&&(U.autoUpdate!==!1||U.needsUpdate!==!1)&&$.length!==0){var ie=a.getRenderTarget(),pe=a.getActiveCubeFace(),de=a.getActiveMipmapLevel(),ye=a.state;ye.setBlending(0),ye.buffers.color.setClear(1,1,1,1),ye.buffers.depth.setTest(!0),ye.setScissorTest(!1);for(var Ee=0,Re=$.length;Ee<Re;Ee++){var Le=$[Ee],le=Le.shadow;if(le!==void 0){if(le.autoUpdate!==!1||le.needsUpdate!==!1){n.copy(le.mapSize);var _e=le.getFrameExtents();if(n.multiply(_e),s.copy(le.mapSize),(n.x>t||n.y>t)&&(n.x>t&&(s.x=Math.floor(t/_e.x),n.x=s.x*_e.x,le.mapSize.x=s.x),n.y>t&&(s.y=Math.floor(t/_e.y),n.y=s.y*_e.y,le.mapSize.y=s.y)),le.map===null&&!le.isPointLightShadow&&this.type===3){var Ae={minFilter:P,magFilter:P,format:H};le.map=new tn(n.x,n.y,Ae),le.map.texture.name=Le.name+".shadowMap",le.mapPass=new tn(n.x,n.y,Ae),le.camera.updateProjectionMatrix()}if(le.map===null){var be={minFilter:x,magFilter:x,format:H};le.map=new tn(n.x,n.y,be),le.map.texture.name=Le.name+".shadowMap",le.camera.updateProjectionMatrix()}a.setRenderTarget(le.map),a.clear();for(var ge=le.getViewportCount(),Te=0;Te<ge;Te++){var Fe=le.getViewport(Te);l.set(s.x*Fe.x,s.y*Fe.y,s.x*Fe.z,s.y*Fe.w),ye.viewport(l),le.updateMatrices(Le,Te),e=le.getFrustum(),J(se,re,le.camera,Le,this.type)}le.isPointLightShadow||this.type!==3||V(le,re),le.needsUpdate=!1}}else console.warn("THREE.WebGLShadowMap:",Le,"has no shadow.")}U.needsUpdate=!1,a.setRenderTarget(ie,pe,de)}}}function xd(a,i,t){var e,n,s=t.isWebGL2,l=new function(){var we=!1,Se=new Ft,qe=null,Ze=new Ft(0,0,0,0);return{setMask:function(Xe){qe===Xe||we||(a.colorMask(Xe,Xe,Xe,Xe),qe=Xe)},setLocked:function(Xe){we=Xe},setClear:function(Xe,gt,Rt,Ot,St){St===!0&&(Xe*=Ot,gt*=Ot,Rt*=Ot),Se.set(Xe,gt,Rt,Ot),Ze.equals(Se)===!1&&(a.clearColor(Xe,gt,Rt,Ot),Ze.copy(Se))},reset:function(){we=!1,qe=null,Ze.set(-1,0,0,0)}}},p=new function(){var we=!1,Se=null,qe=null,Ze=null;return{setTest:function(Xe){Xe?ge(2929):Te(2929)},setMask:function(Xe){Se===Xe||we||(a.depthMask(Xe),Se=Xe)},setFunc:function(Xe){if(qe!==Xe){if(Xe)switch(Xe){case 0:a.depthFunc(512);break;case 1:a.depthFunc(519);break;case 2:a.depthFunc(513);break;case 3:a.depthFunc(515);break;case 4:a.depthFunc(514);break;case 5:a.depthFunc(518);break;case 6:a.depthFunc(516);break;case 7:a.depthFunc(517);break;default:a.depthFunc(515)}else a.depthFunc(515);qe=Xe}},setLocked:function(Xe){we=Xe},setClear:function(Xe){Ze!==Xe&&(a.clearDepth(Xe),Ze=Xe)},reset:function(){we=!1,Se=null,qe=null,Ze=null}}},_=new function(){var we=!1,Se=null,qe=null,Ze=null,rt=null,Xe=null,gt=null,Rt=null,Ot=null;return{setTest:function(At){we||(At?ge(2960):Te(2960))},setMask:function(At){Se===At||we||(a.stencilMask(At),Se=At)},setFunc:function(At,Yt,kt){qe===At&&Ze===Yt&&rt===kt||(a.stencilFunc(At,Yt,kt),qe=At,Ze=Yt,rt=kt)},setOp:function(At,Yt,kt){Xe===At&&gt===Yt&&Rt===kt||(a.stencilOp(At,Yt,kt),Xe=At,gt=Yt,Rt=kt)},setLocked:function(At){we=At},setClear:function(At){Ot!==At&&(a.clearStencil(At),Ot=At)},reset:function(){we=!1,Se=null,qe=null,Ze=null,rt=null,Xe=null,gt=null,Rt=null,Ot=null}}},v={},A=null,E=!1,L=null,D=null,B=null,U=null,V=null,j=null,K=null,ee=!1,J=null,$=null,se=null,re=null,ie=null,pe=a.getParameter(35661),de=!1,ye=0,Ee=a.getParameter(7938);Ee.indexOf("WebGL")!==-1?(ye=parseFloat(/^WebGL (\d)/.exec(Ee)[1]),de=ye>=1):Ee.indexOf("OpenGL ES")!==-1&&(ye=parseFloat(/^OpenGL ES (\d)/.exec(Ee)[1]),de=ye>=2);var Re=null,Le={},le=new Ft,_e=new Ft;function Ae(we,Se,qe){var Ze=new Uint8Array(4),rt=a.createTexture();a.bindTexture(we,rt),a.texParameteri(we,10241,9728),a.texParameteri(we,10240,9728);for(var Xe=0;Xe<qe;Xe++)a.texImage2D(Se+Xe,0,6408,1,1,0,6408,5121,Ze);return rt}var be={};function ge(we){v[we]!==!0&&(a.enable(we),v[we]=!0)}function Te(we){v[we]!==!1&&(a.disable(we),v[we]=!1)}be[3553]=Ae(3553,3553,1),be[34067]=Ae(34067,34069,6),l.setClear(0,0,0,1),p.setClear(1),_.setClear(0),ge(2929),p.setFunc(3),ue(!1),Oe(1),ge(2884),oe(0);var Fe=((e={})[100]=32774,e[101]=32778,e[102]=32779,e);if(s)Fe[103]=32775,Fe[104]=32776;else{var tt=i.get("EXT_blend_minmax");tt!==null&&(Fe[103]=tt.MIN_EXT,Fe[104]=tt.MAX_EXT)}var at=((n={})[200]=0,n[201]=1,n[202]=768,n[204]=770,n[210]=776,n[208]=774,n[206]=772,n[203]=769,n[205]=771,n[209]=775,n[207]=773,n);function oe(we,Se,qe,Ze,rt,Xe,gt,Rt){if(we!==0){if(E===!1&&(ge(3042),E=!0),we===5)rt=rt||Se,Xe=Xe||qe,gt=gt||Ze,Se===D&&rt===V||(a.blendEquationSeparate(Fe[Se],Fe[rt]),D=Se,V=rt),qe===B&&Ze===U&&Xe===j&&gt===K||(a.blendFuncSeparate(at[qe],at[Ze],at[Xe],at[gt]),B=qe,U=Ze,j=Xe,K=gt),L=we,ee=null;else if(we!==L||Rt!==ee){if(D===f&&V===f||(a.blendEquation(32774),D=f,V=f),Rt)switch(we){case 1:a.blendFuncSeparate(1,771,1,771);break;case 2:a.blendFunc(1,1);break;case 3:a.blendFuncSeparate(0,0,769,771);break;case 4:a.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",we)}else switch(we){case 1:a.blendFuncSeparate(770,771,1,771);break;case 2:a.blendFunc(770,1);break;case 3:a.blendFunc(0,769);break;case 4:a.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",we)}B=null,U=null,j=null,K=null,L=we,ee=Rt}}else E===!0&&(Te(3042),E=!1)}function ue(we){J!==we&&(we?a.frontFace(2304):a.frontFace(2305),J=we)}function Oe(we){we!==0?(ge(2884),we!==$&&(we===1?a.cullFace(1029):we===2?a.cullFace(1028):a.cullFace(1032))):Te(2884),$=we}function Pe(we,Se,qe){we?(ge(32823),re===Se&&ie===qe||(a.polygonOffset(Se,qe),re=Se,ie=qe)):Te(32823)}function Ue(we){we===void 0&&(we=33984+pe-1),Re!==we&&(a.activeTexture(we),Re=we)}return{buffers:{color:l,depth:p,stencil:_},enable:ge,disable:Te,useProgram:function(Se){return A!==Se&&(a.useProgram(Se),A=Se,!0)},setBlending:oe,setMaterial:function(Se,qe){Se.side===2?Te(2884):ge(2884);var Ze=Se.side===1;qe&&(Ze=!Ze),ue(Ze),Se.blending===1&&Se.transparent===!1?oe(0):oe(Se.blending,Se.blendEquation,Se.blendSrc,Se.blendDst,Se.blendEquationAlpha,Se.blendSrcAlpha,Se.blendDstAlpha,Se.premultipliedAlpha),p.setFunc(Se.depthFunc),p.setTest(Se.depthTest),p.setMask(Se.depthWrite),l.setMask(Se.colorWrite);var rt=Se.stencilWrite;_.setTest(rt),rt&&(_.setMask(Se.stencilWriteMask),_.setFunc(Se.stencilFunc,Se.stencilRef,Se.stencilFuncMask),_.setOp(Se.stencilFail,Se.stencilZFail,Se.stencilZPass)),Pe(Se.polygonOffset,Se.polygonOffsetFactor,Se.polygonOffsetUnits)},setFlipSided:ue,setCullFace:Oe,setLineWidth:function(Se){Se!==se&&(de&&a.lineWidth(Se),se=Se)},setPolygonOffset:Pe,setScissorTest:function(Se){Se?ge(3089):Te(3089)},activeTexture:Ue,bindTexture:function(Se,qe){Re===null&&Ue();var Ze=Le[Re];Ze===void 0&&(Ze={type:void 0,texture:void 0},Le[Re]=Ze),Ze.type===Se&&Ze.texture===qe||(a.bindTexture(Se,qe||be[Se]),Ze.type=Se,Ze.texture=qe)},unbindTexture:function(){var Se=Le[Re];Se!==void 0&&Se.type!==void 0&&(a.bindTexture(Se.type,null),Se.type=void 0,Se.texture=void 0)},compressedTexImage2D:function(){try{a.compressedTexImage2D.apply(a,arguments)}catch(Se){console.error("THREE.WebGLState:",Se)}},texImage2D:function(){try{a.texImage2D.apply(a,arguments)}catch(Se){console.error("THREE.WebGLState:",Se)}},texImage3D:function(){try{a.texImage3D.apply(a,arguments)}catch(Se){console.error("THREE.WebGLState:",Se)}},scissor:function(Se){le.equals(Se)===!1&&(a.scissor(Se.x,Se.y,Se.z,Se.w),le.copy(Se))},viewport:function(Se){_e.equals(Se)===!1&&(a.viewport(Se.x,Se.y,Se.z,Se.w),_e.copy(Se))},reset:function(){a.disable(3042),a.disable(2884),a.disable(2929),a.disable(32823),a.disable(3089),a.disable(2960),a.blendEquation(32774),a.blendFunc(1,0),a.blendFuncSeparate(1,0,1,0),a.colorMask(!0,!0,!0,!0),a.clearColor(0,0,0,0),a.depthMask(!0),a.depthFunc(513),a.clearDepth(1),a.stencilMask(4294967295),a.stencilFunc(519,0,4294967295),a.stencilOp(7680,7680,7680),a.clearStencil(0),a.cullFace(1029),a.frontFace(2305),a.polygonOffset(0,0),a.activeTexture(33984),a.useProgram(null),a.lineWidth(1),a.scissor(0,0,a.canvas.width,a.canvas.height),a.viewport(0,0,a.canvas.width,a.canvas.height),v={},Re=null,Le={},A=null,E=!1,L=null,D=null,B=null,U=null,V=null,j=null,K=null,ee=!1,J=null,$=null,se=null,re=null,ie=null,l.reset(),p.reset(),_.reset()}}}function Sd(a,i,t,e,n,s,l){var p,_,v,A=n.isWebGL2,E=n.maxTextures,L=n.maxCubemapSize,D=n.maxTextureSize,B=n.maxSamples,U=new WeakMap,V=!1;try{V=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch(oe){}function j(oe,ue){return V?new OffscreenCanvas(oe,ue):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function K(oe,ue,Oe,Pe){var Ue=1;if((oe.width>Pe||oe.height>Pe)&&(Ue=Pe/Math.max(oe.width,oe.height)),Ue<1||ue===!0){if(typeof HTMLImageElement<"u"&&oe instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&oe instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&oe instanceof ImageBitmap){var we=ue?dt.floorPowerOfTwo:Math.floor,Se=we(Ue*oe.width),qe=we(Ue*oe.height);v===void 0&&(v=j(Se,qe));var Ze=Oe?j(Se,qe):v;return Ze.width=Se,Ze.height=qe,Ze.getContext("2d").drawImage(oe,0,0,Se,qe),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+oe.width+"x"+oe.height+") to ("+Se+"x"+qe+")."),Ze}return"data"in oe&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+oe.width+"x"+oe.height+")."),oe}return oe}function ee(oe){return dt.isPowerOfTwo(oe.width)&&dt.isPowerOfTwo(oe.height)}function J(oe,ue){return oe.generateMipmaps&&ue&&oe.minFilter!==x&&oe.minFilter!==P}function $(oe,ue,Oe,Pe){a.generateMipmap(oe),e.get(ue).__maxMipLevel=Math.log2(Math.max(Oe,Pe))}function se(oe,ue,Oe){if(A===!1)return ue;if(oe!==null){if(a[oe]!==void 0)return a[oe];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+oe+"'")}var Pe=ue;return ue===6403&&(Oe===5126&&(Pe=33326),Oe===5131&&(Pe=33325),Oe===5121&&(Pe=33321)),ue===6407&&(Oe===5126&&(Pe=34837),Oe===5131&&(Pe=34843),Oe===5121&&(Pe=32849)),ue===6408&&(Oe===5126&&(Pe=34836),Oe===5131&&(Pe=34842),Oe===5121&&(Pe=32856)),Pe!==33325&&Pe!==33326&&Pe!==34842&&Pe!==34836||i.get("EXT_color_buffer_float"),Pe}function re(oe){return oe===x||oe===w||oe===C?9728:9729}function ie(oe){var ue=oe.target;ue.removeEventListener("dispose",ie),function(Oe){var Pe=e.get(Oe);Pe.__webglInit!==void 0&&(a.deleteTexture(Pe.__webglTexture),e.remove(Oe))}(ue),ue.isVideoTexture&&U.delete(ue),l.memory.textures--}function pe(oe){var ue=oe.target;ue.removeEventListener("dispose",pe),function(Oe){var Pe=Oe.texture,Ue=e.get(Oe),we=e.get(Pe);if(Oe){if(we.__webglTexture!==void 0&&a.deleteTexture(we.__webglTexture),Oe.depthTexture&&Oe.depthTexture.dispose(),Oe.isWebGLCubeRenderTarget)for(var Se=0;Se<6;Se++)a.deleteFramebuffer(Ue.__webglFramebuffer[Se]),Ue.__webglDepthbuffer&&a.deleteRenderbuffer(Ue.__webglDepthbuffer[Se]);else a.deleteFramebuffer(Ue.__webglFramebuffer),Ue.__webglDepthbuffer&&a.deleteRenderbuffer(Ue.__webglDepthbuffer),Ue.__webglMultisampledFramebuffer&&a.deleteFramebuffer(Ue.__webglMultisampledFramebuffer),Ue.__webglColorRenderbuffer&&a.deleteRenderbuffer(Ue.__webglColorRenderbuffer),Ue.__webglDepthRenderbuffer&&a.deleteRenderbuffer(Ue.__webglDepthRenderbuffer);e.remove(Pe),e.remove(Oe)}}(ue),l.memory.textures--}var de=0;function ye(oe,ue){var Oe=e.get(oe);if(oe.isVideoTexture&&function(Ue){var we=l.render.frame;U.get(Ue)!==we&&(U.set(Ue,we),Ue.update())}(oe),oe.version>0&&Oe.__version!==oe.version){var Pe=oe.image;if(Pe===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(Pe.complete!==!1)return void Ae(Oe,oe,ue);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}t.activeTexture(33984+ue),t.bindTexture(3553,Oe.__webglTexture)}function Ee(oe,ue){var Oe=e.get(oe);oe.version>0&&Oe.__version!==oe.version?function(Pe,Ue,we){if(Ue.image.length===6){_e(Pe,Ue),t.activeTexture(33984+we),t.bindTexture(34067,Pe.__webglTexture),a.pixelStorei(37440,Ue.flipY),a.pixelStorei(37441,Ue.premultiplyAlpha),a.pixelStorei(3317,Ue.unpackAlignment),a.pixelStorei(37443,0);for(var Se=Ue&&(Ue.isCompressedTexture||Ue.image[0].isCompressedTexture),qe=Ue.image[0]&&Ue.image[0].isDataTexture,Ze=[],rt=0;rt<6;rt++)Ze[rt]=Se||qe?qe?Ue.image[rt].image:Ue.image[rt]:K(Ue.image[rt],!1,!0,L);var Xe,gt=Ze[0],Rt=ee(gt)||A,Ot=s.convert(Ue.format),St=s.convert(Ue.type),At=se(Ue.internalFormat,Ot,St);if(le(34067,Ue,Rt),Se){for(var Yt=0;Yt<6;Yt++){Xe=Ze[Yt].mipmaps;for(var kt=0;kt<Xe.length;kt++){var ei=Xe[kt];Ue.format!==H&&Ue.format!==G?Ot!==null?t.compressedTexImage2D(34069+Yt,kt,At,ei.width,ei.height,0,ei.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):t.texImage2D(34069+Yt,kt,At,ei.width,ei.height,0,Ot,St,ei.data)}}Pe.__maxMipLevel=Xe.length-1}else{Xe=Ue.mipmaps;for(var pi=0;pi<6;pi++)if(qe){t.texImage2D(34069+pi,0,At,Ze[pi].width,Ze[pi].height,0,Ot,St,Ze[pi].data);for(var Dn=0;Dn<Xe.length;Dn++){var jn=Xe[Dn].image[pi].image;t.texImage2D(34069+pi,Dn+1,At,jn.width,jn.height,0,Ot,St,jn.data)}}else{t.texImage2D(34069+pi,0,At,Ot,St,Ze[pi]);for(var fi=0;fi<Xe.length;fi++){var ci=Xe[fi];t.texImage2D(34069+pi,fi+1,At,Ot,St,ci.image[pi])}}Pe.__maxMipLevel=Xe.length}J(Ue,Rt)&&$(34067,Ue,gt.width,gt.height),Pe.__version=Ue.version,Ue.onUpdate&&Ue.onUpdate(Ue)}}(Oe,oe,ue):(t.activeTexture(33984+ue),t.bindTexture(34067,Oe.__webglTexture))}var Re=((p={})[1e3]=10497,p[1001]=33071,p[1002]=33648,p),Le=((_={})[1003]=9728,_[1004]=9984,_[1005]=9986,_[1006]=9729,_[1007]=9985,_[1008]=9987,_);function le(oe,ue,Oe){if(Oe?(a.texParameteri(oe,10242,Re[ue.wrapS]),a.texParameteri(oe,10243,Re[ue.wrapT]),oe!==32879&&oe!==35866||a.texParameteri(oe,32882,Re[ue.wrapR]),a.texParameteri(oe,10240,Le[ue.magFilter]),a.texParameteri(oe,10241,Le[ue.minFilter])):(a.texParameteri(oe,10242,33071),a.texParameteri(oe,10243,33071),oe!==32879&&oe!==35866||a.texParameteri(oe,32882,33071),ue.wrapS===m&&ue.wrapT===m||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),a.texParameteri(oe,10240,re(ue.magFilter)),a.texParameteri(oe,10241,re(ue.minFilter)),ue.minFilter!==x&&ue.minFilter!==P&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),i.has("EXT_texture_filter_anisotropic")===!0){var Pe=i.get("EXT_texture_filter_anisotropic");if(ue.type===S&&i.has("OES_texture_float_linear")===!1||A===!1&&ue.type===F&&i.has("OES_texture_half_float_linear")===!1)return;(ue.anisotropy>1||e.get(ue).__currentAnisotropy)&&(a.texParameterf(oe,Pe.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(ue.anisotropy,n.getMaxAnisotropy())),e.get(ue).__currentAnisotropy=ue.anisotropy)}}function _e(oe,ue){oe.__webglInit===void 0&&(oe.__webglInit=!0,ue.addEventListener("dispose",ie),oe.__webglTexture=a.createTexture(),l.memory.textures++)}function Ae(oe,ue,Oe){var Pe=3553;ue.isDataTexture2DArray&&(Pe=35866),ue.isDataTexture3D&&(Pe=32879),_e(oe,ue),t.activeTexture(33984+Oe),t.bindTexture(Pe,oe.__webglTexture),a.pixelStorei(37440,ue.flipY),a.pixelStorei(37441,ue.premultiplyAlpha),a.pixelStorei(3317,ue.unpackAlignment),a.pixelStorei(37443,0);var Ue,we=function(ei){return!A&&(ei.wrapS!==m||ei.wrapT!==m||ei.minFilter!==x&&ei.minFilter!==P)}(ue)&&ee(ue.image)===!1,Se=K(ue.image,we,!1,D),qe=ee(Se)||A,Ze=s.convert(ue.format),rt=s.convert(ue.type),Xe=se(ue.internalFormat,Ze,rt);le(Pe,ue,qe);var gt=ue.mipmaps;if(ue.isDepthTexture)Xe=6402,A?Xe=ue.type===S?36012:ue.type===X?33190:ue.type===k?35056:33189:ue.type===S&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),ue.format===q&&Xe===6402&&ue.type!==Y&&ue.type!==X&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),ue.type=Y,rt=s.convert(ue.type)),ue.format===ce&&Xe===6402&&(Xe=34041,ue.type!==k&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),ue.type=k,rt=s.convert(ue.type))),t.texImage2D(3553,0,Xe,Se.width,Se.height,0,Ze,rt,null);else if(ue.isDataTexture)if(gt.length>0&&qe){for(var Rt=0,Ot=gt.length;Rt<Ot;Rt++)Ue=gt[Rt],t.texImage2D(3553,Rt,Xe,Ue.width,Ue.height,0,Ze,rt,Ue.data);ue.generateMipmaps=!1,oe.__maxMipLevel=gt.length-1}else t.texImage2D(3553,0,Xe,Se.width,Se.height,0,Ze,rt,Se.data),oe.__maxMipLevel=0;else if(ue.isCompressedTexture){for(var St=0,At=gt.length;St<At;St++)Ue=gt[St],ue.format!==H&&ue.format!==G?Ze!==null?t.compressedTexImage2D(3553,St,Xe,Ue.width,Ue.height,0,Ue.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):t.texImage2D(3553,St,Xe,Ue.width,Ue.height,0,Ze,rt,Ue.data);oe.__maxMipLevel=gt.length-1}else if(ue.isDataTexture2DArray)t.texImage3D(35866,0,Xe,Se.width,Se.height,Se.depth,0,Ze,rt,Se.data),oe.__maxMipLevel=0;else if(ue.isDataTexture3D)t.texImage3D(32879,0,Xe,Se.width,Se.height,Se.depth,0,Ze,rt,Se.data),oe.__maxMipLevel=0;else if(gt.length>0&&qe){for(var Yt=0,kt=gt.length;Yt<kt;Yt++)Ue=gt[Yt],t.texImage2D(3553,Yt,Xe,Ze,rt,Ue);ue.generateMipmaps=!1,oe.__maxMipLevel=gt.length-1}else t.texImage2D(3553,0,Xe,Ze,rt,Se),oe.__maxMipLevel=0;J(ue,qe)&&$(Pe,ue,Se.width,Se.height),oe.__version=ue.version,ue.onUpdate&&ue.onUpdate(ue)}function be(oe,ue,Oe,Pe){var Ue=ue.texture,we=s.convert(Ue.format),Se=s.convert(Ue.type),qe=se(Ue.internalFormat,we,Se);Pe===32879||Pe===35866?t.texImage3D(Pe,0,qe,ue.width,ue.height,ue.depth,0,we,Se,null):t.texImage2D(Pe,0,qe,ue.width,ue.height,0,we,Se,null),a.bindFramebuffer(36160,oe),a.framebufferTexture2D(36160,Oe,Pe,e.get(Ue).__webglTexture,0),a.bindFramebuffer(36160,null)}function ge(oe,ue,Oe){if(a.bindRenderbuffer(36161,oe),ue.depthBuffer&&!ue.stencilBuffer){var Pe=33189;if(Oe){var Ue=ue.depthTexture;Ue&&Ue.isDepthTexture&&(Ue.type===S?Pe=36012:Ue.type===X&&(Pe=33190));var we=Fe(ue);a.renderbufferStorageMultisample(36161,we,Pe,ue.width,ue.height)}else a.renderbufferStorage(36161,Pe,ue.width,ue.height);a.framebufferRenderbuffer(36160,36096,36161,oe)}else if(ue.depthBuffer&&ue.stencilBuffer){if(Oe){var Se=Fe(ue);a.renderbufferStorageMultisample(36161,Se,35056,ue.width,ue.height)}else a.renderbufferStorage(36161,34041,ue.width,ue.height);a.framebufferRenderbuffer(36160,33306,36161,oe)}else{var qe=ue.texture,Ze=s.convert(qe.format),rt=s.convert(qe.type),Xe=se(qe.internalFormat,Ze,rt);if(Oe){var gt=Fe(ue);a.renderbufferStorageMultisample(36161,gt,Xe,ue.width,ue.height)}else a.renderbufferStorage(36161,Xe,ue.width,ue.height)}a.bindRenderbuffer(36161,null)}function Te(oe){var ue=e.get(oe),Oe=oe.isWebGLCubeRenderTarget===!0;if(oe.depthTexture){if(Oe)throw new Error("target.depthTexture not supported in Cube render targets");(function(Ue,we){if(we&&we.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(a.bindFramebuffer(36160,Ue),!we.depthTexture||!we.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");e.get(we.depthTexture).__webglTexture&&we.depthTexture.image.width===we.width&&we.depthTexture.image.height===we.height||(we.depthTexture.image.width=we.width,we.depthTexture.image.height=we.height,we.depthTexture.needsUpdate=!0),ye(we.depthTexture,0);var Se=e.get(we.depthTexture).__webglTexture;if(we.depthTexture.format===q)a.framebufferTexture2D(36160,36096,3553,Se,0);else{if(we.depthTexture.format!==ce)throw new Error("Unknown depthTexture format");a.framebufferTexture2D(36160,33306,3553,Se,0)}})(ue.__webglFramebuffer,oe)}else if(Oe){ue.__webglDepthbuffer=[];for(var Pe=0;Pe<6;Pe++)a.bindFramebuffer(36160,ue.__webglFramebuffer[Pe]),ue.__webglDepthbuffer[Pe]=a.createRenderbuffer(),ge(ue.__webglDepthbuffer[Pe],oe,!1)}else a.bindFramebuffer(36160,ue.__webglFramebuffer),ue.__webglDepthbuffer=a.createRenderbuffer(),ge(ue.__webglDepthbuffer,oe,!1);a.bindFramebuffer(36160,null)}function Fe(oe){return A&&oe.isWebGLMultisampleRenderTarget?Math.min(B,oe.samples):0}var tt=!1,at=!1;this.allocateTextureUnit=function(){var oe=de;return oe>=E&&console.warn("THREE.WebGLTextures: Trying to use "+oe+" texture units while this GPU supports only "+E),de+=1,oe},this.resetTextureUnits=function(){de=0},this.setTexture2D=ye,this.setTexture2DArray=function(oe,ue){var Oe=e.get(oe);oe.version>0&&Oe.__version!==oe.version?Ae(Oe,oe,ue):(t.activeTexture(33984+ue),t.bindTexture(35866,Oe.__webglTexture))},this.setTexture3D=function(oe,ue){var Oe=e.get(oe);oe.version>0&&Oe.__version!==oe.version?Ae(Oe,oe,ue):(t.activeTexture(33984+ue),t.bindTexture(32879,Oe.__webglTexture))},this.setTextureCube=Ee,this.setupRenderTarget=function(oe){var ue=oe.texture,Oe=e.get(oe),Pe=e.get(ue);oe.addEventListener("dispose",pe),Pe.__webglTexture=a.createTexture(),l.memory.textures++;var Ue=oe.isWebGLCubeRenderTarget===!0,we=oe.isWebGLMultisampleRenderTarget===!0,Se=ue.isDataTexture3D||ue.isDataTexture2DArray,qe=ee(oe)||A;if(!A||ue.format!==G||ue.type!==S&&ue.type!==F||(ue.format=H,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),Ue){Oe.__webglFramebuffer=[];for(var Ze=0;Ze<6;Ze++)Oe.__webglFramebuffer[Ze]=a.createFramebuffer()}else if(Oe.__webglFramebuffer=a.createFramebuffer(),we)if(A){Oe.__webglMultisampledFramebuffer=a.createFramebuffer(),Oe.__webglColorRenderbuffer=a.createRenderbuffer(),a.bindRenderbuffer(36161,Oe.__webglColorRenderbuffer);var rt=s.convert(ue.format),Xe=s.convert(ue.type),gt=se(ue.internalFormat,rt,Xe),Rt=Fe(oe);a.renderbufferStorageMultisample(36161,Rt,gt,oe.width,oe.height),a.bindFramebuffer(36160,Oe.__webglMultisampledFramebuffer),a.framebufferRenderbuffer(36160,36064,36161,Oe.__webglColorRenderbuffer),a.bindRenderbuffer(36161,null),oe.depthBuffer&&(Oe.__webglDepthRenderbuffer=a.createRenderbuffer(),ge(Oe.__webglDepthRenderbuffer,oe,!0)),a.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(Ue){t.bindTexture(34067,Pe.__webglTexture),le(34067,ue,qe);for(var Ot=0;Ot<6;Ot++)be(Oe.__webglFramebuffer[Ot],oe,36064,34069+Ot);J(ue,qe)&&$(34067,ue,oe.width,oe.height),t.bindTexture(34067,null)}else{var St=3553;Se&&(A?St=ue.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),t.bindTexture(St,Pe.__webglTexture),le(St,ue,qe),be(Oe.__webglFramebuffer,oe,36064,St),J(ue,qe)&&$(3553,ue,oe.width,oe.height),t.bindTexture(3553,null)}oe.depthBuffer&&Te(oe)},this.updateRenderTargetMipmap=function(oe){var ue=oe.texture;if(J(ue,ee(oe)||A)){var Oe=oe.isWebGLCubeRenderTarget?34067:3553,Pe=e.get(ue).__webglTexture;t.bindTexture(Oe,Pe),$(Oe,ue,oe.width,oe.height),t.bindTexture(Oe,null)}},this.updateMultisampleRenderTarget=function(oe){if(oe.isWebGLMultisampleRenderTarget)if(A){var ue=e.get(oe);a.bindFramebuffer(36008,ue.__webglMultisampledFramebuffer),a.bindFramebuffer(36009,ue.__webglFramebuffer);var Oe=oe.width,Pe=oe.height,Ue=16384;oe.depthBuffer&&(Ue|=256),oe.stencilBuffer&&(Ue|=1024),a.blitFramebuffer(0,0,Oe,Pe,0,0,Oe,Pe,Ue,9728),a.bindFramebuffer(36160,ue.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(oe,ue){oe&&oe.isWebGLRenderTarget&&(tt===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),tt=!0),oe=oe.texture),ye(oe,ue)},this.safeSetTextureCube=function(oe,ue){oe&&oe.isWebGLCubeRenderTarget&&(at===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),at=!0),oe=oe.texture),Ee(oe,ue)}}function xh(a,i,t){var e=t.isWebGL2;return{convert:function(s){var l;if(s===z)return 5121;if(s===1017)return 32819;if(s===1018)return 32820;if(s===1019)return 33635;if(s===1010)return 5120;if(s===1011)return 5122;if(s===Y)return 5123;if(s===1013)return 5124;if(s===X)return 5125;if(s===S)return 5126;if(s===F)return e?5131:(l=i.get("OES_texture_half_float"))!==null?l.HALF_FLOAT_OES:null;if(s===1021)return 6406;if(s===G)return 6407;if(s===H)return 6408;if(s===1024)return 6409;if(s===1025)return 6410;if(s===q)return 6402;if(s===ce)return 34041;if(s===1028)return 6403;if(s===1029)return 36244;if(s===1030)return 33319;if(s===1031)return 33320;if(s===1032)return 36248;if(s===1033)return 36249;if(s===Q||s===ne||s===he||s===ve){if((l=i.get("WEBGL_compressed_texture_s3tc"))===null)return null;if(s===Q)return l.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===ne)return l.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===he)return l.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===ve)return l.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(s===Ie||s===fe||s===Me||s===Ke){if((l=i.get("WEBGL_compressed_texture_pvrtc"))===null)return null;if(s===Ie)return l.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===fe)return l.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===Me)return l.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===Ke)return l.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(s===36196)return(l=i.get("WEBGL_compressed_texture_etc1"))!==null?l.COMPRESSED_RGB_ETC1_WEBGL:null;if((s===Ye||s===je)&&(l=i.get("WEBGL_compressed_texture_etc"))!==null){if(s===Ye)return l.COMPRESSED_RGB8_ETC2;if(s===je)return l.COMPRESSED_RGBA8_ETC2_EAC}return s===37808||s===37809||s===37810||s===37811||s===37812||s===37813||s===37814||s===37815||s===37816||s===37817||s===37818||s===37819||s===37820||s===37821||s===37840||s===37841||s===37842||s===37843||s===37844||s===37845||s===37846||s===37847||s===37848||s===37849||s===37850||s===37851||s===37852||s===37853?(l=i.get("WEBGL_compressed_texture_astc"))!==null?s:null:s===36492?(l=i.get("EXT_texture_compression_bptc"))!==null?s:null:s===k?e?34042:(l=i.get("WEBGL_depth_texture"))!==null?l.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function Da(a){a===void 0&&(a=[]),di.call(this),this.cameras=a}Da.prototype=Object.assign(Object.create(di.prototype),{constructor:Da,isArrayCamera:!0});var Er=function(a){function i(){var t;return(t=a.call(this)||this).type="Group",t}return Be(i,a),i}(Ge);function Ds(){this._targetRay=null,this._grip=null,this._hand=null}function Sh(a,i){var t=this,e=null,n=1,s=null,l="local-floor",p=null,_=[],v=new Map,A=new di;A.layers.enable(1),A.viewport=new Ft;var E=new di;E.layers.enable(2),E.viewport=new Ft;var L=[A,E],D=new Da;D.layers.enable(1),D.layers.enable(2);var B=null,U=null;function V(ie){var pe=v.get(ie.inputSource);pe&&pe.dispatchEvent({type:ie.type,data:ie.inputSource})}function j(){v.forEach(function(ie,pe){ie.disconnect(pe)}),v.clear(),B=null,U=null,a.setFramebuffer(null),a.setRenderTarget(a.getRenderTarget()),re.stop(),t.isPresenting=!1,t.dispatchEvent({type:"sessionend"})}function K(ie){for(var pe=e.inputSources,de=0;de<_.length;de++)v.set(pe[de],_[de]);for(var ye=0;ye<ie.removed.length;ye++){var Ee=ie.removed[ye],Re=v.get(Ee);Re&&(Re.dispatchEvent({type:"disconnected",data:Ee}),v.delete(Ee))}for(var Le=0;Le<ie.added.length;Le++){var le=ie.added[Le],_e=v.get(le);_e&&_e.dispatchEvent({type:"connected",data:le})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(ie){var pe=_[ie];return pe===void 0&&(pe=new Ds,_[ie]=pe),pe.getTargetRaySpace()},this.getControllerGrip=function(ie){var pe=_[ie];return pe===void 0&&(pe=new Ds,_[ie]=pe),pe.getGripSpace()},this.getHand=function(ie){var pe=_[ie];return pe===void 0&&(pe=new Ds,_[ie]=pe),pe.getHandSpace()},this.setFramebufferScaleFactor=function(ie){n=ie,t.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(ie){l=ie,t.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return s},this.getSession=function(){return e},this.setSession=function(){var ie,pe=(ie=regeneratorRuntime.mark(function de(ye){var Ee,Re,Le;return regeneratorRuntime.wrap(function(le){for(;;)switch(le.prev=le.next){case 0:if((e=ye)===null){le.next=24;break}if(e.addEventListener("select",V),e.addEventListener("selectstart",V),e.addEventListener("selectend",V),e.addEventListener("squeeze",V),e.addEventListener("squeezestart",V),e.addEventListener("squeezeend",V),e.addEventListener("end",j),e.addEventListener("inputsourceschange",K),(Ee=i.getContextAttributes()).xrCompatible===!0){le.next=14;break}return le.next=14,i.makeXRCompatible();case 14:return Re={antialias:Ee.antialias,alpha:Ee.alpha,depth:Ee.depth,stencil:Ee.stencil,framebufferScaleFactor:n},Le=new XRWebGLLayer(e,i,Re),e.updateRenderState({baseLayer:Le}),le.next=19,e.requestReferenceSpace(l);case 19:s=le.sent,re.setContext(e),re.start(),t.isPresenting=!0,t.dispatchEvent({type:"sessionstart"});case 24:case"end":return le.stop()}},de)}),function(){var de=this,ye=arguments;return new Promise(function(Ee,Re){var Le=ie.apply(de,ye);function le(Ae){kr(Le,Ee,Re,le,_e,"next",Ae)}function _e(Ae){kr(Le,Ee,Re,le,_e,"throw",Ae)}le(void 0)})});return function(de){return pe.apply(this,arguments)}}();var ee=new te,J=new te;function $(ie,pe){pe===null?ie.matrixWorld.copy(ie.matrix):ie.matrixWorld.multiplyMatrices(pe.matrixWorld,ie.matrix),ie.matrixWorldInverse.copy(ie.matrixWorld).invert()}this.getCamera=function(ie){D.near=E.near=A.near=ie.near,D.far=E.far=A.far=ie.far,B===D.near&&U===D.far||(e.updateRenderState({depthNear:D.near,depthFar:D.far}),B=D.near,U=D.far);var pe=ie.parent,de=D.cameras;$(D,pe);for(var ye=0;ye<de.length;ye++)$(de[ye],pe);ie.matrixWorld.copy(D.matrixWorld),ie.matrix.copy(D.matrix),ie.matrix.decompose(ie.position,ie.quaternion,ie.scale);for(var Ee=ie.children,Re=0,Le=Ee.length;Re<Le;Re++)Ee[Re].updateMatrixWorld(!0);return de.length===2?function(le,_e,Ae){ee.setFromMatrixPosition(_e.matrixWorld),J.setFromMatrixPosition(Ae.matrixWorld);var be=ee.distanceTo(J),ge=_e.projectionMatrix.elements,Te=Ae.projectionMatrix.elements,Fe=ge[14]/(ge[10]-1),tt=ge[14]/(ge[10]+1),at=(ge[9]+1)/ge[5],oe=(ge[9]-1)/ge[5],ue=(ge[8]-1)/ge[0],Oe=(Te[8]+1)/Te[0],Pe=Fe*ue,Ue=Fe*Oe,we=be/(-ue+Oe),Se=we*-ue;_e.matrixWorld.decompose(le.position,le.quaternion,le.scale),le.translateX(Se),le.translateZ(we),le.matrixWorld.compose(le.position,le.quaternion,le.scale),le.matrixWorldInverse.copy(le.matrixWorld).invert();var qe=Fe+we,Ze=tt+we,rt=Pe-Se,Xe=Ue+(be-Se),gt=at*tt/Ze*qe,Rt=oe*tt/Ze*qe;le.projectionMatrix.makePerspective(rt,Xe,gt,Rt,qe,Ze)}(D,A,E):D.projectionMatrix.copy(A.projectionMatrix),D};var se=null,re=new Jl;re.setAnimationLoop(function(ie,pe){if((p=pe.getViewerPose(s))!==null){var de=p.views,ye=e.renderState.baseLayer;a.setFramebuffer(ye.framebuffer);var Ee=!1;de.length!==D.cameras.length&&(D.cameras.length=0,Ee=!0);for(var Re=0;Re<de.length;Re++){var Le=de[Re],le=ye.getViewport(Le),_e=L[Re];_e.matrix.fromArray(Le.transform.matrix),_e.projectionMatrix.fromArray(Le.projectionMatrix),_e.viewport.set(le.x,le.y,le.width,le.height),Re===0&&D.matrix.copy(_e.matrix),Ee===!0&&D.cameras.push(_e)}}for(var Ae=e.inputSources,be=0;be<_.length;be++){var ge=_[be],Te=Ae[be];ge.update(Te,pe,s)}se&&se(ie,pe)}),this.setAnimationLoop=function(ie){se=ie},this.dispose=function(){}}function wd(a){function i(e,n){e.opacity.value=n.opacity,n.color&&e.diffuse.value.copy(n.color),n.emissive&&e.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(e.map.value=n.map),n.alphaMap&&(e.alphaMap.value=n.alphaMap),n.specularMap&&(e.specularMap.value=n.specularMap);var s,l,p=a.get(n).envMap;if(p){e.envMap.value=p,e.flipEnvMap.value=p.isCubeTexture&&p._needsFlipEnvMap?-1:1,e.reflectivity.value=n.reflectivity,e.refractionRatio.value=n.refractionRatio;var _=a.get(p).__maxMipLevel;_!==void 0&&(e.maxMipLevel.value=_)}n.lightMap&&(e.lightMap.value=n.lightMap,e.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(e.aoMap.value=n.aoMap,e.aoMapIntensity.value=n.aoMapIntensity),n.map?s=n.map:n.specularMap?s=n.specularMap:n.displacementMap?s=n.displacementMap:n.normalMap?s=n.normalMap:n.bumpMap?s=n.bumpMap:n.roughnessMap?s=n.roughnessMap:n.metalnessMap?s=n.metalnessMap:n.alphaMap?s=n.alphaMap:n.emissiveMap?s=n.emissiveMap:n.clearcoatMap?s=n.clearcoatMap:n.clearcoatNormalMap?s=n.clearcoatNormalMap:n.clearcoatRoughnessMap&&(s=n.clearcoatRoughnessMap),s!==void 0&&(s.isWebGLRenderTarget&&(s=s.texture),s.matrixAutoUpdate===!0&&s.updateMatrix(),e.uvTransform.value.copy(s.matrix)),n.aoMap?l=n.aoMap:n.lightMap&&(l=n.lightMap),l!==void 0&&(l.isWebGLRenderTarget&&(l=l.texture),l.matrixAutoUpdate===!0&&l.updateMatrix(),e.uv2Transform.value.copy(l.matrix))}function t(e,n){e.roughness.value=n.roughness,e.metalness.value=n.metalness,n.roughnessMap&&(e.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(e.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(e.emissiveMap.value=n.emissiveMap),n.bumpMap&&(e.bumpMap.value=n.bumpMap,e.bumpScale.value=n.bumpScale,n.side===1&&(e.bumpScale.value*=-1)),n.normalMap&&(e.normalMap.value=n.normalMap,e.normalScale.value.copy(n.normalScale),n.side===1&&e.normalScale.value.negate()),n.displacementMap&&(e.displacementMap.value=n.displacementMap,e.displacementScale.value=n.displacementScale,e.displacementBias.value=n.displacementBias),a.get(n).envMap&&(e.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(n,s){n.fogColor.value.copy(s.color),s.isFog?(n.fogNear.value=s.near,n.fogFar.value=s.far):s.isFogExp2&&(n.fogDensity.value=s.density)},refreshMaterialUniforms:function(n,s,l,p){s.isMeshBasicMaterial?i(n,s):s.isMeshLambertMaterial?(i(n,s),function(_,v){v.emissiveMap&&(_.emissiveMap.value=v.emissiveMap)}(n,s)):s.isMeshToonMaterial?(i(n,s),function(_,v){v.gradientMap&&(_.gradientMap.value=v.gradientMap),v.emissiveMap&&(_.emissiveMap.value=v.emissiveMap),v.bumpMap&&(_.bumpMap.value=v.bumpMap,_.bumpScale.value=v.bumpScale,v.side===1&&(_.bumpScale.value*=-1)),v.normalMap&&(_.normalMap.value=v.normalMap,_.normalScale.value.copy(v.normalScale),v.side===1&&_.normalScale.value.negate()),v.displacementMap&&(_.displacementMap.value=v.displacementMap,_.displacementScale.value=v.displacementScale,_.displacementBias.value=v.displacementBias)}(n,s)):s.isMeshPhongMaterial?(i(n,s),function(_,v){_.specular.value.copy(v.specular),_.shininess.value=Math.max(v.shininess,1e-4),v.emissiveMap&&(_.emissiveMap.value=v.emissiveMap),v.bumpMap&&(_.bumpMap.value=v.bumpMap,_.bumpScale.value=v.bumpScale,v.side===1&&(_.bumpScale.value*=-1)),v.normalMap&&(_.normalMap.value=v.normalMap,_.normalScale.value.copy(v.normalScale),v.side===1&&_.normalScale.value.negate()),v.displacementMap&&(_.displacementMap.value=v.displacementMap,_.displacementScale.value=v.displacementScale,_.displacementBias.value=v.displacementBias)}(n,s)):s.isMeshStandardMaterial?(i(n,s),s.isMeshPhysicalMaterial?function(_,v){t(_,v),_.reflectivity.value=v.reflectivity,_.clearcoat.value=v.clearcoat,_.clearcoatRoughness.value=v.clearcoatRoughness,v.sheen&&_.sheen.value.copy(v.sheen),v.clearcoatMap&&(_.clearcoatMap.value=v.clearcoatMap),v.clearcoatRoughnessMap&&(_.clearcoatRoughnessMap.value=v.clearcoatRoughnessMap),v.clearcoatNormalMap&&(_.clearcoatNormalScale.value.copy(v.clearcoatNormalScale),_.clearcoatNormalMap.value=v.clearcoatNormalMap,v.side===1&&_.clearcoatNormalScale.value.negate()),_.transmission.value=v.transmission,v.transmissionMap&&(_.transmissionMap.value=v.transmissionMap)}(n,s):t(n,s)):s.isMeshMatcapMaterial?(i(n,s),function(_,v){v.matcap&&(_.matcap.value=v.matcap),v.bumpMap&&(_.bumpMap.value=v.bumpMap,_.bumpScale.value=v.bumpScale,v.side===1&&(_.bumpScale.value*=-1)),v.normalMap&&(_.normalMap.value=v.normalMap,_.normalScale.value.copy(v.normalScale),v.side===1&&_.normalScale.value.negate()),v.displacementMap&&(_.displacementMap.value=v.displacementMap,_.displacementScale.value=v.displacementScale,_.displacementBias.value=v.displacementBias)}(n,s)):s.isMeshDepthMaterial?(i(n,s),function(_,v){v.displacementMap&&(_.displacementMap.value=v.displacementMap,_.displacementScale.value=v.displacementScale,_.displacementBias.value=v.displacementBias)}(n,s)):s.isMeshDistanceMaterial?(i(n,s),function(_,v){v.displacementMap&&(_.displacementMap.value=v.displacementMap,_.displacementScale.value=v.displacementScale,_.displacementBias.value=v.displacementBias),_.referencePosition.value.copy(v.referencePosition),_.nearDistance.value=v.nearDistance,_.farDistance.value=v.farDistance}(n,s)):s.isMeshNormalMaterial?(i(n,s),function(_,v){v.bumpMap&&(_.bumpMap.value=v.bumpMap,_.bumpScale.value=v.bumpScale,v.side===1&&(_.bumpScale.value*=-1)),v.normalMap&&(_.normalMap.value=v.normalMap,_.normalScale.value.copy(v.normalScale),v.side===1&&_.normalScale.value.negate()),v.displacementMap&&(_.displacementMap.value=v.displacementMap,_.displacementScale.value=v.displacementScale,_.displacementBias.value=v.displacementBias)}(n,s)):s.isLineBasicMaterial?(function(_,v){_.diffuse.value.copy(v.color),_.opacity.value=v.opacity}(n,s),s.isLineDashedMaterial&&function(_,v){_.dashSize.value=v.dashSize,_.totalSize.value=v.dashSize+v.gapSize,_.scale.value=v.scale}(n,s)):s.isPointsMaterial?function(_,v,A,E){_.diffuse.value.copy(v.color),_.opacity.value=v.opacity,_.size.value=v.size*A,_.scale.value=.5*E,v.map&&(_.map.value=v.map),v.alphaMap&&(_.alphaMap.value=v.alphaMap);var L;v.map?L=v.map:v.alphaMap&&(L=v.alphaMap),L!==void 0&&(L.matrixAutoUpdate===!0&&L.updateMatrix(),_.uvTransform.value.copy(L.matrix))}(n,s,l,p):s.isSpriteMaterial?function(_,v){_.diffuse.value.copy(v.color),_.opacity.value=v.opacity,_.rotation.value=v.rotation,v.map&&(_.map.value=v.map),v.alphaMap&&(_.alphaMap.value=v.alphaMap);var A;v.map?A=v.map:v.alphaMap&&(A=v.alphaMap),A!==void 0&&(A.matrixAutoUpdate===!0&&A.updateMatrix(),_.uvTransform.value.copy(A.matrix))}(n,s):s.isShadowMaterial?(n.color.value.copy(s.color),n.opacity.value=s.opacity):s.isShaderMaterial&&(s.uniformsNeedUpdate=!1)}}}function Kt(a){var i,t=(a=a||{}).canvas!==void 0?a.canvas:((i=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")).style.display="block",i),e=a.context!==void 0?a.context:null,n=a.alpha!==void 0&&a.alpha,s=a.depth===void 0||a.depth,l=a.stencil===void 0||a.stencil,p=a.antialias!==void 0&&a.antialias,_=a.premultipliedAlpha===void 0||a.premultipliedAlpha,v=a.preserveDrawingBuffer!==void 0&&a.preserveDrawingBuffer,A=a.powerPreference!==void 0?a.powerPreference:"default",E=a.failIfMajorPerformanceCaveat!==void 0&&a.failIfMajorPerformanceCaveat,L=null,D=null,B=[],U=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=_i,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var V=this,j=!1,K=null,ee=0,J=0,$=null,se=null,re=-1,ie=null,pe=new Ft,de=new Ft,ye=null,Ee=t.width,Re=t.height,Le=1,le=null,_e=null,Ae=new Ft(0,0,Ee,Re),be=new Ft(0,0,Ee,Re),ge=!1,Te=new Ms,Fe=!1,tt=!1,at=new ht,oe=new te,ue={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Oe(){return $===null?Le:1}var Pe,Ue,we,Se,qe,Ze,rt,Xe,gt,Rt,Ot,St,At,Yt,kt,ei,pi,Dn,jn,fi,ci,He=e;function oa(ae,ke){for(var Ce=0;Ce<ae.length;Ce++){var ze=ae[Ce],Qe=t.getContext(ze,ke);if(Qe!==null)return Qe}return null}try{var ds={alpha:n,depth:s,stencil:l,antialias:p,premultipliedAlpha:_,preserveDrawingBuffer:v,powerPreference:A,failIfMajorPerformanceCaveat:E};if(t.addEventListener("webglcontextlost",ca,!1),t.addEventListener("webglcontextrestored",ua,!1),He===null){var la=["webgl2","webgl","experimental-webgl"];if(V.isWebGL1Renderer===!0&&la.shift(),(He=oa(la,ds))===null)throw oa(la)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}He.getShaderPrecisionFormat===void 0&&(He.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(ae){throw console.error("THREE.WebGLRenderer: "+ae.message),ae}function ha(){Pe=new _u(He),Ue=new pu(He,Pe,a),Pe.init(Ue),fi=new xh(He,Pe,Ue),(we=new xd(He,Pe,Ue)).scissor(de.copy(be).multiplyScalar(Le).floor()),we.viewport(pe.copy(Ae).multiplyScalar(Le).floor()),Se=new yu(He),qe=new dd,Ze=new Sd(He,Pe,we,qe,Ue,fi,Se),rt=new mu(V),Xe=new hu(He,Ue),ci=new uu(He,Pe,Xe,Ue),gt=new gu(He,Xe,Se,ci),Rt=new wu(He,gt,Xe,Se),pi=new Su(He),kt=new fu(qe),Ot=new ud(V,rt,Pe,Ue,ci,kt),St=new wd(qe),At=new md(qe),Yt=new bd(Pe,Ue),ei=new cu(V,rt,we,Rt,_),Dn=new du(He,Pe,Se,Ue),jn=new vu(He,Pe,Se,Ue),Se.programs=Ot.programs,V.capabilities=Ue,V.extensions=Pe,V.properties=qe,V.renderLists=At,V.state=we,V.info=Se}ha();var Ji=new Sh(V,He);this.xr=Ji;var Mo=new bh(V,Rt,Ue.maxTextureSize);function ca(ae){ae.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),j=!0}function ua(){console.log("THREE.WebGLRenderer: Context Restored."),j=!1,ha()}function fr(ae){var ke=ae.target;ke.removeEventListener("dispose",fr),function(Ce){Fr(Ce),qe.remove(Ce)}(ke)}function Fr(ae){var ke=qe.get(ae).program;ke!==void 0&&Ot.releaseProgram(ke)}this.shadowMap=Mo,this.getContext=function(){return He},this.getContextAttributes=function(){return He.getContextAttributes()},this.forceContextLoss=function(){var ae=Pe.get("WEBGL_lose_context");ae&&ae.loseContext()},this.forceContextRestore=function(){var ae=Pe.get("WEBGL_lose_context");ae&&ae.restoreContext()},this.getPixelRatio=function(){return Le},this.setPixelRatio=function(ae){ae!==void 0&&(Le=ae,this.setSize(Ee,Re,!1))},this.getSize=function(ae){return ae===void 0&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),ae=new Ve),ae.set(Ee,Re)},this.setSize=function(ae,ke,Ce){Ji.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Ee=ae,Re=ke,t.width=Math.floor(ae*Le),t.height=Math.floor(ke*Le),Ce!==!1&&(t.style.width=ae+"px",t.style.height=ke+"px"),this.setViewport(0,0,ae,ke))},this.getDrawingBufferSize=function(ae){return ae===void 0&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),ae=new Ve),ae.set(Ee*Le,Re*Le).floor()},this.setDrawingBufferSize=function(ae,ke,Ce){Ee=ae,Re=ke,Le=Ce,t.width=Math.floor(ae*Ce),t.height=Math.floor(ke*Ce),this.setViewport(0,0,ae,ke)},this.getCurrentViewport=function(ae){return ae===void 0&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),ae=new Ft),ae.copy(pe)},this.getViewport=function(ae){return ae.copy(Ae)},this.setViewport=function(ae,ke,Ce,ze){ae.isVector4?Ae.set(ae.x,ae.y,ae.z,ae.w):Ae.set(ae,ke,Ce,ze),we.viewport(pe.copy(Ae).multiplyScalar(Le).floor())},this.getScissor=function(ae){return ae.copy(be)},this.setScissor=function(ae,ke,Ce,ze){ae.isVector4?be.set(ae.x,ae.y,ae.z,ae.w):be.set(ae,ke,Ce,ze),we.scissor(de.copy(be).multiplyScalar(Le).floor())},this.getScissorTest=function(){return ge},this.setScissorTest=function(ae){we.setScissorTest(ge=ae)},this.setOpaqueSort=function(ae){le=ae},this.setTransparentSort=function(ae){_e=ae},this.getClearColor=function(ae){return ae===void 0&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),ae=new nt),ae.copy(ei.getClearColor())},this.setClearColor=function(){ei.setClearColor.apply(ei,arguments)},this.getClearAlpha=function(){return ei.getClearAlpha()},this.setClearAlpha=function(){ei.setClearAlpha.apply(ei,arguments)},this.clear=function(ae,ke,Ce){var ze=0;(ae===void 0||ae)&&(ze|=16384),(ke===void 0||ke)&&(ze|=256),(Ce===void 0||Ce)&&(ze|=1024),He.clear(ze)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ca,!1),t.removeEventListener("webglcontextrestored",ua,!1),At.dispose(),Yt.dispose(),qe.dispose(),rt.dispose(),Rt.dispose(),ci.dispose(),Ji.dispose(),Sn.stop()},this.renderBufferImmediate=function(ae,ke){ci.initAttributes();var Ce=qe.get(ae);ae.hasPositions&&!Ce.position&&(Ce.position=He.createBuffer()),ae.hasNormals&&!Ce.normal&&(Ce.normal=He.createBuffer()),ae.hasUvs&&!Ce.uv&&(Ce.uv=He.createBuffer()),ae.hasColors&&!Ce.color&&(Ce.color=He.createBuffer());var ze=ke.getAttributes();ae.hasPositions&&(He.bindBuffer(34962,Ce.position),He.bufferData(34962,ae.positionArray,35048),ci.enableAttribute(ze.position),He.vertexAttribPointer(ze.position,3,5126,!1,0,0)),ae.hasNormals&&(He.bindBuffer(34962,Ce.normal),He.bufferData(34962,ae.normalArray,35048),ci.enableAttribute(ze.normal),He.vertexAttribPointer(ze.normal,3,5126,!1,0,0)),ae.hasUvs&&(He.bindBuffer(34962,Ce.uv),He.bufferData(34962,ae.uvArray,35048),ci.enableAttribute(ze.uv),He.vertexAttribPointer(ze.uv,2,5126,!1,0,0)),ae.hasColors&&(He.bindBuffer(34962,Ce.color),He.bufferData(34962,ae.colorArray,35048),ci.enableAttribute(ze.color),He.vertexAttribPointer(ze.color,3,5126,!1,0,0)),ci.disableUnusedAttributes(),He.drawArrays(4,0,ae.count),ae.count=0},this.renderBufferDirect=function(ae,ke,Ce,ze,Qe,wt){ke===null&&(ke=ue);var xt=Qe.isMesh&&Qe.matrixWorld.determinant()<0,Tt=pa(ae,ke,ze,Qe);we.setMaterial(ze,xt);var mt=Ce.index,Ht=Ce.attributes.position;if(mt===null){if(Ht===void 0||Ht.count===0)return}else if(mt.count===0)return;var Wt,ut=1;ze.wireframe===!0&&(mt=gt.getWireframeAttribute(Ce),ut=2),(ze.morphTargets||ze.morphNormals)&&pi.update(Qe,Ce,ze,Tt),ci.setup(Qe,ze,Tt,Ce,mt);var Mt=Dn;mt!==null&&(Wt=Xe.get(mt),(Mt=jn).setIndex(Wt));var ii=mt!==null?mt.count:Ht.count,Pt=Ce.drawRange.start*ut,Et=Ce.drawRange.count*ut,It=wt!==null?wt.start*ut:0,yt=wt!==null?wt.count*ut:1/0,zt=Math.max(Pt,It),jt=Math.min(ii,Pt+Et,It+yt)-1,Dt=Math.max(0,jt-zt+1);if(Dt!==0){if(Qe.isMesh)ze.wireframe===!0?(we.setLineWidth(ze.wireframeLinewidth*Oe()),Mt.setMode(1)):Mt.setMode(4);else if(Qe.isLine){var ai=ze.linewidth;ai===void 0&&(ai=1),we.setLineWidth(ai*Oe()),Qe.isLineSegments?Mt.setMode(1):Qe.isLineLoop?Mt.setMode(2):Mt.setMode(3)}else Qe.isPoints?Mt.setMode(0):Qe.isSprite&&Mt.setMode(4);if(Qe.isInstancedMesh)Mt.renderInstances(zt,Dt,Qe.count);else if(Ce.isInstancedBufferGeometry){var Xt=Math.min(Ce.instanceCount,Ce._maxInstanceCount);Mt.renderInstances(zt,Dt,Xt)}else Mt.render(zt,Dt)}},this.compile=function(ae,ke){(D=Yt.get(ae)).init(),ae.traverseVisible(function(ze){ze.isLight&&ze.layers.test(ke.layers)&&(D.pushLight(ze),ze.castShadow&&D.pushShadow(ze))}),D.setupLights();var Ce=new WeakMap;ae.traverse(function(ze){var Qe=ze.material;if(Qe)if(Array.isArray(Qe))for(var wt=0;wt<Qe.length;wt++){var xt=Qe[wt];Ce.has(xt)===!1&&(On(xt,ae,ze),Ce.set(xt))}else Ce.has(Qe)===!1&&(On(Qe,ae,ze),Ce.set(Qe))})};var Rn=null,Sn=new Jl;function zr(ae,ke,Ce,ze){if(ae.visible!==!1){if(ae.layers.test(ke.layers)){if(ae.isGroup)Ce=ae.renderOrder;else if(ae.isLOD)ae.autoUpdate===!0&&ae.update(ke);else if(ae.isLight)D.pushLight(ae),ae.castShadow&&D.pushShadow(ae);else if(ae.isSprite){if(!ae.frustumCulled||Te.intersectsSprite(ae)){ze&&oe.setFromMatrixPosition(ae.matrixWorld).applyMatrix4(at);var Qe=Rt.update(ae),wt=ae.material;wt.visible&&L.push(ae,Qe,wt,Ce,oe.z,null)}}else if(ae.isImmediateRenderObject)ze&&oe.setFromMatrixPosition(ae.matrixWorld).applyMatrix4(at),L.push(ae,null,ae.material,Ce,oe.z,null);else if((ae.isMesh||ae.isLine||ae.isPoints)&&(ae.isSkinnedMesh&&ae.skeleton.frame!==Se.render.frame&&(ae.skeleton.update(),ae.skeleton.frame=Se.render.frame),!ae.frustumCulled||Te.intersectsObject(ae))){ze&&oe.setFromMatrixPosition(ae.matrixWorld).applyMatrix4(at);var xt=Rt.update(ae),Tt=ae.material;if(Array.isArray(Tt))for(var mt=xt.groups,Ht=0,Wt=mt.length;Ht<Wt;Ht++){var ut=mt[Ht],Mt=Tt[ut.materialIndex];Mt&&Mt.visible&&L.push(ae,xt,Mt,Ce,oe.z,ut)}else Tt.visible&&L.push(ae,xt,Tt,Ce,oe.z,null)}}for(var ii=ae.children,Pt=0,Et=ii.length;Pt<Et;Pt++)zr(ii[Pt],ke,Ce,ze)}}function ps(ae,ke,Ce){for(var ze=ke.isScene===!0?ke.overrideMaterial:null,Qe=0,wt=ae.length;Qe<wt;Qe++){var xt=ae[Qe],Tt=xt.object,mt=xt.geometry,Ht=ze===null?xt.material:ze,Wt=xt.group;if(Ce.isArrayCamera)for(var ut=Ce.cameras,Mt=0,ii=ut.length;Mt<ii;Mt++){var Pt=ut[Mt];Tt.layers.test(Pt.layers)&&(we.viewport(pe.copy(Pt.viewport)),D.setupLightsView(Pt),da(Tt,ke,Pt,mt,Ht,Wt))}else da(Tt,ke,Ce,mt,Ht,Wt)}}function da(ae,ke,Ce,ze,Qe,wt){if(ae.onBeforeRender(V,ke,Ce,ze,Qe,wt),ae.modelViewMatrix.multiplyMatrices(Ce.matrixWorldInverse,ae.matrixWorld),ae.normalMatrix.getNormalMatrix(ae.modelViewMatrix),ae.isImmediateRenderObject){var xt=pa(Ce,ke,Qe,ae);we.setMaterial(Qe),ci.reset(),function(Tt,mt){Tt.render(function(Ht){V.renderBufferImmediate(Ht,mt)})}(ae,xt)}else V.renderBufferDirect(Ce,ke,ze,Qe,ae,wt);ae.onAfterRender(V,ke,Ce,ze,Qe,wt)}function On(ae,ke,Ce){ke.isScene!==!0&&(ke=ue);var ze=qe.get(ae),Qe=D.state.lights,wt=D.state.shadowsArray,xt=Qe.state.version,Tt=Ot.getParameters(ae,Qe.state,wt,ke,Ce),mt=Ot.getProgramCacheKey(Tt),Ht=ze.program,Wt=!0;if(ze.environment=ae.isMeshStandardMaterial?ke.environment:null,ze.fog=ke.fog,ze.envMap=rt.get(ae.envMap||ze.environment),Ht===void 0)ae.addEventListener("dispose",fr);else if(Ht.cacheKey!==mt)Fr(ae);else if(ze.lightsStateVersion!==xt)Wt=!1;else{if(Tt.shaderID!==void 0)return;Wt=!1}Wt&&(Tt.uniforms=Ot.getUniforms(ae),ae.onBeforeCompile(Tt,V),Ht=Ot.acquireProgram(Tt,mt),ze.program=Ht,ze.uniforms=Tt.uniforms,ze.outputEncoding=Tt.outputEncoding);var ut=ze.uniforms;(ae.isShaderMaterial||ae.isRawShaderMaterial)&&ae.clipping!==!0||(ze.numClippingPlanes=kt.numPlanes,ze.numIntersection=kt.numIntersection,ut.clippingPlanes=kt.uniform),ze.needsLights=function(Pt){return Pt.isMeshLambertMaterial||Pt.isMeshToonMaterial||Pt.isMeshPhongMaterial||Pt.isMeshStandardMaterial||Pt.isShadowMaterial||Pt.isShaderMaterial&&Pt.lights===!0}(ae),ze.lightsStateVersion=xt,ze.needsLights&&(ut.ambientLightColor.value=Qe.state.ambient,ut.lightProbe.value=Qe.state.probe,ut.directionalLights.value=Qe.state.directional,ut.directionalLightShadows.value=Qe.state.directionalShadow,ut.spotLights.value=Qe.state.spot,ut.spotLightShadows.value=Qe.state.spotShadow,ut.rectAreaLights.value=Qe.state.rectArea,ut.ltc_1.value=Qe.state.rectAreaLTC1,ut.ltc_2.value=Qe.state.rectAreaLTC2,ut.pointLights.value=Qe.state.point,ut.pointLightShadows.value=Qe.state.pointShadow,ut.hemisphereLights.value=Qe.state.hemi,ut.directionalShadowMap.value=Qe.state.directionalShadowMap,ut.directionalShadowMatrix.value=Qe.state.directionalShadowMatrix,ut.spotShadowMap.value=Qe.state.spotShadowMap,ut.spotShadowMatrix.value=Qe.state.spotShadowMatrix,ut.pointShadowMap.value=Qe.state.pointShadowMap,ut.pointShadowMatrix.value=Qe.state.pointShadowMatrix);var Mt=ze.program.getUniforms(),ii=ar.seqWithValue(Mt.seq,ut);ze.uniformsList=ii}function pa(ae,ke,Ce,ze){ke.isScene!==!0&&(ke=ue),Ze.resetTextureUnits();var Qe=ke.fog,wt=Ce.isMeshStandardMaterial?ke.environment:null,xt=$===null?V.outputEncoding:$.texture.encoding,Tt=rt.get(Ce.envMap||wt),mt=qe.get(Ce),Ht=D.state.lights;if(Fe===!0&&(tt===!0||ae!==ie)){var Wt=ae===ie&&Ce.id===re;kt.setState(Ce,ae,Wt)}Ce.version===mt.__version?Ce.fog&&mt.fog!==Qe||mt.environment!==wt||mt.needsLights&&mt.lightsStateVersion!==Ht.state.version?On(Ce,ke,ze):mt.numClippingPlanes===void 0||mt.numClippingPlanes===kt.numPlanes&&mt.numIntersection===kt.numIntersection?(mt.outputEncoding!==xt||mt.envMap!==Tt)&&On(Ce,ke,ze):On(Ce,ke,ze):(On(Ce,ke,ze),mt.__version=Ce.version);var ut,Mt,ii=!1,Pt=!1,Et=!1,It=mt.program,yt=It.getUniforms(),zt=mt.uniforms;if(we.useProgram(It.program)&&(ii=!0,Pt=!0,Et=!0),Ce.id!==re&&(re=Ce.id,Pt=!0),ii||ie!==ae){if(yt.setValue(He,"projectionMatrix",ae.projectionMatrix),Ue.logarithmicDepthBuffer&&yt.setValue(He,"logDepthBufFC",2/(Math.log(ae.far+1)/Math.LN2)),ie!==ae&&(ie=ae,Pt=!0,Et=!0),Ce.isShaderMaterial||Ce.isMeshPhongMaterial||Ce.isMeshToonMaterial||Ce.isMeshStandardMaterial||Ce.envMap){var jt=yt.map.cameraPosition;jt!==void 0&&jt.setValue(He,oe.setFromMatrixPosition(ae.matrixWorld))}(Ce.isMeshPhongMaterial||Ce.isMeshToonMaterial||Ce.isMeshLambertMaterial||Ce.isMeshBasicMaterial||Ce.isMeshStandardMaterial||Ce.isShaderMaterial)&&yt.setValue(He,"isOrthographic",ae.isOrthographicCamera===!0),(Ce.isMeshPhongMaterial||Ce.isMeshToonMaterial||Ce.isMeshLambertMaterial||Ce.isMeshBasicMaterial||Ce.isMeshStandardMaterial||Ce.isShaderMaterial||Ce.isShadowMaterial||Ce.skinning)&&yt.setValue(He,"viewMatrix",ae.matrixWorldInverse)}if(Ce.skinning){yt.setOptional(He,ze,"bindMatrix"),yt.setOptional(He,ze,"bindMatrixInverse");var Dt=ze.skeleton;if(Dt){var ai=Dt.bones;if(Ue.floatVertexTextures){if(Dt.boneTexture===null){var Xt=Math.sqrt(4*ai.length);Xt=dt.ceilPowerOfTwo(Xt),Xt=Math.max(Xt,4);var mi=new Float32Array(Xt*Xt*4);mi.set(Dt.boneMatrices);var $i=new Qr(mi,Xt,Xt,H,S);Dt.boneMatrices=mi,Dt.boneTexture=$i,Dt.boneTextureSize=Xt}yt.setValue(He,"boneTexture",Dt.boneTexture,Ze),yt.setValue(He,"boneTextureSize",Dt.boneTextureSize)}else yt.setOptional(He,Dt,"boneMatrices")}}return(Pt||mt.receiveShadow!==ze.receiveShadow)&&(mt.receiveShadow=ze.receiveShadow,yt.setValue(He,"receiveShadow",ze.receiveShadow)),Pt&&(yt.setValue(He,"toneMappingExposure",V.toneMappingExposure),mt.needsLights&&(Mt=Et,(ut=zt).ambientLightColor.needsUpdate=Mt,ut.lightProbe.needsUpdate=Mt,ut.directionalLights.needsUpdate=Mt,ut.directionalLightShadows.needsUpdate=Mt,ut.pointLights.needsUpdate=Mt,ut.pointLightShadows.needsUpdate=Mt,ut.spotLights.needsUpdate=Mt,ut.spotLightShadows.needsUpdate=Mt,ut.rectAreaLights.needsUpdate=Mt,ut.hemisphereLights.needsUpdate=Mt),Qe&&Ce.fog&&St.refreshFogUniforms(zt,Qe),St.refreshMaterialUniforms(zt,Ce,Le,Re),ar.upload(He,mt.uniformsList,zt,Ze)),Ce.isShaderMaterial&&Ce.uniformsNeedUpdate===!0&&(ar.upload(He,mt.uniformsList,zt,Ze),Ce.uniformsNeedUpdate=!1),Ce.isSpriteMaterial&&yt.setValue(He,"center",ze.center),yt.setValue(He,"modelViewMatrix",ze.modelViewMatrix),yt.setValue(He,"normalMatrix",ze.normalMatrix),yt.setValue(He,"modelMatrix",ze.matrixWorld),It}Sn.setAnimationLoop(function(ae){Ji.isPresenting||Rn&&Rn(ae)}),typeof window<"u"&&Sn.setContext(window),this.setAnimationLoop=function(ae){Rn=ae,Ji.setAnimationLoop(ae),ae===null?Sn.stop():Sn.start()},this.render=function(ae,ke){var Ce,ze;if(arguments[2]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),Ce=arguments[2]),arguments[3]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),ze=arguments[3]),ke===void 0||ke.isCamera===!0){if(j!==!0){ci.resetDefaultState(),re=-1,ie=null,ae.autoUpdate===!0&&ae.updateMatrixWorld(),ke.parent===null&&ke.updateMatrixWorld(),Ji.enabled===!0&&Ji.isPresenting===!0&&(ke=Ji.getCamera(ke)),ae.isScene===!0&&ae.onBeforeRender(V,ae,ke,Ce||$),(D=Yt.get(ae,U.length)).init(),U.push(D),at.multiplyMatrices(ke.projectionMatrix,ke.matrixWorldInverse),Te.setFromProjectionMatrix(at),tt=this.localClippingEnabled,Fe=kt.init(this.clippingPlanes,tt,ke),(L=At.get(ae,B.length)).init(),B.push(L),zr(ae,ke,0,V.sortObjects),L.finish(),V.sortObjects===!0&&L.sort(le,_e),Fe===!0&&kt.beginShadows();var Qe=D.state.shadowsArray;Mo.render(Qe,ae,ke),D.setupLights(),D.setupLightsView(ke),Fe===!0&&kt.endShadows(),this.info.autoReset===!0&&this.info.reset(),Ce!==void 0&&this.setRenderTarget(Ce),ei.render(L,ae,ke,ze);var wt=L.opaque,xt=L.transparent;wt.length>0&&ps(wt,ae,ke),xt.length>0&&ps(xt,ae,ke),ae.isScene===!0&&ae.onAfterRender(V,ae,ke),$!==null&&(Ze.updateRenderTargetMipmap($),Ze.updateMultisampleRenderTarget($)),we.buffers.depth.setTest(!0),we.buffers.depth.setMask(!0),we.buffers.color.setMask(!0),we.setPolygonOffset(!1),U.pop(),D=U.length>0?U[U.length-1]:null,B.pop(),L=B.length>0?B[B.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(ae){K!==ae&&$===null&&He.bindFramebuffer(36160,ae),K=ae},this.getActiveCubeFace=function(){return ee},this.getActiveMipmapLevel=function(){return J},this.getRenderTarget=function(){return $},this.setRenderTarget=function(ae,ke,Ce){ke===void 0&&(ke=0),Ce===void 0&&(Ce=0),$=ae,ee=ke,J=Ce,ae&&qe.get(ae).__webglFramebuffer===void 0&&Ze.setupRenderTarget(ae);var ze=K,Qe=!1,wt=!1;if(ae){var xt=ae.texture;(xt.isDataTexture3D||xt.isDataTexture2DArray)&&(wt=!0);var Tt=qe.get(ae).__webglFramebuffer;ae.isWebGLCubeRenderTarget?(ze=Tt[ke],Qe=!0):ze=ae.isWebGLMultisampleRenderTarget?qe.get(ae).__webglMultisampledFramebuffer:Tt,pe.copy(ae.viewport),de.copy(ae.scissor),ye=ae.scissorTest}else pe.copy(Ae).multiplyScalar(Le).floor(),de.copy(be).multiplyScalar(Le).floor(),ye=ge;if(se!==ze&&(He.bindFramebuffer(36160,ze),se=ze),we.viewport(pe),we.scissor(de),we.setScissorTest(ye),Qe){var mt=qe.get(ae.texture);He.framebufferTexture2D(36160,36064,34069+ke,mt.__webglTexture,Ce)}else if(wt){var Ht=qe.get(ae.texture),Wt=ke||0;He.framebufferTextureLayer(36160,36064,Ht.__webglTexture,Ce||0,Wt)}},this.readRenderTargetPixels=function(ae,ke,Ce,ze,Qe,wt,xt){if(ae&&ae.isWebGLRenderTarget){var Tt=qe.get(ae).__webglFramebuffer;if(ae.isWebGLCubeRenderTarget&&xt!==void 0&&(Tt=Tt[xt]),Tt){var mt=!1;Tt!==se&&(He.bindFramebuffer(36160,Tt),mt=!0);try{var Ht=ae.texture,Wt=Ht.format,ut=Ht.type;if(Wt!==H&&fi.convert(Wt)!==He.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");var Mt=ut===F&&(Pe.has("EXT_color_buffer_half_float")||Ue.isWebGL2&&Pe.has("EXT_color_buffer_float"));if(!(ut===z||fi.convert(ut)===He.getParameter(35738)||ut===S&&(Ue.isWebGL2||Pe.has("OES_texture_float")||Pe.has("WEBGL_color_buffer_float"))||Mt))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");He.checkFramebufferStatus(36160)===36053?ke>=0&&ke<=ae.width-ze&&Ce>=0&&Ce<=ae.height-Qe&&He.readPixels(ke,Ce,ze,Qe,fi.convert(Wt),fi.convert(ut),wt):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{mt&&He.bindFramebuffer(36160,se)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(ae,ke,Ce){Ce===void 0&&(Ce=0);var ze=Math.pow(2,-Ce),Qe=Math.floor(ke.image.width*ze),wt=Math.floor(ke.image.height*ze),xt=fi.convert(ke.format);Ze.setTexture2D(ke,0),He.copyTexImage2D(3553,Ce,xt,ae.x,ae.y,Qe,wt,0),we.unbindTexture()},this.copyTextureToTexture=function(ae,ke,Ce,ze){ze===void 0&&(ze=0);var Qe=ke.image.width,wt=ke.image.height,xt=fi.convert(Ce.format),Tt=fi.convert(Ce.type);Ze.setTexture2D(Ce,0),He.pixelStorei(37440,Ce.flipY),He.pixelStorei(37441,Ce.premultiplyAlpha),He.pixelStorei(3317,Ce.unpackAlignment),ke.isDataTexture?He.texSubImage2D(3553,ze,ae.x,ae.y,Qe,wt,xt,Tt,ke.image.data):ke.isCompressedTexture?He.compressedTexSubImage2D(3553,ze,ae.x,ae.y,ke.mipmaps[0].width,ke.mipmaps[0].height,xt,ke.mipmaps[0].data):He.texSubImage2D(3553,ze,ae.x,ae.y,xt,Tt,ke.image),ze===0&&Ce.generateMipmaps&&He.generateMipmap(3553),we.unbindTexture()},this.copyTextureToTexture3D=function(ae,ke,Ce,ze,Qe){if(Qe===void 0&&(Qe=0),V.isWebGL1Renderer)console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");else{var wt,xt=Ce.image,Tt=xt.width,mt=xt.height,Ht=xt.data,Wt=fi.convert(ze.format),ut=fi.convert(ze.type);if(ze.isDataTexture3D)Ze.setTexture3D(ze,0),wt=32879;else{if(!ze.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Ze.setTexture2DArray(ze,0),wt=35866}He.pixelStorei(37440,ze.flipY),He.pixelStorei(37441,ze.premultiplyAlpha),He.pixelStorei(3317,ze.unpackAlignment);var Mt=He.getParameter(3314),ii=He.getParameter(32878),Pt=He.getParameter(3316),Et=He.getParameter(3315),It=He.getParameter(32877);He.pixelStorei(3314,Tt),He.pixelStorei(32878,mt),He.pixelStorei(3316,ae.min.x),He.pixelStorei(3315,ae.min.y),He.pixelStorei(32877,ae.min.z),He.texSubImage3D(wt,Qe,ke.x,ke.y,ke.z,ae.max.x-ae.min.x+1,ae.max.y-ae.min.y+1,ae.max.z-ae.min.z+1,Wt,ut,Ht),He.pixelStorei(3314,Mt),He.pixelStorei(32878,ii),He.pixelStorei(3316,Pt),He.pixelStorei(3315,Et),He.pixelStorei(32877,It),Qe===0&&ze.generateMipmaps&&He.generateMipmap(wt),we.unbindTexture()}},this.initTexture=function(ae){Ze.setTexture2D(ae,0),we.unbindTexture()},this.resetState=function(){we.reset(),ci.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Er.prototype.isGroup=!0,Object.assign(Ds.prototype,{constructor:Ds,getHandSpace:function(){return this._hand===null&&(this._hand=new Er,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand},getTargetRaySpace:function(){return this._targetRay===null&&(this._targetRay=new Er,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return this._grip===null&&(this._grip=new Er,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(i){return this._targetRay!==null&&this._targetRay.dispatchEvent(i),this._grip!==null&&this._grip.dispatchEvent(i),this._hand!==null&&this._hand.dispatchEvent(i),this},disconnect:function(i){return this.dispatchEvent({type:"disconnected",data:i}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this},update:function(i,t,e){var n=null,s=null,l=null,p=this._targetRay,_=this._grip,v=this._hand;if(i&&t.session.visibilityState!=="visible-blurred")if(v&&i.hand){l=!0;for(var A,E=fs(i.hand.values());!(A=E()).done;){var L=A.value,D=t.getJointPose(L,e);if(v.joints[L.jointName]===void 0){var B=new Er;B.matrixAutoUpdate=!1,B.visible=!1,v.joints[L.jointName]=B,v.add(B)}var U=v.joints[L.jointName];D!==null&&(U.matrix.fromArray(D.transform.matrix),U.matrix.decompose(U.position,U.rotation,U.scale),U.jointRadius=D.radius),U.visible=D!==null}var V=v.joints["index-finger-tip"],j=v.joints["thumb-tip"],K=V.position.distanceTo(j.position);v.inputState.pinching&&K>.025?(v.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:i.handedness,target:this})):!v.inputState.pinching&&K<=.015&&(v.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:i.handedness,target:this}))}else p!==null&&(n=t.getPose(i.targetRaySpace,e))!==null&&(p.matrix.fromArray(n.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale)),_!==null&&i.gripSpace&&(s=t.getPose(i.gripSpace,e))!==null&&(_.matrix.fromArray(s.transform.matrix),_.matrix.decompose(_.position,_.rotation,_.scale));return p!==null&&(p.visible=n!==null),_!==null&&(_.visible=s!==null),v!==null&&(v.visible=l!==null),this}}),Object.assign(Sh.prototype,wi.prototype);var wh=function(a){function i(){return a.apply(this,arguments)||this}return Be(i,a),i}(Kt);wh.prototype.isWebGL1Renderer=!0;var Ko=function(){function a(t,e){this.name="",this.color=new nt(t),this.density=e!==void 0?e:25e-5}var i=a.prototype;return i.clone=function(){return new a(this.color,this.density)},i.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},a}();Ko.prototype.isFogExp2=!0;var Yo=function(){function a(t,e,n){this.name="",this.color=new nt(t),this.near=e!==void 0?e:1,this.far=n!==void 0?n:1e3}var i=a.prototype;return i.clone=function(){return new a(this.color,this.near,this.far)},i.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},a}();Yo.prototype.isFog=!0;var Ra=function(a){function i(){var e;return(e=a.call(this)||this).type="Scene",e.background=null,e.environment=null,e.fog=null,e.overrideMaterial=null,e.autoUpdate=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:bi(e)})),e}Be(i,a);var t=i.prototype;return t.copy=function(e,n){return a.prototype.copy.call(this,e,n),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},t.toJSON=function(e){var n=a.prototype.toJSON.call(this,e);return this.background!==null&&(n.object.background=this.background.toJSON(e)),this.environment!==null&&(n.object.environment=this.environment.toJSON(e)),this.fog!==null&&(n.object.fog=this.fog.toJSON()),n},i}(Ge);function ki(a,i){this.array=a,this.stride=i,this.count=a!==void 0?a.length/i:0,this.usage=un,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=dt.generateUUID()}Ra.prototype.isScene=!0,Object.defineProperty(ki.prototype,"needsUpdate",{set:function(i){i===!0&&this.version++}}),Object.assign(ki.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(i){return this.usage=i,this},copy:function(i){return this.array=new i.array.constructor(i.array),this.count=i.count,this.stride=i.stride,this.usage=i.usage,this},copyAt:function(i,t,e){i*=this.stride,e*=t.stride;for(var n=0,s=this.stride;n<s;n++)this.array[i+n]=t.array[e+n];return this},set:function(i,t){return t===void 0&&(t=0),this.array.set(i,t),this},clone:function(i){i.arrayBuffers===void 0&&(i.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=dt.generateUUID()),i.arrayBuffers[this.array.buffer._uuid]===void 0&&(i.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);var t=new ki(new this.array.constructor(i.arrayBuffers[this.array.buffer._uuid]),this.stride);return t.setUsage(this.usage),t},onUpload:function(i){return this.onUploadCallback=i,this},toJSON:function(i){return i.arrayBuffers===void 0&&(i.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=dt.generateUUID()),i.arrayBuffers[this.array.buffer._uuid]===void 0&&(i.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});var Ar=new te;function or(a,i,t,e){this.name="",this.data=a,this.itemSize=i,this.offset=t,this.normalized=e===!0}Object.defineProperties(or.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(i){this.data.needsUpdate=i}}}),Object.assign(or.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(i){for(var t=0,e=this.data.count;t<e;t++)Ar.x=this.getX(t),Ar.y=this.getY(t),Ar.z=this.getZ(t),Ar.applyMatrix4(i),this.setXYZ(t,Ar.x,Ar.y,Ar.z);return this},setX:function(i,t){return this.data.array[i*this.data.stride+this.offset]=t,this},setY:function(i,t){return this.data.array[i*this.data.stride+this.offset+1]=t,this},setZ:function(i,t){return this.data.array[i*this.data.stride+this.offset+2]=t,this},setW:function(i,t){return this.data.array[i*this.data.stride+this.offset+3]=t,this},getX:function(i){return this.data.array[i*this.data.stride+this.offset]},getY:function(i){return this.data.array[i*this.data.stride+this.offset+1]},getZ:function(i){return this.data.array[i*this.data.stride+this.offset+2]},getW:function(i){return this.data.array[i*this.data.stride+this.offset+3]},setXY:function(i,t,e){return i=i*this.data.stride+this.offset,this.data.array[i+0]=t,this.data.array[i+1]=e,this},setXYZ:function(i,t,e,n){return i=i*this.data.stride+this.offset,this.data.array[i+0]=t,this.data.array[i+1]=e,this.data.array[i+2]=n,this},setXYZW:function(i,t,e,n,s){return i=i*this.data.stride+this.offset,this.data.array[i+0]=t,this.data.array[i+1]=e,this.data.array[i+2]=n,this.data.array[i+3]=s,this},clone:function(i){if(i===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");for(var t=[],e=0;e<this.count;e++)for(var n=e*this.data.stride+this.offset,s=0;s<this.itemSize;s++)t.push(this.data.array[n+s]);return new ft(new this.array.constructor(t),this.itemSize,this.normalized)}return i.interleavedBuffers===void 0&&(i.interleavedBuffers={}),i.interleavedBuffers[this.data.uuid]===void 0&&(i.interleavedBuffers[this.data.uuid]=this.data.clone(i)),new or(i.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(i){if(i===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");for(var t=[],e=0;e<this.count;e++)for(var n=e*this.data.stride+this.offset,s=0;s<this.itemSize;s++)t.push(this.data.array[n+s]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return i.interleavedBuffers===void 0&&(i.interleavedBuffers={}),i.interleavedBuffers[this.data.uuid]===void 0&&(i.interleavedBuffers[this.data.uuid]=this.data.toJSON(i)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}});var es,Oa=function(a){function i(t){var e;return(e=a.call(this)||this).type="SpriteMaterial",e.color=new nt(16777215),e.map=null,e.alphaMap=null,e.rotation=0,e.sizeAttenuation=!0,e.transparent=!0,e.setValues(t),e}return Be(i,a),i.prototype.copy=function(t){return a.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this},i}(Gt);Oa.prototype.isSpriteMaterial=!0;var Rs=new te,ts=new te,is=new te,ns=new Ve,Os=new Ve,Eh=new ht,Ia=new te,Is=new te,Ba=new te,Ah=new Ve,Xo=new Ve,Th=new Ve,Na=function(a){function i(e){var n;if((n=a.call(this)||this).type="Sprite",es===void 0){es=new ct;var s=new ki(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);es.setIndex([0,1,2,0,2,3]),es.setAttribute("position",new or(s,3,0,!1)),es.setAttribute("uv",new or(s,2,3,!1))}return n.geometry=es,n.material=e!==void 0?e:new Oa,n.center=new Ve(.5,.5),n}Be(i,a);var t=i.prototype;return t.raycast=function(e,n){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),ts.setFromMatrixScale(this.matrixWorld),Eh.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),is.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&ts.multiplyScalar(-is.z);var s,l,p=this.material.rotation;p!==0&&(l=Math.cos(p),s=Math.sin(p));var _=this.center;Fa(Ia.set(-.5,-.5,0),is,_,ts,s,l),Fa(Is.set(.5,-.5,0),is,_,ts,s,l),Fa(Ba.set(.5,.5,0),is,_,ts,s,l),Ah.set(0,0),Xo.set(1,0),Th.set(1,1);var v=e.ray.intersectTriangle(Ia,Is,Ba,!1,Rs);if(v!==null||(Fa(Is.set(-.5,.5,0),is,_,ts,s,l),Xo.set(0,1),(v=e.ray.intersectTriangle(Ia,Ba,Is,!1,Rs))!==null)){var A=e.ray.origin.distanceTo(Rs);A<e.near||A>e.far||n.push({distance:A,point:Rs.clone(),uv:Si.getUV(Rs,Ia,Is,Ba,Ah,Xo,Th,new Ve),face:null,object:this})}},t.copy=function(e){return a.prototype.copy.call(this,e),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this},i}(Ge);function Fa(a,i,t,e,n,s){ns.subVectors(a,t).addScalar(.5).multiply(e),n!==void 0?(Os.x=s*ns.x-n*ns.y,Os.y=n*ns.x+s*ns.y):Os.copy(ns),a.copy(i),a.x+=Os.x,a.y+=Os.y,a.applyMatrix4(Eh)}Na.prototype.isSprite=!0;var za=new te,Mh=new te,qo=function(a){function i(){var e;return(e=a.call(this)||this)._currentLevel=0,e.type="LOD",Object.defineProperties(bi(e),{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),e.autoUpdate=!0,e}Be(i,a);var t=i.prototype;return t.copy=function(e){a.prototype.copy.call(this,e,!1);for(var n=e.levels,s=0,l=n.length;s<l;s++){var p=n[s];this.addLevel(p.object.clone(),p.distance)}return this.autoUpdate=e.autoUpdate,this},t.addLevel=function(e,n){n===void 0&&(n=0),n=Math.abs(n);var s,l=this.levels;for(s=0;s<l.length&&!(n<l[s].distance);s++);return l.splice(s,0,{distance:n,object:e}),this.add(e),this},t.getCurrentLevel=function(){return this._currentLevel},t.getObjectForDistance=function(e){var n=this.levels;if(n.length>0){var s,l;for(s=1,l=n.length;s<l&&!(e<n[s].distance);s++);return n[s-1].object}return null},t.raycast=function(e,n){if(this.levels.length>0){za.setFromMatrixPosition(this.matrixWorld);var s=e.ray.origin.distanceTo(za);this.getObjectForDistance(s).raycast(e,n)}},t.update=function(e){var n=this.levels;if(n.length>1){za.setFromMatrixPosition(e.matrixWorld),Mh.setFromMatrixPosition(this.matrixWorld);var s,l,p=za.distanceTo(Mh)/e.zoom;for(n[0].object.visible=!0,s=1,l=n.length;s<l&&p>=n[s].distance;s++)n[s-1].object.visible=!1,n[s].object.visible=!0;for(this._currentLevel=s-1;s<l;s++)n[s].object.visible=!1}},t.toJSON=function(e){var n=a.prototype.toJSON.call(this,e);this.autoUpdate===!1&&(n.object.autoUpdate=!1),n.object.levels=[];for(var s=this.levels,l=0,p=s.length;l<p;l++){var _=s[l];n.object.levels.push({object:_.object.uuid,distance:_.distance})}return n},i}(Ge),Ch=new te,Lh=new Ft,Ph=new Ft,Ed=new te,Dh=new ht;function Bs(a,i){Jt.call(this,a,i),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new ht,this.bindMatrixInverse=new ht}function Ns(){Ge.call(this),this.type="Bone"}Bs.prototype=Object.assign(Object.create(Jt.prototype),{constructor:Bs,isSkinnedMesh:!0,copy:function(i){return Jt.prototype.copy.call(this,i),this.bindMode=i.bindMode,this.bindMatrix.copy(i.bindMatrix),this.bindMatrixInverse.copy(i.bindMatrixInverse),this.skeleton=i.skeleton,this},bind:function(i,t){this.skeleton=i,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var i=new Ft,t=this.geometry.attributes.skinWeight,e=0,n=t.count;e<n;e++){i.x=t.getX(e),i.y=t.getY(e),i.z=t.getZ(e),i.w=t.getW(e);var s=1/i.manhattanLength();s!==1/0?i.multiplyScalar(s):i.set(1,0,0,0),t.setXYZW(e,i.x,i.y,i.z,i.w)}},updateMatrixWorld:function(i){Jt.prototype.updateMatrixWorld.call(this,i),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(i,t){var e=this.skeleton,n=this.geometry;Lh.fromBufferAttribute(n.attributes.skinIndex,i),Ph.fromBufferAttribute(n.attributes.skinWeight,i),Ch.fromBufferAttribute(n.attributes.position,i).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(var s=0;s<4;s++){var l=Ph.getComponent(s);if(l!==0){var p=Lh.getComponent(s);Dh.multiplyMatrices(e.bones[p].matrixWorld,e.boneInverses[p]),t.addScaledVector(Ed.copy(Ch).applyMatrix4(Dh),l)}}return t.applyMatrix4(this.bindMatrixInverse)}}),Ns.prototype=Object.assign(Object.create(Ge.prototype),{constructor:Ns,isBone:!0});var Rh=new ht,Ad=new ht,Zo=function(){function a(t,e){t===void 0&&(t=[]),e===void 0&&(e=[]),this.uuid=dt.generateUUID(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}var i=a.prototype;return i.init=function(){var t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),e.length===0)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(var n=0,s=this.bones.length;n<s;n++)this.boneInverses.push(new ht)}},i.calculateInverses=function(){this.boneInverses.length=0;for(var t=0,e=this.bones.length;t<e;t++){var n=new ht;this.bones[t]&&n.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(n)}},i.pose=function(){for(var t=0,e=this.bones.length;t<e;t++){var n=this.bones[t];n&&n.matrixWorld.copy(this.boneInverses[t]).invert()}for(var s=0,l=this.bones.length;s<l;s++){var p=this.bones[s];p&&(p.parent&&p.parent.isBone?(p.matrix.copy(p.parent.matrixWorld).invert(),p.matrix.multiply(p.matrixWorld)):p.matrix.copy(p.matrixWorld),p.matrix.decompose(p.position,p.quaternion,p.scale))}},i.update=function(){for(var t=this.bones,e=this.boneInverses,n=this.boneMatrices,s=this.boneTexture,l=0,p=t.length;l<p;l++){var _=t[l]?t[l].matrixWorld:Ad;Rh.multiplyMatrices(_,e[l]),Rh.toArray(n,16*l)}s!==null&&(s.needsUpdate=!0)},i.clone=function(){return new a(this.bones,this.boneInverses)},i.getBoneByName=function(t){for(var e=0,n=this.bones.length;e<n;e++){var s=this.bones[e];if(s.name===t)return s}},i.dispose=function(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)},i.fromJSON=function(t,e){this.uuid=t.uuid;for(var n=0,s=t.bones.length;n<s;n++){var l=t.bones[n],p=e[l];p===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",l),p=new Ns),this.bones.push(p),this.boneInverses.push(new ht().fromArray(t.boneInverses[n]))}return this.init(),this},i.toJSON=function(){var t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;for(var e=this.bones,n=this.boneInverses,s=0,l=e.length;s<l;s++){var p=e[s];t.bones.push(p.uuid);var _=n[s];t.boneInverses.push(_.toArray())}return t},a}(),Oh=new ht,Ih=new ht,Ua=[],Fs=new Jt;function ka(a,i,t){Jt.call(this,a,i),this.instanceMatrix=new ft(new Float32Array(16*t),16),this.instanceColor=null,this.count=t,this.frustumCulled=!1}ka.prototype=Object.assign(Object.create(Jt.prototype),{constructor:ka,isInstancedMesh:!0,copy:function(i){return Jt.prototype.copy.call(this,i),this.instanceMatrix.copy(i.instanceMatrix),i.instanceColor!==null&&(this.instanceColor=i.instanceColor.clone()),this.count=i.count,this},getColorAt:function(i,t){t.fromArray(this.instanceColor.array,3*i)},getMatrixAt:function(i,t){t.fromArray(this.instanceMatrix.array,16*i)},raycast:function(i,t){var e=this.matrixWorld,n=this.count;if(Fs.geometry=this.geometry,Fs.material=this.material,Fs.material!==void 0)for(var s=0;s<n;s++){this.getMatrixAt(s,Oh),Ih.multiplyMatrices(e,Oh),Fs.matrixWorld=Ih,Fs.raycast(i,Ua);for(var l=0,p=Ua.length;l<p;l++){var _=Ua[l];_.instanceId=s,_.object=this,t.push(_)}Ua.length=0}},setColorAt:function(i,t){this.instanceColor===null&&(this.instanceColor=new ft(new Float32Array(3*this.count),3)),t.toArray(this.instanceColor.array,3*i)},setMatrixAt:function(i,t){t.toArray(this.instanceMatrix.array,16*i)},updateMorphTargets:function(){},dispose:function(){this.dispatchEvent({type:"dispose"})}});var yi=function(a){function i(t){var e;return(e=a.call(this)||this).type="LineBasicMaterial",e.color=new nt(16777215),e.linewidth=1,e.linecap="round",e.linejoin="round",e.morphTargets=!1,e.setValues(t),e}return Be(i,a),i.prototype.copy=function(t){return a.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.morphTargets=t.morphTargets,this},i}(Gt);yi.prototype.isLineBasicMaterial=!0;var Bh=new te,Nh=new te,Fh=new ht,Qo=new sn,ja=new mn;function vn(a,i){a===void 0&&(a=new ct),i===void 0&&(i=new yi),Ge.call(this),this.type="Line",this.geometry=a,this.material=i,this.updateMorphTargets()}vn.prototype=Object.assign(Object.create(Ge.prototype),{constructor:vn,isLine:!0,copy:function(i){return Ge.prototype.copy.call(this,i),this.material=i.material,this.geometry=i.geometry,this},computeLineDistances:function(){var i=this.geometry;if(i.isBufferGeometry)if(i.index===null){for(var t=i.attributes.position,e=[0],n=1,s=t.count;n<s;n++)Bh.fromBufferAttribute(t,n-1),Nh.fromBufferAttribute(t,n),e[n]=e[n-1],e[n]+=Bh.distanceTo(Nh);i.setAttribute("lineDistance",new st(e,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else i.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this},raycast:function(i,t){var e=this.geometry,n=this.matrixWorld,s=i.params.Line.threshold;if(e.boundingSphere===null&&e.computeBoundingSphere(),ja.copy(e.boundingSphere),ja.applyMatrix4(n),ja.radius+=s,i.ray.intersectsSphere(ja)!==!1){Fh.copy(n).invert(),Qo.copy(i.ray).applyMatrix4(Fh);var l=s/((this.scale.x+this.scale.y+this.scale.z)/3),p=l*l,_=new te,v=new te,A=new te,E=new te,L=this.isLineSegments?2:1;if(e.isBufferGeometry){var D=e.index,B=e.attributes.position;if(D!==null)for(var U=D.array,V=0,j=U.length-1;V<j;V+=L){var K=U[V],ee=U[V+1];if(_.fromBufferAttribute(B,K),v.fromBufferAttribute(B,ee),!(Qo.distanceSqToSegment(_,v,E,A)>p)){E.applyMatrix4(this.matrixWorld);var J=i.ray.origin.distanceTo(E);J<i.near||J>i.far||t.push({distance:J,point:A.clone().applyMatrix4(this.matrixWorld),index:V,face:null,faceIndex:null,object:this})}}else for(var $=0,se=B.count-1;$<se;$+=L)if(_.fromBufferAttribute(B,$),v.fromBufferAttribute(B,$+1),!(Qo.distanceSqToSegment(_,v,E,A)>p)){E.applyMatrix4(this.matrixWorld);var re=i.ray.origin.distanceTo(E);re<i.near||re>i.far||t.push({distance:re,point:A.clone().applyMatrix4(this.matrixWorld),index:$,face:null,faceIndex:null,object:this})}}else e.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},updateMorphTargets:function(){var i=this.geometry;if(i.isBufferGeometry){var t=i.morphAttributes,e=Object.keys(t);if(e.length>0){var n=t[e[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var s=0,l=n.length;s<l;s++){var p=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[p]=s}}}}else{var _=i.morphTargets;_!==void 0&&_.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});var zh=new te,Uh=new te;function Ii(a,i){vn.call(this,a,i),this.type="LineSegments"}Ii.prototype=Object.assign(Object.create(vn.prototype),{constructor:Ii,isLineSegments:!0,computeLineDistances:function(){var i=this.geometry;if(i.isBufferGeometry)if(i.index===null){for(var t=i.attributes.position,e=[],n=0,s=t.count;n<s;n+=2)zh.fromBufferAttribute(t,n),Uh.fromBufferAttribute(t,n+1),e[n]=n===0?0:e[n-1],e[n+1]=e[n]+zh.distanceTo(Uh);i.setAttribute("lineDistance",new st(e,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else i.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}});var Jo=function(a){function i(t,e){var n;return(n=a.call(this,t,e)||this).type="LineLoop",n}return Be(i,a),i}(vn);Jo.prototype.isLineLoop=!0;var Tr=function(a){function i(t){var e;return(e=a.call(this)||this).type="PointsMaterial",e.color=new nt(16777215),e.map=null,e.alphaMap=null,e.size=1,e.sizeAttenuation=!0,e.morphTargets=!1,e.setValues(t),e}return Be(i,a),i.prototype.copy=function(t){return a.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this},i}(Gt);Tr.prototype.isPointsMaterial=!0;var kh=new ht,$o=new sn,Wa=new mn,Va=new te;function rs(a,i){a===void 0&&(a=new ct),i===void 0&&(i=new Tr),Ge.call(this),this.type="Points",this.geometry=a,this.material=i,this.updateMorphTargets()}function jh(a,i,t,e,n,s,l){var p=$o.distanceSqToPoint(a);if(p<t){var _=new te;$o.closestPointToPoint(a,_),_.applyMatrix4(e);var v=n.ray.origin.distanceTo(_);if(v<n.near||v>n.far)return;s.push({distance:v,distanceToRay:Math.sqrt(p),point:_,index:i,face:null,object:l})}}rs.prototype=Object.assign(Object.create(Ge.prototype),{constructor:rs,isPoints:!0,copy:function(i){return Ge.prototype.copy.call(this,i),this.material=i.material,this.geometry=i.geometry,this},raycast:function(i,t){var e=this.geometry,n=this.matrixWorld,s=i.params.Points.threshold;if(e.boundingSphere===null&&e.computeBoundingSphere(),Wa.copy(e.boundingSphere),Wa.applyMatrix4(n),Wa.radius+=s,i.ray.intersectsSphere(Wa)!==!1){kh.copy(n).invert(),$o.copy(i.ray).applyMatrix4(kh);var l=s/((this.scale.x+this.scale.y+this.scale.z)/3),p=l*l;if(e.isBufferGeometry){var _=e.index,v=e.attributes.position;if(_!==null)for(var A=_.array,E=0,L=A.length;E<L;E++){var D=A[E];Va.fromBufferAttribute(v,D),jh(Va,D,p,n,i,t,this)}else for(var B=0,U=v.count;B<U;B++)Va.fromBufferAttribute(v,B),jh(Va,B,p,n,i,t,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},updateMorphTargets:function(){var i=this.geometry;if(i.isBufferGeometry){var t=i.morphAttributes,e=Object.keys(t);if(e.length>0){var n=t[e[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var s=0,l=n.length;s<l;s++){var p=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[p]=s}}}}else{var _=i.morphTargets;_!==void 0&&_.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});var Wh=function(a){function i(e,n,s,l,p,_,v,A,E){var L;(L=a.call(this,e,n,s,l,p,_,v,A,E)||this).format=v!==void 0?v:G,L.minFilter=_!==void 0?_:P,L.magFilter=p!==void 0?p:P,L.generateMipmaps=!1;var D=bi(L);return"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(function B(){D.needsUpdate=!0,e.requestVideoFrameCallback(B)}),L}Be(i,a);var t=i.prototype;return t.clone=function(){return new this.constructor(this.image).copy(this)},t.update=function(){var e=this.image;!("requestVideoFrameCallback"in e)&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)},i}(ui);Wh.prototype.isVideoTexture=!0;var el=function(a){function i(t,e,n,s,l,p,_,v,A,E,L,D){var B;return(B=a.call(this,null,p,_,v,A,E,s,l,L,D)||this).image={width:e,height:n},B.mipmaps=t,B.flipY=!1,B.generateMipmaps=!1,B}return Be(i,a),i}(ui);el.prototype.isCompressedTexture=!0;var Vh=function(a){function i(t,e,n,s,l,p,_,v,A){var E;return(E=a.call(this,t,e,n,s,l,p,_,v,A)||this).needsUpdate=!0,E}return Be(i,a),i}(ui);Vh.prototype.isCanvasTexture=!0;var Gh=function(a){function i(t,e,n,s,l,p,_,v,A,E){var L;if((E=E!==void 0?E:q)!==q&&E!==ce)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");return n===void 0&&E===q&&(n=Y),n===void 0&&E===ce&&(n=k),(L=a.call(this,null,s,l,p,_,v,E,n,A)||this).image={width:t,height:e},L.magFilter=_!==void 0?_:x,L.minFilter=v!==void 0?v:x,L.flipY=!1,L.generateMipmaps=!1,L}return Be(i,a),i}(ui);Gh.prototype.isDepthTexture=!0;var Ga=function(a){function i(t,e,n,s){var l;t===void 0&&(t=1),e===void 0&&(e=8),n===void 0&&(n=0),s===void 0&&(s=2*Math.PI),(l=a.call(this)||this).type="CircleGeometry",l.parameters={radius:t,segments:e,thetaStart:n,thetaLength:s},e=Math.max(3,e);var p=[],_=[],v=[],A=[],E=new te,L=new Ve;_.push(0,0,0),v.push(0,0,1),A.push(.5,.5);for(var D=0,B=3;D<=e;D++,B+=3){var U=n+D/e*s;E.x=t*Math.cos(U),E.y=t*Math.sin(U),_.push(E.x,E.y,E.z),v.push(0,0,1),L.x=(_[B]/t+1)/2,L.y=(_[B+1]/t+1)/2,A.push(L.x,L.y)}for(var V=1;V<=e;V++)p.push(V,V+1,0);return l.setIndex(p),l.setAttribute("position",new st(_,3)),l.setAttribute("normal",new st(v,3)),l.setAttribute("uv",new st(A,2)),l}return Be(i,a),i}(ct),ss=function(a){function i(t,e,n,s,l,p,_,v){var A;t===void 0&&(t=1),e===void 0&&(e=1),n===void 0&&(n=1),s===void 0&&(s=8),l===void 0&&(l=1),p===void 0&&(p=!1),_===void 0&&(_=0),v===void 0&&(v=2*Math.PI),(A=a.call(this)||this).type="CylinderGeometry",A.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:s,heightSegments:l,openEnded:p,thetaStart:_,thetaLength:v};var E=bi(A);s=Math.floor(s),l=Math.floor(l);var L=[],D=[],B=[],U=[],V=0,j=[],K=n/2,ee=0;function J($){for(var se=V,re=new Ve,ie=new te,pe=0,de=$===!0?t:e,ye=$===!0?1:-1,Ee=1;Ee<=s;Ee++)D.push(0,K*ye,0),B.push(0,ye,0),U.push(.5,.5),V++;for(var Re=V,Le=0;Le<=s;Le++){var le=Le/s*v+_,_e=Math.cos(le),Ae=Math.sin(le);ie.x=de*Ae,ie.y=K*ye,ie.z=de*_e,D.push(ie.x,ie.y,ie.z),B.push(0,ye,0),re.x=.5*_e+.5,re.y=.5*Ae*ye+.5,U.push(re.x,re.y),V++}for(var be=0;be<s;be++){var ge=se+be,Te=Re+be;$===!0?L.push(Te,Te+1,ge):L.push(Te+1,Te,ge),pe+=3}E.addGroup(ee,pe,$===!0?1:2),ee+=pe}return function(){for(var $=new te,se=new te,re=0,ie=(e-t)/n,pe=0;pe<=l;pe++){for(var de=[],ye=pe/l,Ee=ye*(e-t)+t,Re=0;Re<=s;Re++){var Le=Re/s,le=Le*v+_,_e=Math.sin(le),Ae=Math.cos(le);se.x=Ee*_e,se.y=-ye*n+K,se.z=Ee*Ae,D.push(se.x,se.y,se.z),$.set(_e,ie,Ae).normalize(),B.push($.x,$.y,$.z),U.push(Le,1-ye),de.push(V++)}j.push(de)}for(var be=0;be<s;be++)for(var ge=0;ge<l;ge++){var Te=j[ge][be],Fe=j[ge+1][be],tt=j[ge+1][be+1],at=j[ge][be+1];L.push(Te,Fe,at),L.push(Fe,tt,at),re+=6}E.addGroup(ee,re,0),ee+=re}(),p===!1&&(t>0&&J(!0),e>0&&J(!1)),A.setIndex(L),A.setAttribute("position",new st(D,3)),A.setAttribute("normal",new st(B,3)),A.setAttribute("uv",new st(U,2)),A}return Be(i,a),i}(ct),Ha=function(a){function i(t,e,n,s,l,p,_){var v;return t===void 0&&(t=1),e===void 0&&(e=1),n===void 0&&(n=8),s===void 0&&(s=1),l===void 0&&(l=!1),p===void 0&&(p=0),_===void 0&&(_=2*Math.PI),(v=a.call(this,0,t,e,n,s,l,p,_)||this).type="ConeGeometry",v.parameters={radius:t,height:e,radialSegments:n,heightSegments:s,openEnded:l,thetaStart:p,thetaLength:_},v}return Be(i,a),i}(ss),lr=function(a){function i(t,e,n,s){var l;n===void 0&&(n=1),s===void 0&&(s=0),(l=a.call(this)||this).type="PolyhedronGeometry",l.parameters={vertices:t,indices:e,radius:n,detail:s};var p=[],_=[];function v(B,U,V,j){for(var K=j+1,ee=[],J=0;J<=K;J++){ee[J]=[];for(var $=B.clone().lerp(V,J/K),se=U.clone().lerp(V,J/K),re=K-J,ie=0;ie<=re;ie++)ee[J][ie]=ie===0&&J===K?$:$.clone().lerp(se,ie/re)}for(var pe=0;pe<K;pe++)for(var de=0;de<2*(K-pe)-1;de++){var ye=Math.floor(de/2);de%2==0?(A(ee[pe][ye+1]),A(ee[pe+1][ye]),A(ee[pe][ye])):(A(ee[pe][ye+1]),A(ee[pe+1][ye+1]),A(ee[pe+1][ye]))}}function A(B){p.push(B.x,B.y,B.z)}function E(B,U){var V=3*B;U.x=t[V+0],U.y=t[V+1],U.z=t[V+2]}function L(B,U,V,j){j<0&&B.x===1&&(_[U]=B.x-1),V.x===0&&V.z===0&&(_[U]=j/2/Math.PI+.5)}function D(B){return Math.atan2(B.z,-B.x)}return function(B){for(var U=new te,V=new te,j=new te,K=0;K<e.length;K+=3)E(e[K+0],U),E(e[K+1],V),E(e[K+2],j),v(U,V,j,B)}(s),function(B){for(var U=new te,V=0;V<p.length;V+=3)U.x=p[V+0],U.y=p[V+1],U.z=p[V+2],U.normalize().multiplyScalar(B),p[V+0]=U.x,p[V+1]=U.y,p[V+2]=U.z}(n),function(){for(var B=new te,U=0;U<p.length;U+=3){B.x=p[U+0],B.y=p[U+1],B.z=p[U+2];var V=D(B)/2/Math.PI+.5,j=(K=B,Math.atan2(-K.y,Math.sqrt(K.x*K.x+K.z*K.z))/Math.PI+.5);_.push(V,1-j)}var K;(function(){for(var ee=new te,J=new te,$=new te,se=new te,re=new Ve,ie=new Ve,pe=new Ve,de=0,ye=0;de<p.length;de+=9,ye+=6){ee.set(p[de+0],p[de+1],p[de+2]),J.set(p[de+3],p[de+4],p[de+5]),$.set(p[de+6],p[de+7],p[de+8]),re.set(_[ye+0],_[ye+1]),ie.set(_[ye+2],_[ye+3]),pe.set(_[ye+4],_[ye+5]),se.copy(ee).add(J).add($).divideScalar(3);var Ee=D(se);L(re,ye+0,ee,Ee),L(ie,ye+2,J,Ee),L(pe,ye+4,$,Ee)}})(),function(){for(var ee=0;ee<_.length;ee+=6){var J=_[ee+0],$=_[ee+2],se=_[ee+4],re=Math.max(J,$,se),ie=Math.min(J,$,se);re>.9&&ie<.1&&(J<.2&&(_[ee+0]+=1),$<.2&&(_[ee+2]+=1),se<.2&&(_[ee+4]+=1))}}()}(),l.setAttribute("position",new st(p,3)),l.setAttribute("normal",new st(p.slice(),3)),l.setAttribute("uv",new st(_,2)),s===0?l.computeVertexNormals():l.normalizeNormals(),l}return Be(i,a),i}(ct),Ka=function(a){function i(t,e){var n;t===void 0&&(t=1),e===void 0&&(e=0);var s=(1+Math.sqrt(5))/2,l=1/s,p=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-l,-s,0,-l,s,0,l,-s,0,l,s,-l,-s,0,-l,s,0,l,-s,0,l,s,0,-s,0,-l,s,0,-l,-s,0,l,s,0,l];return(n=a.call(this,p,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e)||this).type="DodecahedronGeometry",n.parameters={radius:t,detail:e},n}return Be(i,a),i}(lr),Ya=new te,Xa=new te,tl=new te,as=new Si,il=function(a){function i(t,e){var n;if((n=a.call(this)||this).type="EdgesGeometry",n.parameters={thresholdAngle:e},e=e!==void 0?e:1,t.isGeometry===!0)return console.error("THREE.EdgesGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),bi(n);for(var s=Math.pow(10,4),l=Math.cos(dt.DEG2RAD*e),p=t.getIndex(),_=t.getAttribute("position"),v=p?p.count:_.count,A=[0,0,0],E=["a","b","c"],L=new Array(3),D={},B=[],U=0;U<v;U+=3){p?(A[0]=p.getX(U),A[1]=p.getX(U+1),A[2]=p.getX(U+2)):(A[0]=U,A[1]=U+1,A[2]=U+2);var V=as.a,j=as.b,K=as.c;if(V.fromBufferAttribute(_,A[0]),j.fromBufferAttribute(_,A[1]),K.fromBufferAttribute(_,A[2]),as.getNormal(tl),L[0]=Math.round(V.x*s)+","+Math.round(V.y*s)+","+Math.round(V.z*s),L[1]=Math.round(j.x*s)+","+Math.round(j.y*s)+","+Math.round(j.z*s),L[2]=Math.round(K.x*s)+","+Math.round(K.y*s)+","+Math.round(K.z*s),L[0]!==L[1]&&L[1]!==L[2]&&L[2]!==L[0])for(var ee=0;ee<3;ee++){var J=(ee+1)%3,$=L[ee],se=L[J],re=as[E[ee]],ie=as[E[J]],pe=$+"_"+se,de=se+"_"+$;de in D&&D[de]?(tl.dot(D[de].normal)<=l&&(B.push(re.x,re.y,re.z),B.push(ie.x,ie.y,ie.z)),D[de]=null):pe in D||(D[pe]={index0:A[ee],index1:A[J],normal:tl.clone()})}}for(var ye in D)if(D[ye]){var Ee=D[ye],Re=Ee.index0,Le=Ee.index1;Ya.fromBufferAttribute(_,Re),Xa.fromBufferAttribute(_,Le),B.push(Ya.x,Ya.y,Ya.z),B.push(Xa.x,Xa.y,Xa.z)}return n.setAttribute("position",new st(B,3)),n}return Be(i,a),i}(ct),Td=function(i,t,e){e=e||2;var n,s,l,p,_,v,A,E=t&&t.length,L=E?t[0]*e:i.length,D=Hh(i,0,L,e,!0),B=[];if(!D||D.next===D.prev)return B;if(E&&(D=function(V,j,K,ee){var J,$,se,re=[];for(J=0,$=j.length;J<$;J++)(se=Hh(V,j[J]*ee,J<$-1?j[J+1]*ee:V.length,ee,!1))===se.next&&(se.steiner=!0),re.push(Id(se));for(re.sort(Dd),J=0;J<re.length;J++)Rd(re[J],K),K=hr(K,K.next);return K}(i,t,D,e)),i.length>80*e){n=l=i[0],s=p=i[1];for(var U=e;U<L;U+=e)(_=i[U])<n&&(n=_),(v=i[U+1])<s&&(s=v),_>l&&(l=_),v>p&&(p=v);A=(A=Math.max(l-n,p-s))!==0?1/A:0}return zs(D,B,e,n,s,A),B};function Hh(a,i,t,e,n){var s,l;if(n===function(p,_,v,A){for(var E=0,L=_,D=v-A;L<v;L+=A)E+=(p[D]-p[L])*(p[L+1]+p[D+1]),D=L;return E}(a,i,t,e)>0)for(s=i;s<t;s+=e)l=Xh(s,a[s],a[s+1],l);else for(s=t-e;s>=i;s-=e)l=Xh(s,a[s],a[s+1],l);return l&&qa(l,l.next)&&(ks(l),l=l.next),l}function hr(a,i){if(!a)return a;i||(i=a);var t,e=a;do if(t=!1,e.steiner||!qa(e,e.next)&&ti(e.prev,e,e.next)!==0)e=e.next;else{if(ks(e),(e=i=e.prev)===e.next)break;t=!0}while(t||e!==i);return i}function zs(a,i,t,e,n,s,l){if(a){!l&&s&&function(A,E,L,D){var B=A;do B.z===null&&(B.z=nl(B.x,B.y,E,L,D)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==A);B.prevZ.nextZ=null,B.prevZ=null,function(U){var V,j,K,ee,J,$,se,re,ie=1;do{for(j=U,U=null,J=null,$=0;j;){for($++,K=j,se=0,V=0;V<ie&&(se++,K=K.nextZ);V++);for(re=ie;se>0||re>0&&K;)se!==0&&(re===0||!K||j.z<=K.z)?(ee=j,j=j.nextZ,se--):(ee=K,K=K.nextZ,re--),J?J.nextZ=ee:U=ee,ee.prevZ=J,J=ee;j=K}J.nextZ=null,ie*=2}while($>1)}(B)}(a,e,n,s);for(var p,_,v=a;a.prev!==a.next;)if(p=a.prev,_=a.next,s?Cd(a,e,n,s):Md(a))i.push(p.i/t),i.push(a.i/t),i.push(_.i/t),ks(a),a=_.next,v=_.next;else if((a=_)===v){l?l===1?zs(a=Ld(hr(a),i,t),i,t,e,n,s,2):l===2&&Pd(a,i,t,e,n,s):zs(hr(a),i,t,e,n,s,1);break}}}function Md(a){var i=a.prev,t=a,e=a.next;if(ti(i,t,e)>=0)return!1;for(var n=a.next.next;n!==a.prev;){if(os(i.x,i.y,t.x,t.y,e.x,e.y,n.x,n.y)&&ti(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function Cd(a,i,t,e){var n=a.prev,s=a,l=a.next;if(ti(n,s,l)>=0)return!1;for(var p=n.x<s.x?n.x<l.x?n.x:l.x:s.x<l.x?s.x:l.x,_=n.y<s.y?n.y<l.y?n.y:l.y:s.y<l.y?s.y:l.y,v=n.x>s.x?n.x>l.x?n.x:l.x:s.x>l.x?s.x:l.x,A=n.y>s.y?n.y>l.y?n.y:l.y:s.y>l.y?s.y:l.y,E=nl(p,_,i,t,e),L=nl(v,A,i,t,e),D=a.prevZ,B=a.nextZ;D&&D.z>=E&&B&&B.z<=L;){if(D!==a.prev&&D!==a.next&&os(n.x,n.y,s.x,s.y,l.x,l.y,D.x,D.y)&&ti(D.prev,D,D.next)>=0||(D=D.prevZ,B!==a.prev&&B!==a.next&&os(n.x,n.y,s.x,s.y,l.x,l.y,B.x,B.y)&&ti(B.prev,B,B.next)>=0))return!1;B=B.nextZ}for(;D&&D.z>=E;){if(D!==a.prev&&D!==a.next&&os(n.x,n.y,s.x,s.y,l.x,l.y,D.x,D.y)&&ti(D.prev,D,D.next)>=0)return!1;D=D.prevZ}for(;B&&B.z<=L;){if(B!==a.prev&&B!==a.next&&os(n.x,n.y,s.x,s.y,l.x,l.y,B.x,B.y)&&ti(B.prev,B,B.next)>=0)return!1;B=B.nextZ}return!0}function Ld(a,i,t){var e=a;do{var n=e.prev,s=e.next.next;!qa(n,s)&&Kh(n,e,e.next,s)&&Us(n,s)&&Us(s,n)&&(i.push(n.i/t),i.push(e.i/t),i.push(s.i/t),ks(e),ks(e.next),e=a=s),e=e.next}while(e!==a);return hr(e)}function Pd(a,i,t,e,n,s){var l=a;do{for(var p=l.next.next;p!==l.prev;){if(l.i!==p.i&&Bd(l,p)){var _=Yh(l,p);return l=hr(l,l.next),_=hr(_,_.next),zs(l,i,t,e,n,s),void zs(_,i,t,e,n,s)}p=p.next}l=l.next}while(l!==a)}function Dd(a,i){return a.x-i.x}function Rd(a,i){if(i=function(e,n){var s,l=n,p=e.x,_=e.y,v=-1/0;do{if(_<=l.y&&_>=l.next.y&&l.next.y!==l.y){var A=l.x+(_-l.y)*(l.next.x-l.x)/(l.next.y-l.y);if(A<=p&&A>v){if(v=A,A===p){if(_===l.y)return l;if(_===l.next.y)return l.next}s=l.x<l.next.x?l:l.next}}l=l.next}while(l!==n);if(!s)return null;if(p===v)return s;var E,L=s,D=s.x,B=s.y,U=1/0;l=s;do p>=l.x&&l.x>=D&&p!==l.x&&os(_<B?p:v,_,D,B,_<B?v:p,_,l.x,l.y)&&(E=Math.abs(_-l.y)/(p-l.x),Us(l,e)&&(E<U||E===U&&(l.x>s.x||l.x===s.x&&Od(s,l)))&&(s=l,U=E)),l=l.next;while(l!==L);return s}(a,i)){var t=Yh(i,a);hr(i,i.next),hr(t,t.next)}}function Od(a,i){return ti(a.prev,a,i.prev)<0&&ti(i.next,a,a.next)<0}function nl(a,i,t,e,n){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-t)*n)|a<<8))|a<<4))|a<<2))|a<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-e)*n)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function Id(a){var i=a,t=a;do(i.x<t.x||i.x===t.x&&i.y<t.y)&&(t=i),i=i.next;while(i!==a);return t}function os(a,i,t,e,n,s,l,p){return(n-l)*(i-p)-(a-l)*(s-p)>=0&&(a-l)*(e-p)-(t-l)*(i-p)>=0&&(t-l)*(s-p)-(n-l)*(e-p)>=0}function Bd(a,i){return a.next.i!==i.i&&a.prev.i!==i.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Kh(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(a,i)&&(Us(a,i)&&Us(i,a)&&function(t,e){var n=t,s=!1,l=(t.x+e.x)/2,p=(t.y+e.y)/2;do n.y>p!=n.next.y>p&&n.next.y!==n.y&&l<(n.next.x-n.x)*(p-n.y)/(n.next.y-n.y)+n.x&&(s=!s),n=n.next;while(n!==t);return s}(a,i)&&(ti(a.prev,a,i.prev)||ti(a,i.prev,i))||qa(a,i)&&ti(a.prev,a,a.next)>0&&ti(i.prev,i,i.next)>0)}function ti(a,i,t){return(i.y-a.y)*(t.x-i.x)-(i.x-a.x)*(t.y-i.y)}function qa(a,i){return a.x===i.x&&a.y===i.y}function Kh(a,i,t,e){var n=Qa(ti(a,i,t)),s=Qa(ti(a,i,e)),l=Qa(ti(t,e,a)),p=Qa(ti(t,e,i));return n!==s&&l!==p||!(n!==0||!Za(a,t,i))||!(s!==0||!Za(a,e,i))||!(l!==0||!Za(t,a,e))||!(p!==0||!Za(t,i,e))}function Za(a,i,t){return i.x<=Math.max(a.x,t.x)&&i.x>=Math.min(a.x,t.x)&&i.y<=Math.max(a.y,t.y)&&i.y>=Math.min(a.y,t.y)}function Qa(a){return a>0?1:a<0?-1:0}function Us(a,i){return ti(a.prev,a,a.next)<0?ti(a,i,a.next)>=0&&ti(a,a.prev,i)>=0:ti(a,i,a.prev)<0||ti(a,a.next,i)<0}function Yh(a,i){var t=new rl(a.i,a.x,a.y),e=new rl(i.i,i.x,i.y),n=a.next,s=i.prev;return a.next=i,i.prev=a,t.next=n,n.prev=t,e.next=t,t.prev=e,s.next=e,e.prev=s,e}function Xh(a,i,t,e){var n=new rl(a,i,t);return e?(n.next=e.next,n.prev=e,e.next.prev=n,e.next=n):(n.prev=n,n.next=n),n}function ks(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function rl(a,i,t){this.i=a,this.x=i,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Un={area:function(i){for(var t=i.length,e=0,n=t-1,s=0;s<t;n=s++)e+=i[n].x*i[s].y-i[s].x*i[n].y;return .5*e},isClockWise:function(i){return Un.area(i)<0},triangulateShape:function(i,t){var e=[],n=[],s=[];qh(i),Zh(e,i);var l=i.length;t.forEach(qh);for(var p=0;p<t.length;p++)n.push(l),l+=t[p].length,Zh(e,t[p]);for(var _=Td(e,n),v=0;v<_.length;v+=3)s.push(_.slice(v,v+3));return s}};function qh(a){var i=a.length;i>2&&a[i-1].equals(a[0])&&a.pop()}function Zh(a,i){for(var t=0;t<i.length;t++)a.push(i[t].x),a.push(i[t].y)}var kn=function(a){function i(t,e){var n;(n=a.call(this)||this).type="ExtrudeGeometry",n.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];for(var s=bi(n),l=[],p=[],_=0,v=t.length;_<v;_++)A(t[_]);function A(E){var L=[],D=e.curveSegments!==void 0?e.curveSegments:12,B=e.steps!==void 0?e.steps:1,U=e.depth!==void 0?e.depth:100,V=e.bevelEnabled===void 0||e.bevelEnabled,j=e.bevelThickness!==void 0?e.bevelThickness:6,K=e.bevelSize!==void 0?e.bevelSize:j-2,ee=e.bevelOffset!==void 0?e.bevelOffset:0,J=e.bevelSegments!==void 0?e.bevelSegments:3,$=e.extrudePath,se=e.UVGenerator!==void 0?e.UVGenerator:Nd;e.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),U=e.amount);var re,ie,pe,de,ye,Ee=!1;$&&(re=$.getSpacedPoints(B),Ee=!0,V=!1,ie=$.computeFrenetFrames(B,!1),pe=new te,de=new te,ye=new te),V||(J=0,j=0,K=0,ee=0);var Re=E.extractPoints(D),Le=Re.shape,le=Re.holes;if(!Un.isClockWise(Le)){Le=Le.reverse();for(var _e=0,Ae=le.length;_e<Ae;_e++){var be=le[_e];Un.isClockWise(be)&&(le[_e]=be.reverse())}}for(var ge=Un.triangulateShape(Le,le),Te=Le,Fe=0,tt=le.length;Fe<tt;Fe++){var at=le[Fe];Le=Le.concat(at)}function oe(Et,It,yt){return It||console.error("THREE.ExtrudeGeometry: vec does not exist"),It.clone().multiplyScalar(yt).add(Et)}var ue=Le.length,Oe=ge.length;function Pe(Et,It,yt){var zt,jt,Dt,ai=Et.x-It.x,Xt=Et.y-It.y,mi=yt.x-Et.x,$i=yt.y-Et.y,Ur=ai*ai+Xt*Xt,Ep=ai*$i-Xt*mi;if(Math.abs(Ep)>Number.EPSILON){var tu=Math.sqrt(Ur),iu=Math.sqrt(mi*mi+$i*$i),nu=It.x-Xt/tu,ru=It.y+ai/tu,su=((yt.x-$i/iu-nu)*$i-(yt.y+mi/iu-ru)*mi)/(ai*$i-Xt*mi),au=(zt=nu+ai*su-Et.x)*zt+(jt=ru+Xt*su-Et.y)*jt;if(au<=2)return new Ve(zt,jt);Dt=Math.sqrt(au/2)}else{var Co=!1;ai>Number.EPSILON?mi>Number.EPSILON&&(Co=!0):ai<-Number.EPSILON?mi<-Number.EPSILON&&(Co=!0):Math.sign(Xt)===Math.sign($i)&&(Co=!0),Co?(zt=-Xt,jt=ai,Dt=Math.sqrt(Ur)):(zt=ai,jt=Xt,Dt=Math.sqrt(Ur/2))}return new Ve(zt/Dt,jt/Dt)}for(var Ue=[],we=0,Se=Te.length,qe=Se-1,Ze=we+1;we<Se;we++,qe++,Ze++)qe===Se&&(qe=0),Ze===Se&&(Ze=0),Ue[we]=Pe(Te[we],Te[qe],Te[Ze]);for(var rt,Xe=[],gt=Ue.concat(),Rt=0,Ot=le.length;Rt<Ot;Rt++){var St=le[Rt];rt=[];for(var At=0,Yt=St.length,kt=Yt-1,ei=At+1;At<Yt;At++,kt++,ei++)kt===Yt&&(kt=0),ei===Yt&&(ei=0),rt[At]=Pe(St[At],St[kt],St[ei]);Xe.push(rt),gt=gt.concat(rt)}for(var pi=0;pi<J;pi++){for(var Dn=pi/J,jn=j*Math.cos(Dn*Math.PI/2),fi=K*Math.sin(Dn*Math.PI/2)+ee,ci=0,He=Te.length;ci<He;ci++){var oa=oe(Te[ci],Ue[ci],fi);Wt(oa.x,oa.y,-jn)}for(var ds=0,la=le.length;ds<la;ds++){var ha=le[ds];rt=Xe[ds];for(var Ji=0,Mo=ha.length;Ji<Mo;Ji++){var ca=oe(ha[Ji],rt[Ji],fi);Wt(ca.x,ca.y,-jn)}}}for(var ua=K+ee,fr=0;fr<ue;fr++){var Fr=V?oe(Le[fr],gt[fr],ua):Le[fr];Ee?(de.copy(ie.normals[0]).multiplyScalar(Fr.x),pe.copy(ie.binormals[0]).multiplyScalar(Fr.y),ye.copy(re[0]).add(de).add(pe),Wt(ye.x,ye.y,ye.z)):Wt(Fr.x,Fr.y,0)}for(var Rn=1;Rn<=B;Rn++)for(var Sn=0;Sn<ue;Sn++){var zr=V?oe(Le[Sn],gt[Sn],ua):Le[Sn];Ee?(de.copy(ie.normals[Rn]).multiplyScalar(zr.x),pe.copy(ie.binormals[Rn]).multiplyScalar(zr.y),ye.copy(re[Rn]).add(de).add(pe),Wt(ye.x,ye.y,ye.z)):Wt(zr.x,zr.y,U/B*Rn)}for(var ps=J-1;ps>=0;ps--){for(var da=ps/J,On=j*Math.cos(da*Math.PI/2),pa=K*Math.sin(da*Math.PI/2)+ee,ae=0,ke=Te.length;ae<ke;ae++){var Ce=oe(Te[ae],Ue[ae],pa);Wt(Ce.x,Ce.y,U+On)}for(var ze=0,Qe=le.length;ze<Qe;ze++){var wt=le[ze];rt=Xe[ze];for(var xt=0,Tt=wt.length;xt<Tt;xt++){var mt=oe(wt[xt],rt[xt],pa);Ee?Wt(mt.x,mt.y+re[B-1].y,re[B-1].x+On):Wt(mt.x,mt.y,U+On)}}}function Ht(Et,It){for(var yt=Et.length;--yt>=0;){var zt=yt,jt=yt-1;jt<0&&(jt=Et.length-1);for(var Dt=0,ai=B+2*J;Dt<ai;Dt++){var Xt=ue*Dt,mi=ue*(Dt+1);Mt(It+zt+Xt,It+jt+Xt,It+jt+mi,It+zt+mi)}}}function Wt(Et,It,yt){L.push(Et),L.push(It),L.push(yt)}function ut(Et,It,yt){ii(Et),ii(It),ii(yt);var zt=l.length/3,jt=se.generateTopUV(s,l,zt-3,zt-2,zt-1);Pt(jt[0]),Pt(jt[1]),Pt(jt[2])}function Mt(Et,It,yt,zt){ii(Et),ii(It),ii(zt),ii(It),ii(yt),ii(zt);var jt=l.length/3,Dt=se.generateSideWallUV(s,l,jt-6,jt-3,jt-2,jt-1);Pt(Dt[0]),Pt(Dt[1]),Pt(Dt[3]),Pt(Dt[1]),Pt(Dt[2]),Pt(Dt[3])}function ii(Et){l.push(L[3*Et+0]),l.push(L[3*Et+1]),l.push(L[3*Et+2])}function Pt(Et){p.push(Et.x),p.push(Et.y)}(function(){var Et=l.length/3;if(V){for(var It=0,yt=ue*It,zt=0;zt<Oe;zt++){var jt=ge[zt];ut(jt[2]+yt,jt[1]+yt,jt[0]+yt)}yt=ue*(It=B+2*J);for(var Dt=0;Dt<Oe;Dt++){var ai=ge[Dt];ut(ai[0]+yt,ai[1]+yt,ai[2]+yt)}}else{for(var Xt=0;Xt<Oe;Xt++){var mi=ge[Xt];ut(mi[2],mi[1],mi[0])}for(var $i=0;$i<Oe;$i++){var Ur=ge[$i];ut(Ur[0]+ue*B,Ur[1]+ue*B,Ur[2]+ue*B)}}s.addGroup(Et,l.length/3-Et,0)})(),function(){var Et=l.length/3,It=0;Ht(Te,It),It+=Te.length;for(var yt=0,zt=le.length;yt<zt;yt++){var jt=le[yt];Ht(jt,It),It+=jt.length}s.addGroup(Et,l.length/3-Et,1)}()}return n.setAttribute("position",new st(l,3)),n.setAttribute("uv",new st(p,2)),n.computeVertexNormals(),n}return Be(i,a),i.prototype.toJSON=function(){var t=ct.prototype.toJSON.call(this);return function(e,n,s){if(s.shapes=[],Array.isArray(e))for(var l=0,p=e.length;l<p;l++){var _=e[l];s.shapes.push(_.uuid)}else s.shapes.push(e.uuid);return n.extrudePath!==void 0&&(s.options.extrudePath=n.extrudePath.toJSON()),s}(this.parameters.shapes,this.parameters.options,t)},i}(ct),Nd={generateTopUV:function(i,t,e,n,s){var l=t[3*e],p=t[3*e+1],_=t[3*n],v=t[3*n+1],A=t[3*s],E=t[3*s+1];return[new Ve(l,p),new Ve(_,v),new Ve(A,E)]},generateSideWallUV:function(i,t,e,n,s,l){var p=t[3*e],_=t[3*e+1],v=t[3*e+2],A=t[3*n],E=t[3*n+1],L=t[3*n+2],D=t[3*s],B=t[3*s+1],U=t[3*s+2],V=t[3*l],j=t[3*l+1],K=t[3*l+2];return Math.abs(_-E)<.01?[new Ve(p,1-v),new Ve(A,1-L),new Ve(D,1-U),new Ve(V,1-K)]:[new Ve(_,1-v),new Ve(E,1-L),new Ve(B,1-U),new Ve(j,1-K)]}},Ja=function(a){function i(t,e){var n;t===void 0&&(t=1),e===void 0&&(e=0);var s=(1+Math.sqrt(5))/2,l=[-1,s,0,1,s,0,-1,-s,0,1,-s,0,0,-1,s,0,1,s,0,-1,-s,0,1,-s,s,0,-1,s,0,1,-s,0,-1,-s,0,1];return(n=a.call(this,l,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e)||this).type="IcosahedronGeometry",n.parameters={radius:t,detail:e},n}return Be(i,a),i}(lr),$a=function(a){function i(t,e,n,s){var l;e===void 0&&(e=12),n===void 0&&(n=0),s===void 0&&(s=2*Math.PI),(l=a.call(this)||this).type="LatheGeometry",l.parameters={points:t,segments:e,phiStart:n,phiLength:s},e=Math.floor(e),s=dt.clamp(s,0,2*Math.PI);for(var p=[],_=[],v=[],A=1/e,E=new te,L=new Ve,D=0;D<=e;D++)for(var B=n+D*A*s,U=Math.sin(B),V=Math.cos(B),j=0;j<=t.length-1;j++)E.x=t[j].x*U,E.y=t[j].y,E.z=t[j].x*V,_.push(E.x,E.y,E.z),L.x=D/e,L.y=j/(t.length-1),v.push(L.x,L.y);for(var K=0;K<e;K++)for(var ee=0;ee<t.length-1;ee++){var J=ee+K*t.length,$=J,se=J+t.length,re=J+t.length+1,ie=J+1;p.push($,se,ie),p.push(se,re,ie)}if(l.setIndex(p),l.setAttribute("position",new st(_,3)),l.setAttribute("uv",new st(v,2)),l.computeVertexNormals(),s===2*Math.PI)for(var pe=l.attributes.normal.array,de=new te,ye=new te,Ee=new te,Re=e*t.length*3,Le=0,le=0;Le<t.length;Le++,le+=3)de.x=pe[le+0],de.y=pe[le+1],de.z=pe[le+2],ye.x=pe[Re+le+0],ye.y=pe[Re+le+1],ye.z=pe[Re+le+2],Ee.addVectors(de,ye).normalize(),pe[le+0]=pe[Re+le+0]=Ee.x,pe[le+1]=pe[Re+le+1]=Ee.y,pe[le+2]=pe[Re+le+2]=Ee.z;return l}return Be(i,a),i}(ct),Ws=function(a){function i(t,e){var n;return t===void 0&&(t=1),e===void 0&&(e=0),(n=a.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e)||this).type="OctahedronGeometry",n.parameters={radius:t,detail:e},n}return Be(i,a),i}(lr);function Mr(a,i,t){ct.call(this),this.type="ParametricGeometry",this.parameters={func:a,slices:i,stacks:t};var e=[],n=[],s=[],l=[],p=1e-5,_=new te,v=new te,A=new te,E=new te,L=new te;a.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");for(var D=i+1,B=0;B<=t;B++)for(var U=B/t,V=0;V<=i;V++){var j=V/i;a(j,U,v),n.push(v.x,v.y,v.z),j-p>=0?(a(j-p,U,A),E.subVectors(v,A)):(a(j+p,U,A),E.subVectors(A,v)),U-p>=0?(a(j,U-p,A),L.subVectors(v,A)):(a(j,U+p,A),L.subVectors(A,v)),_.crossVectors(E,L).normalize(),s.push(_.x,_.y,_.z),l.push(j,U)}for(var K=0;K<t;K++)for(var ee=0;ee<i;ee++){var J=K*D+ee,$=K*D+ee+1,se=(K+1)*D+ee+1,re=(K+1)*D+ee;e.push(J,$,re),e.push($,se,re)}this.setIndex(e),this.setAttribute("position",new st(n,3)),this.setAttribute("normal",new st(s,3)),this.setAttribute("uv",new st(l,2))}Mr.prototype=Object.create(ct.prototype),Mr.prototype.constructor=Mr;var eo=function(a){function i(t,e,n,s,l,p){var _;t===void 0&&(t=.5),e===void 0&&(e=1),n===void 0&&(n=8),s===void 0&&(s=1),l===void 0&&(l=0),p===void 0&&(p=2*Math.PI),(_=a.call(this)||this).type="RingGeometry",_.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:s,thetaStart:l,thetaLength:p},n=Math.max(3,n);for(var v=[],A=[],E=[],L=[],D=t,B=(e-t)/(s=Math.max(1,s)),U=new te,V=new Ve,j=0;j<=s;j++){for(var K=0;K<=n;K++){var ee=l+K/n*p;U.x=D*Math.cos(ee),U.y=D*Math.sin(ee),A.push(U.x,U.y,U.z),E.push(0,0,1),V.x=(U.x/e+1)/2,V.y=(U.y/e+1)/2,L.push(V.x,V.y)}D+=B}for(var J=0;J<s;J++)for(var $=J*(n+1),se=0;se<n;se++){var re=se+$,ie=re,pe=re+n+1,de=re+n+2,ye=re+1;v.push(ie,pe,ye),v.push(pe,de,ye)}return _.setIndex(v),_.setAttribute("position",new st(A,3)),_.setAttribute("normal",new st(E,3)),_.setAttribute("uv",new st(L,2)),_}return Be(i,a),i}(ct),Vs=function(a){function i(t,e){var n;e===void 0&&(e=12),(n=a.call(this)||this).type="ShapeGeometry",n.parameters={shapes:t,curveSegments:e};var s=[],l=[],p=[],_=[],v=0,A=0;if(Array.isArray(t)===!1)L(t);else for(var E=0;E<t.length;E++)L(t[E]),n.addGroup(v,A,E),v+=A,A=0;function L(D){var B=l.length/3,U=D.extractPoints(e),V=U.shape,j=U.holes;Un.isClockWise(V)===!1&&(V=V.reverse());for(var K=0,ee=j.length;K<ee;K++){var J=j[K];Un.isClockWise(J)===!0&&(j[K]=J.reverse())}for(var $=Un.triangulateShape(V,j),se=0,re=j.length;se<re;se++){var ie=j[se];V=V.concat(ie)}for(var pe=0,de=V.length;pe<de;pe++){var ye=V[pe];l.push(ye.x,ye.y,0),p.push(0,0,1),_.push(ye.x,ye.y)}for(var Ee=0,Re=$.length;Ee<Re;Ee++){var Le=$[Ee],le=Le[0]+B,_e=Le[1]+B,Ae=Le[2]+B;s.push(le,_e,Ae),A+=3}}return n.setIndex(s),n.setAttribute("position",new st(l,3)),n.setAttribute("normal",new st(p,3)),n.setAttribute("uv",new st(_,2)),n}return Be(i,a),i.prototype.toJSON=function(){var t=ct.prototype.toJSON.call(this);return function(e,n){if(n.shapes=[],Array.isArray(e))for(var s=0,l=e.length;s<l;s++){var p=e[s];n.shapes.push(p.uuid)}else n.shapes.push(e.uuid);return n}(this.parameters.shapes,t)},i}(ct),Gs=function(a){function i(t,e,n,s,l,p,_){var v;t===void 0&&(t=1),e===void 0&&(e=8),n===void 0&&(n=6),s===void 0&&(s=0),l===void 0&&(l=2*Math.PI),p===void 0&&(p=0),_===void 0&&(_=Math.PI),(v=a.call(this)||this).type="SphereGeometry",v.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:s,phiLength:l,thetaStart:p,thetaLength:_},e=Math.max(3,Math.floor(e)),n=Math.max(2,Math.floor(n));for(var A=Math.min(p+_,Math.PI),E=0,L=[],D=new te,B=new te,U=[],V=[],j=[],K=[],ee=0;ee<=n;ee++){var J=[],$=ee/n,se=0;ee==0&&p==0?se=.5/e:ee==n&&A==Math.PI&&(se=-.5/e);for(var re=0;re<=e;re++){var ie=re/e;D.x=-t*Math.cos(s+ie*l)*Math.sin(p+$*_),D.y=t*Math.cos(p+$*_),D.z=t*Math.sin(s+ie*l)*Math.sin(p+$*_),V.push(D.x,D.y,D.z),B.copy(D).normalize(),j.push(B.x,B.y,B.z),K.push(ie+se,1-$),J.push(E++)}L.push(J)}for(var pe=0;pe<n;pe++)for(var de=0;de<e;de++){var ye=L[pe][de+1],Ee=L[pe][de],Re=L[pe+1][de],Le=L[pe+1][de+1];(pe!==0||p>0)&&U.push(ye,Ee,Le),(pe!==n-1||A<Math.PI)&&U.push(Ee,Re,Le)}return v.setIndex(U),v.setAttribute("position",new st(V,3)),v.setAttribute("normal",new st(j,3)),v.setAttribute("uv",new st(K,2)),v}return Be(i,a),i}(ct),to=function(a){function i(t,e){var n;return t===void 0&&(t=1),e===void 0&&(e=0),(n=a.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e)||this).type="TetrahedronGeometry",n.parameters={radius:t,detail:e},n}return Be(i,a),i}(lr),io=function(a){function i(t,e){var n;e===void 0&&(e={});var s=e.font;if(!s||!s.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new ct||bi(n);var l=s.generateShapes(t,e.size);return e.depth=e.height!==void 0?e.height:50,e.bevelThickness===void 0&&(e.bevelThickness=10),e.bevelSize===void 0&&(e.bevelSize=8),e.bevelEnabled===void 0&&(e.bevelEnabled=!1),(n=a.call(this,l,e)||this).type="TextGeometry",n}return Be(i,a),i}(kn),no=function(a){function i(t,e,n,s,l){var p;t===void 0&&(t=1),e===void 0&&(e=.4),n===void 0&&(n=8),s===void 0&&(s=6),l===void 0&&(l=2*Math.PI),(p=a.call(this)||this).type="TorusGeometry",p.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:s,arc:l},n=Math.floor(n),s=Math.floor(s);for(var _=[],v=[],A=[],E=[],L=new te,D=new te,B=new te,U=0;U<=n;U++)for(var V=0;V<=s;V++){var j=V/s*l,K=U/n*Math.PI*2;D.x=(t+e*Math.cos(K))*Math.cos(j),D.y=(t+e*Math.cos(K))*Math.sin(j),D.z=e*Math.sin(K),v.push(D.x,D.y,D.z),L.x=t*Math.cos(j),L.y=t*Math.sin(j),B.subVectors(D,L).normalize(),A.push(B.x,B.y,B.z),E.push(V/s),E.push(U/n)}for(var ee=1;ee<=n;ee++)for(var J=1;J<=s;J++){var $=(s+1)*ee+J-1,se=(s+1)*(ee-1)+J-1,re=(s+1)*(ee-1)+J,ie=(s+1)*ee+J;_.push($,se,ie),_.push(se,re,ie)}return p.setIndex(_),p.setAttribute("position",new st(v,3)),p.setAttribute("normal",new st(A,3)),p.setAttribute("uv",new st(E,2)),p}return Be(i,a),i}(ct),ro=function(a){function i(t,e,n,s,l,p){var _;t===void 0&&(t=1),e===void 0&&(e=.4),n===void 0&&(n=64),s===void 0&&(s=8),l===void 0&&(l=2),p===void 0&&(p=3),(_=a.call(this)||this).type="TorusKnotGeometry",_.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:s,p:l,q:p},n=Math.floor(n),s=Math.floor(s);for(var v=[],A=[],E=[],L=[],D=new te,B=new te,U=new te,V=new te,j=new te,K=new te,ee=new te,J=0;J<=n;++J){var $=J/n*l*Math.PI*2;_e($,l,p,t,U),_e($+.01,l,p,t,V),K.subVectors(V,U),ee.addVectors(V,U),j.crossVectors(K,ee),ee.crossVectors(j,K),j.normalize(),ee.normalize();for(var se=0;se<=s;++se){var re=se/s*Math.PI*2,ie=-e*Math.cos(re),pe=e*Math.sin(re);D.x=U.x+(ie*ee.x+pe*j.x),D.y=U.y+(ie*ee.y+pe*j.y),D.z=U.z+(ie*ee.z+pe*j.z),A.push(D.x,D.y,D.z),B.subVectors(D,U).normalize(),E.push(B.x,B.y,B.z),L.push(J/n),L.push(se/s)}}for(var de=1;de<=n;de++)for(var ye=1;ye<=s;ye++){var Ee=(s+1)*(de-1)+(ye-1),Re=(s+1)*de+(ye-1),Le=(s+1)*de+ye,le=(s+1)*(de-1)+ye;v.push(Ee,Re,le),v.push(Re,Le,le)}function _e(Ae,be,ge,Te,Fe){var tt=Math.cos(Ae),at=Math.sin(Ae),oe=ge/be*Ae,ue=Math.cos(oe);Fe.x=Te*(2+ue)*.5*tt,Fe.y=Te*(2+ue)*at*.5,Fe.z=Te*Math.sin(oe)*.5}return _.setIndex(v),_.setAttribute("position",new st(A,3)),_.setAttribute("normal",new st(E,3)),_.setAttribute("uv",new st(L,2)),_}return Be(i,a),i}(ct),so=function(a){function i(t,e,n,s,l){var p;e===void 0&&(e=64),n===void 0&&(n=1),s===void 0&&(s=8),l===void 0&&(l=!1),(p=a.call(this)||this).type="TubeGeometry",p.parameters={path:t,tubularSegments:e,radius:n,radialSegments:s,closed:l};var _=t.computeFrenetFrames(e,l);p.tangents=_.tangents,p.normals=_.normals,p.binormals=_.binormals;var v=new te,A=new te,E=new Ve,L=new te,D=[],B=[],U=[],V=[];function j(K){L=t.getPointAt(K/e,L);for(var ee=_.normals[K],J=_.binormals[K],$=0;$<=s;$++){var se=$/s*Math.PI*2,re=Math.sin(se),ie=-Math.cos(se);A.x=ie*ee.x+re*J.x,A.y=ie*ee.y+re*J.y,A.z=ie*ee.z+re*J.z,A.normalize(),B.push(A.x,A.y,A.z),v.x=L.x+n*A.x,v.y=L.y+n*A.y,v.z=L.z+n*A.z,D.push(v.x,v.y,v.z)}}return function(){for(var K=0;K<e;K++)j(K);j(l===!1?e:0),function(){for(var ee=0;ee<=e;ee++)for(var J=0;J<=s;J++)E.x=ee/e,E.y=J/s,U.push(E.x,E.y)}(),function(){for(var ee=1;ee<=e;ee++)for(var J=1;J<=s;J++){var $=(s+1)*(ee-1)+(J-1),se=(s+1)*ee+(J-1),re=(s+1)*ee+J,ie=(s+1)*(ee-1)+J;V.push($,se,ie),V.push(se,re,ie)}}()}(),p.setIndex(V),p.setAttribute("position",new st(D,3)),p.setAttribute("normal",new st(B,3)),p.setAttribute("uv",new st(U,2)),p}return Be(i,a),i.prototype.toJSON=function(){var t=ct.prototype.toJSON.call(this);return t.path=this.parameters.path.toJSON(),t},i}(ct),sl=function(a){function i(t){var e;if((e=a.call(this)||this).type="WireframeGeometry",t.isGeometry===!0)return console.error("THREE.WireframeGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),bi(e);var n=[],s=[0,0],l={},p=new te;if(t.index!==null){var _=t.attributes.position,v=t.index,A=t.groups;A.length===0&&(A=[{start:0,count:v.count,materialIndex:0}]);for(var E=0,L=A.length;E<L;++E)for(var D=A[E],B=D.start,U=B,V=B+D.count;U<V;U+=3)for(var j=0;j<3;j++){var K=v.getX(U+j),ee=v.getX(U+(j+1)%3);s[0]=Math.min(K,ee),s[1]=Math.max(K,ee);var J=s[0]+","+s[1];l[J]===void 0&&(l[J]={index1:s[0],index2:s[1]})}for(var $ in l){var se=l[$];p.fromBufferAttribute(_,se.index1),n.push(p.x,p.y,p.z),p.fromBufferAttribute(_,se.index2),n.push(p.x,p.y,p.z)}}else for(var re=t.attributes.position,ie=0,pe=re.count/3;ie<pe;ie++)for(var de=0;de<3;de++){var ye=3*ie+de;p.fromBufferAttribute(re,ye),n.push(p.x,p.y,p.z);var Ee=3*ie+(de+1)%3;p.fromBufferAttribute(re,Ee),n.push(p.x,p.y,p.z)}return e.setAttribute("position",new st(n,3)),e}return Be(i,a),i}(ct),Bi=Object.freeze({__proto__:null,BoxGeometry:wr,BoxBufferGeometry:wr,CircleGeometry:Ga,CircleBufferGeometry:Ga,ConeGeometry:Ha,ConeBufferGeometry:Ha,CylinderGeometry:ss,CylinderBufferGeometry:ss,DodecahedronGeometry:Ka,DodecahedronBufferGeometry:Ka,EdgesGeometry:il,ExtrudeGeometry:kn,ExtrudeBufferGeometry:kn,IcosahedronGeometry:Ja,IcosahedronBufferGeometry:Ja,LatheGeometry:$a,LatheBufferGeometry:$a,OctahedronGeometry:Ws,OctahedronBufferGeometry:Ws,ParametricGeometry:Mr,ParametricBufferGeometry:Mr,PlaneGeometry:Cs,PlaneBufferGeometry:Cs,PolyhedronGeometry:lr,PolyhedronBufferGeometry:lr,RingGeometry:eo,RingBufferGeometry:eo,ShapeGeometry:Vs,ShapeBufferGeometry:Vs,SphereGeometry:Gs,SphereBufferGeometry:Gs,TetrahedronGeometry:to,TetrahedronBufferGeometry:to,TextGeometry:io,TextBufferGeometry:io,TorusGeometry:no,TorusBufferGeometry:no,TorusKnotGeometry:ro,TorusKnotBufferGeometry:ro,TubeGeometry:so,TubeBufferGeometry:so,WireframeGeometry:sl}),al=function(a){function i(t){var e;return(e=a.call(this)||this).type="ShadowMaterial",e.color=new nt(0),e.transparent=!0,e.setValues(t),e}return Be(i,a),i.prototype.copy=function(t){return a.prototype.copy.call(this,t),this.color.copy(t.color),this},i}(Gt);al.prototype.isShadowMaterial=!0;var ls=function(a){function i(t){var e;return(e=a.call(this,t)||this).type="RawShaderMaterial",e}return Be(i,a),i}(Ui);function Cn(a){Gt.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new nt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new nt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ve(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.vertexTangents=!1,this.setValues(a)}function cr(a){Cn.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Ve(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(t){this.reflectivity=dt.clamp(2.5*(t-1)/(t+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(a)}ls.prototype.isRawShaderMaterial=!0,Cn.prototype=Object.create(Gt.prototype),Cn.prototype.constructor=Cn,Cn.prototype.isMeshStandardMaterial=!0,Cn.prototype.copy=function(a){return Gt.prototype.copy.call(this,a),this.defines={STANDARD:""},this.color.copy(a.color),this.roughness=a.roughness,this.metalness=a.metalness,this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.roughnessMap=a.roughnessMap,this.metalnessMap=a.metalnessMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.envMapIntensity=a.envMapIntensity,this.refractionRatio=a.refractionRatio,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.skinning=a.skinning,this.morphTargets=a.morphTargets,this.morphNormals=a.morphNormals,this.flatShading=a.flatShading,this.vertexTangents=a.vertexTangents,this},cr.prototype=Object.create(Cn.prototype),cr.prototype.constructor=cr,cr.prototype.isMeshPhysicalMaterial=!0,cr.prototype.copy=function(a){return Cn.prototype.copy.call(this,a),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=a.clearcoat,this.clearcoatMap=a.clearcoatMap,this.clearcoatRoughness=a.clearcoatRoughness,this.clearcoatRoughnessMap=a.clearcoatRoughnessMap,this.clearcoatNormalMap=a.clearcoatNormalMap,this.clearcoatNormalScale.copy(a.clearcoatNormalScale),this.reflectivity=a.reflectivity,a.sheen?this.sheen=(this.sheen||new nt).copy(a.sheen):this.sheen=null,this.transmission=a.transmission,this.transmissionMap=a.transmissionMap,this};var ao=function(a){function i(t){var e;return(e=a.call(this)||this).type="MeshPhongMaterial",e.color=new nt(16777215),e.specular=new nt(1118481),e.shininess=30,e.map=null,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=null,e.aoMapIntensity=1,e.emissive=new nt(0),e.emissiveIntensity=1,e.emissiveMap=null,e.bumpMap=null,e.bumpScale=1,e.normalMap=null,e.normalMapType=0,e.normalScale=new Ve(1,1),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=null,e.alphaMap=null,e.envMap=null,e.combine=0,e.reflectivity=1,e.refractionRatio=.98,e.wireframe=!1,e.wireframeLinewidth=1,e.wireframeLinecap="round",e.wireframeLinejoin="round",e.skinning=!1,e.morphTargets=!1,e.morphNormals=!1,e.flatShading=!1,e.setValues(t),e}return Be(i,a),i.prototype.copy=function(t){return a.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.flatShading=t.flatShading,this},i}(Gt);ao.prototype.isMeshPhongMaterial=!0;var ol=function(a){function i(t){var e;return(e=a.call(this)||this).defines={TOON:""},e.type="MeshToonMaterial",e.color=new nt(16777215),e.map=null,e.gradientMap=null,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=null,e.aoMapIntensity=1,e.emissive=new nt(0),e.emissiveIntensity=1,e.emissiveMap=null,e.bumpMap=null,e.bumpScale=1,e.normalMap=null,e.normalMapType=0,e.normalScale=new Ve(1,1),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.alphaMap=null,e.wireframe=!1,e.wireframeLinewidth=1,e.wireframeLinecap="round",e.wireframeLinejoin="round",e.skinning=!1,e.morphTargets=!1,e.morphNormals=!1,e.setValues(t),e}return Be(i,a),i.prototype.copy=function(t){return a.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},i}(Gt);ol.prototype.isMeshToonMaterial=!0;var ll=function(a){function i(t){var e;return(e=a.call(this)||this).type="MeshNormalMaterial",e.bumpMap=null,e.bumpScale=1,e.normalMap=null,e.normalMapType=0,e.normalScale=new Ve(1,1),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.wireframe=!1,e.wireframeLinewidth=1,e.fog=!1,e.skinning=!1,e.morphTargets=!1,e.morphNormals=!1,e.flatShading=!1,e.setValues(t),e}return Be(i,a),i.prototype.copy=function(t){return a.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.flatShading=t.flatShading,this},i}(Gt);ll.prototype.isMeshNormalMaterial=!0;var hl=function(a){function i(t){var e;return(e=a.call(this)||this).type="MeshLambertMaterial",e.color=new nt(16777215),e.map=null,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=null,e.aoMapIntensity=1,e.emissive=new nt(0),e.emissiveIntensity=1,e.emissiveMap=null,e.specularMap=null,e.alphaMap=null,e.envMap=null,e.combine=0,e.reflectivity=1,e.refractionRatio=.98,e.wireframe=!1,e.wireframeLinewidth=1,e.wireframeLinecap="round",e.wireframeLinejoin="round",e.skinning=!1,e.morphTargets=!1,e.morphNormals=!1,e.setValues(t),e}return Be(i,a),i.prototype.copy=function(t){return a.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},i}(Gt);hl.prototype.isMeshLambertMaterial=!0;var cl=function(a){function i(t){var e;return(e=a.call(this)||this).defines={MATCAP:""},e.type="MeshMatcapMaterial",e.color=new nt(16777215),e.matcap=null,e.map=null,e.bumpMap=null,e.bumpScale=1,e.normalMap=null,e.normalMapType=0,e.normalScale=new Ve(1,1),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.alphaMap=null,e.skinning=!1,e.morphTargets=!1,e.morphNormals=!1,e.flatShading=!1,e.setValues(t),e}return Be(i,a),i.prototype.copy=function(t){return a.prototype.copy.call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.flatShading=t.flatShading,this},i}(Gt);cl.prototype.isMeshMatcapMaterial=!0;var ul=function(a){function i(t){var e;return(e=a.call(this)||this).type="LineDashedMaterial",e.scale=1,e.dashSize=3,e.gapSize=1,e.setValues(t),e}return Be(i,a),i.prototype.copy=function(t){return a.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this},i}(yi);ul.prototype.isLineDashedMaterial=!0;var Fd=Object.freeze({__proto__:null,ShadowMaterial:al,SpriteMaterial:Oa,RawShaderMaterial:ls,ShaderMaterial:Ui,PointsMaterial:Tr,MeshPhysicalMaterial:cr,MeshStandardMaterial:Cn,MeshPhongMaterial:ao,MeshToonMaterial:ol,MeshNormalMaterial:ll,MeshLambertMaterial:hl,MeshDepthMaterial:La,MeshDistanceMaterial:Pa,MeshBasicMaterial:zn,MeshMatcapMaterial:cl,LineDashedMaterial:ul,LineBasicMaterial:yi,Material:Gt}),$t={arraySlice:function(i,t,e){return $t.isTypedArray(i)?new i.constructor(i.subarray(t,e!==void 0?e:i.length)):i.slice(t,e)},convertArray:function(i,t,e){return!i||!e&&i.constructor===t?i:typeof t.BYTES_PER_ELEMENT=="number"?new t(i):Array.prototype.slice.call(i)},isTypedArray:function(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)},getKeyframeOrder:function(i){for(var t=i.length,e=new Array(t),n=0;n!==t;++n)e[n]=n;return e.sort(function(s,l){return i[s]-i[l]}),e},sortedArray:function(i,t,e){for(var n=i.length,s=new i.constructor(n),l=0,p=0;p!==n;++l)for(var _=e[l]*t,v=0;v!==t;++v)s[p++]=i[_+v];return s},flattenJSON:function(i,t,e,n){for(var s=1,l=i[0];l!==void 0&&l[n]===void 0;)l=i[s++];if(l!==void 0){var p=l[n];if(p!==void 0)if(Array.isArray(p))do(p=l[n])!==void 0&&(t.push(l.time),e.push.apply(e,p)),l=i[s++];while(l!==void 0);else if(p.toArray!==void 0)do(p=l[n])!==void 0&&(t.push(l.time),p.toArray(e,e.length)),l=i[s++];while(l!==void 0);else do(p=l[n])!==void 0&&(t.push(l.time),e.push(p)),l=i[s++];while(l!==void 0)}},subclip:function(i,t,e,n,s){s===void 0&&(s=30);var l=i.clone();l.name=t;for(var p=[],_=0;_<l.tracks.length;++_){for(var v=l.tracks[_],A=v.getValueSize(),E=[],L=[],D=0;D<v.times.length;++D){var B=v.times[D]*s;if(!(B<e||B>=n)){E.push(v.times[D]);for(var U=0;U<A;++U)L.push(v.values[D*A+U])}}E.length!==0&&(v.times=$t.convertArray(E,v.times.constructor),v.values=$t.convertArray(L,v.values.constructor),p.push(v))}l.tracks=p;for(var V=1/0,j=0;j<l.tracks.length;++j)V>l.tracks[j].times[0]&&(V=l.tracks[j].times[0]);for(var K=0;K<l.tracks.length;++K)l.tracks[K].shift(-1*V);return l.resetDuration(),l},makeClipAdditive:function(i,t,e,n){t===void 0&&(t=0),e===void 0&&(e=i),n===void 0&&(n=30),n<=0&&(n=30);for(var s=e.tracks.length,l=t/n,p=function(A){var E=e.tracks[A],L=E.ValueTypeName;if(L==="bool"||L==="string")return"continue";var D=i.tracks.find(function(_e){return _e.name===E.name&&_e.ValueTypeName===L});if(D===void 0)return"continue";var B=0,U=E.getValueSize();E.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(B=U/3);var V=0,j=D.getValueSize();D.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(V=j/3);var K=E.times.length-1,ee=void 0;if(l<=E.times[0]){var J=B,$=U-B;ee=$t.arraySlice(E.values,J,$)}else if(l>=E.times[K]){var se=K*U+B,re=se+U-B;ee=$t.arraySlice(E.values,se,re)}else{var ie=E.createInterpolant(),pe=B,de=U-B;ie.evaluate(l),ee=$t.arraySlice(ie.resultBuffer,pe,de)}L==="quaternion"&&new ni().fromArray(ee).normalize().conjugate().toArray(ee);for(var ye=D.times.length,Ee=0;Ee<ye;++Ee){var Re=Ee*j+V;if(L==="quaternion")ni.multiplyQuaternionsFlat(D.values,Re,ee,0,D.values,Re);else for(var Le=j-2*V,le=0;le<Le;++le)D.values[Re+le]-=ee[le]}},_=0;_<s;++_)p(_);return i.blendMode=Wn,i}};function Qi(a,i,t,e){this.parameterPositions=a,this._cachedIndex=0,this.resultBuffer=e!==void 0?e:new i.constructor(t),this.sampleValues=i,this.valueSize=t}function oo(a,i,t,e){Qi.call(this,a,i,t,e),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Hs(a,i,t,e){Qi.call(this,a,i,t,e)}function lo(a,i,t,e){Qi.call(this,a,i,t,e)}Object.assign(Qi.prototype,{evaluate:function(i){var t=this.parameterPositions,e=this._cachedIndex,n=t[e],s=t[e-1];e:{t:{var l;i:{n:if(!(i<n)){for(var p=e+2;;){if(n===void 0){if(i<s)break n;return e=t.length,this._cachedIndex=e,this.afterEnd_(e-1,i,s)}if(e===p)break;if(s=n,i<(n=t[++e]))break t}l=t.length;break i}if(i>=s)break e;var _=t[1];i<_&&(e=2,s=_);for(var v=e-2;;){if(s===void 0)return this._cachedIndex=0,this.beforeStart_(0,i,n);if(e===v)break;if(n=s,i>=(s=t[--e-1]))break t}l=e,e=0}for(;e<l;){var A=e+l>>>1;i<t[A]?l=A:e=A+1}if(n=t[e],(s=t[e-1])===void 0)return this._cachedIndex=0,this.beforeStart_(0,i,n);if(n===void 0)return e=t.length,this._cachedIndex=e,this.afterEnd_(e-1,s,i)}this._cachedIndex=e,this.intervalChanged_(e,s,n)}return this.interpolate_(e,s,i,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(i){for(var t=this.resultBuffer,e=this.sampleValues,n=this.valueSize,s=i*n,l=0;l!==n;++l)t[l]=e[s+l];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Qi.prototype,{beforeStart_:Qi.prototype.copySampleValue_,afterEnd_:Qi.prototype.copySampleValue_}),oo.prototype=Object.assign(Object.create(Qi.prototype),{constructor:oo,DefaultSettings_:{endingStart:Ut,endingEnd:Ut},intervalChanged_:function(i,t,e){var n=this.parameterPositions,s=i-2,l=i+1,p=n[s],_=n[l];if(p===void 0)switch(this.getSettings_().endingStart){case qt:s=i,p=2*t-e;break;case oi:p=t+n[s=n.length-2]-n[s+1];break;default:s=i,p=e}if(_===void 0)switch(this.getSettings_().endingEnd){case qt:l=i,_=2*e-t;break;case oi:l=1,_=e+n[1]-n[0];break;default:l=i-1,_=t}var v=.5*(e-t),A=this.valueSize;this._weightPrev=v/(t-p),this._weightNext=v/(_-e),this._offsetPrev=s*A,this._offsetNext=l*A},interpolate_:function(i,t,e,n){for(var s=this.resultBuffer,l=this.sampleValues,p=this.valueSize,_=i*p,v=_-p,A=this._offsetPrev,E=this._offsetNext,L=this._weightPrev,D=this._weightNext,B=(e-t)/(n-t),U=B*B,V=U*B,j=-L*V+2*L*U-L*B,K=(1+L)*V+(-1.5-2*L)*U+(-.5+L)*B+1,ee=(-1-D)*V+(1.5+D)*U+.5*B,J=D*V-D*U,$=0;$!==p;++$)s[$]=j*l[A+$]+K*l[v+$]+ee*l[_+$]+J*l[E+$];return s}}),Hs.prototype=Object.assign(Object.create(Qi.prototype),{constructor:Hs,interpolate_:function(i,t,e,n){for(var s=this.resultBuffer,l=this.sampleValues,p=this.valueSize,_=i*p,v=_-p,A=(e-t)/(n-t),E=1-A,L=0;L!==p;++L)s[L]=l[v+L]*E+l[_+L]*A;return s}}),lo.prototype=Object.assign(Object.create(Qi.prototype),{constructor:lo,interpolate_:function(i){return this.copySampleValue_(i-1)}});var yn=function(){function a(t,e,n,s){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=$t.convertArray(e,this.TimeBufferType),this.values=$t.convertArray(n,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}a.toJSON=function(t){var e,n=t.constructor;if(n.toJSON!==this.toJSON)e=n.toJSON(t);else{e={name:t.name,times:$t.convertArray(t.times,Array),values:$t.convertArray(t.values,Array)};var s=t.getInterpolation();s!==t.DefaultInterpolation&&(e.interpolation=s)}return e.type=t.ValueTypeName,e};var i=a.prototype;return i.InterpolantFactoryMethodDiscrete=function(t){return new lo(this.times,this.values,this.getValueSize(),t)},i.InterpolantFactoryMethodLinear=function(t){return new Hs(this.times,this.values,this.getValueSize(),t)},i.InterpolantFactoryMethodSmooth=function(t){return new oo(this.times,this.values,this.getValueSize(),t)},i.setInterpolation=function(t){var e;switch(t){case ot:e=this.InterpolantFactoryMethodDiscrete;break;case $e:e=this.InterpolantFactoryMethodLinear;break;case _t:e=this.InterpolantFactoryMethodSmooth}if(e===void 0){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(t===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=e,this},i.getInterpolation=function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ot;case this.InterpolantFactoryMethodLinear:return $e;case this.InterpolantFactoryMethodSmooth:return _t}},i.getValueSize=function(){return this.values.length/this.times.length},i.shift=function(t){if(t!==0)for(var e=this.times,n=0,s=e.length;n!==s;++n)e[n]+=t;return this},i.scale=function(t){if(t!==1)for(var e=this.times,n=0,s=e.length;n!==s;++n)e[n]*=t;return this},i.trim=function(t,e){for(var n=this.times,s=n.length,l=0,p=s-1;l!==s&&n[l]<t;)++l;for(;p!==-1&&n[p]>e;)--p;if(++p,l!==0||p!==s){l>=p&&(l=(p=Math.max(p,1))-1);var _=this.getValueSize();this.times=$t.arraySlice(n,l,p),this.values=$t.arraySlice(this.values,l*_,p*_)}return this},i.validate=function(){var t=!0,e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);var n=this.times,s=this.values,l=n.length;l===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);for(var p=null,_=0;_!==l;_++){var v=n[_];if(typeof v=="number"&&isNaN(v)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,_,v),t=!1;break}if(p!==null&&p>v){console.error("THREE.KeyframeTrack: Out of order keys.",this,_,v,p),t=!1;break}p=v}if(s!==void 0&&$t.isTypedArray(s))for(var A=0,E=s.length;A!==E;++A){var L=s[A];if(isNaN(L)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,A,L),t=!1;break}}return t},i.optimize=function(){for(var t=$t.arraySlice(this.times),e=$t.arraySlice(this.values),n=this.getValueSize(),s=this.getInterpolation()===_t,l=t.length-1,p=1,_=1;_<l;++_){var v=!1,A=t[_];if(A!==t[_+1]&&(_!==1||A!==t[0]))if(s)v=!0;else for(var E=_*n,L=E-n,D=E+n,B=0;B!==n;++B){var U=e[E+B];if(U!==e[L+B]||U!==e[D+B]){v=!0;break}}if(v){if(_!==p){t[p]=t[_];for(var V=_*n,j=p*n,K=0;K!==n;++K)e[j+K]=e[V+K]}++p}}if(l>0){t[p]=t[l];for(var ee=l*n,J=p*n,$=0;$!==n;++$)e[J+$]=e[ee+$];++p}return p!==t.length?(this.times=$t.arraySlice(t,0,p),this.values=$t.arraySlice(e,0,p*n)):(this.times=t,this.values=e),this},i.clone=function(){var t=$t.arraySlice(this.times,0),e=$t.arraySlice(this.values,0),n=new this.constructor(this.name,t,e);return n.createInterpolant=this.createInterpolant,n},a}();yn.prototype.TimeBufferType=Float32Array,yn.prototype.ValueBufferType=Float32Array,yn.prototype.DefaultInterpolation=$e;var Cr=function(a){function i(){return a.apply(this,arguments)||this}return Be(i,a),i}(yn);Cr.prototype.ValueTypeName="bool",Cr.prototype.ValueBufferType=Array,Cr.prototype.DefaultInterpolation=ot,Cr.prototype.InterpolantFactoryMethodLinear=void 0,Cr.prototype.InterpolantFactoryMethodSmooth=void 0;var dl=function(a){function i(){return a.apply(this,arguments)||this}return Be(i,a),i}(yn);dl.prototype.ValueTypeName="color";var Ks=function(a){function i(){return a.apply(this,arguments)||this}return Be(i,a),i}(yn);function ho(a,i,t,e){Qi.call(this,a,i,t,e)}Ks.prototype.ValueTypeName="number",ho.prototype=Object.assign(Object.create(Qi.prototype),{constructor:ho,interpolate_:function(i,t,e,n){for(var s=this.resultBuffer,l=this.sampleValues,p=this.valueSize,_=(e-t)/(n-t),v=i*p,A=v+p;v!==A;v+=4)ni.slerpFlat(s,0,l,v-p,l,v,_);return s}});var hs=function(a){function i(){return a.apply(this,arguments)||this}return Be(i,a),i.prototype.InterpolantFactoryMethodLinear=function(t){return new ho(this.times,this.values,this.getValueSize(),t)},i}(yn);hs.prototype.ValueTypeName="quaternion",hs.prototype.DefaultInterpolation=$e,hs.prototype.InterpolantFactoryMethodSmooth=void 0;var Lr=function(a){function i(){return a.apply(this,arguments)||this}return Be(i,a),i}(yn);Lr.prototype.ValueTypeName="string",Lr.prototype.ValueBufferType=Array,Lr.prototype.DefaultInterpolation=ot,Lr.prototype.InterpolantFactoryMethodLinear=void 0,Lr.prototype.InterpolantFactoryMethodSmooth=void 0;var Ys=function(a){function i(){return a.apply(this,arguments)||this}return Be(i,a),i}(yn);Ys.prototype.ValueTypeName="vector";var Xs=function(){function a(t,e,n,s){e===void 0&&(e=-1),s===void 0&&(s=Nt),this.name=t,this.tracks=n,this.duration=e,this.blendMode=s,this.uuid=dt.generateUUID(),this.duration<0&&this.resetDuration()}a.parse=function(t){for(var e=[],n=t.tracks,s=1/(t.fps||1),l=0,p=n.length;l!==p;++l)e.push(zd(n[l]).scale(s));var _=new this(t.name,t.duration,e,t.blendMode);return _.uuid=t.uuid,_},a.toJSON=function(t){for(var e=[],n=t.tracks,s={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode},l=0,p=n.length;l!==p;++l)e.push(yn.toJSON(n[l]));return s},a.CreateFromMorphTargetSequence=function(t,e,n,s){for(var l=e.length,p=[],_=0;_<l;_++){var v=[],A=[];v.push((_+l-1)%l,_,(_+1)%l),A.push(0,1,0);var E=$t.getKeyframeOrder(v);v=$t.sortedArray(v,1,E),A=$t.sortedArray(A,1,E),s||v[0]!==0||(v.push(l),A.push(A[0])),p.push(new Ks(".morphTargetInfluences["+e[_].name+"]",v,A).scale(1/n))}return new this(t,-1,p)},a.findByName=function(t,e){var n=t;if(!Array.isArray(t)){var s=t;n=s.geometry&&s.geometry.animations||s.animations}for(var l=0;l<n.length;l++)if(n[l].name===e)return n[l];return null},a.CreateClipsFromMorphTargetSequences=function(t,e,n){for(var s={},l=/^([\w-]*?)([\d]+)$/,p=0,_=t.length;p<_;p++){var v=t[p],A=v.name.match(l);if(A&&A.length>1){var E=A[1],L=s[E];L||(s[E]=L=[]),L.push(v)}}var D=[];for(var B in s)D.push(this.CreateFromMorphTargetSequence(B,s[B],e,n));return D},a.parseAnimation=function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(re,ie,pe,de,ye){if(pe.length!==0){var Ee=[],Re=[];$t.flattenJSON(pe,Ee,Re,de),Ee.length!==0&&ye.push(new re(ie,Ee,Re))}},s=[],l=t.name||"default",p=t.fps||30,_=t.blendMode,v=t.length||-1,A=t.hierarchy||[],E=0;E<A.length;E++){var L=A[E].keys;if(L&&L.length!==0)if(L[0].morphTargets){var D={},B=void 0;for(B=0;B<L.length;B++)if(L[B].morphTargets)for(var U=0;U<L[B].morphTargets.length;U++)D[L[B].morphTargets[U]]=-1;for(var V in D){for(var j=[],K=[],ee=0;ee!==L[B].morphTargets.length;++ee){var J=L[B];j.push(J.time),K.push(J.morphTarget===V?1:0)}s.push(new Ks(".morphTargetInfluence["+V+"]",j,K))}v=D.length*(p||1)}else{var $=".bones["+e[E].name+"]";n(Ys,$+".position",L,"pos",s),n(hs,$+".quaternion",L,"rot",s),n(Ys,$+".scale",L,"scl",s)}}return s.length===0?null:new this(l,v,s,_)};var i=a.prototype;return i.resetDuration=function(){for(var t=0,e=0,n=this.tracks.length;e!==n;++e){var s=this.tracks[e];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this},i.trim=function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},i.validate=function(){for(var t=!0,e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},i.optimize=function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},i.clone=function(){for(var t=[],e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)},i.toJSON=function(){return this.constructor.toJSON(this)},a}();function zd(a){if(a.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var i=function(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ks;case"vector":case"vector2":case"vector3":case"vector4":return Ys;case"color":return dl;case"quaternion":return hs;case"bool":case"boolean":return Cr;case"string":return Lr}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}(a.type);if(a.times===void 0){var t=[],e=[];$t.flattenJSON(a.keys,t,e,"value"),a.times=t,a.values=e}return i.parse!==void 0?i.parse(a):new i(a.name,a.times,a.values,a.interpolation)}var Pr={enabled:!1,files:{},add:function(i,t){this.enabled!==!1&&(this.files[i]=t)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};function pl(a,i,t){var e=this,n=!1,s=0,l=0,p=void 0,_=[];this.onStart=void 0,this.onLoad=a,this.onProgress=i,this.onError=t,this.itemStart=function(v){l++,n===!1&&e.onStart!==void 0&&e.onStart(v,s,l),n=!0},this.itemEnd=function(v){s++,e.onProgress!==void 0&&e.onProgress(v,s,l),s===l&&(n=!1,e.onLoad!==void 0&&e.onLoad())},this.itemError=function(v){e.onError!==void 0&&e.onError(v)},this.resolveURL=function(v){return p?p(v):v},this.setURLModifier=function(v){return p=v,this},this.addHandler=function(v,A){return _.push(v,A),this},this.removeHandler=function(v){var A=_.indexOf(v);return A!==-1&&_.splice(A,2),this},this.getHandler=function(v){for(var A=0,E=_.length;A<E;A+=2){var L=_[A],D=_[A+1];if(L.global&&(L.lastIndex=0),L.test(v))return D}return null}}var Qh=new pl;function ri(a){this.manager=a!==void 0?a:Qh,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(ri.prototype,{load:function(){},loadAsync:function(i,t){var e=this;return new Promise(function(n,s){e.load(i,n,t,s)})},parse:function(){},setCrossOrigin:function(i){return this.crossOrigin=i,this},setWithCredentials:function(i){return this.withCredentials=i,this},setPath:function(i){return this.path=i,this},setResourcePath:function(i){return this.resourcePath=i,this},setRequestHeader:function(i){return this.requestHeader=i,this}});var bn={};function cn(a){ri.call(this,a)}cn.prototype=Object.assign(Object.create(ri.prototype),{constructor:cn,load:function(i,t,e,n){i===void 0&&(i=""),this.path!==void 0&&(i=this.path+i),i=this.manager.resolveURL(i);var s=this,l=Pr.get(i);if(l!==void 0)return s.manager.itemStart(i),setTimeout(function(){t&&t(l),s.manager.itemEnd(i)},0),l;if(bn[i]===void 0){var p,_=i.match(/^data:(.*?)(;base64)?,(.*)$/);if(_){var v=_[1],A=!!_[2],E=_[3];E=decodeURIComponent(E),A&&(E=atob(E));try{var L,D=(this.responseType||"").toLowerCase();switch(D){case"arraybuffer":case"blob":for(var B=new Uint8Array(E.length),U=0;U<E.length;U++)B[U]=E.charCodeAt(U);L=D==="blob"?new Blob([B.buffer],{type:v}):B.buffer;break;case"document":var V=new DOMParser;L=V.parseFromString(E,v);break;case"json":L=JSON.parse(E);break;default:L=E}setTimeout(function(){t&&t(L),s.manager.itemEnd(i)},0)}catch(K){setTimeout(function(){n&&n(K),s.manager.itemError(i),s.manager.itemEnd(i)},0)}}else{for(var j in bn[i]=[],bn[i].push({onLoad:t,onProgress:e,onError:n}),(p=new XMLHttpRequest).open("GET",i,!0),p.addEventListener("load",function(K){var ee=this.response,J=bn[i];if(delete bn[i],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Pr.add(i,ee);for(var $=0,se=J.length;$<se;$++){var re=J[$];re.onLoad&&re.onLoad(ee)}s.manager.itemEnd(i)}else{for(var ie=0,pe=J.length;ie<pe;ie++){var de=J[ie];de.onError&&de.onError(K)}s.manager.itemError(i),s.manager.itemEnd(i)}},!1),p.addEventListener("progress",function(K){for(var ee=bn[i],J=0,$=ee.length;J<$;J++){var se=ee[J];se.onProgress&&se.onProgress(K)}},!1),p.addEventListener("error",function(K){var ee=bn[i];delete bn[i];for(var J=0,$=ee.length;J<$;J++){var se=ee[J];se.onError&&se.onError(K)}s.manager.itemError(i),s.manager.itemEnd(i)},!1),p.addEventListener("abort",function(K){var ee=bn[i];delete bn[i];for(var J=0,$=ee.length;J<$;J++){var se=ee[J];se.onError&&se.onError(K)}s.manager.itemError(i),s.manager.itemEnd(i)},!1),this.responseType!==void 0&&(p.responseType=this.responseType),this.withCredentials!==void 0&&(p.withCredentials=this.withCredentials),p.overrideMimeType&&p.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain"),this.requestHeader)p.setRequestHeader(j,this.requestHeader[j]);p.send(null)}return s.manager.itemStart(i),p}bn[i].push({onLoad:t,onProgress:e,onError:n})},setResponseType:function(i){return this.responseType=i,this},setMimeType:function(i){return this.mimeType=i,this}});var Ud=function(a){function i(e){return a.call(this,e)||this}Be(i,a);var t=i.prototype;return t.load=function(e,n,s,l){var p=this,_=new cn(this.manager);_.setPath(this.path),_.setRequestHeader(this.requestHeader),_.setWithCredentials(this.withCredentials),_.load(e,function(v){try{n(p.parse(JSON.parse(v)))}catch(A){l?l(A):console.error(A),p.manager.itemError(e)}},s,l)},t.parse=function(e){for(var n=[],s=0;s<e.length;s++){var l=Xs.parse(e[s]);n.push(l)}return n},i}(ri);function fl(a){ri.call(this,a)}fl.prototype=Object.assign(Object.create(ri.prototype),{constructor:fl,load:function(i,t,e,n){var s=this,l=[],p=new el,_=new cn(this.manager);_.setPath(this.path),_.setResponseType("arraybuffer"),_.setRequestHeader(this.requestHeader),_.setWithCredentials(s.withCredentials);var v=0;function A(D){_.load(i[D],function(B){var U=s.parse(B,!0);l[D]={width:U.width,height:U.height,format:U.format,mipmaps:U.mipmaps},(v+=1)===6&&(U.mipmapCount===1&&(p.minFilter=P),p.image=l,p.format=U.format,p.needsUpdate=!0,t&&t(p))},e,n)}if(Array.isArray(i))for(var E=0,L=i.length;E<L;++E)A(E);else _.load(i,function(D){var B=s.parse(D,!0);if(B.isCubemap){for(var U=B.mipmaps.length/B.mipmapCount,V=0;V<U;V++){l[V]={mipmaps:[]};for(var j=0;j<B.mipmapCount;j++)l[V].mipmaps.push(B.mipmaps[V*B.mipmapCount+j]),l[V].format=B.format,l[V].width=B.width,l[V].height=B.height}p.image=l}else p.image.width=B.width,p.image.height=B.height,p.mipmaps=B.mipmaps;B.mipmapCount===1&&(p.minFilter=P),p.format=B.format,p.needsUpdate=!0,t&&t(p)},e,n);return p}});var co=function(a){function i(t){return a.call(this,t)||this}return Be(i,a),i.prototype.load=function(t,e,n,s){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);var l=this,p=Pr.get(t);if(p!==void 0)return l.manager.itemStart(t),setTimeout(function(){e&&e(p),l.manager.itemEnd(t)},0),p;var _=document.createElementNS("http://www.w3.org/1999/xhtml","img");function v(){_.removeEventListener("load",v,!1),_.removeEventListener("error",A,!1),Pr.add(t,this),e&&e(this),l.manager.itemEnd(t)}function A(E){_.removeEventListener("load",v,!1),_.removeEventListener("error",A,!1),s&&s(E),l.manager.itemError(t),l.manager.itemEnd(t)}return _.addEventListener("load",v,!1),_.addEventListener("error",A,!1),t.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(_.crossOrigin=this.crossOrigin),l.manager.itemStart(t),_.src=t,_},i}(ri),Jh=function(a){function i(t){return a.call(this,t)||this}return Be(i,a),i.prototype.load=function(t,e,n,s){var l=new Zr,p=new co(this.manager);p.setCrossOrigin(this.crossOrigin),p.setPath(this.path);var _=0;function v(E){p.load(t[E],function(L){l.images[E]=L,++_===6&&(l.needsUpdate=!0,e&&e(l))},void 0,s)}for(var A=0;A<t.length;++A)v(A);return l},i}(ri);function uo(a){ri.call(this,a)}function po(a){ri.call(this,a)}function Ni(){this.type="Curve",this.arcLengthDivisions=200}uo.prototype=Object.assign(Object.create(ri.prototype),{constructor:uo,load:function(i,t,e,n){var s=this,l=new Qr,p=new cn(this.manager);return p.setResponseType("arraybuffer"),p.setRequestHeader(this.requestHeader),p.setPath(this.path),p.setWithCredentials(s.withCredentials),p.load(i,function(_){var v=s.parse(_);v&&(v.image!==void 0?l.image=v.image:v.data!==void 0&&(l.image.width=v.width,l.image.height=v.height,l.image.data=v.data),l.wrapS=v.wrapS!==void 0?v.wrapS:m,l.wrapT=v.wrapT!==void 0?v.wrapT:m,l.magFilter=v.magFilter!==void 0?v.magFilter:P,l.minFilter=v.minFilter!==void 0?v.minFilter:P,l.anisotropy=v.anisotropy!==void 0?v.anisotropy:1,v.encoding!==void 0&&(l.encoding=v.encoding),v.flipY!==void 0&&(l.flipY=v.flipY),v.format!==void 0&&(l.format=v.format),v.type!==void 0&&(l.type=v.type),v.mipmaps!==void 0&&(l.mipmaps=v.mipmaps,l.minFilter=M),v.mipmapCount===1&&(l.minFilter=P),l.needsUpdate=!0,t&&t(l,v))},e,n),l}}),po.prototype=Object.assign(Object.create(ri.prototype),{constructor:po,load:function(i,t,e,n){var s=new ui,l=new co(this.manager);return l.setCrossOrigin(this.crossOrigin),l.setPath(this.path),l.load(i,function(p){s.image=p;var _=i.search(/\.jpe?g($|\?)/i)>0||i.search(/^data\:image\/jpeg/)===0;s.format=_?G:H,s.needsUpdate=!0,t!==void 0&&t(s)},e,n),s}}),Object.assign(Ni.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(i,t){var e=this.getUtoTmapping(i);return this.getPoint(e,t)},getPoints:function(i){i===void 0&&(i=5);for(var t=[],e=0;e<=i;e++)t.push(this.getPoint(e/i));return t},getSpacedPoints:function(i){i===void 0&&(i=5);for(var t=[],e=0;e<=i;e++)t.push(this.getPointAt(e/i));return t},getLength:function(){var i=this.getLengths();return i[i.length-1]},getLengths:function(i){if(i===void 0&&(i=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===i+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,e=[],n=this.getPoint(0),s=0;e.push(0);for(var l=1;l<=i;l++)s+=(t=this.getPoint(l/i)).distanceTo(n),e.push(s),n=t;return this.cacheArcLengths=e,e},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(i,t){var e,n=this.getLengths(),s=0,l=n.length;e=t||i*n[l-1];for(var p,_=0,v=l-1;_<=v;)if((p=n[s=Math.floor(_+(v-_)/2)]-e)<0)_=s+1;else{if(!(p>0)){v=s;break}v=s-1}if(n[s=v]===e)return s/(l-1);var A=n[s];return(s+(e-A)/(n[s+1]-A))/(l-1)},getTangent:function(i,t){var e=1e-4,n=i-e,s=i+e;n<0&&(n=0),s>1&&(s=1);var l=this.getPoint(n),p=this.getPoint(s),_=t||(l.isVector2?new Ve:new te);return _.copy(p).sub(l).normalize(),_},getTangentAt:function(i,t){var e=this.getUtoTmapping(i);return this.getTangent(e,t)},computeFrenetFrames:function(i,t){for(var e=new te,n=[],s=[],l=[],p=new te,_=new ht,v=0;v<=i;v++){var A=v/i;n[v]=this.getTangentAt(A,new te),n[v].normalize()}s[0]=new te,l[0]=new te;var E=Number.MAX_VALUE,L=Math.abs(n[0].x),D=Math.abs(n[0].y),B=Math.abs(n[0].z);L<=E&&(E=L,e.set(1,0,0)),D<=E&&(E=D,e.set(0,1,0)),B<=E&&e.set(0,0,1),p.crossVectors(n[0],e).normalize(),s[0].crossVectors(n[0],p),l[0].crossVectors(n[0],s[0]);for(var U=1;U<=i;U++){if(s[U]=s[U-1].clone(),l[U]=l[U-1].clone(),p.crossVectors(n[U-1],n[U]),p.length()>Number.EPSILON){p.normalize();var V=Math.acos(dt.clamp(n[U-1].dot(n[U]),-1,1));s[U].applyMatrix4(_.makeRotationAxis(p,V))}l[U].crossVectors(n[U],s[U])}if(t===!0){var j=Math.acos(dt.clamp(s[0].dot(s[i]),-1,1));j/=i,n[0].dot(p.crossVectors(s[0],s[i]))>0&&(j=-j);for(var K=1;K<=i;K++)s[K].applyMatrix4(_.makeRotationAxis(n[K],j*K)),l[K].crossVectors(n[K],s[K])}return{tangents:n,normals:s,binormals:l}},clone:function(){return new this.constructor().copy(this)},copy:function(i){return this.arcLengthDivisions=i.arcLengthDivisions,this},toJSON:function(){var i={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return i.arcLengthDivisions=this.arcLengthDivisions,i.type=this.type,i},fromJSON:function(i){return this.arcLengthDivisions=i.arcLengthDivisions,this}});var qs=function(a){function i(e,n,s,l,p,_,v,A){var E;return e===void 0&&(e=0),n===void 0&&(n=0),s===void 0&&(s=1),l===void 0&&(l=1),p===void 0&&(p=0),_===void 0&&(_=2*Math.PI),v===void 0&&(v=!1),A===void 0&&(A=0),(E=a.call(this)||this).type="EllipseCurve",E.aX=e,E.aY=n,E.xRadius=s,E.yRadius=l,E.aStartAngle=p,E.aEndAngle=_,E.aClockwise=v,E.aRotation=A,E}Be(i,a);var t=i.prototype;return t.getPoint=function(e,n){for(var s=n||new Ve,l=2*Math.PI,p=this.aEndAngle-this.aStartAngle,_=Math.abs(p)<Number.EPSILON;p<0;)p+=l;for(;p>l;)p-=l;p<Number.EPSILON&&(p=_?0:l),this.aClockwise!==!0||_||(p===l?p=-l:p-=l);var v=this.aStartAngle+e*p,A=this.aX+this.xRadius*Math.cos(v),E=this.aY+this.yRadius*Math.sin(v);if(this.aRotation!==0){var L=Math.cos(this.aRotation),D=Math.sin(this.aRotation),B=A-this.aX,U=E-this.aY;A=B*L-U*D+this.aX,E=B*D+U*L+this.aY}return s.set(A,E)},t.copy=function(e){return a.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},t.toJSON=function(){var e=a.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},t.fromJSON=function(e){return a.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},i}(Ni);qs.prototype.isEllipseCurve=!0;var ml=function(a){function i(t,e,n,s,l,p){var _;return(_=a.call(this,t,e,n,n,s,l,p)||this).type="ArcCurve",_}return Be(i,a),i}(qs);function _l(){var a=0,i=0,t=0,e=0;function n(s,l,p,_){a=s,i=p,t=-3*s+3*l-2*p-_,e=2*s-2*l+p+_}return{initCatmullRom:function(l,p,_,v,A){n(p,_,A*(_-l),A*(v-p))},initNonuniformCatmullRom:function(l,p,_,v,A,E,L){var D=(p-l)/A-(_-l)/(A+E)+(_-p)/E,B=(_-p)/E-(v-p)/(E+L)+(v-_)/L;n(p,_,D*=E,B*=E)},calc:function(l){var p=l*l;return a+i*l+t*p+e*(p*l)}}}ml.prototype.isArcCurve=!0;var fo=new te,gl=new _l,vl=new _l,yl=new _l,bl=function(a){function i(e,n,s,l){var p;return e===void 0&&(e=[]),n===void 0&&(n=!1),s===void 0&&(s="centripetal"),l===void 0&&(l=.5),(p=a.call(this)||this).type="CatmullRomCurve3",p.points=e,p.closed=n,p.curveType=s,p.tension=l,p}Be(i,a);var t=i.prototype;return t.getPoint=function(e,n){n===void 0&&(n=new te);var s,l,p=n,_=this.points,v=_.length,A=(v-(this.closed?0:1))*e,E=Math.floor(A),L=A-E;this.closed?E+=E>0?0:(Math.floor(Math.abs(E)/v)+1)*v:L===0&&E===v-1&&(E=v-2,L=1),this.closed||E>0?s=_[(E-1)%v]:(fo.subVectors(_[0],_[1]).add(_[0]),s=fo);var D=_[E%v],B=_[(E+1)%v];if(this.closed||E+2<v?l=_[(E+2)%v]:(fo.subVectors(_[v-1],_[v-2]).add(_[v-1]),l=fo),this.curveType==="centripetal"||this.curveType==="chordal"){var U=this.curveType==="chordal"?.5:.25,V=Math.pow(s.distanceToSquared(D),U),j=Math.pow(D.distanceToSquared(B),U),K=Math.pow(B.distanceToSquared(l),U);j<1e-4&&(j=1),V<1e-4&&(V=j),K<1e-4&&(K=j),gl.initNonuniformCatmullRom(s.x,D.x,B.x,l.x,V,j,K),vl.initNonuniformCatmullRom(s.y,D.y,B.y,l.y,V,j,K),yl.initNonuniformCatmullRom(s.z,D.z,B.z,l.z,V,j,K)}else this.curveType==="catmullrom"&&(gl.initCatmullRom(s.x,D.x,B.x,l.x,this.tension),vl.initCatmullRom(s.y,D.y,B.y,l.y,this.tension),yl.initCatmullRom(s.z,D.z,B.z,l.z,this.tension));return p.set(gl.calc(L),vl.calc(L),yl.calc(L)),p},t.copy=function(e){a.prototype.copy.call(this,e),this.points=[];for(var n=0,s=e.points.length;n<s;n++){var l=e.points[n];this.points.push(l.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},t.toJSON=function(){var e=a.prototype.toJSON.call(this);e.points=[];for(var n=0,s=this.points.length;n<s;n++){var l=this.points[n];e.points.push(l.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},t.fromJSON=function(e){a.prototype.fromJSON.call(this,e),this.points=[];for(var n=0,s=e.points.length;n<s;n++){var l=e.points[n];this.points.push(new te().fromArray(l))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},i}(Ni);function $h(a,i,t,e,n){var s=.5*(e-i),l=.5*(n-t),p=a*a;return(2*t-2*e+s+l)*(a*p)+(-3*t+3*e-2*s-l)*p+s*a+t}function Zs(a,i,t,e){return function(n,s){var l=1-n;return l*l*s}(a,i)+function(n,s){return 2*(1-n)*n*s}(a,t)+function(n,s){return n*n*s}(a,e)}function Qs(a,i,t,e,n){return function(s,l){var p=1-s;return p*p*p*l}(a,i)+function(s,l){var p=1-s;return 3*p*p*s*l}(a,t)+function(s,l){return 3*(1-s)*s*s*l}(a,e)+function(s,l){return s*s*s*l}(a,n)}bl.prototype.isCatmullRomCurve3=!0;var mo=function(a){function i(e,n,s,l){var p;return e===void 0&&(e=new Ve),n===void 0&&(n=new Ve),s===void 0&&(s=new Ve),l===void 0&&(l=new Ve),(p=a.call(this)||this).type="CubicBezierCurve",p.v0=e,p.v1=n,p.v2=s,p.v3=l,p}Be(i,a);var t=i.prototype;return t.getPoint=function(e,n){n===void 0&&(n=new Ve);var s=n,l=this.v0,p=this.v1,_=this.v2,v=this.v3;return s.set(Qs(e,l.x,p.x,_.x,v.x),Qs(e,l.y,p.y,_.y,v.y)),s},t.copy=function(e){return a.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},t.toJSON=function(){var e=a.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},t.fromJSON=function(e){return a.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},i}(Ni);mo.prototype.isCubicBezierCurve=!0;var xl=function(a){function i(e,n,s,l){var p;return e===void 0&&(e=new te),n===void 0&&(n=new te),s===void 0&&(s=new te),l===void 0&&(l=new te),(p=a.call(this)||this).type="CubicBezierCurve3",p.v0=e,p.v1=n,p.v2=s,p.v3=l,p}Be(i,a);var t=i.prototype;return t.getPoint=function(e,n){n===void 0&&(n=new te);var s=n,l=this.v0,p=this.v1,_=this.v2,v=this.v3;return s.set(Qs(e,l.x,p.x,_.x,v.x),Qs(e,l.y,p.y,_.y,v.y),Qs(e,l.z,p.z,_.z,v.z)),s},t.copy=function(e){return a.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},t.toJSON=function(){var e=a.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},t.fromJSON=function(e){return a.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},i}(Ni);xl.prototype.isCubicBezierCurve3=!0;var Js=function(a){function i(e,n){var s;return e===void 0&&(e=new Ve),n===void 0&&(n=new Ve),(s=a.call(this)||this).type="LineCurve",s.v1=e,s.v2=n,s}Be(i,a);var t=i.prototype;return t.getPoint=function(e,n){n===void 0&&(n=new Ve);var s=n;return e===1?s.copy(this.v2):(s.copy(this.v2).sub(this.v1),s.multiplyScalar(e).add(this.v1)),s},t.getPointAt=function(e,n){return this.getPoint(e,n)},t.getTangent=function(e,n){var s=n||new Ve;return s.copy(this.v2).sub(this.v1).normalize(),s},t.copy=function(e){return a.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},t.toJSON=function(){var e=a.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},t.fromJSON=function(e){return a.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},i}(Ni);Js.prototype.isLineCurve=!0;var ec=function(a){function i(e,n){var s;return e===void 0&&(e=new te),n===void 0&&(n=new te),(s=a.call(this)||this).type="LineCurve3",s.isLineCurve3=!0,s.v1=e,s.v2=n,s}Be(i,a);var t=i.prototype;return t.getPoint=function(e,n){n===void 0&&(n=new te);var s=n;return e===1?s.copy(this.v2):(s.copy(this.v2).sub(this.v1),s.multiplyScalar(e).add(this.v1)),s},t.getPointAt=function(e,n){return this.getPoint(e,n)},t.copy=function(e){return a.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},t.toJSON=function(){var e=a.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},t.fromJSON=function(e){return a.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},i}(Ni),_o=function(a){function i(e,n,s){var l;return e===void 0&&(e=new Ve),n===void 0&&(n=new Ve),s===void 0&&(s=new Ve),(l=a.call(this)||this).type="QuadraticBezierCurve",l.v0=e,l.v1=n,l.v2=s,l}Be(i,a);var t=i.prototype;return t.getPoint=function(e,n){n===void 0&&(n=new Ve);var s=n,l=this.v0,p=this.v1,_=this.v2;return s.set(Zs(e,l.x,p.x,_.x),Zs(e,l.y,p.y,_.y)),s},t.copy=function(e){return a.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},t.toJSON=function(){var e=a.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},t.fromJSON=function(e){return a.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},i}(Ni);_o.prototype.isQuadraticBezierCurve=!0;var Sl=function(a){function i(e,n,s){var l;return e===void 0&&(e=new te),n===void 0&&(n=new te),s===void 0&&(s=new te),(l=a.call(this)||this).type="QuadraticBezierCurve3",l.v0=e,l.v1=n,l.v2=s,l}Be(i,a);var t=i.prototype;return t.getPoint=function(e,n){n===void 0&&(n=new te);var s=n,l=this.v0,p=this.v1,_=this.v2;return s.set(Zs(e,l.x,p.x,_.x),Zs(e,l.y,p.y,_.y),Zs(e,l.z,p.z,_.z)),s},t.copy=function(e){return a.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},t.toJSON=function(){var e=a.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},t.fromJSON=function(e){return a.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},i}(Ni);Sl.prototype.isQuadraticBezierCurve3=!0;var go=function(a){function i(e){var n;return e===void 0&&(e=[]),(n=a.call(this)||this).type="SplineCurve",n.points=e,n}Be(i,a);var t=i.prototype;return t.getPoint=function(e,n){n===void 0&&(n=new Ve);var s=n,l=this.points,p=(l.length-1)*e,_=Math.floor(p),v=p-_,A=l[_===0?_:_-1],E=l[_],L=l[_>l.length-2?l.length-1:_+1],D=l[_>l.length-3?l.length-1:_+2];return s.set($h(v,A.x,E.x,L.x,D.x),$h(v,A.y,E.y,L.y,D.y)),s},t.copy=function(e){a.prototype.copy.call(this,e),this.points=[];for(var n=0,s=e.points.length;n<s;n++){var l=e.points[n];this.points.push(l.clone())}return this},t.toJSON=function(){var e=a.prototype.toJSON.call(this);e.points=[];for(var n=0,s=this.points.length;n<s;n++){var l=this.points[n];e.points.push(l.toArray())}return e},t.fromJSON=function(e){a.prototype.fromJSON.call(this,e),this.points=[];for(var n=0,s=e.points.length;n<s;n++){var l=e.points[n];this.points.push(new Ve().fromArray(l))}return this},i}(Ni);go.prototype.isSplineCurve=!0;var wl=Object.freeze({__proto__:null,ArcCurve:ml,CatmullRomCurve3:bl,CubicBezierCurve:mo,CubicBezierCurve3:xl,EllipseCurve:qs,LineCurve:Js,LineCurve3:ec,QuadraticBezierCurve:_o,QuadraticBezierCurve3:Sl,SplineCurve:go}),tc=function(a){function i(){var e;return(e=a.call(this)||this).type="CurvePath",e.curves=[],e.autoClose=!1,e}Be(i,a);var t=i.prototype;return t.add=function(e){this.curves.push(e)},t.closePath=function(){var e=this.curves[0].getPoint(0),n=this.curves[this.curves.length-1].getPoint(1);e.equals(n)||this.curves.push(new Js(n,e))},t.getPoint=function(e){for(var n=e*this.getLength(),s=this.getCurveLengths(),l=0;l<s.length;){if(s[l]>=n){var p=s[l]-n,_=this.curves[l],v=_.getLength(),A=v===0?0:1-p/v;return _.getPointAt(A)}l++}return null},t.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},t.updateArcLengths=function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},t.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],n=0,s=0,l=this.curves.length;s<l;s++)n+=this.curves[s].getLength(),e.push(n);return this.cacheLengths=e,e},t.getSpacedPoints=function(e){e===void 0&&(e=40);for(var n=[],s=0;s<=e;s++)n.push(this.getPoint(s/e));return this.autoClose&&n.push(n[0]),n},t.getPoints=function(e){e===void 0&&(e=12);for(var n,s=[],l=0,p=this.curves;l<p.length;l++)for(var _=p[l],v=_&&_.isEllipseCurve?2*e:_&&(_.isLineCurve||_.isLineCurve3)?1:_&&_.isSplineCurve?e*_.points.length:e,A=_.getPoints(v),E=0;E<A.length;E++){var L=A[E];n&&n.equals(L)||(s.push(L),n=L)}return this.autoClose&&s.length>1&&!s[s.length-1].equals(s[0])&&s.push(s[0]),s},t.copy=function(e){a.prototype.copy.call(this,e),this.curves=[];for(var n=0,s=e.curves.length;n<s;n++){var l=e.curves[n];this.curves.push(l.clone())}return this.autoClose=e.autoClose,this},t.toJSON=function(){var e=a.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var n=0,s=this.curves.length;n<s;n++){var l=this.curves[n];e.curves.push(l.toJSON())}return e},t.fromJSON=function(e){a.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var n=0,s=e.curves.length;n<s;n++){var l=e.curves[n];this.curves.push(new wl[l.type]().fromJSON(l))}return this},i}(Ni),$s=function(a){function i(e){var n;return(n=a.call(this)||this).type="Path",n.currentPoint=new Ve,e&&n.setFromPoints(e),n}Be(i,a);var t=i.prototype;return t.setFromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var n=1,s=e.length;n<s;n++)this.lineTo(e[n].x,e[n].y);return this},t.moveTo=function(e,n){return this.currentPoint.set(e,n),this},t.lineTo=function(e,n){var s=new Js(this.currentPoint.clone(),new Ve(e,n));return this.curves.push(s),this.currentPoint.set(e,n),this},t.quadraticCurveTo=function(e,n,s,l){var p=new _o(this.currentPoint.clone(),new Ve(e,n),new Ve(s,l));return this.curves.push(p),this.currentPoint.set(s,l),this},t.bezierCurveTo=function(e,n,s,l,p,_){var v=new mo(this.currentPoint.clone(),new Ve(e,n),new Ve(s,l),new Ve(p,_));return this.curves.push(v),this.currentPoint.set(p,_),this},t.splineThru=function(e){var n=[this.currentPoint.clone()].concat(e),s=new go(n);return this.curves.push(s),this.currentPoint.copy(e[e.length-1]),this},t.arc=function(e,n,s,l,p,_){var v=this.currentPoint.x,A=this.currentPoint.y;return this.absarc(e+v,n+A,s,l,p,_),this},t.absarc=function(e,n,s,l,p,_){return this.absellipse(e,n,s,s,l,p,_),this},t.ellipse=function(e,n,s,l,p,_,v,A){var E=this.currentPoint.x,L=this.currentPoint.y;return this.absellipse(e+E,n+L,s,l,p,_,v,A),this},t.absellipse=function(e,n,s,l,p,_,v,A){var E=new qs(e,n,s,l,p,_,v,A);if(this.curves.length>0){var L=E.getPoint(0);L.equals(this.currentPoint)||this.lineTo(L.x,L.y)}this.curves.push(E);var D=E.getPoint(1);return this.currentPoint.copy(D),this},t.copy=function(e){return a.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},t.toJSON=function(){var e=a.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},t.fromJSON=function(e){return a.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this},i}(tc),ur=function(a){function i(e){var n;return(n=a.call(this,e)||this).uuid=dt.generateUUID(),n.type="Shape",n.holes=[],n}Be(i,a);var t=i.prototype;return t.getPointsHoles=function(e){for(var n=[],s=0,l=this.holes.length;s<l;s++)n[s]=this.holes[s].getPoints(e);return n},t.extractPoints=function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},t.copy=function(e){a.prototype.copy.call(this,e),this.holes=[];for(var n=0,s=e.holes.length;n<s;n++){var l=e.holes[n];this.holes.push(l.clone())}return this},t.toJSON=function(){var e=a.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var n=0,s=this.holes.length;n<s;n++){var l=this.holes[n];e.holes.push(l.toJSON())}return e},t.fromJSON=function(e){a.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var n=0,s=e.holes.length;n<s;n++){var l=e.holes[n];this.holes.push(new $s().fromJSON(l))}return this},i}($s),xn=function(a){function i(e,n){var s;return n===void 0&&(n=1),(s=a.call(this)||this).type="Light",s.color=new nt(e),s.intensity=n,s}Be(i,a);var t=i.prototype;return t.copy=function(e){return a.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},t.toJSON=function(e){var n=a.prototype.toJSON.call(this,e);return n.object.color=this.color.getHex(),n.object.intensity=this.intensity,this.groundColor!==void 0&&(n.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(n.object.distance=this.distance),this.angle!==void 0&&(n.object.angle=this.angle),this.decay!==void 0&&(n.object.decay=this.decay),this.penumbra!==void 0&&(n.object.penumbra=this.penumbra),this.shadow!==void 0&&(n.object.shadow=this.shadow.toJSON()),n},i}(Ge);xn.prototype.isLight=!0;var El=function(a){function i(t,e,n){var s;return(s=a.call(this,t,n)||this).type="HemisphereLight",s.position.copy(Ge.DefaultUp),s.updateMatrix(),s.groundColor=new nt(e),s}return Be(i,a),i.prototype.copy=function(t){return xn.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this},i}(xn);El.prototype.isHemisphereLight=!0;var ic=new ht,nc=new te,rc=new te,Al=function(){function a(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Ve(512,512),this.map=null,this.mapPass=null,this.matrix=new ht,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Ms,this._frameExtents=new Ve(1,1),this._viewportCount=1,this._viewports=[new Ft(0,0,1,1)]}var i=a.prototype;return i.getViewportCount=function(){return this._viewportCount},i.getFrustum=function(){return this._frustum},i.updateMatrices=function(t){var e=this.camera,n=this.matrix;nc.setFromMatrixPosition(t.matrixWorld),e.position.copy(nc),rc.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(rc),e.updateMatrixWorld(),ic.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ic),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionMatrix),n.multiply(e.matrixWorldInverse)},i.getViewport=function(t){return this._viewports[t]},i.getFrameExtents=function(){return this._frameExtents},i.copy=function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},i.clone=function(){return new this.constructor().copy(this)},i.toJSON=function(){var t={};return this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),this.mapSize.x===512&&this.mapSize.y===512||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t},a}(),sc=function(a){function i(){var t;return(t=a.call(this,new di(50,1,.5,500))||this).focus=1,t}return Be(i,a),i.prototype.updateMatrices=function(t){var e=this.camera,n=2*dt.RAD2DEG*t.angle*this.focus,s=this.mapSize.width/this.mapSize.height,l=t.distance||e.far;n===e.fov&&s===e.aspect&&l===e.far||(e.fov=n,e.aspect=s,e.far=l,e.updateProjectionMatrix()),a.prototype.updateMatrices.call(this,t)},i}(Al);sc.prototype.isSpotLightShadow=!0;var Tl=function(a){function i(t,e,n,s,l,p){var _;return n===void 0&&(n=0),s===void 0&&(s=Math.PI/3),l===void 0&&(l=0),p===void 0&&(p=1),(_=a.call(this,t,e)||this).type="SpotLight",_.position.copy(Ge.DefaultUp),_.updateMatrix(),_.target=new Ge,_.distance=n,_.angle=s,_.penumbra=l,_.decay=p,_.shadow=new sc,_}return Be(i,a),i.prototype.copy=function(t){return a.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this},gi(i,[{key:"power",get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}]),i}(xn);Tl.prototype.isSpotLight=!0;var ac=new ht,ea=new te,Ml=new te,oc=function(a){function i(){var t;return(t=a.call(this,new di(90,1,.5,500))||this)._frameExtents=new Ve(4,2),t._viewportCount=6,t._viewports=[new Ft(2,1,1,1),new Ft(0,1,1,1),new Ft(3,1,1,1),new Ft(1,1,1,1),new Ft(3,0,1,1),new Ft(1,0,1,1)],t._cubeDirections=[new te(1,0,0),new te(-1,0,0),new te(0,0,1),new te(0,0,-1),new te(0,1,0),new te(0,-1,0)],t._cubeUps=[new te(0,1,0),new te(0,1,0),new te(0,1,0),new te(0,1,0),new te(0,0,1),new te(0,0,-1)],t}return Be(i,a),i.prototype.updateMatrices=function(t,e){e===void 0&&(e=0);var n=this.camera,s=this.matrix;ea.setFromMatrixPosition(t.matrixWorld),n.position.copy(ea),Ml.copy(n.position),Ml.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(Ml),n.updateMatrixWorld(),s.makeTranslation(-ea.x,-ea.y,-ea.z),ac.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ac)},i}(Al);oc.prototype.isPointLightShadow=!0;var Cl=function(a){function i(t,e,n,s){var l;return n===void 0&&(n=0),s===void 0&&(s=1),(l=a.call(this,t,e)||this).type="PointLight",l.distance=n,l.decay=s,l.shadow=new oc,l}return Be(i,a),i.prototype.copy=function(t){return a.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this},gi(i,[{key:"power",get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}]),i}(xn);Cl.prototype.isPointLight=!0;var ta=function(a){function i(e,n,s,l,p,_){var v;return e===void 0&&(e=-1),n===void 0&&(n=1),s===void 0&&(s=1),l===void 0&&(l=-1),p===void 0&&(p=.1),_===void 0&&(_=2e3),(v=a.call(this)||this).type="OrthographicCamera",v.zoom=1,v.view=null,v.left=e,v.right=n,v.top=s,v.bottom=l,v.near=p,v.far=_,v.updateProjectionMatrix(),v}Be(i,a);var t=i.prototype;return t.copy=function(e,n){return a.prototype.copy.call(this,e,n),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this},t.setViewOffset=function(e,n,s,l,p,_){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=s,this.view.offsetY=l,this.view.width=p,this.view.height=_,this.updateProjectionMatrix()},t.clearViewOffset=function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},t.updateProjectionMatrix=function(){var e=(this.right-this.left)/(2*this.zoom),n=(this.top-this.bottom)/(2*this.zoom),s=(this.right+this.left)/2,l=(this.top+this.bottom)/2,p=s-e,_=s+e,v=l+n,A=l-n;if(this.view!==null&&this.view.enabled){var E=(this.right-this.left)/this.view.fullWidth/this.zoom,L=(this.top-this.bottom)/this.view.fullHeight/this.zoom;_=(p+=E*this.view.offsetX)+E*this.view.width,A=(v-=L*this.view.offsetY)-L*this.view.height}this.projectionMatrix.makeOrthographic(p,_,v,A,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},t.toJSON=function(e){var n=Ge.prototype.toJSON.call(this,e);return n.object.zoom=this.zoom,n.object.left=this.left,n.object.right=this.right,n.object.top=this.top,n.object.bottom=this.bottom,n.object.near=this.near,n.object.far=this.far,this.view!==null&&(n.object.view=Object.assign({},this.view)),n},i}(sr);ta.prototype.isOrthographicCamera=!0;var lc=function(a){function i(){return a.call(this,new ta(-5,5,5,-5,.5,500))||this}return Be(i,a),i}(Al);lc.prototype.isDirectionalLightShadow=!0;var Ll=function(a){function i(t,e){var n;return(n=a.call(this,t,e)||this).type="DirectionalLight",n.position.copy(Ge.DefaultUp),n.updateMatrix(),n.target=new Ge,n.shadow=new lc,n}return Be(i,a),i.prototype.copy=function(t){return a.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this},i}(xn);Ll.prototype.isDirectionalLight=!0;var Pl=function(a){function i(t,e){var n;return(n=a.call(this,t,e)||this).type="AmbientLight",n}return Be(i,a),i}(xn);Pl.prototype.isAmbientLight=!0;var Dl=function(a){function i(e,n,s,l){var p;return s===void 0&&(s=10),l===void 0&&(l=10),(p=a.call(this,e,n)||this).type="RectAreaLight",p.width=s,p.height=l,p}Be(i,a);var t=i.prototype;return t.copy=function(e){return a.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},t.toJSON=function(e){var n=a.prototype.toJSON.call(this,e);return n.object.width=this.width,n.object.height=this.height,n},i}(xn);Dl.prototype.isRectAreaLight=!0;var Rl=function(){function a(){this.coefficients=[];for(var t=0;t<9;t++)this.coefficients.push(new te)}var i=a.prototype;return i.set=function(t){for(var e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this},i.zero=function(){for(var t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this},i.getAt=function(t,e){var n=t.x,s=t.y,l=t.z,p=this.coefficients;return e.copy(p[0]).multiplyScalar(.282095),e.addScaledVector(p[1],.488603*s),e.addScaledVector(p[2],.488603*l),e.addScaledVector(p[3],.488603*n),e.addScaledVector(p[4],n*s*1.092548),e.addScaledVector(p[5],s*l*1.092548),e.addScaledVector(p[6],.315392*(3*l*l-1)),e.addScaledVector(p[7],n*l*1.092548),e.addScaledVector(p[8],.546274*(n*n-s*s)),e},i.getIrradianceAt=function(t,e){var n=t.x,s=t.y,l=t.z,p=this.coefficients;return e.copy(p[0]).multiplyScalar(.886227),e.addScaledVector(p[1],1.023328*s),e.addScaledVector(p[2],1.023328*l),e.addScaledVector(p[3],1.023328*n),e.addScaledVector(p[4],.858086*n*s),e.addScaledVector(p[5],.858086*s*l),e.addScaledVector(p[6],.743125*l*l-.247708),e.addScaledVector(p[7],.858086*n*l),e.addScaledVector(p[8],.429043*(n*n-s*s)),e},i.add=function(t){for(var e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this},i.addScaledSH=function(t,e){for(var n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this},i.scale=function(t){for(var e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this},i.lerp=function(t,e){for(var n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this},i.equals=function(t){for(var e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0},i.copy=function(t){return this.set(t.coefficients)},i.clone=function(){return new this.constructor().copy(this)},i.fromArray=function(t,e){e===void 0&&(e=0);for(var n=this.coefficients,s=0;s<9;s++)n[s].fromArray(t,e+3*s);return this},i.toArray=function(t,e){t===void 0&&(t=[]),e===void 0&&(e=0);for(var n=this.coefficients,s=0;s<9;s++)n[s].toArray(t,e+3*s);return t},a.getBasisAt=function(t,e){var n=t.x,s=t.y,l=t.z;e[0]=.282095,e[1]=.488603*s,e[2]=.488603*l,e[3]=.488603*n,e[4]=1.092548*n*s,e[5]=1.092548*s*l,e[6]=.315392*(3*l*l-1),e[7]=1.092548*n*l,e[8]=.546274*(n*n-s*s)},a}();Rl.prototype.isSphericalHarmonics3=!0;var ia=function(a){function i(e,n){var s;return e===void 0&&(e=new Rl),n===void 0&&(n=1),(s=a.call(this,void 0,n)||this).sh=e,s}Be(i,a);var t=i.prototype;return t.copy=function(e){return a.prototype.copy.call(this,e),this.sh.copy(e.sh),this},t.fromJSON=function(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this},t.toJSON=function(e){var n=a.prototype.toJSON.call(this,e);return n.object.sh=this.sh.toArray(),n},i}(xn);ia.prototype.isLightProbe=!0;var hc=function(a){function i(e){var n;return(n=a.call(this,e)||this).textures={},n}Be(i,a);var t=i.prototype;return t.load=function(e,n,s,l){var p=this,_=new cn(p.manager);_.setPath(p.path),_.setRequestHeader(p.requestHeader),_.setWithCredentials(p.withCredentials),_.load(e,function(v){try{n(p.parse(JSON.parse(v)))}catch(A){l?l(A):console.error(A),p.manager.itemError(e)}},s,l)},t.parse=function(e){var n=this.textures;function s(E){return n[E]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",E),n[E]}var l=new Fd[e.type];if(e.uuid!==void 0&&(l.uuid=e.uuid),e.name!==void 0&&(l.name=e.name),e.color!==void 0&&l.color!==void 0&&l.color.setHex(e.color),e.roughness!==void 0&&(l.roughness=e.roughness),e.metalness!==void 0&&(l.metalness=e.metalness),e.sheen!==void 0&&(l.sheen=new nt().setHex(e.sheen)),e.emissive!==void 0&&l.emissive!==void 0&&l.emissive.setHex(e.emissive),e.specular!==void 0&&l.specular!==void 0&&l.specular.setHex(e.specular),e.shininess!==void 0&&(l.shininess=e.shininess),e.clearcoat!==void 0&&(l.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(l.clearcoatRoughness=e.clearcoatRoughness),e.fog!==void 0&&(l.fog=e.fog),e.flatShading!==void 0&&(l.flatShading=e.flatShading),e.blending!==void 0&&(l.blending=e.blending),e.combine!==void 0&&(l.combine=e.combine),e.side!==void 0&&(l.side=e.side),e.opacity!==void 0&&(l.opacity=e.opacity),e.transparent!==void 0&&(l.transparent=e.transparent),e.alphaTest!==void 0&&(l.alphaTest=e.alphaTest),e.depthTest!==void 0&&(l.depthTest=e.depthTest),e.depthWrite!==void 0&&(l.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(l.colorWrite=e.colorWrite),e.stencilWrite!==void 0&&(l.stencilWrite=e.stencilWrite),e.stencilWriteMask!==void 0&&(l.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(l.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(l.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(l.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(l.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(l.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(l.stencilZPass=e.stencilZPass),e.wireframe!==void 0&&(l.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(l.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(l.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(l.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(l.rotation=e.rotation),e.linewidth!==1&&(l.linewidth=e.linewidth),e.dashSize!==void 0&&(l.dashSize=e.dashSize),e.gapSize!==void 0&&(l.gapSize=e.gapSize),e.scale!==void 0&&(l.scale=e.scale),e.polygonOffset!==void 0&&(l.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(l.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(l.polygonOffsetUnits=e.polygonOffsetUnits),e.skinning!==void 0&&(l.skinning=e.skinning),e.morphTargets!==void 0&&(l.morphTargets=e.morphTargets),e.morphNormals!==void 0&&(l.morphNormals=e.morphNormals),e.dithering!==void 0&&(l.dithering=e.dithering),e.vertexTangents!==void 0&&(l.vertexTangents=e.vertexTangents),e.visible!==void 0&&(l.visible=e.visible),e.toneMapped!==void 0&&(l.toneMapped=e.toneMapped),e.userData!==void 0&&(l.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?l.vertexColors=e.vertexColors>0:l.vertexColors=e.vertexColors),e.uniforms!==void 0)for(var p in e.uniforms){var _=e.uniforms[p];switch(l.uniforms[p]={},_.type){case"t":l.uniforms[p].value=s(_.value);break;case"c":l.uniforms[p].value=new nt().setHex(_.value);break;case"v2":l.uniforms[p].value=new Ve().fromArray(_.value);break;case"v3":l.uniforms[p].value=new te().fromArray(_.value);break;case"v4":l.uniforms[p].value=new Ft().fromArray(_.value);break;case"m3":l.uniforms[p].value=new Vt().fromArray(_.value);break;case"m4":l.uniforms[p].value=new ht().fromArray(_.value);break;default:l.uniforms[p].value=_.value}}if(e.defines!==void 0&&(l.defines=e.defines),e.vertexShader!==void 0&&(l.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(l.fragmentShader=e.fragmentShader),e.extensions!==void 0)for(var v in e.extensions)l.extensions[v]=e.extensions[v];if(e.shading!==void 0&&(l.flatShading=e.shading===1),e.size!==void 0&&(l.size=e.size),e.sizeAttenuation!==void 0&&(l.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(l.map=s(e.map)),e.matcap!==void 0&&(l.matcap=s(e.matcap)),e.alphaMap!==void 0&&(l.alphaMap=s(e.alphaMap)),e.bumpMap!==void 0&&(l.bumpMap=s(e.bumpMap)),e.bumpScale!==void 0&&(l.bumpScale=e.bumpScale),e.normalMap!==void 0&&(l.normalMap=s(e.normalMap)),e.normalMapType!==void 0&&(l.normalMapType=e.normalMapType),e.normalScale!==void 0){var A=e.normalScale;Array.isArray(A)===!1&&(A=[A,A]),l.normalScale=new Ve().fromArray(A)}return e.displacementMap!==void 0&&(l.displacementMap=s(e.displacementMap)),e.displacementScale!==void 0&&(l.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(l.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(l.roughnessMap=s(e.roughnessMap)),e.metalnessMap!==void 0&&(l.metalnessMap=s(e.metalnessMap)),e.emissiveMap!==void 0&&(l.emissiveMap=s(e.emissiveMap)),e.emissiveIntensity!==void 0&&(l.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(l.specularMap=s(e.specularMap)),e.envMap!==void 0&&(l.envMap=s(e.envMap)),e.envMapIntensity!==void 0&&(l.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(l.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(l.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(l.lightMap=s(e.lightMap)),e.lightMapIntensity!==void 0&&(l.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(l.aoMap=s(e.aoMap)),e.aoMapIntensity!==void 0&&(l.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(l.gradientMap=s(e.gradientMap)),e.clearcoatMap!==void 0&&(l.clearcoatMap=s(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(l.clearcoatRoughnessMap=s(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(l.clearcoatNormalMap=s(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(l.clearcoatNormalScale=new Ve().fromArray(e.clearcoatNormalScale)),e.transmission!==void 0&&(l.transmission=e.transmission),e.transmissionMap!==void 0&&(l.transmissionMap=s(e.transmissionMap)),l},t.setTextures=function(e){return this.textures=e,this},i}(ri),Ol={decodeText:function(i){if(typeof TextDecoder<"u")return new TextDecoder().decode(i);for(var t="",e=0,n=i.length;e<n;e++)t+=String.fromCharCode(i[e]);try{return decodeURIComponent(escape(t))}catch(s){return t}},extractUrlBase:function(i){var t=i.lastIndexOf("/");return t===-1?"./":i.substr(0,t+1)}};function na(){ct.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function vo(a,i,t,e){typeof t=="number"&&(e=t,t=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),ft.call(this,a,i,t),this.meshPerAttribute=e||1}na.prototype=Object.assign(Object.create(ct.prototype),{constructor:na,isInstancedBufferGeometry:!0,copy:function(i){return ct.prototype.copy.call(this,i),this.instanceCount=i.instanceCount,this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){var i=ct.prototype.toJSON.call(this);return i.instanceCount=this.instanceCount,i.isInstancedBufferGeometry=!0,i}}),vo.prototype=Object.assign(Object.create(ft.prototype),{constructor:vo,isInstancedBufferAttribute:!0,copy:function(i){return ft.prototype.copy.call(this,i),this.meshPerAttribute=i.meshPerAttribute,this},toJSON:function(){var i=ft.prototype.toJSON.call(this);return i.meshPerAttribute=this.meshPerAttribute,i.isInstancedBufferAttribute=!0,i}});var cc=function(a){function i(e){return a.call(this,e)||this}Be(i,a);var t=i.prototype;return t.load=function(e,n,s,l){var p=this,_=new cn(p.manager);_.setPath(p.path),_.setRequestHeader(p.requestHeader),_.setWithCredentials(p.withCredentials),_.load(e,function(v){try{n(p.parse(JSON.parse(v)))}catch(A){l?l(A):console.error(A),p.manager.itemError(e)}},s,l)},t.parse=function(e){var n={},s={};function l(Re,Le){if(n[Le]!==void 0)return n[Le];var le=Re.interleavedBuffers[Le],_e=function(be,ge){if(s[ge]!==void 0)return s[ge];var Te=be.arrayBuffers[ge],Fe=new Uint32Array(Te).buffer;return s[ge]=Fe,Fe}(Re,le.buffer),Ae=new ki(As(le.type,_e),le.stride);return Ae.uuid=le.uuid,n[Le]=Ae,Ae}var p=e.isInstancedBufferGeometry?new na:new ct,_=e.data.index;if(_!==void 0){var v=As(_.type,_.array);p.setIndex(new ft(v,1))}var A=e.data.attributes;for(var E in A){var L=A[E],D=void 0;if(L.isInterleavedBufferAttribute)D=new or(l(e.data,L.data),L.itemSize,L.offset,L.normalized);else{var B=As(L.type,L.array);D=new(L.isInstancedBufferAttribute?vo:ft)(B,L.itemSize,L.normalized)}L.name!==void 0&&(D.name=L.name),p.setAttribute(E,D)}var U=e.data.morphAttributes;if(U)for(var V in U){for(var j=U[V],K=[],ee=0,J=j.length;ee<J;ee++){var $=j[ee],se=void 0;$.isInterleavedBufferAttribute?se=new or(l(e.data,$.data),$.itemSize,$.offset,$.normalized):se=new ft(As($.type,$.array),$.itemSize,$.normalized),$.name!==void 0&&(se.name=$.name),K.push(se)}p.morphAttributes[V]=K}e.data.morphTargetsRelative&&(p.morphTargetsRelative=!0);var re=e.data.groups||e.data.drawcalls||e.data.offsets;if(re!==void 0)for(var ie=0,pe=re.length;ie!==pe;++ie){var de=re[ie];p.addGroup(de.start,de.count,de.materialIndex)}var ye=e.data.boundingSphere;if(ye!==void 0){var Ee=new te;ye.center!==void 0&&Ee.fromArray(ye.center),p.boundingSphere=new mn(Ee,ye.radius)}return e.name&&(p.name=e.name),e.userData&&(p.userData=e.userData),p},i}(ri),kd=function(a){function i(e){return a.call(this,e)||this}Be(i,a);var t=i.prototype;return t.load=function(e,n,s,l){var p=this,_=this.path===""?Ol.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||_;var v=new cn(this.manager);v.setPath(this.path),v.setRequestHeader(this.requestHeader),v.setWithCredentials(this.withCredentials),v.load(e,function(A){var E=null;try{E=JSON.parse(A)}catch(D){return l!==void 0&&l(D),void console.error("THREE:ObjectLoader: Can't parse "+e+".",D.message)}var L=E.metadata;L!==void 0&&L.type!==void 0&&L.type.toLowerCase()!=="geometry"?p.parse(E,n):console.error("THREE.ObjectLoader: Can't load "+e)},s,l)},t.parse=function(e,n){var s=this.parseAnimations(e.animations),l=this.parseShapes(e.shapes),p=this.parseGeometries(e.geometries,l),_=this.parseImages(e.images,function(){n!==void 0&&n(E)}),v=this.parseTextures(e.textures,_),A=this.parseMaterials(e.materials,v),E=this.parseObject(e.object,p,A,s),L=this.parseSkeletons(e.skeletons,E);if(this.bindSkeletons(E,L),n!==void 0){var D=!1;for(var B in _)if(_[B]instanceof HTMLImageElement){D=!0;break}D===!1&&n(E)}return E},t.parseShapes=function(e){var n={};if(e!==void 0)for(var s=0,l=e.length;s<l;s++){var p=new ur().fromJSON(e[s]);n[p.uuid]=p}return n},t.parseSkeletons=function(e,n){var s={},l={};if(n.traverse(function(A){A.isBone&&(l[A.uuid]=A)}),e!==void 0)for(var p=0,_=e.length;p<_;p++){var v=new Zo().fromJSON(e[p],l);s[v.uuid]=v}return s},t.parseGeometries=function(e,n){var s,l={};if(e!==void 0)for(var p=new cc,_=0,v=e.length;_<v;_++){var A=void 0,E=e[_];switch(E.type){case"PlaneGeometry":case"PlaneBufferGeometry":A=new Bi[E.type](E.width,E.height,E.widthSegments,E.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":A=new Bi[E.type](E.width,E.height,E.depth,E.widthSegments,E.heightSegments,E.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":A=new Bi[E.type](E.radius,E.segments,E.thetaStart,E.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":A=new Bi[E.type](E.radiusTop,E.radiusBottom,E.height,E.radialSegments,E.heightSegments,E.openEnded,E.thetaStart,E.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":A=new Bi[E.type](E.radius,E.height,E.radialSegments,E.heightSegments,E.openEnded,E.thetaStart,E.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":A=new Bi[E.type](E.radius,E.widthSegments,E.heightSegments,E.phiStart,E.phiLength,E.thetaStart,E.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":A=new Bi[E.type](E.radius,E.detail);break;case"RingGeometry":case"RingBufferGeometry":A=new Bi[E.type](E.innerRadius,E.outerRadius,E.thetaSegments,E.phiSegments,E.thetaStart,E.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":A=new Bi[E.type](E.radius,E.tube,E.radialSegments,E.tubularSegments,E.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":A=new Bi[E.type](E.radius,E.tube,E.tubularSegments,E.radialSegments,E.p,E.q);break;case"TubeGeometry":case"TubeBufferGeometry":A=new Bi[E.type](new wl[E.path.type]().fromJSON(E.path),E.tubularSegments,E.radius,E.radialSegments,E.closed);break;case"LatheGeometry":case"LatheBufferGeometry":A=new Bi[E.type](E.points,E.segments,E.phiStart,E.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":A=new Bi[E.type](E.vertices,E.indices,E.radius,E.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":s=[];for(var L=0,D=E.shapes.length;L<D;L++){var B=n[E.shapes[L]];s.push(B)}A=new Bi[E.type](s,E.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":s=[];for(var U=0,V=E.shapes.length;U<V;U++){var j=n[E.shapes[U]];s.push(j)}var K=E.options.extrudePath;K!==void 0&&(E.options.extrudePath=new wl[K.type]().fromJSON(K)),A=new Bi[E.type](s,E.options);break;case"BufferGeometry":case"InstancedBufferGeometry":A=p.parse(E);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+E.type+'"');continue}A.uuid=E.uuid,E.name!==void 0&&(A.name=E.name),A.isBufferGeometry===!0&&E.userData!==void 0&&(A.userData=E.userData),l[E.uuid]=A}return l},t.parseMaterials=function(e,n){var s={},l={};if(e!==void 0){var p=new hc;p.setTextures(n);for(var _=0,v=e.length;_<v;_++){var A=e[_];if(A.type==="MultiMaterial"){for(var E=[],L=0;L<A.materials.length;L++){var D=A.materials[L];s[D.uuid]===void 0&&(s[D.uuid]=p.parse(D)),E.push(s[D.uuid])}l[A.uuid]=E}else s[A.uuid]===void 0&&(s[A.uuid]=p.parse(A)),l[A.uuid]=s[A.uuid]}}return l},t.parseAnimations=function(e){var n={};if(e!==void 0)for(var s=0;s<e.length;s++){var l=e[s],p=Xs.parse(l);n[p.uuid]=p}return n},t.parseImages=function(e,n){var s,l=this,p={};function _(K){if(typeof K=="string"){var ee=K;return function(J){return l.manager.itemStart(J),s.load(J,function(){l.manager.itemEnd(J)},void 0,function(){l.manager.itemError(J),l.manager.itemEnd(J)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(ee)?ee:l.resourcePath+ee)}return K.data?{data:As(K.type,K.data),width:K.width,height:K.height}:null}if(e!==void 0&&e.length>0){var v=new pl(n);(s=new co(v)).setCrossOrigin(this.crossOrigin);for(var A=0,E=e.length;A<E;A++){var L=e[A],D=L.url;if(Array.isArray(D)){p[L.uuid]=[];for(var B=0,U=D.length;B<U;B++){var V=_(D[B]);V!==null&&(V instanceof HTMLImageElement?p[L.uuid].push(V):p[L.uuid].push(new Qr(V.data,V.width,V.height)))}}else{var j=_(L.url);j!==null&&(p[L.uuid]=j)}}}return p},t.parseTextures=function(e,n){function s(L,D){return typeof L=="number"?L:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",L),D[L])}var l={};if(e!==void 0)for(var p=0,_=e.length;p<_;p++){var v=e[p];v.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',v.uuid),n[v.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",v.image);var A=void 0,E=n[v.image];Array.isArray(E)?(A=new Zr(E),E.length===6&&(A.needsUpdate=!0)):(A=E&&E.data?new Qr(E.data,E.width,E.height):new ui(E),E&&(A.needsUpdate=!0)),A.uuid=v.uuid,v.name!==void 0&&(A.name=v.name),v.mapping!==void 0&&(A.mapping=s(v.mapping,jd)),v.offset!==void 0&&A.offset.fromArray(v.offset),v.repeat!==void 0&&A.repeat.fromArray(v.repeat),v.center!==void 0&&A.center.fromArray(v.center),v.rotation!==void 0&&(A.rotation=v.rotation),v.wrap!==void 0&&(A.wrapS=s(v.wrap[0],uc),A.wrapT=s(v.wrap[1],uc)),v.format!==void 0&&(A.format=v.format),v.type!==void 0&&(A.type=v.type),v.encoding!==void 0&&(A.encoding=v.encoding),v.minFilter!==void 0&&(A.minFilter=s(v.minFilter,dc)),v.magFilter!==void 0&&(A.magFilter=s(v.magFilter,dc)),v.anisotropy!==void 0&&(A.anisotropy=v.anisotropy),v.flipY!==void 0&&(A.flipY=v.flipY),v.premultiplyAlpha!==void 0&&(A.premultiplyAlpha=v.premultiplyAlpha),v.unpackAlignment!==void 0&&(A.unpackAlignment=v.unpackAlignment),l[v.uuid]=A}return l},t.parseObject=function(e,n,s,l){var p,_,v;function A(re){return n[re]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",re),n[re]}function E(re){if(re!==void 0){if(Array.isArray(re)){for(var ie=[],pe=0,de=re.length;pe<de;pe++){var ye=re[pe];s[ye]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",ye),ie.push(s[ye])}return ie}return s[re]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",re),s[re]}}switch(e.type){case"Scene":p=new Ra,e.background!==void 0&&Number.isInteger(e.background)&&(p.background=new nt(e.background)),e.fog!==void 0&&(e.fog.type==="Fog"?p.fog=new Yo(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(p.fog=new Ko(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":p=new di(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(p.focus=e.focus),e.zoom!==void 0&&(p.zoom=e.zoom),e.filmGauge!==void 0&&(p.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(p.filmOffset=e.filmOffset),e.view!==void 0&&(p.view=Object.assign({},e.view));break;case"OrthographicCamera":p=new ta(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(p.zoom=e.zoom),e.view!==void 0&&(p.view=Object.assign({},e.view));break;case"AmbientLight":p=new Pl(e.color,e.intensity);break;case"DirectionalLight":p=new Ll(e.color,e.intensity);break;case"PointLight":p=new Cl(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":p=new Dl(e.color,e.intensity,e.width,e.height);break;case"SpotLight":p=new Tl(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":p=new El(e.color,e.groundColor,e.intensity);break;case"LightProbe":p=new ia().fromJSON(e);break;case"SkinnedMesh":p=new Bs(_=A(e.geometry),v=E(e.material)),e.bindMode!==void 0&&(p.bindMode=e.bindMode),e.bindMatrix!==void 0&&p.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(p.skeleton=e.skeleton);break;case"Mesh":p=new Jt(_=A(e.geometry),v=E(e.material));break;case"InstancedMesh":_=A(e.geometry),v=E(e.material);var L=e.count,D=e.instanceMatrix;(p=new ka(_,v,L)).instanceMatrix=new ft(new Float32Array(D.array),16);break;case"LOD":p=new qo;break;case"Line":p=new vn(A(e.geometry),E(e.material));break;case"LineLoop":p=new Jo(A(e.geometry),E(e.material));break;case"LineSegments":p=new Ii(A(e.geometry),E(e.material));break;case"PointCloud":case"Points":p=new rs(A(e.geometry),E(e.material));break;case"Sprite":p=new Na(E(e.material));break;case"Group":p=new Er;break;case"Bone":p=new Ns;break;default:p=new Ge}if(p.uuid=e.uuid,e.name!==void 0&&(p.name=e.name),e.matrix!==void 0?(p.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(p.matrixAutoUpdate=e.matrixAutoUpdate),p.matrixAutoUpdate&&p.matrix.decompose(p.position,p.quaternion,p.scale)):(e.position!==void 0&&p.position.fromArray(e.position),e.rotation!==void 0&&p.rotation.fromArray(e.rotation),e.quaternion!==void 0&&p.quaternion.fromArray(e.quaternion),e.scale!==void 0&&p.scale.fromArray(e.scale)),e.castShadow!==void 0&&(p.castShadow=e.castShadow),e.receiveShadow!==void 0&&(p.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(p.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(p.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(p.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&p.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(p.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(p.visible=e.visible),e.frustumCulled!==void 0&&(p.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(p.renderOrder=e.renderOrder),e.userData!==void 0&&(p.userData=e.userData),e.layers!==void 0&&(p.layers.mask=e.layers),e.children!==void 0)for(var B=e.children,U=0;U<B.length;U++)p.add(this.parseObject(B[U],n,s,l));if(e.animations!==void 0)for(var V=e.animations,j=0;j<V.length;j++){var K=V[j];p.animations.push(l[K])}if(e.type==="LOD"){e.autoUpdate!==void 0&&(p.autoUpdate=e.autoUpdate);for(var ee=e.levels,J=0;J<ee.length;J++){var $=ee[J],se=p.getObjectByProperty("uuid",$.object);se!==void 0&&p.addLevel(se,$.distance)}}return p},t.bindSkeletons=function(e,n){Object.keys(n).length!==0&&e.traverse(function(s){if(s.isSkinnedMesh===!0&&s.skeleton!==void 0){var l=n[s.skeleton];l===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",s.skeleton):s.bind(l,s.bindMatrix)}})},t.setTexturePath=function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)},i}(ri),jd={UVMapping:N,CubeReflectionMapping:b,CubeRefractionMapping:h,EquirectangularReflectionMapping:r,EquirectangularRefractionMapping:o,CubeUVReflectionMapping:c,CubeUVRefractionMapping:u},uc={RepeatWrapping:g,ClampToEdgeWrapping:m,MirroredRepeatWrapping:y},dc={NearestFilter:x,NearestMipmapNearestFilter:w,NearestMipmapLinearFilter:C,LinearFilter:P,LinearMipmapNearestFilter:T,LinearMipmapLinearFilter:M};function Il(a){typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),ri.call(this,a),this.options={premultiplyAlpha:"none"}}Il.prototype=Object.assign(Object.create(ri.prototype),{constructor:Il,isImageBitmapLoader:!0,setOptions:function(i){return this.options=i,this},load:function(i,t,e,n){i===void 0&&(i=""),this.path!==void 0&&(i=this.path+i),i=this.manager.resolveURL(i);var s=this,l=Pr.get(i);if(l!==void 0)return s.manager.itemStart(i),setTimeout(function(){t&&t(l),s.manager.itemEnd(i)},0),l;var p={};p.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",p.headers=this.requestHeader,fetch(i,p).then(function(_){return _.blob()}).then(function(_){return createImageBitmap(_,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(_){Pr.add(i,_),t&&t(_),s.manager.itemEnd(i)}).catch(function(_){n&&n(_),s.manager.itemError(i),s.manager.itemEnd(i)}),s.manager.itemStart(i)}});var pc=function(){function a(){this.type="ShapePath",this.color=new nt,this.subPaths=[],this.currentPath=null}var i=a.prototype;return i.moveTo=function(t,e){return this.currentPath=new $s,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this},i.lineTo=function(t,e){return this.currentPath.lineTo(t,e),this},i.quadraticCurveTo=function(t,e,n,s){return this.currentPath.quadraticCurveTo(t,e,n,s),this},i.bezierCurveTo=function(t,e,n,s,l,p){return this.currentPath.bezierCurveTo(t,e,n,s,l,p),this},i.splineThru=function(t){return this.currentPath.splineThru(t),this},i.toShapes=function(t,e){function n(Te){for(var Fe=[],tt=0,at=Te.length;tt<at;tt++){var oe=Te[tt],ue=new ur;ue.curves=oe.curves,Fe.push(ue)}return Fe}function s(Te,Fe){for(var tt=Fe.length,at=!1,oe=tt-1,ue=0;ue<tt;oe=ue++){var Oe=Fe[oe],Pe=Fe[ue],Ue=Pe.x-Oe.x,we=Pe.y-Oe.y;if(Math.abs(we)>Number.EPSILON){if(we<0&&(Oe=Fe[ue],Ue=-Ue,Pe=Fe[oe],we=-we),Te.y<Oe.y||Te.y>Pe.y)continue;if(Te.y===Oe.y){if(Te.x===Oe.x)return!0}else{var Se=we*(Te.x-Oe.x)-Ue*(Te.y-Oe.y);if(Se===0)return!0;if(Se<0)continue;at=!at}}else{if(Te.y!==Oe.y)continue;if(Pe.x<=Te.x&&Te.x<=Oe.x||Oe.x<=Te.x&&Te.x<=Pe.x)return!0}}return at}var l,p,_,v=Un.isClockWise,A=this.subPaths;if(A.length===0)return[];if(e===!0)return n(A);var E=[];if(A.length===1)return p=A[0],(_=new ur).curves=p.curves,E.push(_),E;var L=!v(A[0].getPoints());L=t?!L:L;var D,B,U=[],V=[],j=[],K=0;V[K]=void 0,j[K]=[];for(var ee=0,J=A.length;ee<J;ee++)l=v(D=(p=A[ee]).getPoints()),(l=t?!l:l)?(!L&&V[K]&&K++,V[K]={s:new ur,p:D},V[K].s.curves=p.curves,L&&K++,j[K]=[]):j[K].push({h:p,p:D[0]});if(!V[0])return n(A);if(V.length>1){for(var $=!1,se=[],re=0,ie=V.length;re<ie;re++)U[re]=[];for(var pe=0,de=V.length;pe<de;pe++)for(var ye=j[pe],Ee=0;Ee<ye.length;Ee++){for(var Re=ye[Ee],Le=!0,le=0;le<V.length;le++)s(Re.p,V[le].p)&&(pe!==le&&se.push({froms:pe,tos:le,hole:Ee}),Le?(Le=!1,U[le].push(Re)):$=!0);Le&&U[pe].push(Re)}se.length>0&&($||(j=U))}for(var _e=0,Ae=V.length;_e<Ae;_e++){_=V[_e].s,E.push(_);for(var be=0,ge=(B=j[_e]).length;be<ge;be++)_.holes.push(B[be].h)}return E},a}(),Bl=function(){function a(i){this.type="Font",this.data=i}return a.prototype.generateShapes=function(i,t){t===void 0&&(t=100);for(var e=[],n=function(p,_,v){for(var A=Array.from(p),E=_/v.resolution,L=(v.boundingBox.yMax-v.boundingBox.yMin+v.underlineThickness)*E,D=[],B=0,U=0,V=0;V<A.length;V++){var j=A[V];if(j===`
`)B=0,U-=L;else{var K=Wd(j,E,B,U,v);B+=K.offsetX,D.push(K.path)}}return D}(i,t,this.data),s=0,l=n.length;s<l;s++)Array.prototype.push.apply(e,n[s].toShapes());return e},a}();function Wd(a,i,t,e,n){var s=n.glyphs[a]||n.glyphs["?"];if(s){var l,p,_,v,A,E,L,D,B=new pc;if(s.o)for(var U=s._cachedOutline||(s._cachedOutline=s.o.split(" ")),V=0,j=U.length;V<j;)switch(U[V++]){case"m":l=U[V++]*i+t,p=U[V++]*i+e,B.moveTo(l,p);break;case"l":l=U[V++]*i+t,p=U[V++]*i+e,B.lineTo(l,p);break;case"q":_=U[V++]*i+t,v=U[V++]*i+e,A=U[V++]*i+t,E=U[V++]*i+e,B.quadraticCurveTo(A,E,_,v);break;case"b":_=U[V++]*i+t,v=U[V++]*i+e,A=U[V++]*i+t,E=U[V++]*i+e,L=U[V++]*i+t,D=U[V++]*i+e,B.bezierCurveTo(A,E,L,D,_,v)}return{offsetX:s.ha*i,path:B}}console.error('THREE.Font: character "'+a+'" does not exists in font family '+n.familyName+".")}Bl.prototype.isFont=!0;var yo,Vd=function(a){function i(e){return a.call(this,e)||this}Be(i,a);var t=i.prototype;return t.load=function(e,n,s,l){var p=this,_=new cn(this.manager);_.setPath(this.path),_.setRequestHeader(this.requestHeader),_.setWithCredentials(p.withCredentials),_.load(e,function(v){var A;try{A=JSON.parse(v)}catch(L){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),A=JSON.parse(v.substring(65,v.length-2))}var E=p.parse(A);n&&n(E)},s,l)},t.parse=function(e){return new Bl(e)},i}(ri),Nl={getContext:function(){return yo===void 0&&(yo=new(window.AudioContext||window.webkitAudioContext)),yo},setContext:function(i){yo=i}},fc=function(a){function i(t){return a.call(this,t)||this}return Be(i,a),i.prototype.load=function(t,e,n,s){var l=this,p=new cn(this.manager);p.setResponseType("arraybuffer"),p.setPath(this.path),p.setRequestHeader(this.requestHeader),p.setWithCredentials(this.withCredentials),p.load(t,function(_){try{var v=_.slice(0);Nl.getContext().decodeAudioData(v,function(A){e(A)})}catch(A){s?s(A):console.error(A),l.manager.itemError(t)}},n,s)},i}(ri),mc=function(a){function i(t,e,n){var s;n===void 0&&(n=1),s=a.call(this,void 0,n)||this;var l=new nt().set(t),p=new nt().set(e),_=new te(l.r,l.g,l.b),v=new te(p.r,p.g,p.b),A=Math.sqrt(Math.PI),E=A*Math.sqrt(.75);return s.sh.coefficients[0].copy(_).add(v).multiplyScalar(A),s.sh.coefficients[1].copy(_).sub(v).multiplyScalar(E),s}return Be(i,a),i}(ia);mc.prototype.isHemisphereLightProbe=!0;var _c=function(a){function i(t,e){var n;e===void 0&&(e=1),n=a.call(this,void 0,e)||this;var s=new nt().set(t);return n.sh.coefficients[0].set(s.r,s.g,s.b).multiplyScalar(2*Math.sqrt(Math.PI)),n}return Be(i,a),i}(ia);_c.prototype.isAmbientLightProbe=!0;var gc=new ht,vc=new ht,Gd=function(){function a(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new di,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new di,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}return a.prototype.update=function(i){var t=this._cache;if(t.focus!==i.focus||t.fov!==i.fov||t.aspect!==i.aspect*this.aspect||t.near!==i.near||t.far!==i.far||t.zoom!==i.zoom||t.eyeSep!==this.eyeSep){t.focus=i.focus,t.fov=i.fov,t.aspect=i.aspect*this.aspect,t.near=i.near,t.far=i.far,t.zoom=i.zoom,t.eyeSep=this.eyeSep;var e,n,s=i.projectionMatrix.clone(),l=t.eyeSep/2,p=l*t.near/t.focus,_=t.near*Math.tan(dt.DEG2RAD*t.fov*.5)/t.zoom;vc.elements[12]=-l,gc.elements[12]=l,e=-_*t.aspect+p,n=_*t.aspect+p,s.elements[0]=2*t.near/(n-e),s.elements[8]=(n+e)/(n-e),this.cameraL.projectionMatrix.copy(s),e=-_*t.aspect-p,n=_*t.aspect-p,s.elements[0]=2*t.near/(n-e),s.elements[8]=(n+e)/(n-e),this.cameraR.projectionMatrix.copy(s)}this.cameraL.matrixWorld.copy(i.matrixWorld).multiply(vc),this.cameraR.matrixWorld.copy(i.matrixWorld).multiply(gc)},a}(),yc=function(){function a(t){this.autoStart=t===void 0||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}var i=a.prototype;return i.start=function(){this.startTime=bc(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},i.stop=function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},i.getElapsedTime=function(){return this.getDelta(),this.elapsedTime},i.getDelta=function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=bc();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t},a}();function bc(){return(typeof performance>"u"?Date:performance).now()}var Dr=new te,xc=new ni,Hd=new te,Rr=new te,Kd=function(a){function i(){var e;return(e=a.call(this)||this).type="AudioListener",e.context=Nl.getContext(),e.gain=e.context.createGain(),e.gain.connect(e.context.destination),e.filter=null,e.timeDelta=0,e._clock=new yc,e}Be(i,a);var t=i.prototype;return t.getInput=function(){return this.gain},t.removeFilter=function(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},t.getFilter=function(){return this.filter},t.setFilter=function(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},t.getMasterVolume=function(){return this.gain.gain.value},t.setMasterVolume=function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},t.updateMatrixWorld=function(e){a.prototype.updateMatrixWorld.call(this,e);var n=this.context.listener,s=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Dr,xc,Hd),Rr.set(0,0,-1).applyQuaternion(xc),n.positionX){var l=this.context.currentTime+this.timeDelta;n.positionX.linearRampToValueAtTime(Dr.x,l),n.positionY.linearRampToValueAtTime(Dr.y,l),n.positionZ.linearRampToValueAtTime(Dr.z,l),n.forwardX.linearRampToValueAtTime(Rr.x,l),n.forwardY.linearRampToValueAtTime(Rr.y,l),n.forwardZ.linearRampToValueAtTime(Rr.z,l),n.upX.linearRampToValueAtTime(s.x,l),n.upY.linearRampToValueAtTime(s.y,l),n.upZ.linearRampToValueAtTime(s.z,l)}else n.setPosition(Dr.x,Dr.y,Dr.z),n.setOrientation(Rr.x,Rr.y,Rr.z,s.x,s.y,s.z)},i}(Ge),Fl=function(a){function i(e){var n;return(n=a.call(this)||this).type="Audio",n.listener=e,n.context=e.context,n.gain=n.context.createGain(),n.gain.connect(e.getInput()),n.autoplay=!1,n.buffer=null,n.detune=0,n.loop=!1,n.loopStart=0,n.loopEnd=0,n.offset=0,n.duration=void 0,n.playbackRate=1,n.isPlaying=!1,n.hasPlaybackControl=!0,n.source=null,n.sourceType="empty",n._startedAt=0,n._progress=0,n._connected=!1,n.filters=[],n}Be(i,a);var t=i.prototype;return t.getOutput=function(){return this.gain},t.setNodeSource=function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},t.setMediaElementSource=function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},t.setMediaStreamSource=function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this},t.setBuffer=function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},t.play=function(e){if(e===void 0&&(e=0),this.isPlaying!==!0){if(this.hasPlaybackControl!==!1){this._startedAt=this.context.currentTime+e;var n=this.context.createBufferSource();return n.buffer=this.buffer,n.loop=this.loop,n.loopStart=this.loopStart,n.loopEnd=this.loopEnd,n.onended=this.onEnded.bind(this),n.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=n,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},t.pause=function(){if(this.hasPlaybackControl!==!1)return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},t.stop=function(){if(this.hasPlaybackControl!==!1)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},t.connect=function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,n=this.filters.length;e<n;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this},t.disconnect=function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,n=this.filters.length;e<n;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this},t.getFilters=function(){return this.filters},t.setFilters=function(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this},t.setDetune=function(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},t.getDetune=function(){return this.detune},t.getFilter=function(){return this.getFilters()[0]},t.setFilter=function(e){return this.setFilters(e?[e]:[])},t.setPlaybackRate=function(e){if(this.hasPlaybackControl!==!1)return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},t.getPlaybackRate=function(){return this.playbackRate},t.onEnded=function(){this.isPlaying=!1},t.getLoop=function(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},t.setLoop=function(e){if(this.hasPlaybackControl!==!1)return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},t.setLoopStart=function(e){return this.loopStart=e,this},t.setLoopEnd=function(e){return this.loopEnd=e,this},t.getVolume=function(){return this.gain.gain.value},t.setVolume=function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},i}(Ge),Or=new te,Sc=new ni,Yd=new te,Ir=new te,Xd=function(a){function i(e){var n;return(n=a.call(this,e)||this).panner=n.context.createPanner(),n.panner.panningModel="HRTF",n.panner.connect(n.gain),n}Be(i,a);var t=i.prototype;return t.getOutput=function(){return this.panner},t.getRefDistance=function(){return this.panner.refDistance},t.setRefDistance=function(e){return this.panner.refDistance=e,this},t.getRolloffFactor=function(){return this.panner.rolloffFactor},t.setRolloffFactor=function(e){return this.panner.rolloffFactor=e,this},t.getDistanceModel=function(){return this.panner.distanceModel},t.setDistanceModel=function(e){return this.panner.distanceModel=e,this},t.getMaxDistance=function(){return this.panner.maxDistance},t.setMaxDistance=function(e){return this.panner.maxDistance=e,this},t.setDirectionalCone=function(e,n,s){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=n,this.panner.coneOuterGain=s,this},t.updateMatrixWorld=function(e){if(a.prototype.updateMatrixWorld.call(this,e),this.hasPlaybackControl!==!0||this.isPlaying!==!1){this.matrixWorld.decompose(Or,Sc,Yd),Ir.set(0,0,1).applyQuaternion(Sc);var n=this.panner;if(n.positionX){var s=this.context.currentTime+this.listener.timeDelta;n.positionX.linearRampToValueAtTime(Or.x,s),n.positionY.linearRampToValueAtTime(Or.y,s),n.positionZ.linearRampToValueAtTime(Or.z,s),n.orientationX.linearRampToValueAtTime(Ir.x,s),n.orientationY.linearRampToValueAtTime(Ir.y,s),n.orientationZ.linearRampToValueAtTime(Ir.z,s)}else n.setPosition(Or.x,Or.y,Or.z),n.setOrientation(Ir.x,Ir.y,Ir.z)}},i}(Fl),wc=function(){function a(t,e){e===void 0&&(e=2048),this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}var i=a.prototype;return i.getFrequencyData=function(){return this.analyser.getByteFrequencyData(this.data),this.data},i.getAverageFrequency=function(){for(var t=0,e=this.getFrequencyData(),n=0;n<e.length;n++)t+=e[n];return t/e.length},a}(),Ec=function(){function a(t,e,n){var s,l,p;switch(this.binding=t,this.valueSize=n,e){case"quaternion":s=this._slerp,l=this._slerpAdditive,p=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":s=this._select,l=this._select,p=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:s=this._lerp,l=this._lerpAdditive,p=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=s,this._mixBufferRegionAdditive=l,this._setIdentity=p,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}var i=a.prototype;return i.accumulate=function(t,e){var n=this.buffer,s=this.valueSize,l=t*s+s,p=this.cumulativeWeight;if(p===0){for(var _=0;_!==s;++_)n[l+_]=n[_];p=e}else{var v=e/(p+=e);this._mixBufferRegion(n,l,0,v,s)}this.cumulativeWeight=p},i.accumulateAdditive=function(t){var e=this.buffer,n=this.valueSize,s=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(e,s,0,t,n),this.cumulativeWeightAdditive+=t},i.apply=function(t){var e=this.valueSize,n=this.buffer,s=t*e+e,l=this.cumulativeWeight,p=this.cumulativeWeightAdditive,_=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,l<1){var v=e*this._origIndex;this._mixBufferRegion(n,s,v,1-l,e)}p>0&&this._mixBufferRegionAdditive(n,s,this._addIndex*e,1,e);for(var A=e,E=e+e;A!==E;++A)if(n[A]!==n[A+e]){_.setValue(n,s);break}},i.saveOriginalState=function(){var t=this.binding,e=this.buffer,n=this.valueSize,s=n*this._origIndex;t.getValue(e,s);for(var l=n,p=s;l!==p;++l)e[l]=e[s+l%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},i.restoreOriginalState=function(){var t=3*this.valueSize;this.binding.setValue(this.buffer,t)},i._setAdditiveIdentityNumeric=function(){for(var t=this._addIndex*this.valueSize,e=t+this.valueSize,n=t;n<e;n++)this.buffer[n]=0},i._setAdditiveIdentityQuaternion=function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},i._setAdditiveIdentityOther=function(){for(var t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize,n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]},i._select=function(t,e,n,s,l){if(s>=.5)for(var p=0;p!==l;++p)t[e+p]=t[n+p]},i._slerp=function(t,e,n,s){ni.slerpFlat(t,e,t,e,t,n,s)},i._slerpAdditive=function(t,e,n,s,l){var p=this._workIndex*l;ni.multiplyQuaternionsFlat(t,p,t,e,t,n),ni.slerpFlat(t,e,t,e,t,p,s)},i._lerp=function(t,e,n,s,l){for(var p=1-s,_=0;_!==l;++_){var v=e+_;t[v]=t[v]*p+t[n+_]*s}},i._lerpAdditive=function(t,e,n,s,l){for(var p=0;p!==l;++p){var _=e+p;t[_]=t[_]+t[n+p]*s}},a}(),qd="\\[\\]\\.:\\/",Zd=new RegExp("[\\[\\]\\.:\\/]","g"),zl="[^\\[\\]\\.:\\/]",Qd="[^"+qd.replace("\\.","")+"]",Jd=/((?:WC+[\/:])*)/.source.replace("WC",zl),$d=/(WCOD+)?/.source.replace("WCOD",Qd),ep=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",zl),tp=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",zl),ip=new RegExp("^"+Jd+$d+ep+tp+"$"),np=["material","materials","bones"];function Ac(a,i,t){var e=t||Ci.parseTrackName(i);this._targetGroup=a,this._bindings=a.subscribe_(i,e)}function Ci(a,i,t){this.path=i,this.parsedPath=t||Ci.parseTrackName(i),this.node=Ci.findNode(a,this.parsedPath.nodeName)||a,this.rootNode=a}Object.assign(Ac.prototype,{getValue:function(i,t){this.bind();var e=this._targetGroup.nCachedObjects_,n=this._bindings[e];n!==void 0&&n.getValue(i,t)},setValue:function(i,t){for(var e=this._bindings,n=this._targetGroup.nCachedObjects_,s=e.length;n!==s;++n)e[n].setValue(i,t)},bind:function(){for(var i=this._bindings,t=this._targetGroup.nCachedObjects_,e=i.length;t!==e;++t)i[t].bind()},unbind:function(){for(var i=this._bindings,t=this._targetGroup.nCachedObjects_,e=i.length;t!==e;++t)i[t].unbind()}}),Object.assign(Ci,{Composite:Ac,create:function(i,t,e){return i&&i.isAnimationObjectGroup?new Ci.Composite(i,t,e):new Ci(i,t,e)},sanitizeNodeName:function(i){return i.replace(/\s/g,"_").replace(Zd,"")},parseTrackName:function(i){var t=ip.exec(i);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+i);var e={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=e.nodeName&&e.nodeName.lastIndexOf(".");if(n!==void 0&&n!==-1){var s=e.nodeName.substring(n+1);np.indexOf(s)!==-1&&(e.nodeName=e.nodeName.substring(0,n),e.objectName=s)}if(e.propertyName===null||e.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+i);return e},findNode:function(i,t){if(!t||t===""||t==="."||t===-1||t===i.name||t===i.uuid)return i;if(i.skeleton){var e=i.skeleton.getBoneByName(t);if(e!==void 0)return e}if(i.children){var n=function s(l){for(var p=0;p<l.length;p++){var _=l[p];if(_.name===t||_.uuid===t)return _;var v=s(_.children);if(v)return v}return null}(i.children);if(n)return n}return null}}),Object.assign(Ci.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(a,i){a[i]=this.node[this.propertyName]},function(a,i){for(var t=this.resolvedProperty,e=0,n=t.length;e!==n;++e)a[i++]=t[e]},function(a,i){a[i]=this.resolvedProperty[this.propertyIndex]},function(a,i){this.resolvedProperty.toArray(a,i)}],SetterByBindingTypeAndVersioning:[[function(a,i){this.targetObject[this.propertyName]=a[i]},function(a,i){this.targetObject[this.propertyName]=a[i],this.targetObject.needsUpdate=!0},function(a,i){this.targetObject[this.propertyName]=a[i],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,i){for(var t=this.resolvedProperty,e=0,n=t.length;e!==n;++e)t[e]=a[i++]},function(a,i){for(var t=this.resolvedProperty,e=0,n=t.length;e!==n;++e)t[e]=a[i++];this.targetObject.needsUpdate=!0},function(a,i){for(var t=this.resolvedProperty,e=0,n=t.length;e!==n;++e)t[e]=a[i++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,i){this.resolvedProperty[this.propertyIndex]=a[i]},function(a,i){this.resolvedProperty[this.propertyIndex]=a[i],this.targetObject.needsUpdate=!0},function(a,i){this.resolvedProperty[this.propertyIndex]=a[i],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,i){this.resolvedProperty.fromArray(a,i)},function(a,i){this.resolvedProperty.fromArray(a,i),this.targetObject.needsUpdate=!0},function(a,i){this.resolvedProperty.fromArray(a,i),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(i,t){this.bind(),this.getValue(i,t)},setValue:function(i,t){this.bind(),this.setValue(i,t)},bind:function(){var i=this.node,t=this.parsedPath,e=t.objectName,n=t.propertyName,s=t.propertyIndex;if(i||(i=Ci.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=i),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,i){if(e){var l=t.objectIndex;switch(e){case"materials":if(!i.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!i.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);i=i.material.materials;break;case"bones":if(!i.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);i=i.skeleton.bones;for(var p=0;p<i.length;p++)if(i[p].name===l){l=p;break}break;default:if(i[e]===void 0)return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);i=i[e]}if(l!==void 0){if(i[l]===void 0)return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,i);i=i[l]}}var _=i[n];if(_!==void 0){var v=this.Versioning.None;this.targetObject=i,i.needsUpdate!==void 0?v=this.Versioning.NeedsUpdate:i.matrixWorldNeedsUpdate!==void 0&&(v=this.Versioning.MatrixWorldNeedsUpdate);var A=this.BindingType.Direct;if(s!==void 0){if(n==="morphTargetInfluences"){if(!i.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!i.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!i.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);i.morphTargetDictionary[s]!==void 0&&(s=i.morphTargetDictionary[s])}A=this.BindingType.ArrayElement,this.resolvedProperty=_,this.propertyIndex=s}else _.fromArray!==void 0&&_.toArray!==void 0?(A=this.BindingType.HasFromToArray,this.resolvedProperty=_):Array.isArray(_)?(A=this.BindingType.EntireArray,this.resolvedProperty=_):this.propertyName=n;this.getValue=this.GetterByBindingType[A],this.setValue=this.SetterByBindingTypeAndVersioning[A][v]}else{var E=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+E+"."+n+" but it wasn't found.",i)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(Ci.prototype,{_getValue_unbound:Ci.prototype.getValue,_setValue_unbound:Ci.prototype.setValue});var Tc=function(){function a(){this.uuid=dt.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var e=0,n=arguments.length;e!==n;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var s=this;this.stats={objects:{get total(){return s._objects.length},get inUse(){return this.total-s.nCachedObjects_}},get bindingsPerObject(){return s._bindings.length}}}var i=a.prototype;return i.add=function(){for(var t=this._objects,e=this._indicesByUUID,n=this._paths,s=this._parsedPaths,l=this._bindings,p=l.length,_=void 0,v=t.length,A=this.nCachedObjects_,E=0,L=arguments.length;E!==L;++E){var D=arguments[E],B=D.uuid,U=e[B];if(U===void 0){U=v++,e[B]=U,t.push(D);for(var V=0,j=p;V!==j;++V)l[V].push(new Ci(D,n[V],s[V]))}else if(U<A){_=t[U];var K=--A,ee=t[K];e[ee.uuid]=U,t[U]=ee,e[B]=K,t[K]=D;for(var J=0,$=p;J!==$;++J){var se=l[J],re=se[K],ie=se[U];se[U]=re,ie===void 0&&(ie=new Ci(D,n[J],s[J])),se[K]=ie}}else t[U]!==_&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=A},i.remove=function(){for(var t=this._objects,e=this._indicesByUUID,n=this._bindings,s=n.length,l=this.nCachedObjects_,p=0,_=arguments.length;p!==_;++p){var v=arguments[p],A=v.uuid,E=e[A];if(E!==void 0&&E>=l){var L=l++,D=t[L];e[D.uuid]=E,t[E]=D,e[A]=L,t[L]=v;for(var B=0,U=s;B!==U;++B){var V=n[B],j=V[L],K=V[E];V[E]=j,V[L]=K}}}this.nCachedObjects_=l},i.uncache=function(){for(var t=this._objects,e=this._indicesByUUID,n=this._bindings,s=n.length,l=this.nCachedObjects_,p=t.length,_=0,v=arguments.length;_!==v;++_){var A=arguments[_],E=A.uuid,L=e[E];if(L!==void 0)if(delete e[E],L<l){var D=--l,B=t[D],U=--p,V=t[U];e[B.uuid]=L,t[L]=B,e[V.uuid]=D,t[D]=V,t.pop();for(var j=0,K=s;j!==K;++j){var ee=n[j],J=ee[D],$=ee[U];ee[L]=J,ee[D]=$,ee.pop()}}else{var se=--p,re=t[se];se>0&&(e[re.uuid]=L),t[L]=re,t.pop();for(var ie=0,pe=s;ie!==pe;++ie){var de=n[ie];de[L]=de[se],de.pop()}}}this.nCachedObjects_=l},i.subscribe_=function(t,e){var n=this._bindingsIndicesByPath,s=n[t],l=this._bindings;if(s!==void 0)return l[s];var p=this._paths,_=this._parsedPaths,v=this._objects,A=v.length,E=this.nCachedObjects_,L=new Array(A);s=l.length,n[t]=s,p.push(t),_.push(e),l.push(L);for(var D=E,B=v.length;D!==B;++D){var U=v[D];L[D]=new Ci(U,t,e)}return L},i.unsubscribe_=function(t){var e=this._bindingsIndicesByPath,n=e[t];if(n!==void 0){var s=this._paths,l=this._parsedPaths,p=this._bindings,_=p.length-1,v=p[_];e[t[_]]=n,p[n]=v,p.pop(),l[n]=l[_],l.pop(),s[n]=s[_],s.pop()}},a}();Tc.prototype.isAnimationObjectGroup=!0;var rp=function(){function a(t,e,n,s){n===void 0&&(n=null),s===void 0&&(s=e.blendMode),this._mixer=t,this._clip=e,this._localRoot=n,this.blendMode=s;for(var l=e.tracks,p=l.length,_=new Array(p),v={endingStart:Ut,endingEnd:Ut},A=0;A!==p;++A){var E=l[A].createInterpolant(null);_[A]=E,E.settings=v}this._interpolantSettings=v,this._interpolants=_,this._propertyBindings=new Array(p),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}var i=a.prototype;return i.play=function(){return this._mixer._activateAction(this),this},i.stop=function(){return this._mixer._deactivateAction(this),this.reset()},i.reset=function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},i.isRunning=function(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)},i.isScheduled=function(){return this._mixer._isActiveAction(this)},i.startAt=function(t){return this._startTime=t,this},i.setLoop=function(t,e){return this.loop=t,this.repetitions=e,this},i.setEffectiveWeight=function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},i.getEffectiveWeight=function(){return this._effectiveWeight},i.fadeIn=function(t){return this._scheduleFading(t,0,1)},i.fadeOut=function(t){return this._scheduleFading(t,1,0)},i.crossFadeFrom=function(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){var s=this._clip.duration,l=t._clip.duration,p=l/s,_=s/l;t.warp(1,p,e),this.warp(_,1,e)}return this},i.crossFadeTo=function(t,e,n){return t.crossFadeFrom(this,e,n)},i.stopFading=function(){var t=this._weightInterpolant;return t!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},i.setEffectiveTimeScale=function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},i.getEffectiveTimeScale=function(){return this._effectiveTimeScale},i.setDuration=function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},i.syncWith=function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},i.halt=function(t){return this.warp(this._effectiveTimeScale,0,t)},i.warp=function(t,e,n){var s=this._mixer,l=s.time,p=this.timeScale,_=this._timeScaleInterpolant;_===null&&(_=s._lendControlInterpolant(),this._timeScaleInterpolant=_);var v=_.parameterPositions,A=_.sampleValues;return v[0]=l,v[1]=l+n,A[0]=t/p,A[1]=e/p,this},i.stopWarping=function(){var t=this._timeScaleInterpolant;return t!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},i.getMixer=function(){return this._mixer},i.getClip=function(){return this._clip},i.getRoot=function(){return this._localRoot||this._mixer._root},i._update=function(t,e,n,s){if(this.enabled){var l=this._startTime;if(l!==null){var p=(t-l)*n;if(p<0||n===0)return;this._startTime=null,e=n*p}e*=this._updateTimeScale(t);var _=this._updateTime(e),v=this._updateWeight(t);if(v>0){var A=this._interpolants,E=this._propertyBindings;switch(this.blendMode){case Wn:for(var L=0,D=A.length;L!==D;++L)A[L].evaluate(_),E[L].accumulateAdditive(v);break;case Nt:default:for(var B=0,U=A.length;B!==U;++B)A[B].evaluate(_),E[B].accumulate(s,v)}}}else this._updateWeight(t)},i._updateWeight=function(t){var e=0;if(this.enabled){e=this.weight;var n=this._weightInterpolant;if(n!==null){var s=n.evaluate(t)[0];e*=s,t>n.parameterPositions[1]&&(this.stopFading(),s===0&&(this.enabled=!1))}}return this._effectiveWeight=e,e},i._updateTimeScale=function(t){var e=0;if(!this.paused){e=this.timeScale;var n=this._timeScaleInterpolant;n!==null&&(e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),e===0?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e},i._updateTime=function(t){var e=this._clip.duration,n=this.loop,s=this.time+t,l=this._loopCount,p=n===2202;if(t===0)return l===-1?s:p&&(1&l)==1?e-s:s;if(n===2200){l===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(s>=e)s=e;else{if(!(s<0)){this.time=s;break e}s=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(l===-1&&(t>=0?(l=0,this._setEndings(!0,this.repetitions===0,p)):this._setEndings(this.repetitions===0,!0,p)),s>=e||s<0){var _=Math.floor(s/e);s-=e*_,l+=Math.abs(_);var v=this.repetitions-l;if(v<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,s=t>0?e:0,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(v===1){var A=t<0;this._setEndings(A,!A,p)}else this._setEndings(!1,!1,p);this._loopCount=l,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:_})}}else this.time=s;if(p&&(1&l)==1)return e-s}return s},i._setEndings=function(t,e,n){var s=this._interpolantSettings;n?(s.endingStart=qt,s.endingEnd=qt):(s.endingStart=t?this.zeroSlopeAtStart?qt:Ut:oi,s.endingEnd=e?this.zeroSlopeAtEnd?qt:Ut:oi)},i._scheduleFading=function(t,e,n){var s=this._mixer,l=s.time,p=this._weightInterpolant;p===null&&(p=s._lendControlInterpolant(),this._weightInterpolant=p);var _=p.parameterPositions,v=p.sampleValues;return _[0]=l,v[0]=e,_[1]=l+t,v[1]=n,this},a}(),Mc=function(a){function i(e){var n;return(n=a.call(this)||this)._root=e,n._initMemoryManager(),n._accuIndex=0,n.time=0,n.timeScale=1,n}Be(i,a);var t=i.prototype;return t._bindAction=function(e,n){var s=e._localRoot||this._root,l=e._clip.tracks,p=l.length,_=e._propertyBindings,v=e._interpolants,A=s.uuid,E=this._bindingsByRootAndName,L=E[A];L===void 0&&(L={},E[A]=L);for(var D=0;D!==p;++D){var B=l[D],U=B.name,V=L[U];if(V!==void 0)_[D]=V;else{if((V=_[D])!==void 0){V._cacheIndex===null&&(++V.referenceCount,this._addInactiveBinding(V,A,U));continue}var j=n&&n._propertyBindings[D].binding.parsedPath;++(V=new Ec(Ci.create(s,U,j),B.ValueTypeName,B.getValueSize())).referenceCount,this._addInactiveBinding(V,A,U),_[D]=V}v[D].resultBuffer=V.buffer}},t._activateAction=function(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){var n=(e._localRoot||this._root).uuid,s=e._clip.uuid,l=this._actionsByClip[s];this._bindAction(e,l&&l.knownActions[0]),this._addInactiveAction(e,s,n)}for(var p=e._propertyBindings,_=0,v=p.length;_!==v;++_){var A=p[_];A.useCount++==0&&(this._lendBinding(A),A.saveOriginalState())}this._lendAction(e)}},t._deactivateAction=function(e){if(this._isActiveAction(e)){for(var n=e._propertyBindings,s=0,l=n.length;s!==l;++s){var p=n[s];--p.useCount==0&&(p.restoreOriginalState(),this._takeBackBinding(p))}this._takeBackAction(e)}},t._initMemoryManager=function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},t._isActiveAction=function(e){var n=e._cacheIndex;return n!==null&&n<this._nActiveActions},t._addInactiveAction=function(e,n,s){var l=this._actions,p=this._actionsByClip,_=p[n];if(_===void 0)_={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,p[n]=_;else{var v=_.knownActions;e._byClipCacheIndex=v.length,v.push(e)}e._cacheIndex=l.length,l.push(e),_.actionByRoot[s]=e},t._removeInactiveAction=function(e){var n=this._actions,s=n[n.length-1],l=e._cacheIndex;s._cacheIndex=l,n[l]=s,n.pop(),e._cacheIndex=null;var p=e._clip.uuid,_=this._actionsByClip,v=_[p],A=v.knownActions,E=A[A.length-1],L=e._byClipCacheIndex;E._byClipCacheIndex=L,A[L]=E,A.pop(),e._byClipCacheIndex=null,delete v.actionByRoot[(e._localRoot||this._root).uuid],A.length===0&&delete _[p],this._removeInactiveBindingsForAction(e)},t._removeInactiveBindingsForAction=function(e){for(var n=e._propertyBindings,s=0,l=n.length;s!==l;++s){var p=n[s];--p.referenceCount==0&&this._removeInactiveBinding(p)}},t._lendAction=function(e){var n=this._actions,s=e._cacheIndex,l=this._nActiveActions++,p=n[l];e._cacheIndex=l,n[l]=e,p._cacheIndex=s,n[s]=p},t._takeBackAction=function(e){var n=this._actions,s=e._cacheIndex,l=--this._nActiveActions,p=n[l];e._cacheIndex=l,n[l]=e,p._cacheIndex=s,n[s]=p},t._addInactiveBinding=function(e,n,s){var l=this._bindingsByRootAndName,p=this._bindings,_=l[n];_===void 0&&(_={},l[n]=_),_[s]=e,e._cacheIndex=p.length,p.push(e)},t._removeInactiveBinding=function(e){var n=this._bindings,s=e.binding,l=s.rootNode.uuid,p=s.path,_=this._bindingsByRootAndName,v=_[l],A=n[n.length-1],E=e._cacheIndex;A._cacheIndex=E,n[E]=A,n.pop(),delete v[p],Object.keys(v).length===0&&delete _[l]},t._lendBinding=function(e){var n=this._bindings,s=e._cacheIndex,l=this._nActiveBindings++,p=n[l];e._cacheIndex=l,n[l]=e,p._cacheIndex=s,n[s]=p},t._takeBackBinding=function(e){var n=this._bindings,s=e._cacheIndex,l=--this._nActiveBindings,p=n[l];e._cacheIndex=l,n[l]=e,p._cacheIndex=s,n[s]=p},t._lendControlInterpolant=function(){var e=this._controlInterpolants,n=this._nActiveControlInterpolants++,s=e[n];return s===void 0&&((s=new Hs(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=n,e[n]=s),s},t._takeBackControlInterpolant=function(e){var n=this._controlInterpolants,s=e.__cacheIndex,l=--this._nActiveControlInterpolants,p=n[l];e.__cacheIndex=l,n[l]=e,p.__cacheIndex=s,n[s]=p},t.clipAction=function(e,n,s){var l=n||this._root,p=l.uuid,_=typeof e=="string"?Xs.findByName(l,e):e,v=_!==null?_.uuid:e,A=this._actionsByClip[v],E=null;if(s===void 0&&(s=_!==null?_.blendMode:Nt),A!==void 0){var L=A.actionByRoot[p];if(L!==void 0&&L.blendMode===s)return L;E=A.knownActions[0],_===null&&(_=E._clip)}if(_===null)return null;var D=new rp(this,_,n,s);return this._bindAction(D,E),this._addInactiveAction(D,v,p),D},t.existingAction=function(e,n){var s=n||this._root,l=s.uuid,p=typeof e=="string"?Xs.findByName(s,e):e,_=p?p.uuid:e,v=this._actionsByClip[_];return v!==void 0&&v.actionByRoot[l]||null},t.stopAllAction=function(){for(var e=this._actions,n=this._nActiveActions-1;n>=0;--n)e[n].stop();return this},t.update=function(e){e*=this.timeScale;for(var n=this._actions,s=this._nActiveActions,l=this.time+=e,p=Math.sign(e),_=this._accuIndex^=1,v=0;v!==s;++v)n[v]._update(l,e,p,_);for(var A=this._bindings,E=this._nActiveBindings,L=0;L!==E;++L)A[L].apply(_);return this},t.setTime=function(e){this.time=0;for(var n=0;n<this._actions.length;n++)this._actions[n].time=0;return this.update(e)},t.getRoot=function(){return this._root},t.uncacheClip=function(e){var n=this._actions,s=e.uuid,l=this._actionsByClip,p=l[s];if(p!==void 0){for(var _=p.knownActions,v=0,A=_.length;v!==A;++v){var E=_[v];this._deactivateAction(E);var L=E._cacheIndex,D=n[n.length-1];E._cacheIndex=null,E._byClipCacheIndex=null,D._cacheIndex=L,n[L]=D,n.pop(),this._removeInactiveBindingsForAction(E)}delete l[s]}},t.uncacheRoot=function(e){var n=e.uuid,s=this._actionsByClip;for(var l in s){var p=s[l].actionByRoot[n];p!==void 0&&(this._deactivateAction(p),this._removeInactiveAction(p))}var _=this._bindingsByRootAndName[n];if(_!==void 0)for(var v in _){var A=_[v];A.restoreOriginalState(),this._removeInactiveBinding(A)}},t.uncacheAction=function(e,n){var s=this.existingAction(e,n);s!==null&&(this._deactivateAction(s),this._removeInactiveAction(s))},i}(wi);Mc.prototype._controlInterpolantsResultBuffer=new Float32Array(1);var Cc=function(){function a(i){typeof i=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),i=arguments[1]),this.value=i}return a.prototype.clone=function(){return new a(this.value.clone===void 0?this.value:this.value.clone())},a}();function Ul(a,i,t){ki.call(this,a,i),this.meshPerAttribute=t||1}function kl(a,i,t,e,n){this.buffer=a,this.type=i,this.itemSize=t,this.elementSize=e,this.count=n,this.version=0}function jl(a,i,t,e){t===void 0&&(t=0),e===void 0&&(e=1/0),this.ray=new sn(a,i),this.near=t,this.far=e,this.camera=null,this.layers=new Bt,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Lc(a,i){return a.distance-i.distance}function Wl(a,i,t,e){if(a.layers.test(i.layers)&&a.raycast(i,t),e===!0)for(var n=a.children,s=0,l=n.length;s<l;s++)Wl(n[s],i,t,!0)}Ul.prototype=Object.assign(Object.create(ki.prototype),{constructor:Ul,isInstancedInterleavedBuffer:!0,copy:function(i){return ki.prototype.copy.call(this,i),this.meshPerAttribute=i.meshPerAttribute,this},clone:function(i){var t=ki.prototype.clone.call(this,i);return t.meshPerAttribute=this.meshPerAttribute,t},toJSON:function(i){var t=ki.prototype.toJSON.call(this,i);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}),Object.defineProperty(kl.prototype,"needsUpdate",{set:function(i){i===!0&&this.version++}}),Object.assign(kl.prototype,{isGLBufferAttribute:!0,setBuffer:function(i){return this.buffer=i,this},setType:function(i,t){return this.type=i,this.elementSize=t,this},setItemSize:function(i){return this.itemSize=i,this},setCount:function(i){return this.count=i,this}}),Object.assign(jl.prototype,{set:function(i,t){this.ray.set(i,t)},setFromCamera:function(i,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(i.x,i.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(i.x,i.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)},intersectObject:function(i,t,e){return t===void 0&&(t=!1),e===void 0&&(e=[]),Wl(i,this,e,t),e.sort(Lc),e},intersectObjects:function(i,t,e){t===void 0&&(t=!1),e===void 0&&(e=[]);for(var n=0,s=i.length;n<s;n++)Wl(i[n],this,e,t);return e.sort(Lc),e}});var sp=function(){function a(t,e,n){return t===void 0&&(t=1),e===void 0&&(e=0),n===void 0&&(n=0),this.radius=t,this.phi=e,this.theta=n,this}var i=a.prototype;return i.set=function(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this},i.copy=function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},i.makeSafe=function(){var t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this},i.setFromVector3=function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},i.setFromCartesianCoords=function(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(dt.clamp(e/this.radius,-1,1))),this},i.clone=function(){return new this.constructor().copy(this)},a}(),ap=function(){function a(t,e,n){return t===void 0&&(t=1),e===void 0&&(e=0),n===void 0&&(n=0),this.radius=t,this.theta=e,this.y=n,this}var i=a.prototype;return i.set=function(t,e,n){return this.radius=t,this.theta=e,this.y=n,this},i.copy=function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},i.setFromVector3=function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},i.setFromCartesianCoords=function(t,e,n){return this.radius=Math.sqrt(t*t+n*n),this.theta=Math.atan2(t,n),this.y=e,this},i.clone=function(){return new this.constructor().copy(this)},a}(),Pc=new Ve,cs=function(){function a(t,e){t===void 0&&(t=new Ve(1/0,1/0)),e===void 0&&(e=new Ve(-1/0,-1/0)),this.min=t,this.max=e}var i=a.prototype;return i.set=function(t,e){return this.min.copy(t),this.max.copy(e),this},i.setFromPoints=function(t){this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},i.setFromCenterAndSize=function(t,e){var n=Pc.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this},i.clone=function(){return new this.constructor().copy(this)},i.copy=function(t){return this.min.copy(t.min),this.max.copy(t.max),this},i.makeEmpty=function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},i.isEmpty=function(){return this.max.x<this.min.x||this.max.y<this.min.y},i.getCenter=function(t){return t===void 0&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new Ve),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},i.getSize=function(t){return t===void 0&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new Ve),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},i.expandByPoint=function(t){return this.min.min(t),this.max.max(t),this},i.expandByVector=function(t){return this.min.sub(t),this.max.add(t),this},i.expandByScalar=function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},i.containsPoint=function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},i.containsBox=function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},i.getParameter=function(t,e){return e===void 0&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new Ve),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},i.intersectsBox=function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},i.clampPoint=function(t,e){return e===void 0&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new Ve),e.copy(t).clamp(this.min,this.max)},i.distanceToPoint=function(t){return Pc.copy(t).clamp(this.min,this.max).sub(t).length()},i.intersect=function(t){return this.min.max(t.min),this.max.min(t.max),this},i.union=function(t){return this.min.min(t.min),this.max.max(t.max),this},i.translate=function(t){return this.min.add(t),this.max.add(t),this},i.equals=function(t){return t.min.equals(this.min)&&t.max.equals(this.max)},a}();cs.prototype.isBox2=!0;var Dc=new te,bo=new te,Rc=function(){function a(t,e){t===void 0&&(t=new te),e===void 0&&(e=new te),this.start=t,this.end=e}var i=a.prototype;return i.set=function(t,e){return this.start.copy(t),this.end.copy(e),this},i.copy=function(t){return this.start.copy(t.start),this.end.copy(t.end),this},i.getCenter=function(t){return t===void 0&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new te),t.addVectors(this.start,this.end).multiplyScalar(.5)},i.delta=function(t){return t===void 0&&(console.warn("THREE.Line3: .delta() target is now required"),t=new te),t.subVectors(this.end,this.start)},i.distanceSq=function(){return this.start.distanceToSquared(this.end)},i.distance=function(){return this.start.distanceTo(this.end)},i.at=function(t,e){return e===void 0&&(console.warn("THREE.Line3: .at() target is now required"),e=new te),this.delta(e).multiplyScalar(t).add(this.start)},i.closestPointToPointParameter=function(t,e){Dc.subVectors(t,this.start),bo.subVectors(this.end,this.start);var n=bo.dot(bo),s=bo.dot(Dc)/n;return e&&(s=dt.clamp(s,0,1)),s},i.closestPointToPoint=function(t,e,n){var s=this.closestPointToPointParameter(t,e);return n===void 0&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new te),this.delta(n).multiplyScalar(s).add(this.start)},i.applyMatrix4=function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},i.equals=function(t){return t.start.equals(this.start)&&t.end.equals(this.end)},i.clone=function(){return new this.constructor().copy(this)},a}();function ra(a){Ge.call(this),this.material=a,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}ra.prototype=Object.create(Ge.prototype),ra.prototype.constructor=ra,ra.prototype.isImmediateRenderObject=!0;var Oc=new te,op=function(a){function i(e,n){var s;(s=a.call(this)||this).light=e,s.light.updateMatrixWorld(),s.matrix=e.matrixWorld,s.matrixAutoUpdate=!1,s.color=n;for(var l=new ct,p=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],_=0,v=1;_<32;_++,v++){var A=_/32*Math.PI*2,E=v/32*Math.PI*2;p.push(Math.cos(A),Math.sin(A),1,Math.cos(E),Math.sin(E),1)}l.setAttribute("position",new st(p,3));var L=new yi({fog:!1,toneMapped:!1});return s.cone=new Ii(l,L),s.add(s.cone),s.update(),s}Be(i,a);var t=i.prototype;return t.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},t.update=function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,n=e*Math.tan(this.light.angle);this.cone.scale.set(n,n,e),Oc.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Oc),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)},i}(Ge),dr=new te,xo=new ht,Vl=new ht,Ic=function(a){function i(t){for(var e,n=Bc(t),s=new ct,l=[],p=[],_=new nt(0,0,1),v=new nt(0,1,0),A=0;A<n.length;A++){var E=n[A];E.parent&&E.parent.isBone&&(l.push(0,0,0),l.push(0,0,0),p.push(_.r,_.g,_.b),p.push(v.r,v.g,v.b))}s.setAttribute("position",new st(l,3)),s.setAttribute("color",new st(p,3));var L=new yi({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});return(e=a.call(this,s,L)||this).type="SkeletonHelper",e.isSkeletonHelper=!0,e.root=t,e.bones=n,e.matrix=t.matrixWorld,e.matrixAutoUpdate=!1,e}return Be(i,a),i.prototype.updateMatrixWorld=function(t){var e=this.bones,n=this.geometry,s=n.getAttribute("position");Vl.copy(this.root.matrixWorld).invert();for(var l=0,p=0;l<e.length;l++){var _=e[l];_.parent&&_.parent.isBone&&(xo.multiplyMatrices(Vl,_.matrixWorld),dr.setFromMatrixPosition(xo),s.setXYZ(p,dr.x,dr.y,dr.z),xo.multiplyMatrices(Vl,_.parent.matrixWorld),dr.setFromMatrixPosition(xo),s.setXYZ(p+1,dr.x,dr.y,dr.z),p+=2)}n.getAttribute("position").needsUpdate=!0,a.prototype.updateMatrixWorld.call(this,t)},i}(Ii);function Bc(a){var i=[];a&&a.isBone&&i.push(a);for(var t=0;t<a.children.length;t++)i.push.apply(i,Bc(a.children[t]));return i}var lp=function(a){function i(e,n,s){var l,p=new Gs(n,4,2),_=new zn({wireframe:!0,fog:!1,toneMapped:!1});return(l=a.call(this,p,_)||this).light=e,l.light.updateMatrixWorld(),l.color=s,l.type="PointLightHelper",l.matrix=l.light.matrixWorld,l.matrixAutoUpdate=!1,l.update(),l}Be(i,a);var t=i.prototype;return t.dispose=function(){this.geometry.dispose(),this.material.dispose()},t.update=function(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)},i}(Jt),hp=new te,Nc=new nt,Fc=new nt,cp=function(a){function i(e,n,s){var l;(l=a.call(this)||this).light=e,l.light.updateMatrixWorld(),l.matrix=e.matrixWorld,l.matrixAutoUpdate=!1,l.color=s;var p=new Ws(n);p.rotateY(.5*Math.PI),l.material=new zn({wireframe:!0,fog:!1,toneMapped:!1}),l.color===void 0&&(l.material.vertexColors=!0);var _=p.getAttribute("position"),v=new Float32Array(3*_.count);return p.setAttribute("color",new ft(v,3)),l.add(new Jt(p,l.material)),l.update(),l}Be(i,a);var t=i.prototype;return t.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},t.update=function(){var e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{var n=e.geometry.getAttribute("color");Nc.copy(this.light.color),Fc.copy(this.light.groundColor);for(var s=0,l=n.count;s<l;s++){var p=s<l/2?Nc:Fc;n.setXYZ(s,p.r,p.g,p.b)}n.needsUpdate=!0}e.lookAt(hp.setFromMatrixPosition(this.light.matrixWorld).negate())},i}(Ge),zc=function(a){function i(t,e,n,s){var l;t===void 0&&(t=10),e===void 0&&(e=10),n===void 0&&(n=4473924),s===void 0&&(s=8947848),n=new nt(n),s=new nt(s);for(var p=e/2,_=t/e,v=t/2,A=[],E=[],L=0,D=0,B=-v;L<=e;L++,B+=_){A.push(-v,0,B,v,0,B),A.push(B,0,-v,B,0,v);var U=L===p?n:s;U.toArray(E,D),D+=3,U.toArray(E,D),D+=3,U.toArray(E,D),D+=3,U.toArray(E,D),D+=3}var V=new ct;V.setAttribute("position",new st(A,3)),V.setAttribute("color",new st(E,3));var j=new yi({vertexColors:!0,toneMapped:!1});return(l=a.call(this,V,j)||this).type="GridHelper",l}return Be(i,a),i}(Ii),up=function(a){function i(t,e,n,s,l,p){var _;t===void 0&&(t=10),e===void 0&&(e=16),n===void 0&&(n=8),s===void 0&&(s=64),l===void 0&&(l=4473924),p===void 0&&(p=8947848),l=new nt(l),p=new nt(p);for(var v=[],A=[],E=0;E<=e;E++){var L=E/e*(2*Math.PI),D=Math.sin(L)*t,B=Math.cos(L)*t;v.push(0,0,0),v.push(D,0,B);var U=1&E?l:p;A.push(U.r,U.g,U.b),A.push(U.r,U.g,U.b)}for(var V=0;V<=n;V++)for(var j=1&V?l:p,K=t-t/n*V,ee=0;ee<s;ee++){var J=ee/s*(2*Math.PI),$=Math.sin(J)*K,se=Math.cos(J)*K;v.push($,0,se),A.push(j.r,j.g,j.b),J=(ee+1)/s*(2*Math.PI),$=Math.sin(J)*K,se=Math.cos(J)*K,v.push($,0,se),A.push(j.r,j.g,j.b)}var re=new ct;re.setAttribute("position",new st(v,3)),re.setAttribute("color",new st(A,3));var ie=new yi({vertexColors:!0,toneMapped:!1});return(_=a.call(this,re,ie)||this).type="PolarGridHelper",_}return Be(i,a),i}(Ii),Uc=new te,So=new te,kc=new te,dp=function(a){function i(e,n,s){var l;(l=a.call(this)||this).light=e,l.light.updateMatrixWorld(),l.matrix=e.matrixWorld,l.matrixAutoUpdate=!1,l.color=s,n===void 0&&(n=1);var p=new ct;p.setAttribute("position",new st([-n,n,0,n,n,0,n,-n,0,-n,-n,0,-n,n,0],3));var _=new yi({fog:!1,toneMapped:!1});return l.lightPlane=new vn(p,_),l.add(l.lightPlane),(p=new ct).setAttribute("position",new st([0,0,0,0,0,1],3)),l.targetLine=new vn(p,_),l.add(l.targetLine),l.update(),l}Be(i,a);var t=i.prototype;return t.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},t.update=function(){Uc.setFromMatrixPosition(this.light.matrixWorld),So.setFromMatrixPosition(this.light.target.matrixWorld),kc.subVectors(So,Uc),this.lightPlane.lookAt(So),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(So),this.targetLine.scale.z=kc.length()},i}(Ge),wo=new te,si=new sr,pp=function(a){function i(t){var e,n=new ct,s=new yi({color:16777215,vertexColors:!0,toneMapped:!1}),l=[],p=[],_={},v=new nt(16755200),A=new nt(16711680),E=new nt(43775),L=new nt(16777215),D=new nt(3355443);function B(V,j,K){U(V,K),U(j,K)}function U(V,j){l.push(0,0,0),p.push(j.r,j.g,j.b),_[V]===void 0&&(_[V]=[]),_[V].push(l.length/3-1)}return B("n1","n2",v),B("n2","n4",v),B("n4","n3",v),B("n3","n1",v),B("f1","f2",v),B("f2","f4",v),B("f4","f3",v),B("f3","f1",v),B("n1","f1",v),B("n2","f2",v),B("n3","f3",v),B("n4","f4",v),B("p","n1",A),B("p","n2",A),B("p","n3",A),B("p","n4",A),B("u1","u2",E),B("u2","u3",E),B("u3","u1",E),B("c","t",L),B("p","c",D),B("cn1","cn2",D),B("cn3","cn4",D),B("cf1","cf2",D),B("cf3","cf4",D),n.setAttribute("position",new st(l,3)),n.setAttribute("color",new st(p,3)),(e=a.call(this,n,s)||this).type="CameraHelper",e.camera=t,e.camera.updateProjectionMatrix&&e.camera.updateProjectionMatrix(),e.matrix=t.matrixWorld,e.matrixAutoUpdate=!1,e.pointMap=_,e.update(),e}return Be(i,a),i.prototype.update=function(){var t=this.geometry,e=this.pointMap;si.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),hi("c",e,t,si,0,0,-1),hi("t",e,t,si,0,0,1),hi("n1",e,t,si,-1,-1,-1),hi("n2",e,t,si,1,-1,-1),hi("n3",e,t,si,-1,1,-1),hi("n4",e,t,si,1,1,-1),hi("f1",e,t,si,-1,-1,1),hi("f2",e,t,si,1,-1,1),hi("f3",e,t,si,-1,1,1),hi("f4",e,t,si,1,1,1),hi("u1",e,t,si,.7,1.1,-1),hi("u2",e,t,si,-.7,1.1,-1),hi("u3",e,t,si,0,2,-1),hi("cf1",e,t,si,-1,0,1),hi("cf2",e,t,si,1,0,1),hi("cf3",e,t,si,0,-1,1),hi("cf4",e,t,si,0,1,1),hi("cn1",e,t,si,-1,0,-1),hi("cn2",e,t,si,1,0,-1),hi("cn3",e,t,si,0,-1,-1),hi("cn4",e,t,si,0,1,-1),t.getAttribute("position").needsUpdate=!0},i}(Ii);function hi(a,i,t,e,n,s,l){wo.set(n,s,l).unproject(e);var p=i[a];if(p!==void 0)for(var _=t.getAttribute("position"),v=0,A=p.length;v<A;v++)_.setXYZ(p[v],wo.x,wo.y,wo.z)}var Gl,jc,pr,Eo=new xi,Wc=function(a){function i(e,n){var s;n===void 0&&(n=16776960);var l=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),p=new Float32Array(24),_=new ct;return _.setIndex(new ft(l,1)),_.setAttribute("position",new ft(p,3)),(s=a.call(this,_,new yi({color:n,toneMapped:!1}))||this).object=e,s.type="BoxHelper",s.matrixAutoUpdate=!1,s.update(),s}Be(i,a);var t=i.prototype;return t.update=function(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&Eo.setFromObject(this.object),!Eo.isEmpty()){var n=Eo.min,s=Eo.max,l=this.geometry.attributes.position,p=l.array;p[0]=s.x,p[1]=s.y,p[2]=s.z,p[3]=n.x,p[4]=s.y,p[5]=s.z,p[6]=n.x,p[7]=n.y,p[8]=s.z,p[9]=s.x,p[10]=n.y,p[11]=s.z,p[12]=s.x,p[13]=s.y,p[14]=n.z,p[15]=n.x,p[16]=s.y,p[17]=n.z,p[18]=n.x,p[19]=n.y,p[20]=n.z,p[21]=s.x,p[22]=n.y,p[23]=n.z,l.needsUpdate=!0,this.geometry.computeBoundingSphere()}},t.setFromObject=function(e){return this.object=e,this.update(),this},t.copy=function(e){return Ii.prototype.copy.call(this,e),this.object=e.object,this},i}(Ii),fp=function(a){function i(t,e){var n;e===void 0&&(e=16776960);var s=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),l=new ct;return l.setIndex(new ft(s,1)),l.setAttribute("position",new st([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),(n=a.call(this,l,new yi({color:e,toneMapped:!1}))||this).box=t,n.type="Box3Helper",n.geometry.computeBoundingSphere(),n}return Be(i,a),i.prototype.updateMatrixWorld=function(t){var e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),a.prototype.updateMatrixWorld.call(this,t))},i}(Ii),mp=function(a){function i(t,e,n){var s;e===void 0&&(e=1),n===void 0&&(n=16776960);var l=n,p=new ct;p.setAttribute("position",new st([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),p.computeBoundingSphere(),(s=a.call(this,p,new yi({color:l,toneMapped:!1}))||this).type="PlaneHelper",s.plane=t,s.size=e;var _=new ct;return _.setAttribute("position",new st([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),_.computeBoundingSphere(),s.add(new Jt(_,new zn({color:l,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1}))),s}return Be(i,a),i.prototype.updateMatrixWorld=function(t){var e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?1:0,this.lookAt(this.plane.normal),a.prototype.updateMatrixWorld.call(this,t)},i}(vn),Vc=new te,_p=function(a){function i(e,n,s,l,p,_){var v;return e===void 0&&(e=new te(0,0,1)),n===void 0&&(n=new te(0,0,0)),s===void 0&&(s=1),l===void 0&&(l=16776960),p===void 0&&(p=.2*s),_===void 0&&(_=.2*p),(v=a.call(this)||this).type="ArrowHelper",Gl===void 0&&((Gl=new ct).setAttribute("position",new st([0,0,0,0,1,0],3)),(jc=new ss(0,.5,1,5,1)).translate(0,-.5,0)),v.position.copy(n),v.line=new vn(Gl,new yi({color:l,toneMapped:!1})),v.line.matrixAutoUpdate=!1,v.add(v.line),v.cone=new Jt(jc,new zn({color:l,toneMapped:!1})),v.cone.matrixAutoUpdate=!1,v.add(v.cone),v.setDirection(e),v.setLength(s,p,_),v}Be(i,a);var t=i.prototype;return t.setDirection=function(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Vc.set(e.z,0,-e.x).normalize();var n=Math.acos(e.y);this.quaternion.setFromAxisAngle(Vc,n)}},t.setLength=function(e,n,s){n===void 0&&(n=.2*e),s===void 0&&(s=.2*n),this.line.scale.set(1,Math.max(1e-4,e-n),1),this.line.updateMatrix(),this.cone.scale.set(s,n,s),this.cone.position.y=e,this.cone.updateMatrix()},t.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},t.copy=function(e){return a.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},i}(Ge),Gc=function(a){function i(t){var e;t===void 0&&(t=1);var n=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],s=new ct;s.setAttribute("position",new st(n,3)),s.setAttribute("color",new st([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var l=new yi({vertexColors:!0,toneMapped:!1});return(e=a.call(this,s,l)||this).type="AxesHelper",e}return Be(i,a),i}(Ii),Hc=new Float32Array(1),gp=new Int32Array(Hc.buffer),vp={toHalfFloat:function(i){Hc[0]=i;var t=gp[0],e=t>>16&32768,n=t>>12&2047,s=t>>23&255;return s<103?e:s>142?(e|=31744,e|=(s==255?0:1)&&8388607&t):s<113?e|=((n|=2048)>>114-s)+(n>>113-s&1):(e|=s-112<<10|n>>1,e+=1&n)}},Ln=Math.pow(2,8),Kc=[.125,.215,.35,.446,.526,.582],Yc=5+Kc.length,sa=20,Pn=((pr={})[3e3]=0,pr[3001]=1,pr[3002]=2,pr[3004]=3,pr[3005]=4,pr[3006]=5,pr[3007]=6,pr),Br=new zn({side:1,depthWrite:!1,depthTest:!1}),yp=new Jt(new wr,Br),Hl=new ta,Kl=Sp(),aa=Kl._lodPlanes,Xc=Kl._sizeLods,Ao=Kl._sigmas,qc=new nt,Yl=null,Nr=(1+Math.sqrt(5))/2,us=1/Nr,Zc=[new te(1,1,1),new te(-1,1,1),new te(1,1,-1),new te(-1,1,-1),new te(0,Nr,us),new te(0,Nr,-us),new te(us,0,Nr),new te(-us,0,Nr),new te(Nr,us,0),new te(-Nr,us,0)];function Qc(a){var i=Math.max(a.r,a.g,a.b),t=Math.min(Math.max(Math.ceil(Math.log2(i)),-128),127);return a.multiplyScalar(Math.pow(2,-t)),(t+128)/255}var bp=function(){function a(t){var e,n,s;this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=(e=sa,n=new Float32Array(e),s=new te(0,1,0),new ls({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s},inputEncoding:{value:Pn[3e3]},outputEncoding:{value:Pn[3e3]}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute vec3 position;
		attribute vec2 uv;
		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			

		uniform int inputEncoding;
		uniform int outputEncoding;

		#include <encodings_pars_fragment>

		vec4 inputTexelToLinear( vec4 value ) {

			if ( inputEncoding == 0 ) {

				return value;

			} else if ( inputEncoding == 1 ) {

				return sRGBToLinear( value );

			} else if ( inputEncoding == 2 ) {

				return RGBEToLinear( value );

			} else if ( inputEncoding == 3 ) {

				return RGBMToLinear( value, 7.0 );

			} else if ( inputEncoding == 4 ) {

				return RGBMToLinear( value, 16.0 );

			} else if ( inputEncoding == 5 ) {

				return RGBDToLinear( value, 256.0 );

			} else {

				return GammaToLinear( value, 2.2 );

			}

		}

		vec4 linearToOutputTexel( vec4 value ) {

			if ( outputEncoding == 0 ) {

				return value;

			} else if ( outputEncoding == 1 ) {

				return LinearTosRGB( value );

			} else if ( outputEncoding == 2 ) {

				return LinearToRGBE( value );

			} else if ( outputEncoding == 3 ) {

				return LinearToRGBM( value, 7.0 );

			} else if ( outputEncoding == 4 ) {

				return LinearToRGBM( value, 16.0 );

			} else if ( outputEncoding == 5 ) {

				return LinearToRGBD( value, 256.0 );

			} else {

				return LinearToGamma( value, 2.2 );

			}

		}

		vec4 envMapTexelToLinear( vec4 color ) {

			return inputTexelToLinear( color );

		}
	

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}var i=a.prototype;return i.fromScene=function(t,e,n,s){e===void 0&&(e=0),n===void 0&&(n=.1),s===void 0&&(s=100),Yl=this._renderer.getRenderTarget();var l=this._allocateTargets();return this._sceneToCubeUV(t,n,s,l),e>0&&this._blur(l,0,0,e),this._applyPMREM(l),this._cleanup(l),l},i.fromEquirectangular=function(t){return this._fromTexture(t)},i.fromCubemap=function(t){return this._fromTexture(t)},i.compileCubemapShader=function(){this._cubemapShader===null&&(this._cubemapShader=eu(),this._compileMaterial(this._cubemapShader))},i.compileEquirectangularShader=function(){this._equirectShader===null&&(this._equirectShader=$c(),this._compileMaterial(this._equirectShader))},i.dispose=function(){this._blurMaterial.dispose(),this._cubemapShader!==null&&this._cubemapShader.dispose(),this._equirectShader!==null&&this._equirectShader.dispose();for(var t=0;t<aa.length;t++)aa[t].dispose()},i._cleanup=function(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Yl),t.scissorTest=!1,To(t,0,0,t.width,t.height)},i._fromTexture=function(t){Yl=this._renderer.getRenderTarget();var e=this._allocateTargets(t);return this._textureToCubeUV(t,e),this._applyPMREM(e),this._cleanup(e),e},i._allocateTargets=function(t){var e={magFilter:x,minFilter:x,generateMipmaps:!1,type:z,format:1023,encoding:xp(t)?t.encoding:mr,depthBuffer:!1},n=Jc(e);return n.depthBuffer=!t,this._pingPongRenderTarget=Jc(e),n},i._compileMaterial=function(t){var e=new Jt(aa[0],t);this._renderer.compile(e,Hl)},i._sceneToCubeUV=function(t,e,n,s){var l=new di(90,1,e,n),p=[1,-1,1,1,1,1],_=[1,1,1,-1,-1,-1],v=this._renderer,A=v.autoClear,E=v.outputEncoding,L=v.toneMapping;v.getClearColor(qc),v.toneMapping=0,v.outputEncoding=_i,v.autoClear=!1;var D=!1,B=t.background;if(B){if(B.isColor){Br.color.copy(B).convertSRGBToLinear(),t.background=null;var U=Qc(Br.color);Br.opacity=U,D=!0}}else{Br.color.copy(qc).convertSRGBToLinear();var V=Qc(Br.color);Br.opacity=V,D=!0}for(var j=0;j<6;j++){var K=j%3;K==0?(l.up.set(0,p[j],0),l.lookAt(_[j],0,0)):K==1?(l.up.set(0,0,p[j]),l.lookAt(0,_[j],0)):(l.up.set(0,p[j],0),l.lookAt(0,0,_[j])),To(s,K*Ln,j>2?Ln:0,Ln,Ln),v.setRenderTarget(s),D&&v.render(yp,l),v.render(t,l)}v.toneMapping=L,v.outputEncoding=E,v.autoClear=A},i._textureToCubeUV=function(t,e){var n=this._renderer;t.isCubeTexture?this._cubemapShader==null&&(this._cubemapShader=eu()):this._equirectShader==null&&(this._equirectShader=$c());var s=t.isCubeTexture?this._cubemapShader:this._equirectShader,l=new Jt(aa[0],s),p=s.uniforms;p.envMap.value=t,t.isCubeTexture||p.texelSize.value.set(1/t.image.width,1/t.image.height),p.inputEncoding.value=Pn[t.encoding],p.outputEncoding.value=Pn[e.texture.encoding],To(e,0,0,3*Ln,2*Ln),n.setRenderTarget(e),n.render(l,Hl)},i._applyPMREM=function(t){var e=this._renderer,n=e.autoClear;e.autoClear=!1;for(var s=1;s<Yc;s++){var l=Math.sqrt(Ao[s]*Ao[s]-Ao[s-1]*Ao[s-1]),p=Zc[(s-1)%Zc.length];this._blur(t,s-1,s,l,p)}e.autoClear=n},i._blur=function(t,e,n,s,l){var p=this._pingPongRenderTarget;this._halfBlur(t,p,e,n,s,"latitudinal",l),this._halfBlur(p,t,n,n,s,"longitudinal",l)},i._halfBlur=function(t,e,n,s,l,p,_){var v=this._renderer,A=this._blurMaterial;p!=="latitudinal"&&p!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");var E=new Jt(aa[s],A),L=A.uniforms,D=Xc[n]-1,B=isFinite(l)?Math.PI/(2*D):2*Math.PI/39,U=l/B,V=isFinite(l)?1+Math.floor(3*U):sa;V>sa&&console.warn("sigmaRadians, "+l+", is too large and will clip, as it requested "+V+" samples when the maximum is set to "+sa);for(var j=[],K=0,ee=0;ee<sa;++ee){var J=ee/U,$=Math.exp(-J*J/2);j.push($),ee==0?K+=$:ee<V&&(K+=2*$)}for(var se=0;se<j.length;se++)j[se]=j[se]/K;L.envMap.value=t.texture,L.samples.value=V,L.weights.value=j,L.latitudinal.value=p==="latitudinal",_&&(L.poleAxis.value=_),L.dTheta.value=B,L.mipInt.value=8-n,L.inputEncoding.value=Pn[t.texture.encoding],L.outputEncoding.value=Pn[t.texture.encoding];var re=Xc[s];To(e,3*Math.max(0,Ln-2*re),(s===0?0:2*Ln)+2*re*(s>4?s-8+4:0),3*re,2*re),v.setRenderTarget(e),v.render(E,Hl)},a}();function xp(a){return a!==void 0&&a.type===z&&(a.encoding===_i||a.encoding===Vn||a.encoding===Gn)}function Sp(){for(var a=[],i=[],t=[],e=8,n=0;n<Yc;n++){var s=Math.pow(2,e);i.push(s);var l=1/s;n>4?l=Kc[n-8+4-1]:n==0&&(l=0),t.push(l);for(var p=1/(s-1),_=-p/2,v=1+p/2,A=[_,_,v,_,v,v,_,_,v,v,_,v],E=new Float32Array(108),L=new Float32Array(72),D=new Float32Array(36),B=0;B<6;B++){var U=B%3*2/3-1,V=B>2?0:-1,j=[U,V,0,U+2/3,V,0,U+2/3,V+1,0,U,V,0,U+2/3,V+1,0,U,V+1,0];E.set(j,18*B),L.set(A,12*B);var K=[B,B,B,B,B,B];D.set(K,6*B)}var ee=new ct;ee.setAttribute("position",new ft(E,3)),ee.setAttribute("uv",new ft(L,2)),ee.setAttribute("faceIndex",new ft(D,1)),a.push(ee),e>4&&e--}return{_lodPlanes:a,_sizeLods:i,_sigmas:t}}function Jc(a){var i=new tn(3*Ln,3*Ln,a);return i.texture.mapping=c,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function To(a,i,t,e,n){a.viewport.set(i,t,e,n),a.scissor.set(i,t,e,n)}function $c(){var a=new Ve(1,1);return new ls({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:a},inputEncoding:{value:Pn[3e3]},outputEncoding:{value:Pn[3e3]}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute vec3 position;
		attribute vec2 uv;
		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform vec2 texelSize;

			

		uniform int inputEncoding;
		uniform int outputEncoding;

		#include <encodings_pars_fragment>

		vec4 inputTexelToLinear( vec4 value ) {

			if ( inputEncoding == 0 ) {

				return value;

			} else if ( inputEncoding == 1 ) {

				return sRGBToLinear( value );

			} else if ( inputEncoding == 2 ) {

				return RGBEToLinear( value );

			} else if ( inputEncoding == 3 ) {

				return RGBMToLinear( value, 7.0 );

			} else if ( inputEncoding == 4 ) {

				return RGBMToLinear( value, 16.0 );

			} else if ( inputEncoding == 5 ) {

				return RGBDToLinear( value, 256.0 );

			} else {

				return GammaToLinear( value, 2.2 );

			}

		}

		vec4 linearToOutputTexel( vec4 value ) {

			if ( outputEncoding == 0 ) {

				return value;

			} else if ( outputEncoding == 1 ) {

				return LinearTosRGB( value );

			} else if ( outputEncoding == 2 ) {

				return LinearToRGBE( value );

			} else if ( outputEncoding == 3 ) {

				return LinearToRGBM( value, 7.0 );

			} else if ( outputEncoding == 4 ) {

				return LinearToRGBM( value, 16.0 );

			} else if ( outputEncoding == 5 ) {

				return LinearToRGBD( value, 256.0 );

			} else {

				return LinearToGamma( value, 2.2 );

			}

		}

		vec4 envMapTexelToLinear( vec4 color ) {

			return inputTexelToLinear( color );

		}
	

			#include <common>

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				vec2 f = fract( uv / texelSize - 0.5 );
				uv -= f * texelSize;
				vec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x += texelSize.x;
				vec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.y += texelSize.y;
				vec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x -= texelSize.x;
				vec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;

				vec3 tm = mix( tl, tr, f.x );
				vec3 bm = mix( bl, br, f.x );
				gl_FragColor.rgb = mix( tm, bm, f.y );

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}function eu(){return new ls({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:Pn[3e3]},outputEncoding:{value:Pn[3e3]}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute vec3 position;
		attribute vec2 uv;
		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			

		uniform int inputEncoding;
		uniform int outputEncoding;

		#include <encodings_pars_fragment>

		vec4 inputTexelToLinear( vec4 value ) {

			if ( inputEncoding == 0 ) {

				return value;

			} else if ( inputEncoding == 1 ) {

				return sRGBToLinear( value );

			} else if ( inputEncoding == 2 ) {

				return RGBEToLinear( value );

			} else if ( inputEncoding == 3 ) {

				return RGBMToLinear( value, 7.0 );

			} else if ( inputEncoding == 4 ) {

				return RGBMToLinear( value, 16.0 );

			} else if ( inputEncoding == 5 ) {

				return RGBDToLinear( value, 256.0 );

			} else {

				return GammaToLinear( value, 2.2 );

			}

		}

		vec4 linearToOutputTexel( vec4 value ) {

			if ( outputEncoding == 0 ) {

				return value;

			} else if ( outputEncoding == 1 ) {

				return LinearTosRGB( value );

			} else if ( outputEncoding == 2 ) {

				return LinearToRGBE( value );

			} else if ( outputEncoding == 3 ) {

				return LinearToRGBM( value, 7.0 );

			} else if ( outputEncoding == 4 ) {

				return LinearToRGBM( value, 16.0 );

			} else if ( outputEncoding == 5 ) {

				return LinearToRGBD( value, 256.0 );

			} else {

				return LinearToGamma( value, 2.2 );

			}

		}

		vec4 envMapTexelToLinear( vec4 color ) {

			return inputTexelToLinear( color );

		}
	

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;
				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}Ni.create=function(a,i){return console.log("THREE.Curve.create() has been deprecated"),a.prototype=Object.create(Ni.prototype),a.prototype.constructor=a,a.prototype.getPoint=i,a},$s.prototype.fromPoints=function(a){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(a)},zc.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Ic.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},ri.prototype.extractUrlBase=function(a){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Ol.extractUrlBase(a)},ri.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},cs.prototype.center=function(a){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(a)},cs.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},cs.prototype.isIntersectionBox=function(a){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(a)},cs.prototype.size=function(a){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(a)},xi.prototype.center=function(a){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(a)},xi.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},xi.prototype.isIntersectionBox=function(a){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(a)},xi.prototype.isIntersectionSphere=function(a){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(a)},xi.prototype.size=function(a){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(a)},mn.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Ms.prototype.setFromMatrix=function(a){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(a)},Rc.prototype.center=function(a){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(a)},dt.random16=function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},dt.nearestPowerOfTwo=function(a){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),dt.floorPowerOfTwo(a)},dt.nextPowerOfTwo=function(a){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),dt.ceilPowerOfTwo(a)},Vt.prototype.flattenToArrayOffset=function(a,i){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(a,i)},Vt.prototype.multiplyVector3=function(a){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),a.applyMatrix3(this)},Vt.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Vt.prototype.applyToBufferAttribute=function(a){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),a.applyMatrix3(this)},Vt.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Vt.prototype.getInverse=function(a){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(a).invert()},ht.prototype.extractPosition=function(a){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(a)},ht.prototype.flattenToArrayOffset=function(a,i){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(a,i)},ht.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new te().setFromMatrixColumn(this,3)},ht.prototype.setRotationFromQuaternion=function(a){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(a)},ht.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},ht.prototype.multiplyVector3=function(a){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),a.applyMatrix4(this)},ht.prototype.multiplyVector4=function(a){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),a.applyMatrix4(this)},ht.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},ht.prototype.rotateAxis=function(a){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),a.transformDirection(this)},ht.prototype.crossVector=function(a){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),a.applyMatrix4(this)},ht.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},ht.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},ht.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},ht.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},ht.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},ht.prototype.applyToBufferAttribute=function(a){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),a.applyMatrix4(this)},ht.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},ht.prototype.makeFrustum=function(a,i,t,e,n,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(a,i,e,t,n,s)},ht.prototype.getInverse=function(a){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(a).invert()},Oi.prototype.isIntersectionLine=function(a){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(a)},ni.prototype.multiplyVector3=function(a){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),a.applyQuaternion(this)},ni.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},sn.prototype.isIntersectionBox=function(a){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(a)},sn.prototype.isIntersectionPlane=function(a){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(a)},sn.prototype.isIntersectionSphere=function(a){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(a)},Si.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},Si.prototype.barycoordFromPoint=function(a,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(a,i)},Si.prototype.midpoint=function(a){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(a)},Si.prototypenormal=function(a){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(a)},Si.prototype.plane=function(a){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(a)},Si.barycoordFromPoint=function(a,i,t,e,n){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Si.getBarycoord(a,i,t,e,n)},Si.normal=function(a,i,t,e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Si.getNormal(a,i,t,e)},ur.prototype.extractAllPoints=function(a){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(a)},ur.prototype.extrude=function(a){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new kn(this,a)},ur.prototype.makeGeometry=function(a){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Vs(this,a)},Ve.prototype.fromAttribute=function(a,i,t){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(a,i,t)},Ve.prototype.distanceToManhattan=function(a){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(a)},Ve.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},te.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},te.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},te.prototype.getPositionFromMatrix=function(a){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(a)},te.prototype.getScaleFromMatrix=function(a){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(a)},te.prototype.getColumnFromMatrix=function(a,i){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(i,a)},te.prototype.applyProjection=function(a){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(a)},te.prototype.fromAttribute=function(a,i,t){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(a,i,t)},te.prototype.distanceToManhattan=function(a){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(a)},te.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Ft.prototype.fromAttribute=function(a,i,t){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(a,i,t)},Ft.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Ge.prototype.getChildByName=function(a){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(a)},Ge.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},Ge.prototype.translate=function(a,i){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(i,a)},Ge.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},Ge.prototype.applyMatrix=function(a){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(a)},Object.defineProperties(Ge.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(i){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=i}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Jt.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(Jt.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(qo.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Zo.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Bs.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Ni.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(i){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=i}}),di.prototype.setLens=function(a,i){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),i!==void 0&&(this.filmGauge=i),this.setFocalLength(a)},Object.defineProperties(xn.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(i){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=i}},shadowCameraLeft:{set:function(i){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=i}},shadowCameraRight:{set:function(i){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=i}},shadowCameraTop:{set:function(i){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=i}},shadowCameraBottom:{set:function(i){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=i}},shadowCameraNear:{set:function(i){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=i}},shadowCameraFar:{set:function(i){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=i}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(i){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=i}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(i){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=i}},shadowMapHeight:{set:function(i){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=i}}}),Object.defineProperties(ft.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Wi},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Wi)}}}),ft.prototype.setDynamic=function(a){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(a===!0?Wi:un),this},ft.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},ft.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},ct.prototype.addIndex=function(a){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(a)},ct.prototype.addAttribute=function(a,i){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),i&&i.isBufferAttribute||i&&i.isInterleavedBufferAttribute?a==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(i),this):this.setAttribute(a,i):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(a,new ft(arguments[1],arguments[2])))},ct.prototype.addDrawCall=function(a,i,t){t!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(a,i)},ct.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},ct.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},ct.prototype.removeAttribute=function(a){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(a)},ct.prototype.applyMatrix=function(a){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(a)},Object.defineProperties(ct.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(na.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(i){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=i}}}),Object.defineProperties(jl.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(i){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=i}}}),Object.defineProperties(ki.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===Wi},set:function(i){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(i)}}}),ki.prototype.setDynamic=function(a){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(a===!0?Wi:un),this},ki.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},kn.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},kn.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},kn.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},Ra.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Object.defineProperties(Cc.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Gt.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new nt}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(i){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===1}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(i){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=i}}}),Object.defineProperties(ao.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(cr.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(i){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=i}}}),Object.defineProperties(Ui.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(i){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=i}}}),Kt.prototype.clearTarget=function(a,i,t,e){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(a),this.clear(i,t,e)},Kt.prototype.animate=function(a){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(a)},Kt.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},Kt.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},Kt.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},Kt.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},Kt.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},Kt.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},Kt.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},Kt.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},Kt.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},Kt.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},Kt.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},Kt.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},Kt.prototype.enableScissorTest=function(a){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(a)},Kt.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},Kt.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},Kt.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},Kt.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},Kt.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},Kt.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},Kt.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},Kt.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},Kt.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},Kt.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(Kt.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(i){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=i}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(i){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=i}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(i){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=i===!0?Vn:_i}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(bh.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(tn.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(i){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=i}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(i){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=i}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(i){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=i}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(i){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=i}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(i){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=i}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(i){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=i}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(i){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=i}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(i){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=i}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(i){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=i}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(i){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=i}}}),Object.defineProperties(Fl.prototype,{load:{value:function(i){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return new fc().load(i,function(e){t.setBuffer(e)}),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),wc.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Ta.prototype.updateCubeMap=function(a,i){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(a,i)},Ta.prototype.clear=function(a,i,t,e){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(a,i,t,e)},Hi.crossOrigin=void 0,Hi.loadTexture=function(a,i,t,e){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var n=new po;n.setCrossOrigin(this.crossOrigin);var s=n.load(a,t,void 0,e);return i&&(s.mapping=i),s},Hi.loadTextureCube=function(a,i,t,e){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var n=new Jh;n.setCrossOrigin(this.crossOrigin);var s=n.load(a,t,void 0,e);return i&&(s.mapping=i),s},Hi.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Hi.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var wp={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:I}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=I),d.ACESFilmicToneMapping=4,d.AddEquation=f,d.AddOperation=2,d.AdditiveAnimationBlendMode=Wn,d.AdditiveBlending=2,d.AlphaFormat=1021,d.AlwaysDepth=1,d.AlwaysStencilFunc=519,d.AmbientLight=Pl,d.AmbientLightProbe=_c,d.AnimationClip=Xs,d.AnimationLoader=Ud,d.AnimationMixer=Mc,d.AnimationObjectGroup=Tc,d.AnimationUtils=$t,d.ArcCurve=ml,d.ArrayCamera=Da,d.ArrowHelper=_p,d.Audio=Fl,d.AudioAnalyser=wc,d.AudioContext=Nl,d.AudioListener=Kd,d.AudioLoader=fc,d.AxesHelper=Gc,d.AxisHelper=function(a){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Gc(a)},d.BackSide=1,d.BasicDepthPacking=3200,d.BasicShadowMap=0,d.BinaryTextureLoader=function(a){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new uo(a)},d.Bone=Ns,d.BooleanKeyframeTrack=Cr,d.BoundingBoxHelper=function(a,i){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Wc(a,i)},d.Box2=cs,d.Box3=xi,d.Box3Helper=fp,d.BoxBufferGeometry=wr,d.BoxGeometry=wr,d.BoxHelper=Wc,d.BufferAttribute=ft,d.BufferGeometry=ct,d.BufferGeometryLoader=cc,d.ByteType=1010,d.Cache=Pr,d.Camera=sr,d.CameraHelper=pp,d.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},d.CanvasTexture=Vh,d.CatmullRomCurve3=bl,d.CineonToneMapping=3,d.CircleBufferGeometry=Ga,d.CircleGeometry=Ga,d.ClampToEdgeWrapping=m,d.Clock=yc,d.Color=nt,d.ColorKeyframeTrack=dl,d.CompressedTexture=el,d.CompressedTextureLoader=fl,d.ConeBufferGeometry=Ha,d.ConeGeometry=Ha,d.CubeCamera=Ta,d.CubeReflectionMapping=b,d.CubeRefractionMapping=h,d.CubeTexture=Zr,d.CubeTextureLoader=Jh,d.CubeUVReflectionMapping=c,d.CubeUVRefractionMapping=u,d.CubicBezierCurve=mo,d.CubicBezierCurve3=xl,d.CubicInterpolant=oo,d.CullFaceBack=1,d.CullFaceFront=2,d.CullFaceFrontBack=3,d.CullFaceNone=0,d.Curve=Ni,d.CurvePath=tc,d.CustomBlending=5,d.CustomToneMapping=5,d.CylinderBufferGeometry=ss,d.CylinderGeometry=ss,d.Cylindrical=ap,d.DataTexture=Qr,d.DataTexture2DArray=Wo,d.DataTexture3D=Vo,d.DataTextureLoader=uo,d.DataUtils=vp,d.DecrementStencilOp=7683,d.DecrementWrapStencilOp=34056,d.DefaultLoadingManager=Qh,d.DepthFormat=q,d.DepthStencilFormat=ce,d.DepthTexture=Gh,d.DirectionalLight=Ll,d.DirectionalLightHelper=dp,d.DiscreteInterpolant=lo,d.DodecahedronBufferGeometry=Ka,d.DodecahedronGeometry=Ka,d.DoubleSide=2,d.DstAlphaFactor=206,d.DstColorFactor=208,d.DynamicBufferAttribute=function(a,i){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new ft(a,i).setUsage(Wi)},d.DynamicCopyUsage=35050,d.DynamicDrawUsage=Wi,d.DynamicReadUsage=35049,d.EdgesGeometry=il,d.EdgesHelper=function(a,i){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Ii(new il(a.geometry),new yi({color:i!==void 0?i:16777215}))},d.EllipseCurve=qs,d.EqualDepth=4,d.EqualStencilFunc=514,d.EquirectangularReflectionMapping=r,d.EquirectangularRefractionMapping=o,d.Euler=pt,d.EventDispatcher=wi,d.ExtrudeBufferGeometry=kn,d.ExtrudeGeometry=kn,d.FaceColors=1,d.FileLoader=cn,d.FlatShading=1,d.Float16BufferAttribute=ws,d.Float32Attribute=function(a,i){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new st(a,i)},d.Float32BufferAttribute=st,d.Float64Attribute=function(a,i){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Es(a,i)},d.Float64BufferAttribute=Es,d.FloatType=S,d.Fog=Yo,d.FogExp2=Ko,d.Font=Bl,d.FontLoader=Vd,d.FrontSide=0,d.Frustum=Ms,d.GLBufferAttribute=kl,d.GLSL1="100",d.GLSL3=Hn,d.GammaEncoding=Gn,d.GreaterDepth=6,d.GreaterEqualDepth=5,d.GreaterEqualStencilFunc=518,d.GreaterStencilFunc=516,d.GridHelper=zc,d.Group=Er,d.HalfFloatType=F,d.HemisphereLight=El,d.HemisphereLightHelper=cp,d.HemisphereLightProbe=mc,d.IcosahedronBufferGeometry=Ja,d.IcosahedronGeometry=Ja,d.ImageBitmapLoader=Il,d.ImageLoader=co,d.ImageUtils=Hi,d.ImmediateRenderObject=ra,d.IncrementStencilOp=7682,d.IncrementWrapStencilOp=34055,d.InstancedBufferAttribute=vo,d.InstancedBufferGeometry=na,d.InstancedInterleavedBuffer=Ul,d.InstancedMesh=ka,d.Int16Attribute=function(a,i){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new xs(a,i)},d.Int16BufferAttribute=xs,d.Int32Attribute=function(a,i){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Ss(a,i)},d.Int32BufferAttribute=Ss,d.Int8Attribute=function(a,i){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new vs(a,i)},d.Int8BufferAttribute=vs,d.IntType=1013,d.InterleavedBuffer=ki,d.InterleavedBufferAttribute=or,d.Interpolant=Qi,d.InterpolateDiscrete=ot,d.InterpolateLinear=$e,d.InterpolateSmooth=_t,d.InvertStencilOp=5386,d.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},d.KeepStencilOp=ji,d.KeyframeTrack=yn,d.LOD=qo,d.LatheBufferGeometry=$a,d.LatheGeometry=$a,d.Layers=Bt,d.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},d.LessDepth=2,d.LessEqualDepth=3,d.LessEqualStencilFunc=515,d.LessStencilFunc=513,d.Light=xn,d.LightProbe=ia,d.Line=vn,d.Line3=Rc,d.LineBasicMaterial=yi,d.LineCurve=Js,d.LineCurve3=ec,d.LineDashedMaterial=ul,d.LineLoop=Jo,d.LinePieces=1,d.LineSegments=Ii,d.LineStrip=0,d.LinearEncoding=_i,d.LinearFilter=P,d.LinearInterpolant=Hs,d.LinearMipMapLinearFilter=1008,d.LinearMipMapNearestFilter=1007,d.LinearMipmapLinearFilter=M,d.LinearMipmapNearestFilter=T,d.LinearToneMapping=1,d.Loader=ri,d.LoaderUtils=Ol,d.LoadingManager=pl,d.LogLuvEncoding=3003,d.LoopOnce=2200,d.LoopPingPong=2202,d.LoopRepeat=2201,d.LuminanceAlphaFormat=1025,d.LuminanceFormat=1024,d.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},d.Material=Gt,d.MaterialLoader=hc,d.Math=dt,d.MathUtils=dt,d.Matrix3=Vt,d.Matrix4=ht,d.MaxEquation=104,d.Mesh=Jt,d.MeshBasicMaterial=zn,d.MeshDepthMaterial=La,d.MeshDistanceMaterial=Pa,d.MeshFaceMaterial=function(a){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),a},d.MeshLambertMaterial=hl,d.MeshMatcapMaterial=cl,d.MeshNormalMaterial=ll,d.MeshPhongMaterial=ao,d.MeshPhysicalMaterial=cr,d.MeshStandardMaterial=Cn,d.MeshToonMaterial=ol,d.MinEquation=103,d.MirroredRepeatWrapping=y,d.MixOperation=1,d.MultiMaterial=function(a){return a===void 0&&(a=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),a.isMultiMaterial=!0,a.materials=a,a.clone=function(){return a.slice()},a},d.MultiplyBlending=4,d.MultiplyOperation=0,d.NearestFilter=x,d.NearestMipMapLinearFilter=1005,d.NearestMipMapNearestFilter=1004,d.NearestMipmapLinearFilter=C,d.NearestMipmapNearestFilter=w,d.NeverDepth=0,d.NeverStencilFunc=512,d.NoBlending=0,d.NoColors=0,d.NoToneMapping=0,d.NormalAnimationBlendMode=Nt,d.NormalBlending=1,d.NotEqualDepth=7,d.NotEqualStencilFunc=517,d.NumberKeyframeTrack=Ks,d.Object3D=Ge,d.ObjectLoader=kd,d.ObjectSpaceNormalMap=1,d.OctahedronBufferGeometry=Ws,d.OctahedronGeometry=Ws,d.OneFactor=201,d.OneMinusDstAlphaFactor=207,d.OneMinusDstColorFactor=209,d.OneMinusSrcAlphaFactor=205,d.OneMinusSrcColorFactor=203,d.OrthographicCamera=ta,d.PCFShadowMap=1,d.PCFSoftShadowMap=2,d.PMREMGenerator=bp,d.ParametricBufferGeometry=Mr,d.ParametricGeometry=Mr,d.Particle=function(a){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Na(a)},d.ParticleBasicMaterial=function(a){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Tr(a)},d.ParticleSystem=function(a,i){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new rs(a,i)},d.ParticleSystemMaterial=function(a){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Tr(a)},d.Path=$s,d.PerspectiveCamera=di,d.Plane=Oi,d.PlaneBufferGeometry=Cs,d.PlaneGeometry=Cs,d.PlaneHelper=mp,d.PointCloud=function(a,i){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new rs(a,i)},d.PointCloudMaterial=function(a){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Tr(a)},d.PointLight=Cl,d.PointLightHelper=lp,d.Points=rs,d.PointsMaterial=Tr,d.PolarGridHelper=up,d.PolyhedronBufferGeometry=lr,d.PolyhedronGeometry=lr,d.PositionalAudio=Xd,d.PropertyBinding=Ci,d.PropertyMixer=Ec,d.QuadraticBezierCurve=_o,d.QuadraticBezierCurve3=Sl,d.Quaternion=ni,d.QuaternionKeyframeTrack=hs,d.QuaternionLinearInterpolant=ho,d.REVISION=I,d.RGBADepthPacking=3201,d.RGBAFormat=H,d.RGBAIntegerFormat=1033,d.RGBA_ASTC_10x10_Format=37819,d.RGBA_ASTC_10x5_Format=37816,d.RGBA_ASTC_10x6_Format=37817,d.RGBA_ASTC_10x8_Format=37818,d.RGBA_ASTC_12x10_Format=37820,d.RGBA_ASTC_12x12_Format=37821,d.RGBA_ASTC_4x4_Format=37808,d.RGBA_ASTC_5x4_Format=37809,d.RGBA_ASTC_5x5_Format=37810,d.RGBA_ASTC_6x5_Format=37811,d.RGBA_ASTC_6x6_Format=37812,d.RGBA_ASTC_8x5_Format=37813,d.RGBA_ASTC_8x6_Format=37814,d.RGBA_ASTC_8x8_Format=37815,d.RGBA_BPTC_Format=36492,d.RGBA_ETC2_EAC_Format=je,d.RGBA_PVRTC_2BPPV1_Format=Ke,d.RGBA_PVRTC_4BPPV1_Format=Me,d.RGBA_S3TC_DXT1_Format=ne,d.RGBA_S3TC_DXT3_Format=he,d.RGBA_S3TC_DXT5_Format=ve,d.RGBDEncoding=wn,d.RGBEEncoding=mr,d.RGBEFormat=1023,d.RGBFormat=G,d.RGBIntegerFormat=1032,d.RGBM16Encoding=bt,d.RGBM7Encoding=In,d.RGB_ETC1_Format=36196,d.RGB_ETC2_Format=Ye,d.RGB_PVRTC_2BPPV1_Format=fe,d.RGB_PVRTC_4BPPV1_Format=Ie,d.RGB_S3TC_DXT1_Format=Q,d.RGFormat=1030,d.RGIntegerFormat=1031,d.RawShaderMaterial=ls,d.Ray=sn,d.Raycaster=jl,d.RectAreaLight=Dl,d.RedFormat=1028,d.RedIntegerFormat=1029,d.ReinhardToneMapping=2,d.RepeatWrapping=g,d.ReplaceStencilOp=7681,d.ReverseSubtractEquation=102,d.RingBufferGeometry=eo,d.RingGeometry=eo,d.SRGB8_ALPHA8_ASTC_10x10_Format=37851,d.SRGB8_ALPHA8_ASTC_10x5_Format=37848,d.SRGB8_ALPHA8_ASTC_10x6_Format=37849,d.SRGB8_ALPHA8_ASTC_10x8_Format=37850,d.SRGB8_ALPHA8_ASTC_12x10_Format=37852,d.SRGB8_ALPHA8_ASTC_12x12_Format=37853,d.SRGB8_ALPHA8_ASTC_4x4_Format=37840,d.SRGB8_ALPHA8_ASTC_5x4_Format=37841,d.SRGB8_ALPHA8_ASTC_5x5_Format=37842,d.SRGB8_ALPHA8_ASTC_6x5_Format=37843,d.SRGB8_ALPHA8_ASTC_6x6_Format=37844,d.SRGB8_ALPHA8_ASTC_8x5_Format=37845,d.SRGB8_ALPHA8_ASTC_8x6_Format=37846,d.SRGB8_ALPHA8_ASTC_8x8_Format=37847,d.Scene=Ra,d.SceneUtils=wp,d.ShaderChunk=Lt,d.ShaderLib=gn,d.ShaderMaterial=Ui,d.ShadowMaterial=al,d.Shape=ur,d.ShapeBufferGeometry=Vs,d.ShapeGeometry=Vs,d.ShapePath=pc,d.ShapeUtils=Un,d.ShortType=1011,d.Skeleton=Zo,d.SkeletonHelper=Ic,d.SkinnedMesh=Bs,d.SmoothShading=2,d.Sphere=mn,d.SphereBufferGeometry=Gs,d.SphereGeometry=Gs,d.Spherical=sp,d.SphericalHarmonics3=Rl,d.SplineCurve=go,d.SpotLight=Tl,d.SpotLightHelper=op,d.Sprite=Na,d.SpriteMaterial=Oa,d.SrcAlphaFactor=204,d.SrcAlphaSaturateFactor=210,d.SrcColorFactor=202,d.StaticCopyUsage=35046,d.StaticDrawUsage=un,d.StaticReadUsage=35045,d.StereoCamera=Gd,d.StreamCopyUsage=35042,d.StreamDrawUsage=35040,d.StreamReadUsage=35041,d.StringKeyframeTrack=Lr,d.SubtractEquation=101,d.SubtractiveBlending=3,d.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},d.TangentSpaceNormalMap=0,d.TetrahedronBufferGeometry=to,d.TetrahedronGeometry=to,d.TextBufferGeometry=io,d.TextGeometry=io,d.Texture=ui,d.TextureLoader=po,d.TorusBufferGeometry=no,d.TorusGeometry=no,d.TorusKnotBufferGeometry=ro,d.TorusKnotGeometry=ro,d.Triangle=Si,d.TriangleFanDrawMode=2,d.TriangleStripDrawMode=1,d.TrianglesDrawMode=0,d.TubeBufferGeometry=so,d.TubeGeometry=so,d.UVMapping=N,d.Uint16Attribute=function(a,i){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new xr(a,i)},d.Uint16BufferAttribute=xr,d.Uint32Attribute=function(a,i){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Sr(a,i)},d.Uint32BufferAttribute=Sr,d.Uint8Attribute=function(a,i){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new ys(a,i)},d.Uint8BufferAttribute=ys,d.Uint8ClampedAttribute=function(a,i){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new bs(a,i)},d.Uint8ClampedBufferAttribute=bs,d.Uniform=Cc,d.UniformsLib=et,d.UniformsUtils=Ql,d.UnsignedByteType=z,d.UnsignedInt248Type=k,d.UnsignedIntType=X,d.UnsignedShort4444Type=1017,d.UnsignedShort5551Type=1018,d.UnsignedShort565Type=1019,d.UnsignedShortType=Y,d.VSMShadowMap=3,d.Vector2=Ve,d.Vector3=te,d.Vector4=Ft,d.VectorKeyframeTrack=Ys,d.Vertex=function(a,i,t){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new te(a,i,t)},d.VertexColors=2,d.VideoTexture=Wh,d.WebGL1Renderer=wh,d.WebGLCubeRenderTarget=Ma,d.WebGLMultisampleRenderTarget=Xn,d.WebGLRenderTarget=tn,d.WebGLRenderTargetCube=function(a,i,t){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Ma(a,t)},d.WebGLRenderer=Kt,d.WebGLUtils=xh,d.WireframeGeometry=sl,d.WireframeHelper=function(a,i){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Ii(new sl(a.geometry),new yi({color:i!==void 0?i:16777215}))},d.WrapAroundEnding=oi,d.XHRLoader=function(a){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new cn(a)},d.ZeroCurvatureEnding=Ut,d.ZeroFactor=200,d.ZeroSlopeEnding=qt,d.ZeroStencilOp=0,d.sRGBEncoding=Vn,Object.defineProperty(d,"__esModule",{value:!0})})},7049:(R,W,d)=>{"use strict";var O,I;O=[d(1203),d(1873),d(3660),d(4371),d(1711),d(3073)],I=d.dj.d(O,function(f,N,b,h,r,o){var c=f([],{getName:function(){},start:function(y,x){},send:function(y){},stop:function(){},isStarted:function(){},isFastChannel:function(){}}),u;u=f([c],{logSubscriptions:!1,constructor:function(y,x,w,C,P){this._streamName=y,this._streamId=x,this._factory=w,this._setDelegate(C),this._subscription={},this._onDisconnected(),this.messageService=P||r.messageService},getName:function(){return this._streamName},send:function(y){var x;return this.isStarted()?y?Object.prototype.toString.call(y)!=="[object ArrayBuffer]"?(o.error("Cannot send as data is not an ArrayBuffer object."),new h().reject("Cannot send as data is not an ArrayBuffer object.")):(x=this._queueSend(y),this._deferProcessQueue(),x):(o.error("Cannot send as data is null."),new h().reject("Cannot send as data is null.")):(o.error("Cannot send as not connected to a stream."),new h().reject("Cannot send as not connected to a stream."))},start:function(y,x){this.logSubscriptions&&o.info("BinaryStream start: "+this._streamName,y,x);var w=this._addHandler(y,x),C;return w?(this._connectHandle=b.after(this.messageService,"onConnected",N.hitch(this,"_onConnected"),!0),this._disconnectHandle=b.after(this.messageService,"onDisconnected",N.hitch(this,"_onDisconnected"),!0),this.messageService.isConnected()?this._onConnected():this._onDisconnected(),this._messageHandle=b.after(this._delegate,"onMessage",N.hitch(this,this._onDelegateMessage),!0),this._closeHandle=b.after(this._delegate,"onClose",N.hitch(this,this._onDelegateClose),!0),this.isStarted()?new h().resolve():(C=this._queueStart(),this._deferProcessQueue(),C)):(o.error("Already connected to a stream, can't start."),new h().reject("Already connected to a stream, can't start."))},stop:function(){this.logSubscriptions&&o.info("BinaryStream stop: "+this._streamName);var y=this._removeHandler(),x;return y?this.isStarted()?(x=this._queueStop().then(N.hitch(this,this._cleanup),N.hitch(this,this._cleanup)),this._deferProcessQueue(),x):(this._cleanup(),new h().resolve()):(this._cleanup(),new h().reject("Not connected to stream, can't stop."))},flush:function(){var y=new h;return this.isConnected()?(this._processQueue(),y.resolve()):y.reject("Can only manually flush the queue when connected."),y.promise},isConnected:function(){return this._isConnected},isStarted:function(){var y=this._delegate&&this._delegate.delegateConnected();return this.isConnected()&&y},isFastChannel:function(){return!1},_setDelegate:function(y){this._delegate=y},_onDisconnected:function(){this._isConnected=!1,this._queuedOps=[]},_onConnected:function(){this._isConnected=!0,this._processQueue()},_queueSend:function(y){var x=new h;return this._queuedOps.push({type:"send",data:y,deferred:x}),x.promise},_queueStart:function(){var y=new h;return this._queuedOps.push({type:"start",deferred:y}),y.promise},_queueStop:function(){var y=new h;return this._queuedOps.push({type:"stop",deferred:y}),y.promise},_processQueue:function(){if(this.isConnected()){var y=this._queuedOps;this._queuedOps=[],y.forEach(function(x){var w;x.type==="send"?this.isStarted()?w=this._delegate.doSend(x.data):this._queuedOps.push(x):x.type==="start"?w=this._doStart():x.type==="stop"&&(w=this._doStop()),w.then(x.deferred.resolve,x.deferred.reject)},this)}},_deferProcessQueue:function(){if(!this._deferredTimeout){var y=this;this._deferredTimeout=setTimeout(function(){y._deferredTimeout=!1,y._processQueue()},0)}},_doStart:function(){if(this.started)return new h().resolve();var y=this._delegate.connect();return this.started=!0,y},_doStop:function(){if(this.started){var y=this._delegate.disconnect();return this.started=!1,y}else return new h().resolve()},_onDelegateMessage:function(y){y&&this._callHandler(y)},_addHandler:function(y,x){if(!this._subscription.hasOwnProperty("handler")){if(x=x||this,typeof y=="string"&&typeof x[y]!="function"){o.warn("Not adding, invalid handler: "+y);return}return this._subscription={handler:y,scope:x},!0}return!1},_removeHandler:function(){var y=this._subscription.hasOwnProperty("handler");return this._subscription={},y},_callHandler:function(y){try{typeof this._subscription.handler=="string"?this._subscription.scope[this._subscription.handler].call(this._subscription.scope,y):this._subscription.handler.call(this._subscription.scope,y)}catch(x){o.error("Error while executing message handler on stream: "+this._streamName+", error: "+x)}},_onDelegateClose:function(){this._cleanup()},_cleanup:function(){this._onDisconnected(),this._connectHandle&&this._connectHandle.remove(),this._disconnectHandle&&this._disconnectHandle.remove(),this._messageHandle&&this._messageHandle.remove(),this._closeHandle&&this._closeHandle.remove(),this._factory&&this._factory._removeStream(this._streamName)}});var g;return g=f([c],{logging:!1,constructor:function(y,x,w){this._streamName=y,this._factory=x,this._fallbackStream=w,this._isStarted=!1,this._subscription={}},getName:function(){return this._streamName},start:function(y,x){if(!this.isStarted()&&window.cefclient&&window.cefclient.createChannel)try{var w=this._addHandler(y,x);if(w){var C=this;window.cefclient.createChannel(this._streamName,function(P,T){T&&C._callHandler({channelName:P,data:T})},[]),this._isStarted=!0,this._logHelper("Successfully created webwindow stream")}else return o.error("Already connected to a stream, can't start."),new h().reject("Already connected to a stream, can't start.");return new h().resolve()}catch(P){o.warn("Could not connect to webwindow stream.")}return this._logHelper("Could not create webwindow stream, using fallback"),this._useFallback=!0,this._fallbackStream.start(y,x)},send:function(y){return this._useFallback?this._fallbackStream.send(y):this.isStarted()?y?Object.prototype.toString.call(y)!=="[object ArrayBuffer]"?(o.error("Cannot send as data is not an ArrayBuffer object."),new h().reject("Cannot send as data is not an ArrayBuffer object.")):(window.cefclient.sendData(this._streamName,y),this._logHelper("Webwindow stream sent data of size: "+y.byteLength),new h().resolve()):(o.error("Cannot send as data is null."),new h().reject("Cannot send as data is null.")):(o.error("Cannot send as not connected to a stream."),new h().reject("Cannot send as not connected to a stream."))},stop:function(){if(this._useFallback)return this._fallbackStream.stop();var y=this._removeHandler();return y?(this.isStarted()&&(window.cefclient.stop(this._streamName),this._logHelper("Stopped webwindow stream"),this._isStarted=!1),this._cleanup(),new h().resolve()):(this._cleanup(),new h().reject("Cannot stop as not connected to a stream."))},isStarted:function(){return this._useFallback?this._fallbackStream.isStarted():this._isStarted},isFastChannel:function(){return this._isStarted&&!this._useFallback},flush:function(){return this._useFallback?this._fallbackStream.flush():new h().resolve()},_cleanup:function(){this._factory&&this._factory._removeStream(this._streamName)},_callHandler:function(y){try{typeof this._subscription.handler=="string"?this._subscription.scope[this._subscription.handler].call(this._subscription.scope,y):this._subscription.handler.call(this._subscription.scope,y)}catch(x){o.error("Error while executing message handler on stream: "+this._streamName+", error: "+x)}},_addHandler:function(y,x){if(!this._subscription.hasOwnProperty("handler")){if(x=x||this,typeof y=="string"&&typeof x[y]!="function"){o.warn("Not adding, invalid handler: "+y);return}return this._subscription={handler:y,scope:x},!0}return!1},_removeHandler:function(){var y=this._subscription.hasOwnProperty("handler");return this._subscription={},y},_logHelper:function(y){this.logging&&o.info(this._streamName+" - "+y)}}),c.Impl=u,c.CefImpl=g,c},R,W),R.exports=I},1919:(R,W,d)=>{"use strict";var O,I;O=[d(1203),d(1873),d(3660),d(3073),d(7049),d(1155)],I=d.dj.d(O,function(f,N,b,h,r,o){var c;c=f([],{logLifeCycle:!1,constructor:function(){this._streams={},this._nextStreamId=-1},createStream:function(y,x,w){if(!this._hasStream(y)){this.logLifeCycle&&h.info("Creating new stream: "+y),this._nextStreamId+=2;var C=w||this._createDelegate(y),P=new r.Impl(y,this._nextStreamId,this,C,x),T=c.enableCefBinaryStream&&window.cefclient&&window.cefclient.createChannel;if(T)var P=new r.CefImpl(y,this,P);this._streams[y]=P}return this._streams[y]},_hasStream:function(y){return this._streams.hasOwnProperty(y)},_removeStream:function(y){return this._hasStream(y)?(this.logLifeCycle&&h.info("Removing stream: "+y),delete this._streams[y],!0):!1},_createDelegate:function(y){return new o(y,this._nextStreamId)}}),c.enableCefBinaryStream=!0,location.search.indexOf("cefbinarystream=off")>=0&&(c.enableCefBinaryStream=!1);var u=new c,g={factory:u,createStream:N.hitch(u,"createStream")};return g},R,W),R.exports=I},9876:(R,W,d)=>{"use strict";var O,I;O=[d(1203),d(1873),d(3073)],I=d.dj.d(O,function(f,N,b){var h={RESERVED:0,SETUP:1,KEEPALIVE:2,CONNECT_STREAM:3,DISCONNECT_STREAM:4,PAYLOAD:5,CANCEL_PAYLOAD:6,ERROR:7,EXT:255},r={EMPTY:0,SETUP_ACK:128,SETUP_RESPOND:64,KEEPALIVE_RESPOND:128,CONNECT_STREAM_ACK:128,PAYLOAD_COMPLETE:128},o={INVALID_SETUP:1,UNSUPPORTED_SETUP:2,REJECTED_SETUP:3,CONNECTION_ERROR:257,APPLICATION_ERROR:513,REJECTED:514,CANCELED:515,INVALID:516,RESERVED:4294967295},c;c=f([],{DEFAULT_MAJOR_VERSION:0,DEFAULT_MINOR_VERSION:1,DEFAULT_KEEPALIVETIME:32,MAX_LIFETIME:65535,MAX_STREAM_ID:4294967295,HEADER_LENGTH:10,ERROR_CODE_LENGTH:4,SETUP_PARAMS_LENGTH:12,HEADER_LENGTH_START:0,HEADER_STREAM_ID_START:4,HEADER_TYPE_START:8,HEADER_FLAGS_START:9,_convertStringToArrayBuffer:function(y){for(var x=new ArrayBuffer(y.length*2),w=new Uint16Array(x),C=0,P=y.length;C<P;C++)w[C]=y.charCodeAt(C);return x},_convertArrayBufferToString:function(y){return String.fromCharCode.apply(null,new Uint16Array(y))},_copyArrayBuffer:function(y,x,w){var C=new Uint8Array(x);C.set(new Uint8Array(y),w)},_deserializeHeaderLength:function(y){var x=y.byteLength,w=y.getUint32(this.HEADER_LENGTH_START);if(x!==w)throw new Error("Header length "+w+" does not match buffer length "+x);return w},_deserializeType:function(y){return y.getUint8(this.HEADER_TYPE_START)},_deserializeFlags:function(y){return y.getUint8(this.HEADER_FLAGS_START)},_deserializeStreamId:function(y){return y.getUint32(this.HEADER_STREAM_ID_START)},_deserializePayload:function(y,x,w){w.payload=y.slice(x)},_deserializeHeader:function(y,x){return x.header={length:this._deserializeHeaderLength(y),streamId:this._deserializeStreamId(y),type:this._deserializeType(y),flags:this._deserializeFlags(y)},this.HEADER_LENGTH},_deserializeErrorCode:function(y,x,w){return w.errorCode=y.getUint32(x),x+=this.ERROR_CODE_LENGTH,x},_deserializeSetupParams:function(y,x,w){w.setupParams={majorVersion:y.getUint32(x),minorVersion:y.getUint32(x+4),keepAliveTime:y.getUint16(x+8),maxLifeTime:y.getUint16(x+10)},x+=this.SETUP_PARAMS_LENGTH;var C=y.getUint8(x);return w.dataEncoding=y.getUint8(x,C*2),x+=1+C,x},deserialize:function(y){var x=new window.DataView(y),w={},C=this._deserializeHeader(x,w);switch(w.header.type){case h.SETUP:C=this._deserializeSetupParams(x,C,w),this._deserializePayload(y,C,w);break;case h.KEEPALIVE:case h.CONNECT_STREAM:case h.PAYLOAD:this._deserializePayload(y,C,w);break;case h.DISCONNECT_STREAM:case h.CANCEL_PAYLOAD:break;case h.ERROR:C=this._deserializeErrorCode(x,C,w),this._deserializePayload(y,C,w);break;default:throw new Error("Invalid frame type")}return w},_computeFrameLength:function(y){var x=this.HEADER_LENGTH;return y.header.type===h.SETUP?(x+=this.SETUP_PARAMS_LENGTH,x+=1+y.dataEncoding.length):y.header.type===h.ERROR&&(x+=this.ERROR_CODE_LENGTH),y.payload instanceof ArrayBuffer&&(x+=y.payload.byteLength),x},_serializeHeader:function(y,x){return x.setUint32(this.HEADER_LENGTH_START,y.header.length),x.setUint32(this.HEADER_STREAM_ID_START,y.header.streamId),x.setUint8(this.HEADER_TYPE_START,y.header.type),x.setUint8(this.HEADER_FLAGS_START,y.header.flags),this.HEADER_LENGTH},_serializePayload:function(y,x,w){this._copyArrayBuffer(y.payload,x,w)},_serializeSetupParams:function(y,x,w){return x.setUint32(w,y.setupParams.majorVersion),x.setUint32(w+4,y.setupParams.minorVersion),x.setUint16(w+8,y.setupParams.keepAliveTime),x.setUint16(w+10,y.setupParams.maxLifeTime),w+=this.SETUP_PARAMS_LENGTH,x.setUint8(w,y.dataEncoding.length),w+=1,this._copyArrayBuffer(this._convertStringToArrayBuffer(y.dataEncoding),x.buffer,w),w+=y.dataEncoding.length*2,w},_serializeErrorCode:function(y,x,w){return x.setUint32(w,y.errorCode),w+=this.ERROR_CODE_LENGTH,w},serialize:function(y){var x=new ArrayBuffer(y.header.length),w=new window.DataView(x),C=this._serializeHeader(y,w);return y.header.type===h.SETUP?C=this._serializeSetupParams(y,w,C):y.header.type===h.ERROR&&(C=this._serializeErrorCode(y,w,C)),y.payload instanceof ArrayBuffer&&this._serializePayload(y,x,C),x},getSetupFrame:function(y){var x={header:{type:h.SETUP,flags:y.flags||r.EMPTY,streamId:0},setupParams:{majorVersion:y.majorVersion||this.DEFAULT_MAJOR_VERSION,minorVersion:y.minorVersion||this.DEFAULT_MINOR_VERSION,keepAliveTime:y.keepAliveTime||this.DEFAULT_KEEPALIVETIME,maxLifeTime:y.maxLifeTime||this.MAX_LIFETIME},dataEncoding:y.dataEncoding||"",payload:y.data||""};return x.header.length=this._computeFrameLength(x),x},getKeepAliveFrame:function(y){var x={header:{type:h.KEEPALIVE,flags:y.respond?r.KEEPALIVE_RESPOND:r.EMPTY,streamId:0},payload:y.data||""};return x.header.length=this._computeFrameLength(x),x},getConnectStreamFrame:function(y){var x={header:{type:h.CONNECT_STREAM,flags:y.ack?r.CONNECT_STREAM_ACK:r.EMPTY,streamId:y.streamId},payload:y.data};return x.header.length=this._computeFrameLength(x),x},getDisconnectStreamFrame:function(y){var x={header:{type:h.DISCONNECT_STREAM,flags:r.EMPTY,streamId:y.streamId}};return x.header.length=this._computeFrameLength(x),x},getPayloadFrame:function(y){var x={header:{type:h.PAYLOAD,flags:y.complete?r.PAYLOAD_COMPLETE:r.EMPTY,streamId:y.streamId},payload:y.data};return x.header.length=this._computeFrameLength(x),x},getCancelPayloadFrame:function(y){var x={header:{type:h.CANCEL_PAYLOAD,flags:r.EMPTY,streamId:y.streamId}};return x.header.length=this._computeFrameLength(x),x},_getErrorFrame:function(y,x){var w={header:{type:h.ERROR,flags:r.EMPTY,streamId:y.streamId},errorCode:x,payload:y.data};return w.header.length=this._computeFrameLength(w),w},getInvalidSetupFrame:function(y){var x={streamId:0,data:this._convertStringToArrayBuffer(y)};return this._getErrorFrame(x,o.INVALID_SETUP)},getUnsupportedSetupFrame:function(y){var x={streamId:0,data:this._convertStringToArrayBuffer(y)};return this._getErrorFrame(x,o.UNSUPPORTED_SETUP)},getRejectedSetupFrame:function(y){var x={streamId:0,data:this._convertStringToArrayBuffer(y)};return this._getErrorFrame(x,o.REJECTED_SETUP)},getConnectionErrorFrame:function(y){return y.data=this._convertStringToArrayBuffer(y.msg),this._getErrorFrame(y,o.CONNECTION_ERROR)},getApplicationErrorFrame:function(y){return y.data=this._convertStringToArrayBuffer(y.msg),this._getErrorFrame(y,o.APPLICATION_ERROR)}});var u=new c,g={impl:u,TYPES:h,FLAGS:r,ERROR_CODES:o,deserialize:u.deserialize.bind(u),serialize:u.serialize.bind(u),getSetupFrame:u.getSetupFrame.bind(u),getKeepAliveFrame:u.getKeepAliveFrame.bind(u),getConnectStreamFrame:u.getConnectStreamFrame.bind(u),getDisconnectStreamFrame:u.getDisconnectStreamFrame.bind(u),getPayloadFrame:u.getPayloadFrame.bind(u),getCancelPayloadFrame:u.getCancelPayloadFrame.bind(u),getInvalidSetupFrame:u.getInvalidSetupFrame.bind(u),getUnsupportedSetupFrame:u.getUnsupportedSetupFrame.bind(u),getRejectedSetupFrame:u.getRejectedSetupFrame.bind(u),getConnectionErrorFrame:u.getConnectionErrorFrame.bind(u),getApplicationErrorFrame:u.getApplicationErrorFrame.bind(u)};return g},R,W),R.exports=I},1155:(R,W,d)=>{"use strict";var O,I;O=[d(1203),d(1873),d(3660),d(4371),d(8199),d(3073),d(8681),d(9876)],I=d.dj.d(O,function(f,N,b,h,r,o,c,u){return f([],{BASE_END_POINT:"messageservice/binary/",KEEPALIVE_TIMEOUT:2e4,logLifecycle:!1,constructor:function(m,y,x){x=x||{},this._streamName=m,this._streamId=y,this._keepAliveTimeout=x.keepAliveTimeout||this.KEEPALIVE_TIMEOUT,this._timers=[]},onMessage:function(m){},onClose:function(){},connect:function(){var m=new h;this.delegate=this._createDelegate(),this._messageHandle=b.after(this.delegate,"onMessage",N.hitch(this,this._handleTransportMessage),!0),this._closeHandle=b.after(this.delegate,"onClose",N.hitch(this,this._handleTransportClose),!0),this.delegate.setUrl(this._getEndpoint());var y=this.delegate.connect(),x=this;return y.then(function(w){if(x._keepAliveTimeout>0){var C=setInterval(function(){x._sendKeepAlive(!1)},x._keepAliveTimeout);x._timers.push(C)}m.resolve(w)},function(w){m.reject(w)}),this._logLifecycleInfo("BinaryStreamTransport constructing new websocket instance."),m.promise},disconnect:function(){return this.delegate.reset(),new h().resolve()},cleanup:function(){this.delegate&&(this._logLifecycleInfo("BinaryStreamTransport disconnecting due to cleanup call."),this.delegate.disconnect(),this.delegate=null)},delegateConnected:function(){return this.delegate?this.delegate.isConnected():!1},doSend:function(m){var y=u.getPayloadFrame({streamId:this._streamId,complete:!0,data:m});return this._delegateSend(y),new h().resolve()},_delegateSend:function(m){var y=u.serialize(m);this.delegate.send(y)},_handleTransportMessage:function(m){var y=m.data,x=u.deserialize(y);switch(this._logLifecycleInfo("Received frame type: "+x.header.type),x.header.type){case u.TYPES.KEEPALIVE:this._handleKeepAlive(x);break;case u.TYPES.PAYLOAD:this._handlePayload(x);break;default:throw new Error(x.header.type+" frame not supported")}},_handleTransportClose:function(m,y){this._timers&&(this._logLifecycleInfo("Canceling all timers"),this._timers.forEach(function(x){clearInterval(x)})),this.onClose(),this._messageHandle&&this._messageHandle.remove(),this._closeHandle&&this._closeHandle.remove()},_handlePayload:function(m){this._logLifecycleInfo("Received Payload of size: "+m.payload.byteLength),this.onMessage({data:m.payload})},_handleKeepAlive:function(m){this._logLifecycleInfo("Received keepalive from server")},_sendKeepAlive:function(m){if(m=m||!1,!!this.delegateConnected()){this._logLifecycleInfo("Sending keep-alive");var y=u.getKeepAliveFrame({respond:m});this._delegateSend(y)}},_getEndpoint:function(){return r.createWorkerRoutingHostUrl(this.BASE_END_POINT+this._streamName)},_logLifecycleInfo:function(m){this.logLifecycle&&o.info(m)},_createDelegate:function(){return new c}})},R,W),R.exports=I},8681:(R,W,d)=>{"use strict";var O,I;O=[d(1203),d(1873),d(4371),d(3073)],I=d.dj.d(O,function(f,N,b,h){return f([],{CLOSE_NORMAL_CLOSURE:1e3,CLOSE_GOING_AWAY:1001,CLOSE_PROTOCOL_ERROR:1002,logLifecycle:!1,connectTimeout:5e3,constructor:function(){this._webSocket=null,this._connected=!1},connect:function(){var o=new b,c=this.getUrl();if(!c)return h.error("Invalid URL"),o.reject("Invalid URL"),o.promise;var c=c.replace(/^http/,"ws");if(c.indexOf("ws")!==0)return h.error("Invalid URL: ",c),o.reject("Invalid URL: "+c),o.promise;this.logLifecycle&&h.info("Connecting to URL: "+c);var u=this,g=null;this.connectTimeout>0&&(g=setTimeout(function(){g=null,this._connected||(this.logLifecycle&&h.info("Timed out while connecting to URL ",c,"in "+u.connectTimeout,"ms"),u.onClose(u.CLOSE_PROTOCOL_ERROR,"Connect Timeout"),o.reject("Timed out while connecting to URL"))},this.connectTimeout));var m;try{m=new WebSocket(c),m.binaryType="arraybuffer";var y=function(){if(u.logLifecycle&&h.info("WebSocket opened: "+m),g&&(window.clearTimeout(g),g=null),o.resolve(),m!==u._webSocket){u.logLifecycle&&h.info("Ignoring open event, WebSocket"+u._webSocket);return}u.onOpen()},x=function(P){var T=P?P.code:u.CLOSE_NORMAL_CLOSURE,M=P?P.reason:void 0;if(u.logLifecycle&&h.info("WebSocket closed: "+T+"/"+M),g&&(window.clearTimeout(g),g=null),o.reject(),m!==u._webSocket){u.logLifecycle&&h.info("Ignoring close event, WebSocket");return}u.onClose(T,M)},w=function(P){if(u.logLifecycle&&h.info("WebSocket message received"),m!==u._webSocket){u.logLifecycle&&h.info("Ignoring message event, WebSocket");return}u.onMessage(P)};m.onopen=y,m.onclose=x,m.onerror=function(){h.error("WebSocket received error"),x({code:u.CLOSE_PROTOCOL_ERROR})},m.onmessage=w,this._webSocket=m}catch(C){h.error("WebSocket error: ",C),o.reject("Browser does not support WebSockets")}return o.promise},onOpen:function(){this._connected=!0},onMessage:function(o){},onClose:function(o,c){this._webSocket!==null&&this._connected&&this._webSocket.close(this.CLOSE_NORMAL_CLOSURE,"Close"),this._connected=!1,this._webSocket=null},send:function(o){try{this._webSocket===null?(this.logLifecycle&&h.info("WebSocket not connected, connecting..."),this.connect()):this._connected&&(this.logLifecycle&&h.info("Sending data"),this._webSocket.send(o))}catch(c){h.error("Error sending data: ",c)}},abort:function(){if(this._webSocket!==null)try{this.logLifecycle&&h.info("Aborting..."),this._webSocket.close(this.CLOSE_GOING_AWAY)}catch(o){this.logLifecycle&&h.info("Error aborting: ",o)}this.reset()},reset:function(){this.logLifecycle&&h.info("WebSocket closing connection"),this._webSocket!==null&&this._connected&&this._webSocket.close(this.CLOSE_NORMAL_CLOSURE,"Reset"),this._webSocket=null,this._connected=!1},setUrl:function(o){this._url=o},getUrl:function(){return this._url},isConnected:function(){return this._connected}})},R,W),R.exports=I},4653:(R,W,d)=>{var O,I;O=[d(6723),d(3073)],I=d.dj.d(O,function(f,N){var b={deprecated:function(h){var r,o,c=!!f.isDebug||!!window.showDeprecationsAsErrors;c&&this._isConfigValid(h)&&(o=window.showDeprecationsAsErrors||h.deprecationLevel===this.ERROR?this.ERROR:this.WARN,r="DEPRECATED: ",h.deprecated&&(r+=h.deprecated.module,h.deprecated.method&&(r+="."+h.deprecated.method+"()"),r+="."),h.replacement&&(r+=" Use "+h.replacement.module,h.replacement.method&&(r+="."+h.replacement.method+"()"),r+=" instead."),h.removalVersion&&(r+=" Will be removed in version: "+h.removalVersion+"."),h.geckNumber&&(r+=" Please use g"+h.geckNumber+" to track latest information regarding this deprecation"),h.additionalInformation&&(r+=" "+h.additionalInformation),N[o](r))},_isConfigValid:function(h){var r=!!h.deprecated&&typeof h.deprecated=="object"&&h.deprecated.hasOwnProperty("module");return h.replacement&&(r=r&&typeof h.replacement=="object"&&h.replacement.hasOwnProperty("module")),h.geckNumber&&(r=r&&typeof h.geckNumber=="number"),r||N.error("Supplied deprecationConfig properties are not valid. Please refer to http://inside.mathworks.com/wiki/Web_Widgets_Deprecation_API for right API"),r}};return Object.defineProperties(b,{WARN:{value:"warn",enumerable:!0},ERROR:{value:"error",enumerable:!0}}),b},R,W),R.exports=I},3716:(R,W,d)=>{"use strict";var O,I;O=[d(7841),d(7199),d(4653)],I=d.dj.d(O,function(f,N,b){return{HYPERLINK_ESCAPE_REGEXP:/<a\s+href\s*=\s*"[^"]*"[^>]*>[\s\S]*?<\/a>/g,HYPERLINK_WITH_PARENTHESIS_ESCAPE_REGEXP:/<a\s+href\s*=\s*"([^"]*)"([^>]*)>([\s\S]*?)<\/a>/g,STRONG_ESCAPE_REGEXP:/<strong>|<\/strong>/g,BOLD_LINK_ATTRIBUTE_REGEX:/\bstyle\s*=\s*"[^"]*\bfont-weight\s*:\s*bold\b[^"]*"/,parseQueryString:function(){var r=window.location.search.substr(1,window.location.search.length);return this._parseQueryString(r)},_parseQueryString:function(r){return f.queryToObject(r)},parseUrl:function(r){var o=document.createElement("a");o.display="none",o.href=r||window.location.href,o.href=o.href;var c={protocol:o.protocol,hostname:o.hostname,port:o.port,pathname:o.pathname,search:o.search,hash:o.hash};return(c.protocol==="https:"||c.protocol==="http:")&&c.pathname.indexOf("/")!==0&&(c.pathname="/"+c.pathname),c.protocol==="https:"&&c.port==="443"&&r.indexOf("https://"+c.hostname+":443")!==0&&(c.port=""),c},escapeHtml:function(r){var o=document.createElement("div");o.textContent=r;var c=o.innerHTML;return c},escapeLinksAndHtml:function(r,o){b.deprecated({deprecated:{module:"mw-html-utils/HtmlUtils",method:"escapeLinksAndHtml"},replacement:{module:"mw-html-utils/HtmlUtils",method:"treatHtmlLikeCommandWindow"}});var c="",u=r.split(this.HYPERLINK_ESCAPE_REGEXP),g=r.match(this.HYPERLINK_ESCAPE_REGEXP),m="",y=this,x=0,w=function(P,T,M,z){var Y=y.parseUrl(T).protocol;Y!=="http:"&&Y!=="https:"&&Y!=="matlab:"&&(T="#"),T=y.escapeHtml(T),z=y._strongNotEscaped(z,!0),m='<a href="'+T+'">'+z+"</a>"};if(o)c=this.escapeHtml(r),c=this.escapeWhitespace(c);else if(u[0]!==""&&(c=this._strongNotEscaped(u[0],!0)),g!==null&&g.length!==0)for(x=0;x<g.length;x=x+1)g[x].replace(this.HYPERLINK_WITH_PARENTHESIS_ESCAPE_REGEXP,w),u[x+1]!==""&&(u[x+1]=this._strongNotEscaped(u[x+1],!0)),c+=m+u[x+1];return c},treatHtmlLikeCommandWindow:function(r,o,c){if(typeof r!="string")return"";var u="",g=r.split(this.HYPERLINK_ESCAPE_REGEXP),m=r.match(this.HYPERLINK_ESCAPE_REGEXP),y="",x=this,w=0;c=c||{};var C=function(T,M,z,Y){var X=x.parseUrl(M).protocol,S="";X!=="http:"&&X!=="https:"&&X!=="matlab:"&&(M="#"),M=x.escapeHtml(M),Y=x._strongNotEscaped(Y,!1),x.BOLD_LINK_ATTRIBUTE_REGEX.test(z)&&(S=' style="font-weight:bold"'),y='<a href="'+M+'"'+S+">"+Y+"</a>"};if(o)u=this.escapeHtml(r);else if(g[0]!==""&&(u=this._strongNotEscaped(g[0],!1)),m!==null&&m.length!==0)for(w=0;w<m.length;w=w+1)m[w].replace(this.HYPERLINK_WITH_PARENTHESIS_ESCAPE_REGEXP,C),g[w+1]!==""&&(g[w+1]=this._strongNotEscaped(g[w+1],!1)),u+=y+g[w+1];return c.addPreTagToPreserveWhiteSpace&&(u='<span style="white-space: pre">'+u+"</span>"),u},_strongNotEscaped:function(r,o){var c="",u=r.match(this.STRONG_ESCAPE_REGEXP),g=r.split(this.STRONG_ESCAPE_REGEXP),m=function(w){return w};o&&(m=this.escapeWhitespace);var y=0;if(u!==null&&u.length!==0)for(c=m(this.escapeHtml(g[0])),y=0;y<u.length;y=y+1)c+=u[y]+m(this.escapeHtml(g[y+1]));else c=m(this.escapeHtml(r));return c},escapeWhitespace:function(r){return b.deprecated({deprecated:{module:"mw-html-utils/HtmlUtils",method:"escapeWhitespace"},replacement:{module:"Plain HTML",method:'Set class as white-space: pre or use <span style="white-space: pre">...</span>'}}),r=r||"",r.replace(/\n/g,"<br>").replace(/ {2}/g,"&nbsp;&nbsp;")},handleAnchors:function(r,o){if(o&&o.target&&o.target.href){o.preventDefault(),o.stopPropagation();var c=o.target.href;if(c.indexOf("matlab:")!==-1){var u=c.substring(0,7);if(u==="matlab:"){var g=o.target.href.substring(7);r(window.decodeURIComponent(g))}}else window.open(o.target.href)}},isElementOverflown:function(r){return r.scrollHeight>r.clientHeight||r.scrollWidth>r.clientWidth},sanitizeHtmlFromJava:N.sanitizeHtmlFromJava,sanitizeHtml:N.sanitizeHtml}},R,W),R.exports=I},7199:(R,W,d)=>{"use strict";var O,I;O=[],I=d.dj.d(O,function(){var f={A:["target","href","title"],ABBR:["title"],ADDRESS:[],AREA:["shape","coords","href","alt"],ARTICLE:[],ASIDE:[],AUDIO:["autoplay","controls","loop","preload","src"],B:[],BDI:["dir"],BDO:["dir"],BIG:[],BLOCKQUOTE:["cite"],BR:[],CAPTION:[],CENTER:[],CITE:[],CODE:[],COL:["align","valign","span","width"],COLGROUP:["align","valign","span","width"],DD:[],DEL:["datetime"],DETAILS:["open"],DIV:[],DL:[],DT:[],EM:[],FONT:["color","size","face"],FOOTER:[],H1:[],H2:[],H3:[],H4:[],H5:[],H6:[],HEADER:[],HR:[],I:[],IMG:["src","alt","title","width","height"],INS:["datetime"],LI:[],MARK:[],NAV:[],OL:[],P:[],PRE:[],S:[],SECTION:[],SMALL:[],SPAN:[],SUB:[],SUP:[],STRONG:[],TABLE:["width","border","align","valign"],TBODY:["align","valign"],TD:["width","rowspan","colspan","align","valign"],TFOOT:["align","valign"],TH:["width","rowspan","colspan","align","valign"],THEAD:["align","valign"],TR:["rowspan","align","valign"],TT:[],U:[],UL:[],VIDEO:["autoplay","controls","loop","preload","src","height","width"]},N=Object.assign(f),b={href:{"http:":!0,"https:":!0,"mailto:":!0,"matlab:":!0,relative:{"#":!0,"/":!0}},src:{"http:":!0,"https:":!0,"mailto:":!0,relative:{"#":!0,"/":!0}}},h=Object.assign(b),r=["backgroundColor","borderBottom","borderBottomColor","borderBottomLeftRadius","borderBottomRightRadius","borderBottomStyle","borderBottomWidth","borderLeft","borderLeftColor","borderLeftStyle","borderLeftWidth","borderRadius","borderRight","borderRightColor","borderRightStyle","borderRightWidth","borderSpacing","borderStyle","borderTop","borderTopColor","borderTopLeftRadius","borderTopRightRadius","borderTopStyle","borderTopWidth","borderWidth","color","fontFamily","fontSize","fontStyle","fontWeight","height","lineHeight","margin","marginBottom","marginLeft","marginRight","marginTop","maxHeight","maxWidth","minHeight","minWidth","overflow","overflowWrap","overflowX","overflowY","padding","paddingBottom","paddingLeft","paddingRight","paddingTop","textAlign","textAnchor","textDecoration","textIndent","textOverflow","textShadow","textTransform","width"],o=[].concat(r);o.push("whiteSpace");var c=function(m,y,x){var w=void 0,C=y.getAttribute("style");if(w=x?r:o,m.style&&C!==null&&C!=="")for(var P=0;P<w.length;P+=1){var T=w[P],M=y.style[T];m.style[T]!==void 0&&(m.style[T]=M)}},u=function(m,y,x,w){return function(C){var P=function(k,G){var H=String.prototype.trim.call(G),q=H.indexOf(":");if(q<0&&k.relative[H.charAt(0)])return H;var ce=H.substring(0,q);return k[ce+":"]?H:"#"},T=function(k,G){for(var H=[],q=0;q<k.length;q+=1){var ce=k[q];if(G.hasAttribute(ce)){var Q=G.getAttribute(ce),ne="";y[ce]?ne=P(y[ce],Q):ne=Q,H.push({key:ce,value:ne})}}return H},M=function(k){var G=void 0;if(k.nodeType===window.Node.ELEMENT_NODE){var H=m[k.tagName];if(H){G=document.createElement(k.tagName);var q=m[k.tagName],ce=T(q,k);ce.forEach(function(Q){G.setAttribute(Q.key,Q.value)}),x&&c(G,k,w)}else G=document.createDocumentFragment()}else k.nodeType===window.Node.TEXT_NODE?G=document.createTextNode(k.textContent):G=document.createDocumentFragment();return G},z=function F(k){var G=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,H=document.createDocumentFragment();if(G>150||!k)return H;for(var q=k.firstChild;q;q=q.nextSibling){var ce=M(q);q.nodeType===window.Node.ELEMENT_NODE&&ce.appendChild(F(q,G+1)),H.appendChild(ce)}return H},Y=new DOMParser,X=Y.parseFromString(C,"text/html"),S=void 0;return X.body?S=z(X.body):S=document.createDocumentFragment(),S}};return{sanitizeHtmlFromJava:u(f,b,!0,"java"),sanitizeHtml:u(N,h,!0)}},R,W),R.exports=I},3073:(R,W,d)=>{var O,I;O=[d(5818),d(587),d(8556),d(133),d(245)],I=d.dj.d(O,function(f,N,b,h,r){"use strict";var o={};const c="DEFAULT",g=h.create(100),m={debug:4,log:3,dir:3,table:3,trace:3,time:3,timeEnd:3,group:3,groupCollapsed:3,groupEnd:3,info:2,warn:1,assert:0,error:0},y={};let x=0,w=N.DEBUG,C=f.DEVELOPMENT;const P=[],T={};let M=null;class z{constructor(X){if(T[X]!=null)return;r.makeReadOnlyProperty(this,"name",X),T[this.name]=this,this._timers={},this._threshold=N.DEBUG,this._showTimestamp=!0,r.makeReadOnlyProperty(this,"modes",f),r.makeReadOnlyProperty(this,"levels",N);const S=this;typeof window=="object"&&(window.$mwLog={get filter(){return S.filter},set filter(F){S.filter=F},get mode(){return S.mode},set mode(F){S.mode=F}})}static _sanitizeLevel(X){return typeof X=="number"?X:N.DEBUG}static _sanitizeMode(X){return r.objectValues(f).indexOf(X)>-1?X:f.DEVELOPMENT}get threshold(){return this._threshold}set threshold(X){this._threshold=z._sanitizeLevel(X)}get showTimestamp(){return this._showTimestamp}set showTimestamp(X){this._showTimestamp=!!X}get globalThreshold(){return w}set globalThreshold(X){w=z._sanitizeLevel(X)}get mode(){return C}set mode(X){X&&(C=z._sanitizeMode(X))}get filter(){return M}set filter(X){(typeof X=="function"||X===null)&&(M=X)}_shouldLog(X,S){if(M&&C===f.DEVELOPMENT){const F={name:this.name,type:S};return!!M(F)}return w>X&&this._threshold>X}_nameAndTime(){const X=[];return this.name!==c&&X.push(this.name),this._showTimestamp&&X.push(r.currentTimeString()),X}table(X){if(this._shouldLog(m.table,b.TABLE)){const S={namespace:this.name,type:b.TABLE,message:[X],time:new Date};g.add(S),r.printToConsole(b.LOG,this._nameAndTime(),C),r.printToConsole(b.TABLE,[X],C),r.execCallbacks(y,S)}}trace(){if(this._shouldLog(m.trace,b.TRACE)){const X={namespace:this.name,type:b.TRACE,message:null,time:new Date};let F=new Error().stack.split(`
`);for(F[0]==="Error"&&F.shift();F[0].includes("Log.js")||F[0].includes("logger.trace")||F[0].includes("trace");)F.shift();F=F.join(`
`),X.message=[F],g.add(X),r.printToConsole(b.LOG,this._nameAndTime(),C),r.printToConsole(b.TRACE,[],C),r.execCallbacks(y,X)}}time(X){this._shouldLog(m.time)&&(this._timers[X]==null?this._timers[X]=new Date().getTime():this.warn('timer "'+X+'" already exists.'))}timeEnd(X){if(this._shouldLog(m.timeEnd,b.TIME_END)){const S={namespace:this.name,type:b.TIME_END,message:null,time:new Date};if(this._timers[X]!=null){const F=new Date().getTime()-this._timers[X];S.message=[X+": "+F+"ms - timer ended"],g.add(S),r.printToConsole(b.LOG,this._nameAndTime().concat(S.message),C),r.execCallbacks(y,S),this._timers[X]=null}else this.warn('timer "'+X+`" doesn't exist.`)}}_group(X,S){if(this._shouldLog(m.group,S?b.GROUP_COLLAPSED:b.GROUP)){const F=S?b.GROUP_COLLAPSED:b.GROUP,k={namespace:this.name,type:F,message:[X],time:new Date};P.push(X),g.add(k),r.printToConsole(F,[X],C),r.execCallbacks(y,k)}}groupCollapsed(X){this._group(X,!0)}group(X){this._group(X,!1)}groupEnd(){if(this._shouldLog(m.groupEnd,b.GROUP_END)){const X=P.pop(),S={namespace:this.name,type:b.GROUP_END,message:[X],time:new Date};g.add(S),r.printToConsole(b.GROUP_END,[],C),r.execCallbacks(y,S)}}assert(X,S){if(this._shouldLog(m.assert,b.ASSERT)&&!X){const F={namespace:this.name,type:b.ASSERT,message:["Assertion failed:",S],time:new Date};g.add(F),F.message.shift();const k=[!1].concat(this._nameAndTime().concat(F.message));r.printToConsole(b.ASSERT,k,C),r.execCallbacks(y,F)}}_basicLogMethod(X,S,F){if(this._shouldLog(S,X)){const k={namespace:this.name,type:X,message:F,time:new Date};F=this._nameAndTime().concat(F),g.add(k),r.printToConsole(X,F,C),r.execCallbacks(y,k)}}debug(X){const S=Array.prototype.slice.call(arguments);this._basicLogMethod(b.DEBUG,m.debug,S)}log(X){const S=Array.prototype.slice.call(arguments);this._basicLogMethod(b.LOG,m.log,S)}dir(X){const S=Array.prototype.slice.call(arguments);this._basicLogMethod(b.DIR,m.dir,S)}info(X){const S=Array.prototype.slice.call(arguments);this._basicLogMethod(b.INFO,m.info,S)}warn(X){const S=Array.prototype.slice.call(arguments);this._basicLogMethod(b.WARN,m.warn,S)}error(X){const S=Array.prototype.slice.call(arguments);this._basicLogMethod(b.ERROR,m.error,S)}addCallback(X,S){y[x]=X,S&&g.applyCallback(X);const F={},k=x;return F.remove=()=>{delete y[k]},x++,F}createLogger(X){const S=new z(X);return S.name?S:T[X]}}return o.default=new z(c),o.default},R,W),R.exports=I},133:(R,W,d)=>{var O,I;O=[d(245)],I=d.dj.d(O,function(f){"use strict";var N={};function b(r){const o={},c=[];f.makeReadOnlyProperty(o,"size",r);let u=0;return o.add=function(g){c[u]=g,u=(u+1)%o.size},o.applyCallback=function(g){let m=u+1;c[m]===void 0&&(m=0);let y=0,x=m;for(;y<o.size&&c[x]!==void 0;)g(c[x]),x=(x+1)%r,y++},o}const h={};return h.create=b,N.default=h,N.default},R,W),R.exports=I},587:(R,W,d)=>{var O,I;O=[],I=d.dj.d(O,function(){"use strict";var f={};const N={DEBUG:5,LOG:4,TABLE:4,TIME:4,DIR:4,INFO:3,WARN:2,ASSERT:1,ERROR:1};return Object.freeze(N),f.default=N,f.default},R,W),R.exports=I},5818:(R,W,d)=>{var O,I;O=[],I=d.dj.d(O,function(){"use strict";var f={};const N={DEVELOPMENT:"DEVELOPMENT",PRODUCTION:"PRODUCTION"};return Object.freeze(N),f.default=N,f.default},R,W),R.exports=I},8556:(R,W,d)=>{var O,I;O=[],I=d.dj.d(O,function(){"use strict";var f={};const N={DEBUG:"debug",LOG:"log",TABLE:"table",TRACE:"trace",TIME_END:"timeEnd",GROUP:"group",GROUP_COLLAPSED:"groupCollapsed",GROUP_END:"groupEnd",DIR:"dir",INFO:"info",WARN:"warn",ASSERT:"assert",ERROR:"error"};return Object.freeze(N),f.default=N,f.default},R,W),R.exports=I},245:(R,W,d)=>{var O,I;O=[d(5818)],I=d.dj.d(O,function(f){"use strict";var N={};const b={};return b.objectValues=function(h){const r=[];for(const o in h)Object.prototype.hasOwnProperty.call(h,o)&&r.push(h[o]);return r},b.makeReadOnlyProperty=function(h,r,o){Object.defineProperty(h,r,{value:o,writable:!1})},b.execCallbacks=function(h,r){const o=b.objectValues(h);for(const c in o)o[c](r)},b.currentTimeString=function(){const h=new Date;return h.toLocaleTimeString("en-US",{hour12:!1,hour:"numeric",minute:"numeric",second:"numeric"})+"."+h.getTime()%1e3},b.printToConsole=function(h,r,o){(o!==f.PRODUCTION||h==="error")&&console[h].apply(console,r)},N.default=b,N.default},R,W),R.exports=I},1711:(R,W,d)=>{var O,I;O=[d(9478),d(5528),d(981),d(7114),d(8199)],I=d.dj.d(O,function(f,N,b,h,r){"use strict";var o={};function c(x,w){const C=w._startFunction||w.start,P=w.stop,T=x._startFunction||x.start,M=x.stop,z=function(){T.call(x,[]),C.call(w,[])},Y=function(){P.call(w,[]),M.call(x,[])};w._startFunction?w._startFunction=z:w.start=z,x._startFunction?x._startFunction=z:x.start=z,w.stop=Y,x.stop=Y}const u=f(new N(r,null,null,null,{instanceType:b.MATLAB_SERVICE_HOST.name})),g=new N(r,null,null,null,{instanceType:b.APP_SERVICE_HOST.name});let m;r.enableServerOnWorkerAsync=function(){},r.disableServerOnWorkerAsync=function(){};const y={};return y[b.APP_SERVICE_HOST.name]=()=>(m||(m=f(g),u.isStarted()&&m.start(),c(u,m)),m),y[b.MATLAB_SERVICE_HOST.name]=()=>u,u.create=function(x){return h(y,x)},o.default=u,o.default},R,W),R.exports=I},5528:(R,W,d)=>{var O,I;O=[d(1203),d(6723),d(4371),d(792),d(5094),d(8213),d(981),d(3073),d(7581)],I=d.dj.d(O,function(f,N,b,h,r,o,c,u,g){"use strict";var m={};const y=h.setTimeout,x=h.clearTimeout,w=2e4,C=30,P=!1;let T=0,M=0;const z={},Y=200;setInterval(function(){T+=Y,Object.keys(z).forEach(function(k){const G=z[k];G&&G.execTime<=T&&(G.func(),delete z[k])})},Y),h.setTimeout=function(k,G){if(G===0)return y(k,G);{M+=1;const H=`t-${M}`;return z[H]={func:function(){try{k()}catch(q){u.warn(`Exception invoking timed function in callback
, this is likely an issue with code calling MessageService`,k,q)}},execTime:T+G},H}},h.clearTimeout=function(k){typeof k=="number"?x(k):delete z[k]};const X=function(k,G,H,q,ce){const Q=new h.CometD(k);return Q.registerExtension("ack",new r),Q},S=function(k,G){k.successful?G.resolve(k):(u.warn("Message failed: ",k),G.reject(k))},F=f([],{BASE_PREFIX:"/matlab",BASE_END_POINT:"messageservice/async",logCometdLifecycle:!1,logCometdSubscriptions:!1,constructor:function(k,G,H,q,ce){ce=ce||{},this.remote=k,this.constructCometD=G||X,this.workerProxyAsyncClient=H||new g("remoteWorkerAsyncProducer");const Q=c[ce.instanceType];Q&&(this.BASE_PREFIX=Q.BASE_PREFIX,this.BASE_END_POINT=Q.BASE_END_POINT),this.cometdProperties=q||{useWorkerScheduler:!1,stickyReconnect:!0,connectTimeout:5e3,maxConnections:2,backoffIncrement:2e3,maxBackoff:2e3,logLevel:"warn",maxNetworkDelay:w,requestHeaders:{},appendMessageTypeToURL:!1,autoBatch:!0,urls:{},maxURILength:2e3,maxSendBayeuxMessageSize:Number.MAX_SAFE_INTEGER};const ne=["maxNetworkDelay","connectTimeout","logLevel"],he=N.cometdProperties;if(he)for(let fe=0;fe<ne.length;fe+=1){const Me=ne[fe];he[Me]!==void 0&&(this.cometdProperties[Me]=he[Me])}this.subscriptions={},this.recentMessages=[],this._deferredCleanupFunction=()=>{this._deferredCleanup=!1,this.recentMessages=[]},this.routingHost=F.workerHostOverride||this.remote.getWorkerRoutingHost(),this.routingKey=this.remote.getWorkerRoutingKey(),this.computeToken=this.remote.getComputeSessionId();const ve=this.remote.getEndPointByName("WORKER_ASYNC_ENDPOINT");this.withCredentials=ve?ve.withCredentials:!1;const Ie=this._setUpEndPoint();this.computeToken&&(Ie.computeToken=this.computeToken),this.cometdProperties.url=Ie.url,this.cometdProperties.requestHeaders={computeToken:Ie.computeToken},this.cometd=null,this._connectedAtLeastOnce=!1,this.logCometdLifecycle&&u.info("MessageServiceAsync will construct new cometd instance when connecting.")},onMessage:function(k){},onConnectionError:function(){},onConnectionFails:function(){},onConnectionSuccess:function(){},connect:function(k){this.routingHost=F.workerHostOverride||this.remote.getWorkerRoutingHost(),this.routingKey=this.remote.getWorkerRoutingKey(),this.computeToken=this.remote.getComputeSessionId();const G=this.remote.getEndPointByName("WORKER_ASYNC_ENDPOINT");this.withCredentials=G?G.withCredentials:!1;const H=this._setUpEndPoint();this.computeToken&&(H.computeToken=this.computeToken),this.cometdProperties.url=H.url,this.cometdProperties.requestHeaders={computeToken:H.computeToken},this.cometd||(this.cometd=this.constructCometD("messageService",this.workerProxyAsyncClient,{websocket:F.enableWebsocket},H,this.remote),this.registerTransports({websocket:F.enableWebsocket}),this.logCometdLifecycle&&u.info("MessageServiceAsync constructing new cometd instance."));const q=new b;let ce=0;return this.cleanupListeners(),this._handshakeHandle=this.cometd.addListener("/meta/handshake",Q=>{if(Q.successful===!0){ce=0;let ne,he;const ve=[];this.doStartBatch();for(ne in k)Object.prototype.hasOwnProperty.call(k,ne)&&(he=k[ne],ve.push(this.doSubscribe(ne)),he.subscribed=!0);this.doEndBatch(),Promise.all(ve).then(Ie=>{this._connectedAtLeastOnce=!0,q.isFulfilled()?this.cometd&&this.onConnectionSuccess():q.resolve(Ie)},()=>{let Ie,fe;const Me=[];this.doStartBatch();for(Ie in k)Object.prototype.hasOwnProperty.call(k,Ie)&&(fe=k[Ie],Me.push(this.doSubscribe(Ie)),fe.subscribed=!0);this.doEndBatch(),Promise.all(Me).then(Ke=>{this._connectedAtLeastOnce=!0,q.isFulfilled()?this.cometd&&this.onConnectionSuccess():q.resolve(Ke)},Ke=>{q.reject(Ke)})})}}),this._connectHandle=this.cometd.addListener("/meta/connect",Q=>{Q.successful===!0&&(ce>0&&this.cometd&&this.onConnectionSuccess(),ce=0)}),this._unsuccessHandle=this.cometd.addListener("/meta/unsuccessful",Q=>{if((Q.channel==="/meta/handshake"||Q.channel==="/meta/connect"||Q.advice&&Q.advice.reconnect==="handshake")&&ce<C)ce+=1,ce===1&&this.onConnectionError();else if(Q.channel==="/meta/disconnect")q&&!q.isFulfilled()&&q.reject(Q);else if(ce>=C){const ne=this.doDisconnect();this._connectedAtLeastOnce||ne.catch(()=>{u.info("MessageService never got connected to the server, and the attempt to disconnect also fails. Suppressing console error with this info log")}),q&&!q.isFulfilled()?q.reject(Q):this.onConnectionFails()}}),this.cometd.init(this.cometdProperties),q.promise},registerTransports:function(k){const G=new h.LongPollingTransport;G.accept=()=>!0;const H=new h.WebSocketTransport;this.cometd.unregisterTransports(),k[o.WEBSOCKET]&&this.cometd.registerTransport(o.WEBSOCKET,H,0),this.cometd.registerTransport(o.LONG_POLLING,G,1)},disconnect:function(){this.logCometdLifecycle&&u.info("MessageServiceAsync disconnecting cometd due to disconnect call.",this.cometd.getClientId());const k=this._createOneShotMessagePromise("/meta/disconnect");return this.cometd.disconnect(),k},destructCometd:function(){this.cometd&&(this.cleanupListeners(),this.cometd=null,this.logCometdLifecycle&&u.info("MessageServiceAsync destroying cometd instance."))},cleanup:function(){this.cometd&&(this.logCometdLifecycle&&u.info("MessageServiceAsync disconnecting cometd due to cleanup call.",this.cometd,this.cometd&&this.cometd.getClientId()),this.cometd.disconnect())},cleanupListeners:function(){this._handshakeHandle&&this.cometd.removeListener(this._handshakeHandle),this._connectHandle&&this.cometd.removeListener(this._connectHandle),this._unsuccessHandle&&this.cometd.removeListener(this._unsuccessHandle)},delegateConnected:function(){return this.cometd?!this.cometd.isDisconnected()&&this.cometd.getStatus()!=="handshaking":!1},doPublish:function(k,G){const H=new b;return this.cometd.publish(this._getRequestChannel(k),G,{},function(q){S(q,H)}),H.promise},doSubscribe:function(k){this.logCometdSubscriptions&&u.info("MessageServiceAsync subscribing cometd to channel: "+k);const G=this._createOneShotMessagePromise("/meta/subscribe");return this.subscriptions[k]=this.cometd.subscribe(this._getRequestChannel(k),this,this._handleCometResponse),G},doDisconnect:function(){this.logCometdSubscriptions&&u.info("MessageServiceAsync sending disconnect to cometd");const k=this._createOneShotMessagePromise("/meta/disconnect");return this.cometd.disconnect(!0),k},doUnsubscribe:function(k){if(this.subscriptions[k]){this.logCometdSubscriptions&&u.info("MessageServiceAsync unsubscribing cometd from channel: "+k);const G=this._createOneShotMessagePromise("/meta/unsubscribe");return this.cometd.unsubscribe(this.subscriptions[k]),delete this.subscriptions[k],G}else return new b().resolve({successful:!0})},doStartBatch:function(){this.cometd.startBatch()},doEndBatch:function(){this.cometd.endBatch()},doSetLatency:function(k){this.workerProxyAsyncClient.setLatency(k)},doSetErrorRate:function(k){this.workerProxyAsyncClient.setErrorRate(k)},getTransport:function(){return this.cometd&&!this.cometd.isDisconnected()?this.cometd.getTransport().getType():o.UNKNOWN},_handleCometResponse:function(k){this._shouldHandleMessage(k)&&this.onMessage(this._stripBasePrefixAndConvertToJson(k))},_shouldHandleMessage:function(k){return k.id?!1:this.recentMessages.indexOf(k)<0?(this.recentMessages.push(k),this._deferRecentMessagesCleanup(),!0):!1},_deferRecentMessagesCleanup:function(){this._deferredCleanup||(this._deferredCleanup=setTimeout(this._deferredCleanupFunction,0))},_createOneShotMessagePromise:function(k){const G=new b;return this._addOneShotListener(k,function(H){S(H,G)}),G.promise},_addOneShotListener:function(k,G){const H=this,q=this.cometd,ce=this.cometd.addListener(k,function(Q){q.removeListener(ce),G.apply(H,arguments)})},_setUpEndPoint:function(){let k,G=!1;const H="MESSAGE_SERVICE_ASYNC_ENDPOINT",q=!0,ce=!0;let Q;return P&&typeof this.remote.sendPayload=="function"?(G=!0,this.remote.createNewEndPoint(H,q,this.BASE_END_POINT,"remoteWorkerAsyncProducer",ce),this.remote.setServiceEndPoint(H,this.routingHost,this.routingKey),k=this.remote.getUrlForEndPoint(H),Q=this.remote.getEndPointAllowsDirectXhr(H)):(k=this.routingHost||"/",k.slice(-1)!=="/"&&(k+="/"),k+=this.BASE_END_POINT,this.routingKey&&(k+="?routingkey="+this.routingKey)),{remoteSupportsSendPayload:G,url:k,endPointName:H,endPointAllowsDirectXhr:Q}},_getRequestChannel:function(k){return this.BASE_PREFIX+k},_stripBasePrefixAndConvertToJson:function(k){return{channel:k.channel.substring(this.BASE_PREFIX.length),data:k.data}}});return F.enableWebsocket=!1,F.workerHostOverride=!1,window.location.search.indexOf("websocket=on")>=0&&(F.enableWebsocket=!0),m.default=F,m.default},R,W),R.exports=I},6963:(R,W,d)=>{var O,I;O=[d(1203),d(1873),d(3660),d(4371),d(3073),d(3933),d(5413),d(8213)],I=d.dj.d(O,function(f,N,b,h,r,o,c,u){"use strict";var g={};return g.default=f([o],{logSubscriptions:!1,constructor:function(){this.batching=!0,this.typeSerializers=[],this.typeDeserializers={},this.channelSubscriptions={},this._queuedOps=[],this._hasConnected=!1},setDelegate:function m(y){this.inherited("setDelegate",m,arguments),b.after(this._delegate,"onMessage",N.hitch(this,this.handleMessage),!0)},publish:function(m,y){if(!c(m))throw new Error(`Illegal argument: invalid channel name ${m}`);if(this.isConnected()){const x=this._queuePublish(m,this.serialize(y));return this._deferProcessQueue(),x}else return this._queuePublish(m,this.serialize(y))},subscribe:function(m,y,x){if(!c(m))throw new Error(`Illegal argument: invalid channel name ${m}`);this.logSubscriptions&&r.info("MessageService subscribe: "+m,y,x);const w=this._queueSubscribe(m,y,x);return this._addHandler(this.channelSubscriptions,m,y,x),w.catch(()=>{w.isCanceled()||this._removeHandler(this.channelSubscriptions,m,y,x)}),this.isConnected()&&this._deferProcessQueue(),w},unsubscribe:function(m,y,x){if(!c(m))throw new Error(`Illegal argument: invalid channel name ${m}`);if(this.logSubscriptions&&r.info("MessageService unsubscribe: "+m,y,x),this._removeHandler(this.channelSubscriptions,m,y,x)){if(this._removeQueuedMatchingSubscribe(m,y,x))return new h().resolve();if(this.isConnected()){const C=this._queueUnsubscribe(m,y,x);return this._deferProcessQueue(),C}else return new h().resolve()}else return r.error("Not subscribed to channel: "+m+", can't unsubscribe."),new h().reject("Not subscribed to channel: "+m+", can't unsubscribe.")},flush:function(){if(this.isConnected())this._processQueue();else throw new Error("Can only manually flush the queue when connected.")},setLatency:function(m){this._delegate&&this._delegate.doSetLatency&&this._delegate.doSetLatency(m)},setErrorRate:function(m){this._delegate&&this._delegate.doSetErrorRate&&this._delegate.doSetErrorRate(m)},getTransport:function(){return this._delegate&&this._delegate.getTransport?this._delegate.getTransport():u.UNKNOWN},_enterDisconnected:function m(){this.inherited("_enterDisconnected",m,arguments),this._rejectQueue()},_enterConnecting:function m(){this.inherited("_enterConnecting",m,arguments),Object.keys(this.channelSubscriptions).forEach(y=>{this.channelSubscriptions[y].subscribed=!1})},_enterConnected:function m(){this._hasConnected=!0,this.inherited("_enterConnected",m,arguments),this._processQueue()},_enterDisconnecting:function m(){this._processQueue(),this.inherited("_enterDisconnecting",m,arguments)},_enterFatallyDisconnected:function m(){this.inherited("_enterFatallyDisconnected",m,arguments),this._rejectQueue()},_queuePublish:function(m,y){const x=new h;return this._queuedOps.push({type:"publish",channel:m,data:y,deferred:x}),x.promise},_queueSubscribe:function(m,y,x){const w=new h;return this._queuedOps.push({type:"subscribe",channel:m,handler:y,scope:x,deferred:w}),w.promise},_removeQueuedMatchingSubscribe:function(m,y,x){let w;for(let C=this._queuedOps.length-1;C>=0;C-=1)if(w=this._queuedOps[C],w.type==="subscribe"&&w.channel===m&&w.handler===y&&w.scope===x){this._queuedOps.splice(C,1);const P=this._delegate&&this._delegate.delegateConnected();return this.isConnected()&&P&&w.deferred.resolve(),!0}},_queueUnsubscribe:function(m,y,x){const w=new h;return this._queuedOps.push({type:"unsubscribe",channel:m,handler:y,scope:x,deferred:w}),w.promise},_processQueue:function(){const m=this._delegate&&this._delegate.delegateConnected();if(!(this.isConnected()&&m)&&this._currentState!=="disconnecting")return;this._delegate.doStartBatch();const x=this._queuedOps;this._queuedOps=[],x.forEach(function(w){let C;w.type==="publish"?C=this._delegate.doPublish(w.channel,w.data):w.type==="subscribe"?C=this._doSubscribe(w.channel,w.handler,w.scope):w.type==="unsubscribe"&&(C=this._doUnsubscribe(w.channel,w.handler,w.scope)),C.then(w.deferred.resolve,w.deferred.reject)},this),this._delegate.doEndBatch()},_rejectQueue:function(){if(this._hasConnected){for(let m=0;m<this._queuedOps.length;m+=1)this._queuedOps[m].deferred.reject(new Error("MessageService disconnected. Discarding queued message"));this._queuedOps=[]}this._hasConnected=!1},_deferProcessQueue:function(){if(this.batching&&!this._deferredTimeout){const m=this;this._deferredTimeout=setTimeout(function(){m._deferredTimeout=!1,m._processQueue()},0)}else this.batching||this._processQueue()},_doSubscribe:function(m){if(this.channelSubscriptions[m].subscribed)return new h().resolve();{const y=this._delegate.doSubscribe(m);return this.channelSubscriptions[m].subscribed=!0,y.catch(()=>{this.channelSubscriptions[m].subscribed=!1}),y}},_doUnsubscribe:function(m){return this.channelSubscriptions[m]?new h().resolve():this._delegate.doUnsubscribe(m)},handleMessage:function(m){let y;if(m&&m.channel){m.data&&(m.data=this.deserialize(m.data));const x=m.channel.split("/");for(y=1;y<=x.length;y+=1)this._callHandlers(this.channelSubscriptions,x.slice(0,y).concat("**").join("/"),m);this._callHandlers(this.channelSubscriptions,x.slice(0,x.length-1).concat("*").join("/"),m),this._callHandlers(this.channelSubscriptions,x.concat("*").join("/"),m),this._callHandlers(this.channelSubscriptions,m.channel,m)}},registerMessageHandler:function(m,y,x){r.error("registerMessageHandler is not supported any more.")},deregisterMessageHandler:function(m,y,x){r.error("deregisterMessageHandler is not supported any more.")},registerTypeSerializer:function(m,y,x){this.typeSerializers.push({typeMatcher:m,type:y,serializer:x})},registerTypeDeserializer:function(m,y){this.typeDeserializers[m]=y},serialize:function(m){return Array.isArray(m)?this._serializeArray(m):m==null||typeof m=="number"||typeof m=="boolean"||N.isString(m)?m:this._serializeObject(m)},deserialize:function(m){return Array.isArray(m)?this._deserializeArray(m):typeof m=="number"||typeof m=="boolean"||N.isString(m)?m:this._deserializeObject(m)},_addHandler:function(m,y,x,w){if(w=w||this,typeof x=="string"&&typeof w[x]!="function"){r.warn("Not adding invalid handler: "+x);return}let C=m[y];C||(C=[],m[y]=C);const P={channel:y,handler:x,scope:w};C.push(P),C.sort(function(T){return T.exclusive?-1:0})},_removeHandler:function(m,y,x,w){w=w||this;const C=m[y],P=this._getHandlerIndex(C,{handler:x,scope:w});return P>=0&&C.splice(P,1),(!C||C.length===0)&&delete m[y],P>=0},_callHandlers:function(m,y,x){let w,C;if(Object.prototype.hasOwnProperty.call(m,y))for(w=m[y],C=0;C<w.length;C+=1)try{typeof w[C].handler=="string"?w[C].scope[w[C].handler].call(w[C].scope,x):w[C].handler.call(w[C].scope,x)}catch(P){r.error("Error while executing message handler on channel: "+y+", message: "+JSON.stringify(x,null,2)+", error: ",P)}},_getHandlerIndex:function(m,y){if(!m)return-1;let x;for(x=0;x<m.length;x+=1)if(y.handler===m[x].handler&&y.scope===m[x].scope)return x;return-1},_serializeObject:function(m){let y;for(y=0;y<this.typeSerializers.length;y+=1){const w=this.typeSerializers[y];if(w.typeMatcher(m))return{__type__:w.type,__value__:w.serializer.call(this,m)}}if(m instanceof window.Image)return m;const x={};for(const w in m)Object.prototype.hasOwnProperty.call(m,w)&&(x[w]=this.serialize(m[w]));return x},_serializeArray:function(m){const y=Array.from(m);let x;const w=y.length;for(x=0;x<w;x+=1)y[x]=this.serialize(y[x]);return y},_deserializeObject:function(m){let y;if(m==null)return null;if(Object.prototype.hasOwnProperty.call(m,"__type__")&&Object.prototype.hasOwnProperty.call(m,"__value__"))try{return this.typeDeserializers[m.__type__].call(this,m.__value__)}catch(x){r.error("Error while trying to deserialize: ",m,"Error: ",x)}for(y in m)Object.prototype.hasOwnProperty.call(m,y)&&m[y]!==null&&m[y]!==void 0&&(m[y]=this.deserialize(m[y]));return m},_deserializeArray:function(m){let y;const x=m.length;for(y=0;y<x;y+=1)m[y]=this.deserialize(m[y]);return m}}),g.default},R,W),R.exports=I},3933:(R,W,d)=>{var O,I;O=[d(1203),d(3543),d(1873),d(3660),d(6363),d(3073)],I=d.dj.d(O,function(f,N,b,h,r,o){"use strict";var c={};return c.default=f([N],{logStateChanges:!1,constructor:function(){this._stateOptions={context:this,name:"WraDataService",namespace:"MOTW.wra",defaultSubstate:"disconnected",substates:{disconnected:{transitions:{onEnterState:this._enterDisconnected,start:"connecting"}},connecting:{transitions:{onEnterState:this._enterConnecting,_connectSuccess:"connected",_connectFailure:"fatallyDisconnected",stop:"disconnected"}},connected:{transitions:{onEnterState:this._enterConnected,_reconnect:"connecting",stop:"disconnecting"}},disconnecting:{transitions:{onEnterState:this._enterDisconnecting,_disconnectSuccess:"disconnected",_disconnectFailure:"disconnected","timeout 2":"disconnected"}},fatallyDisconnected:{transitions:{onEnterState:this._enterFatallyDisconnected,stop:"disconnected"}}}}},setDelegate:function(u){this._delegate!==u&&(this._delegate=u,this._states=new r(this._stateOptions),h.after(this._states,"onEnterState",b.hitch(this,this._enterState),!0),this._states.start());const g=this;h.after(this._delegate,"onConnectionError",function(){g._changeStateToConnecting()},!0),h.after(this._delegate,"onConnectionFails",function(){g._currentState="fatallyDisconnected",g._enterFatallyDisconnected()},!0),h.after(this._delegate,"onConnectionSuccess",function(){g._currentState="connected",g._enterConnected()},!0)},_changeStateToConnecting:function(){o.info("something wrong with connection, so changing state to connecting now, cometd is trying to connect again on its own"),this._currentState="connecting",this.onNotConnected()},onConnected:function(){this.emit("connected")},onNewlyConnected:function(){},onDisconnected:function(){this.emit("disconnected")},onReconnected:function(){this.emit("reconnected")},onFatallyDisconnected:function(){this.emit("fatallyDisconnected")},onNotConnected:function(){this.emit("notConnected")},isStarted:function(){return this._currentState!=="disconnecting"&&this._currentState!=="disconnected"},isConnected:function(){return this._currentState==="connected"},isFatallyDisconnected:function(){return this._currentState==="fatallyDisconnected"},isDisconnected:function(){return this._currentState==="disconnected"},start:function(){this._forceStop=!1},stop:function(){this._forceStop=!0},_enterState:function(u){const g=this._currentState;this._currentState=u,this.logStateChanges&&o.info("MessageService state change: "+g+" -> "+u),g==="connected"&&this.onNotConnected(),u==="connected"&&this._previouslyConnected?this.onReconnected():u==="connected"&&!this._previouslyConnected&&this.onNewlyConnected()},_enterDisconnected:function(){this._previouslyConnected=!1,this._delegate.cleanup(),this._forceStop&&this._delegate.destructCometd(),this.onDisconnected()},_enterConnecting:function(){this._delegate.cleanup(),this._delegate.connect(this.channelSubscriptions).then(this._connectSuccess,this._connectFailure)},_reconnect:function(){},_connectSuccess:function(){},_connectFailure:function(){},_timeoutAction:function(){this.logStateChanges&&o.info("MessageService timeout:",arguments)},_enterConnected:function(){this._previouslyConnected&&o.info("Successfully connected."),this._previouslyConnected=!0,this.onConnected()},_enterFatallyDisconnected:function(){this.onFatallyDisconnected()},_enterDisconnecting:function(){this._delegate.disconnect().then(this._disconnectSuccess,this._disconnectFailure)},_disconnectSuccess:function(){},_disconnectFailure:function(){}}),c.default},R,W),R.exports=I},9478:(R,W,d)=>{var O,I;O=[d(1873),d(3660),d(1929),d(6963)],I=d.dj.d(O,function(f,N,b,h){"use strict";var r={};return r.default=function(c){const u=new h,g={messageService:u,subscribe:f.hitch(u,"subscribe"),unsubscribe:f.hitch(u,"unsubscribe"),publish:f.hitch(u,"publish"),start:f.hitch(u,"start"),stop:f.hitch(u,"stop"),isRunning:f.hitch(u,"isStarted"),isStarted:f.hitch(u,"isStarted"),isConnected:f.hitch(u,"isConnected"),isFatallyDisconnected:f.hitch(u,"isFatallyDisconnected"),isDisconnected:f.hitch(u,"isDisconnected"),setLatency:f.hitch(u,"setLatency"),setErrorRate:f.hitch(u,"setErrorRate"),getTransport:f.hitch(u,"getTransport"),onConnected:function(){},onDisconnected:function(){},onReconnected:function(){},onFatallyDisconnected:function(){},onNotConnected:function(){},on:function(m,y){return b(this.messageService,m,y)},handleMessage:f.hitch(u,"handleMessage"),internalMotwDisableStart:function(){this._startFunction=this.start,this.start=function(){}},internalMotwEnableStart:function(){this._startFunction&&(this.start=this._startFunction,this._startFunction=null)}};return N.after(u,"onConnected",f.hitch(g,"onConnected"),!0),N.after(u,"onDisconnected",f.hitch(g,"onDisconnected"),!0),N.after(u,"onReconnected",f.hitch(g,"onReconnected"),!0),N.after(u,"onFatallyDisconnected",f.hitch(g,"onFatallyDisconnected"),!0),N.after(u,"onNotConnected",f.hitch(g,"onNotConnected"),!0),u.setDelegate(c),g},r.default},R,W),R.exports=I},981:(R,W,d)=>{var O,I;O=[],I=d.dj.d(O,function(){"use strict";var f={};return f.default={APP_SERVICE_HOST:{name:"APP_SERVICE_HOST",BASE_PREFIX:"/matlab",BASE_END_POINT:"messageservice/async/blue"},MATLAB_SERVICE_HOST:{name:"MATLAB_SERVICE_HOST",BASE_PREFIX:"/matlab",BASE_END_POINT:"messageservice/async"}},f.default},R,W),R.exports=I},5413:(R,W,d)=>{var O,I;O=[d(792)],I=d.dj.d(O,function(f){"use strict";var N={};function b(g){return f.Utils.isString(g)}function h(g){return g>="A"&&g<="Z"?!0:g>="a"&&g<="z"}function r(g){return g>="0"&&g<="9"}function o(g){switch(g){case" ":case"!":case"#":case"$":case"(":case")":case"*":case"+":case"-":case".":case"/":case"@":case"_":case"{":case"~":case"}":case":":case"\\":case",":return!0;default:return!1}}function c(g){if(!b(g)||g.length<2||g.charAt(0)!=="/")return!1;for(let m=1;m<g.length;++m){const y=g.charAt(m);if(!(h(y)||r(y)||o(y)))return!1}return!0}const u=function(g){return c("/matlab"+g)};return N.default=u,N.default},R,W),R.exports=I},7114:(R,W,d)=>{var O,I;O=[d(981)],I=d.dj.d(O,function(f){"use strict";var N={};const b=/AppServiceHost/i,h=o=>o.serviceName.match(b)!==null,r=(o,c)=>h(c)?o[f.APP_SERVICE_HOST.name]():o[f.MATLAB_SERVICE_HOST.name]();return N.default=function(c,u){if(u.serviceName){if(!u.serviceName.length||u.serviceName.length<5)throw new Error("serviceName must be longer than 4 characters")}else throw new Error("Must provide a serviceName");const g=r(c,u),m={};return["subscribe","unsubscribe","publish","isStarted","isConnected","isFatallyDisconnected","isDisconnected","setLatency","setErrorRate","getTransport","on","onConnected","onDisconnected"].forEach(y=>{m[y]=g[y].bind(g)}),m.messageService=g.messageService,m},N.default},R,W),R.exports=I},8213:(R,W,d)=>{var O,I;O=[],I=d.dj.d(O,function(){"use strict";var f={};return f.default={UNKNOWN:"unknown",LONG_POLLING:"long-polling",WEBSOCKET:"websocket"},f.default},R,W),R.exports=I},9984:(R,W,d)=>{"use strict";var O,I;O=[d(1203),d(640),d(7581),d(8504)],I=d.dj.d(O,function(f,N,b,h){return f([],{constructor:function(){this._initializeEndPointsCollection()},_initializeEndPointsCollection:function(){this.endPointsCollection={ROUTER_LEAF_INSECURE_ENDPOINT:{routingHost:"",routingKey:"",iframeProxy:null,enabled:!0,iframeProxyUrl:"",pathSuffix:"messageservice/json",messages:["RouterLogin","CreateAccount","CurrentUser","Login","UpdateAccount","ServiceRegistry","ClientType","AuthorizationDetails","AcquireMatlab"],iframeProxyName:"remoteProducer",withCredentials:!0,acceptsMessageContainerMessages:!0},ROUTER_LEAF_SECURE_ENDPOINT:{routingHost:"",routingKey:"",iframeProxy:null,enabled:!0,iframeProxyUrl:"",pathSuffix:"messageservice/json/secure",messages:[],iframeProxyName:"remoteProducer",withCredentials:!0,acceptsMessageContainerMessages:!0},WORKER_ENDPOINT:{routingHost:"",routingKey:"",iframeProxy:null,enabled:!1,iframeProxyUrl:"",pathSuffix:"messageservice/json/secure",messages:[],iframeProxyName:"remoteWorkerProducer",withCredentials:!0,acceptsMessageContainerMessages:!0},WORKER_ASYNC_ENDPOINT:{routingHost:"",routingKey:"",iframeProxy:null,enabled:!0,iframeProxyUrl:"",pathSuffix:"messageservice/async",messages:[],iframeProxyName:"remoteWorkerAsyncProducer",withCredentials:!0,acceptsMessageContainerMessages:!0},USAGE_DATA_ROUTER_ENDPOINT:{routingHost:"",routingKey:"",iframeProxy:null,enabled:!0,iframeProxyUrl:"",pathSuffix:"udc/service/v1/events",messages:["UsageDataEventCollection"],iframeProxyName:"remoteUDCProducer",withCredentials:!1,acceptsMessageContainerMessages:!1},HELP_DATA_ROUTER_ENDPOINT:{routingHost:"",routingKey:"",iframeProxy:null,enabled:!0,iframeProxyUrl:"",pathSuffix:"",messages:["HelpDataEventCollection"],iframeProxyName:"doc_center",withCredentials:!1,acceptsMessageContainerMessages:!1}}},reset:function(){this._initializeEndPointsCollection()},setUpNewEndPoint:function(o,c,u,g,m){this.endPointsCollection[o]={routingHost:"",routingKey:"",pathSuffix:u,enabled:c,messages:[],iframeProxy:null,iframeProxyName:g,acceptsMessageContainerMessages:m}},getPathSuffixForEndPoint:function(o){return this.endPointsCollection[o].pathSuffix},setPathSuffixForEndPoint:function(o,c){this.endPointsCollection[o].pathSuffix=c},getEndPointNames:function(){const o={};let c;for(c in this.endPointsCollection)Object.prototype.hasOwnProperty.call(this.endPointsCollection,c)&&(o[c]=c);return o},setRoutingHostAndRoutingKey:function(o,c,u){if(c&&c.lastIndexOf("/")!==c.length-1&&(c+="/"),!h.isAllowed(c))throw new Error("Insecure endpoint.");this.endPointsCollection[o].routingHost=c,u&&(this.endPointsCollection[o].routingKey=u),this._setIframeRoutingHostAndRoutingkey(o)},_setIframeRoutingHostAndRoutingkey:function(o){const c=this.getIframeProxyClientForEndPoint(o);c&&c.setRemotePageHost(this.endPointsCollection[o].routingHost,this.endPointsCollection[o].routingKey,null,this.endPointsCollection[o].iframeProxyUrl,{withCredentials:this.endPointsCollection[o].withCredentials})},getRoutingHost:function(o){return this.endPointsCollection[o].routingHost},getRoutingKey:function(o){return this.endPointsCollection[o].routingKey},getMessageTypesMappedToEndPoint:function(o){return this.endPointsCollection[o].messages},isEndPointEnabled:function(o){return this.endPointsCollection[o].enabled},setMessageTypesToEndPoint:function(o,c){this.endPointsCollection[o].messages=c},enableEndPoint:function(o){this.endPointsCollection[o].enabled=!0},disableEndPoint:function(o){this.endPointsCollection[o].enabled=!1},getEndPointForMessageType:function(o){let c=null,u;for(u in this.endPointsCollection)if(Object.prototype.hasOwnProperty.call(this.endPointsCollection,u)&&(c=N.lastIndexOf(this.endPointsCollection[u].messages,o)>-1?u:c,c)){if(this.isEndPointEnabled(c))break;c=null}return c||this.getEndPointNames().ROUTER_LEAF_SECURE_ENDPOINT},getRemoteUrlForEndPoint:function(o){let c=this.endPointsCollection[o].routingHost+this.endPointsCollection[o].pathSuffix;return this.endPointsCollection[o].routingKey&&(c=c+"?routingkey="+this.endPointsCollection[o].routingKey),c},setIframeProxyClientForEndPoint:function(o,c){this.endPointsCollection[o].iframeProxy=c},getIframeProxyClientForEndPoint:function(o){let c=this.endPointsCollection[o].iframeProxy;return c||(c=new b(this.endPointsCollection[o].iframeProxyName),this.endPointsCollection[o].iframeProxy=c),c},isEndpointMessageContainerBased:function(o){return o&&this.endPointsCollection[o]?this.endPointsCollection[o].acceptsMessageContainerMessages:!0},addMessagesTypesToEndPoint:function(o,c){this.endPointsCollection[o]&&this.endPointsCollection[o].messages.indexOf(c)===-1&&this.endPointsCollection[o].messages.push(c)},removeMessageTypesFromEndPoint:function(o,c){if(this.endPointsCollection[o]){const u=this.endPointsCollection[o].messages.indexOf(c);u>-1&&this.endPointsCollection[o].messages.splice(u,1)}}})},R,W),R.exports=I},8199:(R,W,d)=>{"use strict";var O,I;O=[d(1873),d(5642),d(3660),d(7581),d(9889),d(8194),d(1830),d(8168),d(1967),d(1422),d(5530),d(6051),d(3073),d(9863),d(2084)],I=d.dj.d(O,function(f,N,b,h,r,o,c,u,g,m,y,x,w,C,P){const T={reset:function(){let z=[];const Y=new r,X=new c({faultManager:Y}),S=new o({responseManager:X});T.faultManager=Y,T.responseManager=X,T.requestManager=S,T._serviceRegistryLookup=P,T._uploadParameters={};const F=T.proxyClient=new h;T.createUploadIframeTarget=f.hitch(F,F.createUploadIframeTarget),T.cancelUpload=f.hitch(F,F.cancelUpload),m.setIframeProxyClientForEndPoint(m.getEndPointNames().ROUTER_LEAF_SECURE_ENDPOINT,F),m.setIframeProxyClientForEndPoint(m.getEndPointNames().ROUTER_LEAF_INSECURE_ENDPOINT,F),u.construct=function(k){return k=k||{},m.getRoutingHost(m.getEndPointNames().ROUTER_LEAF_INSECURE_ENDPOINT)||T.setEndpoint(),k.allowedMessages=z,k.sendMessage=T.sendMessage,k.computeSessionId=T.getComputeSessionId,new g(k)},T.registerEndpointLevelFaultHandler=f.hitch(Y,Y.registerEndpointLevelFaultHandler),T.sendMessage=f.hitch(S,S.sendMessage),T.sendPayload=y.sendPayload,T.registerDefaultMessageFactory=f.hitch(S,S.registerDefaultMessageFactory),T.deregisterDefaultMessageFactory=f.hitch(S,S.deregisterDefaultMessageFactory),T.registerResponseHandler=f.hitch(X,X.registerResponseHandler),T.deregisterResponseHandler=f.hitch(X,X.deregisterResponseHandler),T.registerFaultHandler=f.hitch(Y,Y.registerFaultHandler),T.deregisterFaultHandler=f.hitch(Y,Y.deregisterFaultHandler),T.registerTopLevelFaultHandler=f.hitch(Y,Y.registerTopLevelFaultHandler),T.deregisterTopLevelFaultHandler=f.hitch(Y,Y.deregisterTopLevelFaultHandler),T.setServiceEndPoint=function(k,G,H){m.setRoutingHostAndRoutingKey(k,G,H)},T.setServicePathSuffixForEndPoint=function(k,G){m.setPathSuffixForEndPoint(k,G)},T.ignoreTopLevelFault=T.registerTopLevelFaultHandler,T.setComputeToken=function(k){T._uploadParameters.computeToken=k.computeSessionId,S.computeToken=k},T.setWorkerEndpoint=function(k,G){T._uploadParameters.routingKey=G,m.setRoutingHostAndRoutingKey(m.getEndPointNames().WORKER_ENDPOINT,k,G)},T.setEndpoint=function(k){if(!k){const G=T._serviceRegistryLookup.getServiceRegistryEndpoint("primary");G?k=G:(w.info("ServiceRegistryLookup is empty, falling back to localhost"),k="/")}if(!k||k==="/"){const G=(document.getElementsByTagName("base")[0]||{}).href;if(G!==void 0){const H=document.createElement("a");H.display="none",H.href=G,k=H.protocol+"//"+H.hostname+(H.port?":"+H.port:"")+"/"}else k=window.location.protocol+"//"+window.location.host+"/"}m.setRoutingHostAndRoutingKey(m.getEndPointNames().ROUTER_LEAF_SECURE_ENDPOINT,k),m.setRoutingHostAndRoutingKey(m.getEndPointNames().ROUTER_LEAF_INSECURE_ENDPOINT,k),F.setRemotePageHost(k,void 0,void 0,void 0,{withCredentials:m.endPointsCollection[m.getEndPointNames().ROUTER_LEAF_SECURE_ENDPOINT].withCredentials})},T.setAllowedMessages=function(k){z=k},T.allowAllMessages=function(){z=[]},T.getEndPoint=function(){return m.getRoutingHost(m.getEndPointNames().ROUTER_LEAF_SECURE_ENDPOINT)},T.getComputeSessionId=function(){return S.computeToken?S.computeToken.computeSessionId:null},T.getWorkerRoutingHost=function(){let k=m.getRoutingHost(m.getEndPointNames().WORKER_ENDPOINT);if(k)return k;if(k=T._serviceRegistryLookup.getServiceRegistryEndpoint("primary"),!k||k==="/"){const G=(document.getElementsByTagName("base")[0]||{}).href;if(G!==void 0){const H=document.createElement("a");H.display="none",H.href=G,k=H.protocol+"//"+H.hostname+(H.port?":"+H.port:"")+"/"}else k=window.location.protocol+"//"+window.location.host+"/"}return k},T.getWorkerRoutingKey=function(){return m.getRoutingKey(m.getEndPointNames().WORKER_ENDPOINT)},T.getDownloadUrlForFile=k=>{if(!k)throw new Error("Invalid input arguments provided!");const G=new N,H=new URL(T.getWorkerRoutingHost()+"download"+k);return y.sendPayload(JSON.stringify({messages:{CreateCsrfToken:[{}]}}),m.getEndPointNames().WORKER_ENDPOINT).then(ce=>{ce.messages.CreateCsrfTokenResponse.forEach(function(Q){Q.messageFaults&&Q.messageFaults.length>0||(H.searchParams.set("csrfToken",Q.csrfToken),G.resolve(H))})}),G},T.upload=function(k,G){return new x().upload(k,G,{endpoint:T.getWorkerRoutingHost(),uploadParams:T._uploadParameters})},T.createWorkerRoutingHostUrl=function(k){return C.createWorkerRoutingHostUrl(k,{host:T.getWorkerRoutingHost(),sessionId:T.getComputeSessionId(),routingKey:T.getWorkerRoutingKey()})},T.getServiceRegistryEndpoint=function(k){return T._serviceRegistryLookup.getServiceRegistryEndpoint(k)},T.enableServerOnWorkerAsync=function(){m.enableEndPoint(m.getEndPointNames().WORKER_ASYNC_ENDPOINT)},T.disableServerOnWorkerAsync=function(){m.disableEndPoint(m.getEndPointNames().WORKER_ASYNC_ENDPOINT)},T.isServerOnWorkerAsyncEnabled=function(){return m.isEndPointEnabled(m.getEndPointNames().WORKER_ASYNC_ENDPOINT)},T.enableServerOnWorker=function(){m.enableEndPoint(m.getEndPointNames().WORKER_ENDPOINT)},T.disableServerOnWorker=function(){m.disableEndPoint(m.getEndPointNames().WORKER_ENDPOINT)},T.isWorkerEndpointEnabled=function(){return m.isEndPointEnabled(m.getEndPointNames().WORKER_ENDPOINT)},T.setWorkerOnlyMessageTypes=function(k){m.setMessageTypesToEndPoint(m.getEndPointNames().WORKER_ENDPOINT,k)},b.after(F,"onError",function(k){k&&Y.handleNonTransactionFault(k)},!0),T.createNewEndPoint=function(k,G,H,q,ce){this.getEndPointByName(k)||m.setUpNewEndPoint(k,G,H,q,ce)},T.getUrlForEndPoint=function(k){return m.getRemoteUrlForEndPoint(k)},T.getEndPointByName=function(k){return m.getEndPointNames()[k]}}};return T.reset(),T},R,W),R.exports=I},1422:(R,W,d)=>{"use strict";var O,I;O=[d(9984)],I=d.dj.d(O,function(f){let N=null;return function(){return N===null&&(N=new f),N}()},R,W),R.exports=I},508:(R,W,d)=>{"use strict";var O,I;O=[],I=d.dj.d(O,function(){"use strict";return class{constructor(f){this._xhr=null,this._uploadDestinationUrl=f.uploadDestinationUrl,this._computeToken=f.computeToken,this._routingkey=f.routingkey,this._fileDestination=f.fileDestination,this._csrfToken=f.csrfToken,this._postMessage=N=>{f.postMessage(N)}}_postMessageToParent(f){this._postMessage({data:f})}_createFormDataFromFileList(f){const N=new window.FormData,b="uploadFileName";for(let h=0;h<f.length;h++){const r=f[h];N.append(b,r,r.name)}return N}_createAndSendXhr(f){this._xhr=new XMLHttpRequest,this._xhr.upload.onprogress=N=>{this._postMessageToParent({type:"updateProgress",loaded:N.loaded,total:N.total})},this._xhr.onload=()=>{this._postMessageToParent({type:"uploadFinished",status:this._xhr.status,response:this._xhr.response})},this._xhr.onerror=()=>{this._postMessageToParent({type:"uploadError",status:this._xhr.status,response:this._xhr.response})},this._xhr.open("POST","".concat(this._uploadDestinationUrl,"?dest=").concat(this._fileDestination,"&computeToken=").concat(this._computeToken,"&routingkey=").concat(this._routingkey,"&csrfToken=").concat(this._csrfToken),!0),this._xhr.withCredentials=!0,this._xhr.send(f)}handleMessage(f){if(f.data instanceof FileList){const N=this._createFormDataFromFileList(f.data);this._createAndSendXhr(N);return}f.data==="cancelUpload"&&(this._xhr&&this._xhr.abort(),this._postMessageToParent({type:"uploadCanceled"}))}}},R,W),R.exports=I},6051:(R,W,d)=>{"use strict";var O,I;O=[d(1203),d(4371),d(2490),d(3716),d(1422),d(5530),d(508)],I=d.dj.d(O,function(f,N,b,h,r,o,c){return f([],{constructor:function(){},upload:function(g,m,y){const x=this;if(this._uploadHandler=new N(function(){x.postMessageToUploadIframe("cancelUpload"),x._unloadIframe()}),this._workerEndpoint=y.endpoint,g instanceof FileList){let w={csrfToken:void 0,validForMs:void 0};return o.sendPayload(JSON.stringify({messages:{CreateCsrfToken:[{}]}}),r.getEndPointNames().WORKER_ENDPOINT).then(function(P){P.messages.CreateCsrfTokenResponse.forEach(function(Y){Y.messageFaults&&Y.messageFaults.length>0||(w={csrfToken:Y.csrfToken,validForMs:Y.validForMs})});const T=y.uploadParams,M=T.computeToken,z=T.routingKey;x._initiateUpload(g,{uploadDestinationUrl:x._workerEndpoint+"upload",computeToken:M,routingkey:z,fileDestination:encodeURIComponent(m),csrfToken:encodeURIComponent(w.csrfToken)})}),this._uploadHandler}},_initiateUpload:function(g,m){const y=this;this._eventCallBack=function(x){switch(x.data.type){case"updateProgress":y._uploadHandler.progress({loaded:x.data.loaded,total:x.data.total});break;case"uploadFinished":y._uploadHandler.resolve({status:x.data.status,response:x.data.response}),y._unloadIframe();break;case"uploadError":y._uploadHandler.reject({status:x.data.status,response:x.data.response});break;default:break}},m.postMessage=this._eventCallBack,this._ReplaceUploadIframe=new c(m),this.postMessageToUploadIframe(g)},_unloadIframe:function(){this._ReplaceUploadIframe=null},getHostName:function(g){return h.parseUrl(g).hostname},postMessageToUploadIframe:function(g){this._ReplaceUploadIframe&&this._ReplaceUploadIframe.handleMessage({data:g})}})},R,W),R.exports=I},6423:(R,W,d)=>{"use strict";var O,I;O=[],I=d.dj.d(O,function(){return{Eval:["CurrentFolder","ListFolder"],"Eval:Ping":[],"Eval:RunFile":["UpdateFile","CurrentFolder","ListFolder"],"Eval:MlsPublishPre":["UpdateFile"],"FEval:liveEvalInstrumentCode":[],Interrupt:[],"FEval:GetFigures":["CurrentFolder","ListFolder"],"FEval:CloseFigure":["FEval:GetFigures"],"FEval:SelectFigure":["FEval:GetFigures"],"FEval:ResetAxes":["FEval:GetFigures"],"FEval:ResizeFigure":["FEval:GetFigures"],"FEval:AxesInteraction2D":["FEval:GetFigures"],"FEval:AxesInteraction3D":["FEval:GetFigures"],CurrentUser:["ServiceRegistry"],RouterLogin:["ServiceRegistry"],CurrentFolder:["ListFolder"],MoveFile:["CurrentFolder"],Variable:[],CloseFile:["SaveSession"],UpdateFile:["SaveSession"],SaveSession:["UpdateFile"],SaveSessionState:["UpdateFile"],Logout:["CloseFile"],UpdateShare:["ListFolder"],AcquireMatlab:["ServiceRegistry"]}},R,W),R.exports=I},5662:(R,W,d)=>{"use strict";var O,I;O=[d(3458),d(1929),d(5665),d(3073)],I=d.dj.d(O,function(f,N,b,h){"use strict";function r(o){if(!o)throw new Error("Expected a valid url in urlToEmptyJsFile");const c={};c.framedoc=null;const u="error",g=b.get(o,c,!0),m=f.byId(g.id,c.frameDoc),y=N(m,u,function(x){h.info("CheckUrlService detected an error accessing url: "+o),g.handleResponse(null,x),y.remove()});return g.promise}return r},R,W),R.exports=I},7581:(R,W,d)=>{"use strict";var O,I;O=[d(5135),d(1203),d(5642),d(1873),d(3660),d(2490),d(3073),d(5662)],I=d.dj.d(O,function(f,N,b,h,r,o,c,u){const g=N([],{constructor:function(){this._messageId=0,this._loaded=!1,this._pendingQueue=[],this._transactions={},this._uploadTargetCallbacks={},this._checkUrl=null,this._loadTimeoutHandle=null,this._checkUrlTimeout=null,this._errorRate=0,this._inFlightTransactions={},this._webSocket=null},setRemotePageHost:function(y,x,w,C){let P=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};y=this._combineUriPaths(y||"","/"),x=x||"",C=C||"",this.computeToken=w,this._withCredentials=this._withCredentials||!1,typeof P.withCredentials>"u"||P.withCredentials===null||(this._withCredentials=!!P.withCredentials),!(y===this._host&&x===this._key&&C===this._proxyUrl)&&(this._errorLoading=!1,this._host=y,this._key=x,this._proxyUrl=C,this._cleanupFailureChecks(),this._loaded=!0,this._flushPending())},setLatency:function(y){this._latency=y},setErrorRate:function(y){this._errorRate=y},sendMessage:function(y,x,w){const C=this;let P;this.computeToken&&(w=w||{},w.headers=w.headers||{},w.headers.computeToken=this.computeToken);const T=w||{},M=this._getNewMessageId();P={action:"sendMessage",id:M,endpoint:x,options:T,message:y};function z(){P={action:"abort",id:M},C._postMessage(P)}const Y={deferred:new b(z),id:M};return this._errorLoading?Y.deferred.reject("Error loading: "+this._url):(this._transactions[M]=Y,this._postMessage(P)),Y.deferred},_postMessage:function(y){this._loaded?this._postMessageNow(y):this._pendingQueue.push(y)},_handleMessage:function(y){let x,w,C,P;const T=y.data.action;if(!T)throw new Error("Client unable to parse message, no action specified: "+JSON.stringify(y.data));switch(T){case"ready":this._cleanupFailureChecks(),this._loaded=!0,this._flushPending();break;case"sendMessageResponse":this._sendMessageResponse(y);break;case"uploadIframeMessage":x=y.data.id,w=y.data.message,this._uploadTargetCallbacks[x](w);break;case"websocketOpened":this.onWebsocketOpen();break;case"websocketClosed":C=y.data.message,this.onWebsocketClose(C);break;case"websocketMsg":P=y.data.message,this.onWebsocketMsg(P);break;case"websocketError":this.onWebsocketError();break;default:throw new Error("Unknown action: "+T+", data: "+JSON.stringify(y.data))}},_sendMessageResponse:function(y){let x;const w=y.data.id,C=y.data.responseType,P=y.data.message;if(!w||!C)throw new Error("Invalid message: "+JSON.stringify(y.data));const T=this._transactions[w];if(!T)throw new Error("Unknown transaction id: "+w+": "+JSON.stringify(y.data));if(delete this._transactions[w],!T.deferred.isCanceled()){if(C==="success"){try{x=P&&JSON.parse(P)}catch(M){x=P}x=x===""?{}:x,T.deferred.resolve(x);return}this.onError(P),T.deferred.reject(P)}},_cleanupFailureChecks:function(){this._checkUrlTimeout&&clearTimeout(this._checkUrlTimeout),this._loadTimeoutHandle&&clearTimeout(this._loadTimeoutHandle),this._checkUrl&&!this._checkUrl.isFulfilled()&&this._checkUrl.cancel("Timeout Occurred",!1),this._checkUrlTimeout=null,this._loadTimeoutHandle=null,this._checkUrl=null},_handleLoadTimeout:function(){let y;if(this._loaded)return;const x={code:"IframeLoadTimeout",description:"Iframe proxy loading failed due to an HTTP error",message:""},w=this._transactions;this._transactions={},this._pendingQueue=[];for(y in w)Object.prototype.hasOwnProperty.call(w,y)&&w[y].deferred.reject("Timeout: "+this._url+" at "+new Date);this._errorLoading=!0,this.onError(x)},_handleXhrResponse:function(y,x){const w={action:"sendMessageResponse",id:y,responseType:"success",message:x};this._handleMessage({data:w})},_handleXhrFault:function(y,x){const w={action:"sendMessageResponse",id:y,responseType:"fault",message:x};this._handleMessage({data:w})},_sendXHRNow:function(y){let x,w,C,P,T,M,z;const Y=y.data.action;if(!Y)throw new Error("Unable to parse message, no action specified: "+JSON.stringify(y.data));let X;switch(Y){case"sendMessage":if(x=y.data.id,w=y.data.endpoint,P=y.data.options,C=y.data.message,x&&w&&C)try{if(T=new XMLHttpRequest,this._inFlightTransactions[x]={xhr:T},M=!1,T.onreadystatechange=()=>{let S;T.readyState===0?(M=!0,this.handleXhrFault(x,"XHR readyState 0")):T.readyState===4&&!M&&(M=!0,S=T.status||0,S>=200&&S<300||S===304?this._handleXhrResponse(x,T.responseText):this._handleXhrFault(x,T.responseText)),M&&T&&(T.onreadystatechange=this._noop,T=null,delete this._inFlightTransactions[x].xhr,delete this._inFlightTransactions[x])},T.open("POST",w,!0),T.withCredentials=this._withCredentials,T.setRequestHeader("Content-Type",P.contentType?P.contentType:"application/json"),T.setRequestHeader("X-Requested-With","XMLHttpRequest"),P.headers)for(z in P.headers)Object.prototype.hasOwnProperty.call(P.headers,z)&&T.setRequestHeader(z,P.headers[z]);T.send(C)}catch(S){this.handleXhrFault(x,"Unable to send data: "+S.toString())}else throw new Error("Invalid message to send: "+JSON.stringify(y.data));break;case"abort":x=y.data.id,this._inFlightTransactions[x]&&this._inFlightTransactions[x].xhr.abort();break;case"connectWebsocket":X=y.data.url,this._webSocket=new WebSocket(X),this._webSocket.onopen=()=>{this.onWebsocketOpen()},this._webSocket.onmessage=S=>{this.onWebsocketMsg(S)},this._webSocket.onclose=S=>{const F={code:S.code,reason:S.reason,wasClean:S.wasClean};this.onWebsocketClose(F)},this._webSocket.onerror=()=>{this.onWebsocketError()};break;case"websocketSend":this._webSocket.send(y.data.data);break;case"closeWebsocket":this._webSocket.close();break;default:throw new Error("Unknown action: "+Y)}},_postMessageNow:function(y){const x=this;let w,C;function P(){if(x._errorRate>0&&Math.random()<x._errorRate&&y.action==="sendMessage"){if(w=y.id,C=x._transactions[w],C){delete x._transactions[w],c.error("Generating simulated error. Request was: ",JSON.stringify(y));const T="403 Forbidden;403";x.onError(T),C.deferred.reject(T)}}else x._sendXHRNow({data:y})}this._latency?setTimeout(P,this._latency):P()},_flushPending:function(){this._pendingQueue.forEach(this._postMessageNow,this),this._pendingQueue=[]},_getNewMessageId:function(){return this._messageId+=1,this._messageId.toString()},onError:function(){},onWebsocketOpen:function(){},onWebsocketMsg:function(){},onWebsocketClose:function(){},onWebsocketError:function(){},_combineUriPaths:function(){return Array.prototype.slice.call(arguments).reduce(function(w,C){return w.length===0?C:(C.length>0&&(C[0]==="/"&&w.lastIndexOf("/")===w.length-1?C=C.substring(1):C[0]!=="/"&&w.lastIndexOf("/")!==w.length-1&&(w+="/")),w+C)})}});return g.WebSocket=N([],{constructor:function(y){const x=this;this.proxyClient=g.WebSocket.proxyClient,this.proxyClient.computeToken&&y.indexOf("?")>=0&&(y=y+"&computeToken="+this.proxyClient.computeToken);const w={action:"connectWebsocket",url:y};this.proxyClient._postMessage(w),r.after(this.proxyClient,"onWebsocketOpen",function(){x.onopen.apply(x,arguments)},!0),r.after(this.proxyClient,"onWebsocketMsg",function(){x.onmessage.apply(x,arguments)},!0),r.after(this.proxyClient,"onWebsocketClose",function(){x.onclose.apply(x,arguments)},!0),r.after(this.proxyClient,"onWebsocketError",function(){x.onerror.apply(x,arguments),x.proxyClient.onError.apply(x.proxyClient,arguments)},!0)},onopen:function(){},onmessage:function(){},onclose:function(){},onerror:function(){},send:function(y){const x={action:"websocketSend",data:y};this.proxyClient._postMessage(x)},close:function(){const y={action:"closeWebsocket"};this.proxyClient._postMessage(y)}}),g},R,W),R.exports=I},1967:(R,W,d)=>{"use strict";var O,I;O=[d(1203),d(582),d(5530)],I=d.dj.d(O,function(f,N,b){return f([N],{_doSend:function(r){return b.sendPayload(r,this.endPointName)}})},R,W),R.exports=I},9889:(R,W,d)=>{"use strict";var O,I;O=[d(640),d(1203),d(1873)],I=d.dj.d(O,function(f,N,b){return N([],{constructor:function(r){r=r||{},this.faultHandlers=r.faultHandlers||{},this.topLevelHandlers=r.topLevelHandlers||[],this.endPointLevelHandlers=r.endPointLevelHandlers||{}},registerFaultHandler:function(r,o,c){c&&(o=b.hitch(c,o)),this.faultHandlers[r]=o},deregisterFaultHandler:function(r){delete this.faultHandlers[r]},registerTopLevelFaultHandler:function(r,o,c){let u;if(c&&(o=b.hitch(c,o)),b.isString(r)){if(r==="*")return u={matcher:r,handler:o},this.defaultTopLevelHandler=o,u;r=this._constructMatcherFromQuery(r)}return u={matcher:r,handler:o},this.topLevelHandlers.push(u),u},registerEndpointLevelFaultHandler:function(r,o,c,u){u&&(c=b.hitch(u,c)),b.isString(o)&&(o=this._constructMatcherFromQuery(o));const g={matcher:o,handler:c};return this.endPointLevelHandlers[r]||(this.endPointLevelHandlers[r]=[]),this.endPointLevelHandlers[r].push(g),g},deregisterTopLevelFaultHandler:function(r){const o=this.topLevelHandlers.indexOf(r);o>-1?this.topLevelHandlers.splice(o,1):r.matcher==="*"&&delete this.defaultTopLevelHandler},_constructMatcherFromQuery:function(r){const o=r.split("||"),c=[];return o.forEach(function(u){u=b.trim(u),u=u.replace(/([.])/g,"\\$1"),u=u.replace(/\*/g,".*"),c.push(new RegExp("^"+u+"$"))}),function(u){return f.some(c,function(g){return g.test(u.faultCode||u.code||"")})}},handleFault:function(r){let o;const c=function(g,m){let y;const x=r.getMessageClassifier(m);x&&(y=[g,x].join(":"),this.faultHandlers[y]&&this.faultHandlers[y](r.fault,r.context))};for(o in r.requestMessages)if(Object.prototype.hasOwnProperty.call(r.requestMessages,o)){this.faultHandlers[o]&&this.faultHandlers[o](r.fault,r.context);const u=r.requestMessages[o];Array.isArray(u)&&u.forEach(b.hitch(this,c,o))}this.faultHandlers["*"]&&this.faultHandlers["*"](r.fault,r.context),this.endPointLevelHandlers[r.endPointName]?this._handleEndpointLevelFault(r):this._handleTopLevelFault(r)},_handleEndpointLevelFault:function(r){let o=!1;const c=f.filter(this.endPointLevelHandlers[r.endPointName],function(u){return u.matcher.call(this,r.fault,r.context)},this);return c.length>0&&c[0].handler&&(o=!0,c[0].handler.call(this,r.fault,r.context,r)),o},_handleTopLevelFault:function(r){const o=f.filter(this.topLevelHandlers,function(u){return u.matcher.call(this,r.fault,r.context)},this),c=o.length>0?o[0].handler:this.defaultTopLevelHandler;c&&c.call(this,r.fault,r.context,r)},handleNonTransactionFault:function(r){const o=f.filter(this.topLevelHandlers,function(u){return u.matcher.call(this,r)},this),c=o.length>0?o[0].handler:this.defaultTopLevelHandler;c&&c.call(this,r)}})},R,W),R.exports=I},582:(R,W,d)=>{"use strict";var O,I;O=[d(1203),d(8519),d(1873),d(1422),d(8168)],I=d.dj.d(O,function(f,N,b,h,r){return f(r,{constructor:function(c){c=c||{},this.uuid=c.uuid||this._generateUuid()},_getRequest:function(c){const u=h.isEndpointMessageContainerBased(this.endPointName);let g=null;return u?(g={uuid:this.uuid,messages:c},this.computeToken&&(g.computeToken=this.computeToken)):Object.keys(c).forEach(function(y){g=c[y]}),this._sanitizeForJson(g),JSON.stringify(g,null,0)},_sanitizeForJson:function(c){let u;if(b.isArray(c))c.forEach(this._sanitizeForJson,this);else if(b.isObject(c))for(u in c)Object.prototype.hasOwnProperty.call(c,u)&&(c[u]===void 0?delete c[u]:(b.isObject(c[u])||b.isArray(c[u]))&&this._sanitizeForJson(c[u]))},_doSend:function(c){return N.post({url:this._getEndpoint(),contentType:"application/json",handleAs:"json",postData:c})},_processResponse:function(c){this.stopTime=new Date().getTime(),c?(c.fault&&(this.fault=c.fault),c.messages?this.responseMessages=c.messages:this.responseMessages=c):this.fault={faultCode:"Connection.Fault",message:"Unable to communicate with server, no response."}},_processFault:function(c){this.stopTime=new Date().getTime(),this.fault={faultCode:"Connection.Fault",message:c}}})},R,W),R.exports=I},8194:(R,W,d)=>{"use strict";var O,I;O=[d(640),d(1203),d(5642),d(1873),d(1422),d(6423),d(8168)],I=d.dj.d(O,function(f,N,b,h,r,o,c){return N([],{defaultMapping:o,constructor:function(g){g=g||{},this.defaultFactories=g.defaultFactories||{},this.mockHandlers=g.mockHandlers||{},this.mapping=g.mapping||this.defaultMapping,this.responseManager=g.responseManager},registerDefaultMessageFactory:function(g,m,y){y&&(m=h.hitch(y,m)),this.defaultFactories[g]=m},deregisterDefaultMessageFactory:function(g){delete this.defaultFactories[g]},registerMockResponseGenerator:function(g,m,y){const x=this;m=h.hitch(y||this,m),this.mockHandlers[g]=function(w,C){let P;const T=c.construct(C);P=m(w,T),P||(P=new b,P.callback()),P.addCallback(function(){x.responseManager._processResult(T)})}},deregisterMockResponseGenerator:function(g){delete this.mockHandlers[g]},sendMessage:function(g,m,y){const x={},w={};let C,P;m=m||{},this._createAndFillTransactions(g,m,y,x,w);const T=Object.keys(x);for(C=0;C<T.length;C=C+1)P=T[C],this._callMocks(w[P]),x[P].send(),this.responseManager.handleTransaction(x[P])},_getTransaction:function(g,m){return c.construct({context:m,computeToken:this.computeToken,endPointName:g})},_getMockTransaction:function(g,m,y){return c.construct({context:m,computeToken:this.computeToken,endPointName:g,uuid:y})},_createAndFillTransactions:function(g,m,y,x,w){let C,P;const T=function(X){let S,F,k,G,H,q;const ce=r.getEndPointForMessageType(X);if(H=x[ce],q=w[ce],H||(H=this._getTransaction(ce,m),q=this._getMockTransaction(ce,m,H.uuid),x[ce]=H,w[ce]=q),this.defaultFactories[X]){if(S=this.defaultFactories[X](H.context),!S)return;F=X.split(":"),k=F[0],G=F.slice(1,F.length).join(":"),this.mockHandlers[X]||H.addRequestMessage(k,S,G),q.addRequestMessage(k,S,G)}};let M,z;for(C in g)if(Object.prototype.hasOwnProperty.call(g,C)){const Y=r.getEndPointForMessageType(C);M=w[Y],z=x[Y],x[Y]||(z=this._getTransaction(Y,m),M=this._getMockTransaction(Y,m,z.uuid),x[Y]=z,w[Y]=M),P=[C,y].join(":"),this.mockHandlers[C]||this.mockHandlers[P]||z.addRequestMessage(C,g[C],y),M.addRequestMessage(C,g[C],y),this.mapping[P]?this.mapping[P].forEach(T,this):this.mapping[C]&&this.mapping[C].forEach(T,this)}},_callMocks:function(g){let m,y;const x=g.context;delete g.context;const w=function(P,T){let M;const z=m.getMessageClassifier(T);z&&(M=[P,z].join(":"),this.mockHandlers[M]&&this.mockHandlers[M]([T],m))};for(y in g.requestMessages)Object.prototype.hasOwnProperty.call(g.requestMessages,y)&&(m=h.mixin({},g),m.context=x,Object.prototype.hasOwnProperty.call(this.mockHandlers,y)&&this.mockHandlers[y](m.requestMessages[y],m),Array.isArray(m.requestMessages[y])?m.requestMessages[y].forEach(h.hitch(this,w,y)):w(y,m.requestMessages[y]));this.mockHandlers["*"]&&this.mockHandlers["*"](y,m.requestMessages[y],m)}})},R,W),R.exports=I},1830:(R,W,d)=>{"use strict";var O,I;O=[d(1203),d(1873),d(3073),d(1422)],I=d.dj.d(O,function(f,N,b,h){return f([],{constructor:function(o){o=o||{},this.responseHandlers=o.responseHandlers||{},this.faultManager=o.faultManager,this.transactions=o.transactions||[]},registerResponseHandler:function(o,c,u){u&&(c=N.hitch(u,c)),this.responseHandlers[o]=c},deregisterResponseHandler:function(o){delete this.responseHandlers[o]},handleTransaction:function(o){this.transactions.push(o),o.deferred.addCallback(N.hitch(this,this._processAll,o)),o.deferred.addCallback(N.hitch(this,this._processResult,o)),o.deferred.addErrback(N.hitch(this,this._processAll,o)),o.deferred.addErrback(N.hitch(this,this._processFault,o))},_processAll:function(o){const c=this.transactions.indexOf(o);c>=0&&this.transactions.splice(c,1)},_processResult:function(o){o.getResponseMessageTypes().forEach(function(c){const u=o.responseMessages[c],g=[];try{Array.isArray(u)&&(u.forEach(function(m){let y;const x=o.getMessageClassifier(m);if(x){y=[c,x].join(":");const w=this;let C=!1;o.getRequestMessageTypes().forEach(function(P){const T=o.requestMessages[P];Array.isArray(T)?T.forEach(function(M){w.responseHandlers[y]&&M.uuid===m.uuid&&(w.responseHandlers[y]([m],o.context),C=!0)}):w.responseHandlers[y]&&T.uuid===m.uuid&&(w.responseHandlers[y]([m],o.context),C=!0)}),C||g.push(m)}else g.push(m)},this),g.length>0&&this.responseHandlers[c]&&this.responseHandlers[c](g,o.context),this.responseHandlers["*"]&&this.responseHandlers["*"](c,o.responseMessages[c],o.context))}catch(m){b.error(`Remote: Fault occurred while processing response.
Message: `+m.message+`
Type: `+c+`
Response: `+JSON.stringify(u,null,2))}},this),this._processUdcResponses(o),o.fault&&this.faultManager.handleFault(o)},_processUdcResponses:function(o){if(!h.isEndpointMessageContainerBased(o.endPointName)){const u=Object.keys(o.requestMessages)[0];this.responseHandlers[u]&&this.responseHandlers[u](o.responseMessages)}},_processFault:function(o){this.faultManager.handleFault(o)}})},R,W),R.exports=I},8168:(R,W,d)=>{"use strict";var O,I;O=[d(1203),d(5642),d(1873),d(1422),d(3957)],I=d.dj.d(O,function(f,N,b,h,r){return f([],{constructor:function(c){c=c||{},this.requestMessages=c.requestMessages||{},this.responseMessages=c.responseMessages||{},this.context=c.context,this.computeToken=c.computeToken,this.uuidClassifierMap=c.uuidClassifierMap||{},this.endPointName=c.endPointName||null,this.allowedMessages=c.allowedMessages||[],this.ignoreMessageTypes=c.ignoreMessageTypes||[],this.sendMessage=c.sendMessage},addRequestMessage:function(c,u,g){if(!u)return;const m=h.isEndpointMessageContainerBased(this.endPointName);this.requestMessages[c]||(this.requestMessages[c]=[]),b.isArray(u)?u.forEach(function(y){this.addRequestMessage(c,y,g)},this):m?(u.uuid=u.uuid||this._generateUuid(),g&&(this.uuidClassifierMap[u.uuid]=g),this.requestMessages[c].push(u)):this.requestMessages[c]=u,this.requestMessages=this._filterMessages(this.requestMessages)},_filterMessages:function(c){const u={};return this.getRequestMessageTypes().forEach(function(g){(this.allowedMessages.length===0||this.allowedMessages.indexOf(g)>=0)&&(u[g]=c[g])},this),u},getResponseMessageTypes:function(){let c;const u=[];for(c in this.responseMessages)Object.prototype.hasOwnProperty.call(this.responseMessages,c)&&u.push(c);return u},getRequestMessageTypes:function(){let c;const u=[];for(c in this.requestMessages)Object.prototype.hasOwnProperty.call(this.requestMessages,c)&&u.push(c);return u},getMessageClassifier:function(c){return c&&c.uuid&&Object.prototype.hasOwnProperty.call(this.uuidClassifierMap,c.uuid)?this.uuidClassifierMap[c.uuid]:""},send:function(){this._removeEmptyMessages(),this._isEmpty(this.requestMessages)?(this.deferred=new N,this.deferred.callback()):(this.startTime=new Date().getTime(),this.deferred=this._doSend(this._getRequest(this.requestMessages)),this.deferred.addCallback(this,this._processResponse),this.deferred.addErrback(this,this._processFault))},addIgnoreMessageType:function(c,u){if(this.getRequestMessageTypes().indexOf(c)>-1)if(u){let g;for(g in this.uuidClassifierMap)Object.prototype.hasOwnProperty.call(this.uuidClassifierMap,g)&&u&&this.uuidClassifierMap[g]===u&&this.ignoreMessageTypes.push(c+":"+u)}else this.ignoreMessageTypes.push(c)},_removeEmptyMessages:function(){if(!this._isEmpty(this.requestMessages)){let c;for(c in this.requestMessages)Object.prototype.hasOwnProperty.call(this.requestMessages,c)&&b.isArray(this.requestMessages[c])&&r.getArrayLength(this.requestMessages[c])===0&&delete this.requestMessages[c]}},_isEmpty:function(c){let u;for(u in c)if(Object.prototype.hasOwnProperty.call(c,u))return!1;return!0},_generateUuid:function(){return r.generateUuid()}})},R,W),R.exports=I},8787:(R,W,d)=>{"use strict";var O,I;O=[d(9810),d(3716),d(8504)],I=d.dj.d(O,function(f,N,b){let h=!1;const r={};r._serviceData={},r.getServiceRegistryEndpoint=function(u){if(r._serviceData.serviceregistry){let g;const m=r._serviceData.serviceregistry.length;for(g=0;g<m;g+=1)if(r._serviceData.serviceregistry[g].name===u)return r._serviceData.serviceregistry[g].endpoint}return""};const o=function(g){let m=N.parseQueryString().mre;if(m){const y=new URL(m,window.location.href);if(b.isAllowed(y)){m=y.href;let x=g.serviceregistry;x=Array.isArray(x)?x:[];let w=!1;x.forEach(C=>{C.name&&C.name==="primary"&&(C.endpoint=m,w=!0)}),w||(x.push({name:"primary",endpoint:m}),g.serviceregistry=x)}}return g},c={_doXhr:function(g,m){return f(g,{handleAs:"json",failOk:!0,method:"GET",timeout:15e3,sync:m})},_reset:function(){h=!1,r._serviceData={}},load:function(g,m,y){if(h)y(r);else{const x=!m.async;c._doXhr("/serviceregistrylookup/1/service",x).then(function(w){w instanceof Object||(w={}),r._serviceData=o(w),h=!0,y(r)},function(){r._serviceData=o({}),h=!0,y(r)})}}};return c},R,W),R.exports=I},9863:(R,W,d)=>{"use strict";var O,I;O=[d(3073)],I=d.dj.d(O,function(f){const N=/^(?:[a-z]+:)?\/\//i,b=["localhost","127.0.0.1","[::1]"];return{createWorkerRoutingHostUrl:function(r,o){if(r==="about:blank")return r;let c=r,u="",g="";const m=o.host,y=o.sessionId,x=o.routingKey;let w=!0;try{if(u=new URL(m),this.isAbsoluteUrl(r))if(g=new URL(r),g.origin&&b.includes(g.hostname)){const C=g.pathname;c=new URL(C,u).href,g.search&&(g.searchParams.has("mre")&&g.searchParams.delete("mre"),c=c+g.search)}else g.origin&&g.hostname!==u.hostname&&(w=!1);else r&&r.startsWith("/")?c=u+r.substr(1,r.length):c=u+r;return w?(c=new URL(c),c.searchParams.set("mre",u),x&&y&&(c.search+="&routingkey="+x+"&computeToken="+encodeURIComponent(y)),c.href):c}catch(C){f.error("Input URL is malformed")}return c},isAbsoluteUrl:function(r){return!!N.test(r)}}},R,W),R.exports=I},8504:(R,W,d)=>{"use strict";var O,I;O=[],I=d.dj.d(O,function(){const f=["localhost","127.0.0.1","[::1]"];return{isAllowed(N){return N instanceof URL||(N=new URL(N)),this._checkIfSameOrigin(N.origin)||this._checkIfMathWorksAllowedDomain(N.hostname)||this._checkIfAllowedLocalHost(N.hostname)},_checkIfSameOrigin:N=>N===window.location.protocol+"//"+window.location.host,_checkIfMathWorksAllowedDomain:N=>{const b=N;for(const h of[".matlab.com",".mathworks.com",".mathworks.cn",".mwcloudtest.com"])if(b.endsWith(h))return!0;return!1},_checkIfAllowedLocalHost:N=>!!f.includes(N)}},R,W),R.exports=I},5530:(R,W,d)=>{"use strict";var O,I;O=[d(1422),d(5642)],I=d.dj.d(O,function(f,N){const b=function(r,o,c){return f.getIframeProxyClientForEndPoint(o).sendMessage(r,f.getRemoteUrlForEndPoint(o),c)};return{sendPayload:function(r,o,c){const u=new N;return b(r,o,c).then(function(m){u.resolve(m)}),u}}},R,W),R.exports=I},6363:(R,W,d)=>{"use strict";var O,I;O=[d(1203),d(9687)],I=d.dj.d(O,function(f,N){return f([],{constructor:function(h){h.stateMachine=this,this.state=new N(h)},start:function(){this.state.enter()},stop:function(){this.state.exit()},_changeState:function(h,r){this.state.enter(h,r)},onEnterState:function(h){},onExitState:function(h){}})},R,W),R.exports=I},9376:(R,W,d)=>{"use strict";var O,I;O=[d(1203),d(1873),d(3660),d(3073),d(4410)],I=d.dj.d(O,function(f,N,b,h,r){return f(r,{constructor:function(){this.connection={}},enable:function(){N.isFunction(this.context[this.name])&&(this.cachedFunction=this.context[this.name]),this.connection=b.after(this.context,this.name,N.hitch(null,this.triggerHandler,this.name),!0)},disable:function(){this.connection.remove(),this.cachedFunction&&(this.context[this.name]=this.cachedFunction)}})},R,W),R.exports=I},6441:(R,W,d)=>{"use strict";var O,I;O=[d(1203),d(1873),d(7505),d(3073),d(4410)],I=d.dj.d(O,function(f,N,b,h,r){return f(r,{constructor:function(){const c=this.name.split(" ");(c.length<2||c[0]!=="subscribe")&&h.error("Invalid trigger name for a MessageTrigger. Could not parse out the message name."),this.messageId=c[1]||"",this.subscrition={}},enable:function(){this.subscription=b.subscribe(this.messageId,N.hitch(null,this.triggerHandler,this.name))},disable:function(){this.subscription.remove()}})},R,W),R.exports=I},9240:(R,W,d)=>{"use strict";var O,I;O=[d(1203),d(1873),d(3073),d(8199),d(4410)],I=d.dj.d(O,function(f,N,b,h,r){return f(r,{constructor:function(){const c=this.name.split(" ");(c.length<2||c[0]!=="response"&&c[0]!=="fault")&&b.error("Invalid trigger name for a RemoteTrigger. Could not parse out the type of handler."),(!h.registerResponseHandler||!h.registerFaultHandler)&&b.error("The remote package is not available, this type of trigger will not work."),this.messageId=c[1]||"",this.handlerType=c[0]},enable:function(){this.handlerType==="response"?h.registerResponseHandler(this.messageId,N.hitch(null,this.triggerHandler,this.name)):h.registerFaultHandler(this.messageId,N.hitch(null,this.triggerHandler,this.name))},disable:function(){this.handlerType==="response"?h.deregisterResponseHandler(this.messageId):h.deregisterFaultHandler(this.messageId)}})},R,W),R.exports=I},9687:(R,W,d)=>{"use strict";var O,I;O=[d(1203),d(1873),d(3073),d(9376),d(6441),d(9240),d(3629),d(9359)],I=d.dj.d(O,function(f,N,b,h,r,o,c,u){let g;return g=f([],{constructor:function(y){this.stateMachine=y.stateMachine||{_changeState:function(){},onEnterState:function(){},onExitState:function(){}},this.namespace=y.namespace||"",this.name=y.name||this.getDefaultName(),this.context=y.context||{},this.data=y.data||{},this.composition=y.composition||"XOR",this.defaultSubstate=y.defaultSubstate||"",this.constructSubstates(y.substates),this.constructTriggersAndTransitions(y.transitions),this.active=y.active||!1},getDefaultName:function(){let y,x;return this.namespace.length>0?(y=this.namespace.split("."),x=y.pop()):b.warn("State: state name is not specified."),x||""},constructSubstates:function(y){const x={};let w,C;for(w in y)Object.prototype.hasOwnProperty.call(y,w)&&(C=y[w],C.name&&C.name!==w&&b.error("State: error constructing substate: "+w+", the specified names don't match: "+C.name),C.name=w,C.namespace=C.namespace||[this.namespace,this.name].join("."),C.stateMachine=C.stateMachine||this.stateMachine,C.context=C.context||this.context,x[C.name]=new g(C));this.substates=x},constructTriggersAndTransitions:function(y){let x;const w={},C=[];let P;for(x in y)Object.prototype.hasOwnProperty.call(y,x)&&(P=this.constructTrigger(x),P&&C.push(P),w[x]=this.constructTransition(x,y[x]));this.transitions=w,this.triggers=C},constructTrigger:function(y){let x,w;const C=y.split(" ");return C.length===2?C[0]==="subscribe"?w=r:C[0]==="response"||C[0]==="fault"?w=o:C[0]==="timeout"&&(w=c):(y!=="onEnterState"||y!=="onExitState")&&(w=h),w&&(x=new w({name:y,context:this.context,triggerHandler:N.hitch(this,this.handleTrigger)})),x},constructTransition:function(y,x){let w,C;return(N.isFunction(x)||N.isString(x)||N.isArray(x))&&(y==="onEnterState"||y==="onExitState"?(w=x,x={},x.action=w,x.target=""):(C=x,x={},x.target=C)),x.state=this,new u(x)},enter:function(y,x){this.active||(this.active=!0,this.enableTriggers(),this.stateMachine.onEnterState(this.name),this.handleTrigger.apply(this,["onEnterState"].concat(x))),y?this.changeSubstates(y,x):this.changeToDefaultSubstate(x)},exit:function(){const y=this.activeSubstates();this.active=!1,this.disableTriggers(),y.forEach(function(x){x.exit()}),this.handleTrigger("onExitState"),this.stateMachine.onExitState(this.name)},enableTriggers:function(){this.triggers.forEach(function(y){y.enable()})},disableTriggers:function(){this.triggers.forEach(function(y){y.disable()})},handleTrigger:function(y){let x,w;this.transitions[y]&&(w=Array.prototype.slice.call(arguments,1,arguments.length),x=this.transitions[y].handleTrigger(y,w),x&&(N.isString(x)||(w=x.args,x=x.target),this.stateMachine._changeState(x,w)))},changeSubstates:function(y,x){const w=this.activeSubstates();this.substates[y]&&(w.length>=0&&w[0].name!==y&&w.forEach(function(C){C.exit()}),this.substates[y].enter(void 0,x))},changeToDefaultSubstate:function(y){this.activeSubstates().length===0&&this.substates[this.defaultSubstate]&&this.substates[this.defaultSubstate].enter(void 0,y)},activeSubstates:function(){const y=[];let x;for(x in this.substates)Object.prototype.hasOwnProperty.call(this.substates,x)&&this.substates[x].active&&y.push(this.substates[x]);return y}}),g},R,W),R.exports=I},3629:(R,W,d)=>{"use strict";var O,I;O=[d(1203),d(1873),d(3073),d(4410)],I=d.dj.d(O,function(f,N,b,h){return f(h,{constructor:function(){const o=this.name.split(" ");(o.length<2||o[0]!=="timeout")&&b.error("Invalid trigger name for a TimeoutTrigger. Could not parse out the type of handler."),this.timeoutInSeconds=parseFloat(o[1]),this.handlerType=o[0]},enable:function(){this.disable(),this.timeoutHandle=setTimeout(N.hitch(null,this.triggerHandler,this.name),this.timeoutInSeconds*1e3)},disable:function(){this.timeoutHandle&&(clearTimeout(this.timeoutHandle),this.timeoutHandle=null)}})},R,W),R.exports=I},9359:(R,W,d)=>{"use strict";var O,I;O=[d(1203),d(1873),d(3073)],I=d.dj.d(O,function(f,N,b){return f([],{constructor:function(r){this.state={},this.target="",this.condition=null,this.action=null,f.safeMixin(this,r)},handleTrigger:function(r,o){let c="";return this.checkCondition(r,o)&&(this.runAction(r,o),c=this.getTarget(r,this.target,o)),c},checkCondition:function(r,o){return this.condition?N.hitch(this.state.context,this.condition).apply(null,[r,this.state.data].concat(o)):!0},runAction:function(r,o){let c;const u=this;this.action&&(c=N.hitch(this.state.context,this.action),c.apply(null,[r,u.state.data].concat(o)))},getTarget:function(r,o,c){let u,g,m,y;if(N.isString(o))g=o;else if(N.isFunction(o))m=N.hitch(this.state.context,o),g=m.apply(null,[r,this.state.data].concat(c));else if(N.isArray(o))for(u=0;u<o.length;u+=1){if(g=this.getTarget(r,o[u],c),N.isString(g)){g={target:g},N.mixin(g,y);break}if(g&&g.target){N.mixin(g,y);break}y=g||{}}else b.warn("Transition: improper target: ",o);return g}})},R,W),R.exports=I},4410:(R,W,d)=>{"use strict";var O,I;O=[d(1203)],I=d.dj.d(O,function(f){return f([],{constructor:function(b){this.name="",this.context={},this.triggerHandler=b.triggerHandler||function(){},f.safeMixin(this,b)},enable:function(){},disable:function(){}})},R,W),R.exports=I},3460:(R,W,d)=>{var O,I;O=[d(3282),d(5690),d(3846),d(5714)],I=d.dj.d(O,function(f,N,b,h){"use strict";var r={};class o{static createTooltip(u){if(!b.isElement(u.referenceNode))throw new Error("You must pass a valid dom node");if(N.has(u.referenceNode))throw new Error("A tooltip already exists for this reference node.Pass a new reference node");const g=new f(u);N.set(u.referenceNode,g);const m={};return Object.defineProperty(m,"content",{get(){return g.content},set(y){g.content=y,g.replaceContent()},enumerable:!0,configurable:!0}),m.destroy=g.destroy.bind(g),m}}return o.TYPE=h,r.default=o,r.default},R,W),R.exports=I},88:(R,W,d)=>{"use strict";var O,I;O=[d(5714),d(2764)],I=d.dj.d(O,function(f,N){"use strict";var b={};const h=`
<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M8 0.5L15.5 14.5H0.5L8 0.5Z" fill="var(--mw-icon-alert-red, #B7313C)" stroke="var(--mw-icon-alert-red, #B7313C)" stroke-linecap="square" stroke-linejoin="round"/>
<circle cx="8" cy="12" r="1" fill="var(--mw-icon-background-default-white, white)"/>
<path d="M8 9V5" stroke="var(--mw-icon-background-default-white, white)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<use href="#error" />
</svg>`,r=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M8 0.5L15.5 14.5H0.5L8 0.5Z" fill="var(--mw-icon-background-medium-yellow, #FFEF91)" stroke="var(--mw-icon-border-default-yellow, #674C06)" stroke-linecap="square" stroke-linejoin="round"/>
<circle cx="8" cy="12" r="1" fill="var(--mw-icon-glyph-content-yellow, #674C07)"/>
<path d="M8 9V5" stroke="var(--mw-icon-glyph-content-yellow, #674C07)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<use href="#warning" />
</svg>`;class o{static createContent(u){const{container:g,content:m}=u;if(m.type){let x=document.createElement("div");const w=m.type;let C;if(m.type===f.ERROR?(C="mw-tooltip-icon-error",x.innerHTML=h):m.type===f.WARNING&&(x.innerHTML=r,C="mw-tooltip-icon-warning"),C){const P=x.children[0].cloneNode(!0);x=null,g.setAttribute("mw-tooltip-type",w),P.setAttribute("class",C),g.appendChild(P)}}else g.hasAttribute("mw-tooltip-type")&&g.removeAttribute("mw-tooltip-type");g.type=m.type,(m.text===void 0||m.text===null)&&(m.text=""),typeof m.text!="string"&&(m.text=m.text.toString());const y=document.createElement("span");if(y.className="mw-tooltip-text",g.appendChild(y),m.isHTML===!0){const x=N.sanitizeHtmlForTooltip(m.text);y.appendChild(x)}else m.text.split(`
`).forEach(w=>{const C=document.createElement("span");C.textContent=w,y.appendChild(C),y.appendChild(document.createElement("br"))})}}return b.default=o,b.default},R,W),R.exports=I},3282:(R,W,d)=>{var O,I;O=[d(88),d(5690),d(5309),d(6011),d(7228),d(3846),d(3902),d(5163)],I=d.dj.d(O,function(f,N,b,h,r,o,c,u){"use strict";var g={};class m{constructor(x){this._referenceNode=x.referenceNode,this._hoverTimeOut=[],this._focusTimeOut=[],Object.defineProperty(this,"content",{set:function(w){this._content=w||null},get:function(){return this._content},enumerable:!0,configurable:!0}),this._content=x.content||null,this._handleHide=this._handleHide.bind(this),this._handleEscape=this._handleEscape.bind(this),this._handleShowOnFocus=this._handleShowOnFocus.bind(this),this._handleShowOnHover=this._handleShowOnHover.bind(this),this._calculateTooltipZindex=this._calculateTooltipZindex.bind(this),this._handleThePositionOfToolTip=this._handleThePositionOfToolTip.bind(this),this._attachEventListeners(),b.set(h.IDLE,this)}_isCurrentTooltip(){return b.get(h.WAITING)===this||b.get(h.SHOW)===this}_handleShowOnFocus(x){if(this._isCurrentTooltip()||!this._content||b.get(h.CURRENT_ACTIVE_ELEMENT)===this){o.setTooltipPrivateEventProp(x,"_mwTooltipCustomData","_focusEventHandled");return}if(o.getTooltipPrivateEventProp(x,"_mwTooltipCustomData","_focusEventHandled"))return;o.setTooltipPrivateEventProp(x,"_mwTooltipCustomData","_focusEventHandled"),b.set(h.CURRENT_ACTIVE_ELEMENT,this),b.set(h.WAITING,this);const w=setTimeout(()=>{b.set(h.SHOW,this),this._createTooltip(this._content);const C=o.getCoordsWrtPage(this._referenceNode),P=C.top+this._referenceNode.clientTop+this._referenceNode.clientHeight,T=C.left+this._referenceNode.clientLeft+this._referenceNode.clientWidth,M=P+r.OFFSET_FROM_BOTTOM,z=T-r.OFFSET_FROM_RIGHT;this._handleThePositionOfToolTip(z,M)},500);this._focusTimeOut.push(w)}_handleShowOnHover(x){let w=x.target;if(!this._referenceNode.contains(x.target)||this._isCurrentTooltip()||!this._content){o.setTooltipPrivateEventProp(x,"_mwTooltipCustomData","_hoverEventHandled");return}if(o.getTooltipPrivateEventProp(x,"_mwTooltipCustomData","_hoverEventHandled"))return;o.setTooltipPrivateEventProp(x,"_mwTooltipCustomData","_hoverEventHandled");let C=x.pageX,P=x.pageY;this._mouseMove=M=>{w=M.target,C=M.pageX,P=M.pageY},this._referenceNode.addEventListener("mousemove",this._mouseMove),b.set(h.WAITING,this);const T=setTimeout(()=>{if(!this._referenceNode.contains(w)){this._hideTooltip();return}this._createTooltip(this._content),b.set(h.SHOW,this),this._referenceNode.removeEventListener("mousemove",this._mouseMove);const M=P+r.OFFSET_FROM_BOTTOM_WITH_Y,z=C+r.OFFSET_FROM_BOTTOM_WITH_X;this._handleThePositionOfToolTip(z,M,C,P)},500);this._hoverTimeOut.push(T)}_clearTimeoutsAndEvents(){this._mouseMove&&this._referenceNode.removeEventListener("mousemove",this._mouseMove),clearTimeout(this._hoverTimeOut.pop()),clearTimeout(this._focusTimeOut.pop())}replaceContent(){if(this._isOpen()){for(;this._tooltipContainerSpan.hasChildNodes();)this._tooltipContainerSpan.removeChild(this._tooltipContainerSpan.lastChild);f.createContent({content:this.content,container:this._tooltipContainerSpan})}}_isOpen(){return!!this._tooltipContainerSpan}_getReferenceNodeTheme(){let x=c.getTheme(this._referenceNode);return x=x===""?u.light:u[x],x}_createTooltip(x){if(!x||Object.keys(x).length<=0)return;this._tooltipContainerSpan=document.createElement("span");const w=this._getReferenceNodeTheme();c.setTheme(w,this._tooltipContainerSpan),this._tooltipContainerSpan.setAttribute("mw-tooltip",""),this._tooltipContainerSpan.setAttribute("role","tooltip"),this._tooltipContainerSpan.style.maxWidth="min(calc(100vw - 20px), 400px)",f.createContent({content:x,container:this._tooltipContainerSpan}),document.body.appendChild(this._tooltipContainerSpan);let C=o.generateUuid();C="mw-tooltip-"+C,this._tooltipContainerSpan.setAttribute("id",C),this._referenceNode.setAttribute("aria-describedby",C)}_handleHide(x){x&&x.target&&!this._referenceNode.contains(x.target)||this._hideTooltip()}_calculateTooltipZindex(){const x=o.getEffectiveZindex(this._referenceNode),w=o.getElementZindex(this._tooltipContainerSpan);return x==="auto"||w==="auto"||x<w?"auto":x+1}_attachEventListeners(){this._referenceNode.addEventListener("mouseleave",this._handleHide),this._referenceNode.addEventListener("focusout",this._handleHide),this._referenceNode.addEventListener("click",this._handleHide),this._referenceNode.addEventListener("keydown",this._handleHide),this._referenceNode.addEventListener("mouseenter",this._handleShowOnHover),this._referenceNode.addEventListener("focusin",this._handleShowOnFocus),document.addEventListener("keyup",this._handleEscape)}_hideTooltip(){b.set(h.IDLE,this),this._tooltipContainerSpan&&(this._tooltipContainerSpan.setAttribute("mw-tooltip",""),document.body.removeChild(this._tooltipContainerSpan),this._tooltipContainerSpan=null),this._clearTimeoutsAndEvents()}_handleEscape(x){x.key==="Escape"&&this._hideTooltip()}_detachEventListeners(){this._referenceNode.removeEventListener("mouseleave",this._handleHide),this._referenceNode.removeEventListener("focusout",this._handleHide),this._referenceNode.removeEventListener("click",this._handleHide),this._referenceNode.removeEventListener("keydown",this._handleHide),this._referenceNode.removeEventListener("mouseenter",this._handleShowOnHover),this._referenceNode.removeEventListener("focusin",this._handleShowOnFocus),document.removeEventListener("keyup",this._handleEscape)}_handleThePositionOfToolTip(x,w,C,P){this._tooltipContainerSpan.setAttribute("mw-tooltip","show");const T=this._calculateTooltipZindex();T!=="auto"&&(this._tooltipContainerSpan.style.zIndex=T),this._tooltipContainerSpan.style.top=`${w}px`;const M=this._tooltipContainerSpan.getBoundingClientRect(),z=M.left+M.width>=window.innerWidth,Y=x+M.width>=window.innerWidth;if(z||Y){let X;const S=o.getBrowserVerticalScrollbarWidth();z?X=M.left:Y&&(X=x);const F=X+M.width-window.innerWidth;x=X-F-S}if(M.top+M.height>=window.innerHeight){const X=M.top+M.height-window.innerHeight,S=o.getBrowserHorizontalScrollbarHeight();w=w-X-S-r.OFFSET_FROM_TOP}C>=0&&P>=0&&C>x&&C<x+M.width&&P>w&&P<w+M.height&&(w=w-M.height+(P-w)-r.OFFSET_FROM_TOP_WITH_Y),this._tooltipContainerSpan.style.top=`${w}px`,this._tooltipContainerSpan.style.left=`${x}px`}destroy(){N.has(this._referenceNode)&&(this._detachEventListeners(),this._referenceNode.hasAttribute("aria-describedby")&&this._referenceNode.removeAttribute("aria-describedby"),this._tooltipContainerSpan&&(document.body.removeChild(this._tooltipContainerSpan),this._tooltipContainerSpan=null),N.delete(this._referenceNode),b.set(h.IDLE,this),b.clear(h.IDLE,this),b.get(h.CURRENT_ACTIVE_ELEMENT)===this&&b.clear(h.CURRENT_ACTIVE_ELEMENT),this._clearTimeoutsAndEvents(),this._referenceNode=null,this._hoverTimeOut=null,this._focusTimeOut=null,this._content=null,Object.defineProperty(this,"content",{set:function(){this._content=null},get:function(){return this._content},enumerable:!0,configurable:!0}))}}return g.default=m,g.default},R,W),R.exports=I},5690:(R,W,d)=>{"use strict";var O,I;O=[],I=d.dj.d(O,function(){"use strict";var f={};class N{constructor(){this._tooltipDepot=new WeakMap}clear(){this._tooltipDepot=new WeakMap}delete(h){return this._tooltipDepot.delete(h)}get(h){return this._tooltipDepot.get(h)}has(h){return this._tooltipDepot.has(h)}set(h,r){return this._tooltipDepot.set(h,r),this}}return f.default=new N,f.default},R,W),R.exports=I},5309:(R,W,d)=>{"use strict";var O,I;O=[d(6011)],I=d.dj.d(O,function(f){"use strict";var N={};class b{constructor(){this._state={},this._state.waiting=null,this._state.show=null,this._state.idle=[],this._state.activeElement=null}get(r){return this._state[r]?this._state[r]:null}clear(r,o){if(o){const c=this._state[r].indexOf(o);c>-1&&this._state[r].splice(c,1)}else switch(r){case"idle":this._state[r]=[];break;default:this._state[r]=null;break}}set(r,o){switch(r){case"show":this._state[r]?this._state[r]&&this._state[r]!==o&&(this._state[r]._handleHide(),this._state[r]=o,this.clear(f.WAITING),this.clear("idle",o)):(this._state[r]=o,this.clear(f.WAITING),this.clear("idle",o));break;case"idle":this._state[r].indexOf(o)===-1&&(this._state[r].push(o),this.get(f.WAITING)===o&&this.clear(f.WAITING),this.get(f.SHOW)===o&&this.clear(f.SHOW));break;case"waiting":this._state[r]?this._state[r]&&this._state[r]!==o&&(this._state[r]._handleHide(),this._state[r]=o,this.clear("idle",o)):(this._state[r]=o,this.clear("idle",o));break;case"activeElement":this._state[r]=o;break}}}return N.default=new b,N.default},R,W),R.exports=I},7228:(R,W,d)=>{var O,I;O=[],I=d.dj.d(O,function(){"use strict";var f={};const N=Object.freeze({OFFSET_FROM_BOTTOM:5,OFFSET_FROM_RIGHT:15,OFFSET_FROM_BOTTOM_WITH_X:10,OFFSET_FROM_TOP:20,OFFSET_FROM_BOTTOM_WITH_Y:20,OFFSET_FROM_TOP_WITH_Y:10});return f.default=N,f.default},R,W),R.exports=I},6011:(R,W,d)=>{var O,I;O=[],I=d.dj.d(O,function(){"use strict";var f={};const N=Object.freeze({SHOW:"show",HIDE:"hide",WAITING:"waiting",IDLE:"idle",CURRENT_ACTIVE_ELEMENT:"activeElement"});return f.default=N,f.default},R,W),R.exports=I},5163:(R,W,d)=>{var O,I;O=[d(8554)],I=d.dj.d(O,function(f){"use strict";var N={};const b=Object.freeze({light:f.LIGHT,dark:f.DARK});return N.default=b,N.default},R,W),R.exports=I},5714:(R,W,d)=>{var O,I;O=[],I=d.dj.d(O,function(){"use strict";var f={};const N=Object.freeze({WARNING:"warning",ERROR:"error"});return f.default=N,f.default},R,W),R.exports=I},2764:(R,W,d)=>{var O,I;O=[],I=d.dj.d(O,function(){"use strict";var f={};const N={B:[],BR:[],CODE:[],EM:[],I:[],S:[],SUB:[],SUP:[],STRONG:[],U:[]},b=function(h){return function(r){const o=function(x,w){const C=[];for(const P of x){const T=P;if(w.hasAttribute(T)){const M=w.getAttribute(T);C.push({key:T,value:M})}}return C},c=function(x){let w;if(x.nodeType===window.Node.ELEMENT_NODE)if(h[x.tagName]){w=document.createElement(x.tagName);const P=h[x.tagName];o(P,x).forEach(M=>{w.setAttribute(M.key,M.value)})}else w=document.createDocumentFragment();else x.nodeType===window.Node.TEXT_NODE?w=document.createTextNode(x.textContent):w=document.createDocumentFragment();return w},u=function(x,w=0){const C=document.createDocumentFragment();if(w>150||!x)return C;for(let P=x.firstChild;P;P=P.nextSibling){const T=c(P);P.nodeType===window.Node.ELEMENT_NODE&&T.appendChild(u(P,w+1)),C.appendChild(T)}return C},m=new DOMParser().parseFromString(r,"text/html");let y;return m.body?y=u(m.body):y=document.createDocumentFragment(),y}};return f.default={sanitizeHtmlForTooltip:b(N)},f.default},R,W),R.exports=I},3846:(R,W,d)=>{"use strict";var O,I;O=[],I=d.dj.d(O,function(){"use strict";var f={};class N{static getCoordsWrtPage(h){const r=h.getBoundingClientRect();return{top:r.top+window.pageYOffset,left:r.left+window.pageXOffset}}static isElement(h){return h instanceof window.Element||h instanceof window.HTMLElement}static isValidReferenceNode(h){return h&&Array.isArray(h)&&h.length>0?h.every(r=>r instanceof window.Element||r instanceof window.HTMLElement):h instanceof window.Element||h instanceof window.HTMLElement||h instanceof window.NodeList&&h.length>0}static removeChildNodes(h){for(;h.lastChild;)h.removeChild(h.lastChild)}static getBrowserVerticalScrollbarWidth(){return window.innerWidth-document.documentElement.clientWidth}static getBrowserHorizontalScrollbarHeight(){return window.innerHeight-document.documentElement.clientHeight}static getScrollbarWidth(h){return h.offsetWidth-h.clientWidth}static getScrollbarHeight(h){return h.offsetHeight-h.clientHeight}static setTooltipPrivateEventProp(h,r,o){(!h[r]||!h[r][o])&&(h[r]={},h[r][o]="true")}static getTooltipPrivateEventProp(h,r,o){return!!(h[r]&&h[r][o])}static generateUuid(){return"xxxxxxxx".replace(/[xy]/g,function(h){const r=Math.random()*16|0;return(h==="x"?r:r&3|8).toString(16)}).toUpperCase()}static getElementZindex(h){return window.getComputedStyle(h).getPropertyValue("z-index")}static getEffectiveZindex(h){let r=0,o,c=!0;for(;h&&N.isElement(h);)o=N.getElementZindex(h),o!=="auto"&&(o=parseInt(o,10),o>r&&(c=!1,r=o)),h=h.parentNode;return c?"auto":r}static isSelectorValid(h){return h.substring(0,1)==="."||h.substring(0,1)==="#"}static calculateTooltipZindex(h,r){const o=N.getEffectiveZindex(h),c=N.getElementZindex(r);return o==="auto"||c==="auto"||o<c?"auto":o+1}static observeElementInDom(h){let r,o=document.body.contains(h);const c=new Promise(function(g,m){r=g}),u=new window.MutationObserver(function(g){document.body.contains(h)?o=!0:o&&(o=!1,r(h))});return u.observe(document.body,{childList:!0,subtree:!0}),{promise:c,observer:u}}static stopObservingElement(h){h.disconnect()}static hasMultipleReferenceNode(h){return h&&(Array.isArray(h)||h instanceof window.NodeList)&&h.length>0}}return f.default=N,f.default},R,W),R.exports=I},8554:(R,W,d)=>{var O,I;O=[],I=d.dj.d(O,function(){"use strict";var f={};const N=Object.freeze({LIGHT:"light",DARK:"dark"});return f.default=N,f.default},R,W),R.exports=I},3902:(R,W,d)=>{var O,I;O=[d(8554)],I=d.dj.d(O,function(f){"use strict";var N={};let b;class h{constructor(){this.themeClass={light:"mw-theme-light",dark:"mw-theme-dark"},this.themeName={"mw-theme-light":f.LIGHT,"mw-theme-dark":f.DARK},window.matchMedia&&(this.windowMediaQuery=window.matchMedia("(prefers-color-scheme: dark)")),this._mediaQueryEventHandler=this._mediaQueryEventHandler.bind(this)}set useSystemMode(c){c?this._setThemeBySystemMode():this._removeSystemMode()}set useSettings(c){c&&(b=c.settingsObj||c,b.getSetting(["matlab","appearance"],"MATLABTheme").then(u=>{this._settingsValueHandler(u.value,c.domNode)}),b.listenTo(["matlab","appearance"],"MATLABTheme",u=>{this._settingsValueHandler(u.newValue,c.domNode)}))}_settingsValueHandler(c,u){let g;switch(c){case"System":this.useSystemMode=!0;break;case"Light":this.useSystemMode=!1,g=this.getTheme(),this.setTheme(f.LIGHT,u),this._emitEvent(g,f.LIGHT);break;case"Dark":this.useSystemMode=!1,g=this.getTheme(),this.setTheme(f.DARK,u),this._emitEvent(g,f.DARK);break}}_setThemeBySystemMode(){let c=this.getTheme();this.windowMediaQuery.matches?(this.setTheme(f.DARK),this._emitEvent(c,f.DARK)):(this.setTheme(f.LIGHT),this._emitEvent(c,f.LIGHT)),this.windowMediaQuery&&this.windowMediaQuery.addEventListener("change",this._mediaQueryEventHandler)}_removeSystemMode(){this.windowMediaQuery.removeEventListener("change",this._mediaQueryEventHandler)}_mediaQueryEventHandler(c){let u=this.getTheme();c.matches?(this.setTheme(f.DARK),this._emitEvent(u,f.DARK)):(this.setTheme(f.LIGHT),this._emitEvent(u,f.LIGHT))}_emitEvent(c,u){let g={oldTheme:c,newTheme:u},m=new CustomEvent("themechanged",{detail:g});if(document.body.dispatchEvent(m),b){const y=["matlab","appearance","CurrentTheme"].join("."),x=u.charAt(0).toUpperCase()+u.slice(1);b.setSettingValue(y,x,b.SettingLevel.TEMPORARY),b.clearSettingValue(y,b.SettingLevel.PERSONAL)}}setTheme(c,u){if(Object.keys(this.themeClass).includes(c)){let g=u||document.getElementsByTagName("body")[0];if(this._isHTMLElement(g)){for(let m in this.themeClass)g.classList.contains(this.themeClass[m])&&g.classList.remove(this.themeClass[m]);g.style.colorScheme=c,g.classList.add(this.themeClass[c])}}else throw new Error("The requested theme is not supported")}_isHTMLElement(c){return!!(c&&(c instanceof HTMLElement||c.ownerDocument&&c.ownerDocument.defaultView&&c.ownerDocument.defaultView.Element&&c instanceof c.ownerDocument.defaultView.Element))}getTheme(c){let u=c||document.getElementsByTagName("body")[0];return window.getComputedStyle(u).getPropertyValue("--mw-themeName").trim()}}var r=new h;return Object.freeze(r),N.default=r,N.default},R,W),R.exports=I},3957:(R,W,d)=>{var O,I;O=[d(4653)],I=d.dj.d(O,function(f){"use strict";var N={};return N.default={generateUuid:function(){return this._uuidFromTemplate("xxxxxxxx").toUpperCase()},generateUUIDv4:function(){return this._uuidFromTemplate("xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx")},_uuidFromTemplate:function(b){return b.replace(/[xy]/g,function(h){const r=Math.random()*16|0;return(h==="x"?r:r&3|8).toString(16)})},isImageData:function(b){return!!b&&(typeof window=="object"&&window.ImageData&&b instanceof window.ImageData||Object.prototype.hasOwnProperty.call(b,"width")&&Object.prototype.hasOwnProperty.call(b,"height")&&Object.prototype.hasOwnProperty.call(b,"data"))},isArray:function(b){return f.deprecated({deprecated:{module:"mw-utils/Utils",method:"isArray"},geckNumber:1444368}),Array.isArray(b)},getArrayLength:function(b){let h=0;return Array.isArray(b)?(b.forEach(function(r){r&&(h+=1)}),h):!1},isWhitespace:function(b){return/^\s+$/.test(b)},removeSurroundingNewLines:function(b){for(;b.charAt(0)===`
`;)b=b.substring(1);for(;b.charAt(b.length-1)===`
`;)b=b.substring(0,b.length-1);return b},getFirstUniqueElement:function(b,h){let r=null;return h.some(function(o){return b.indexOf(o)===-1?(r=o,!0):!1}),r},unionOfWordSets:function(b,h,r){b=this._stringToArray(b),h=this._stringToArray(h);const o=this.unionOfArrays(b,h);return r?o.join(" "):o},intersectionOfWordSets:function(b,h,r){b=this._stringToArray(b),h=this._stringToArray(h);const o=this.intersectionOfArrays(b,h);return r?o.join(" "):o},differenceOfWordSets:function(b,h,r){b=this._stringToArray(b),h=this._stringToArray(h);const o=this.unique(this.differenceOfArrays(b,h));return r?o.join(" "):o},unionOfArrays:function(b,h){return this.unique(b.concat(h))},intersectionOfArrays:function(b,h){return this.nonunique(b.concat(h))},differenceOfArrays:function(b,h){if(window.Map===void 0)return this._legacyDifferenceOfArrays(b,h);let r,o,c;const u=new Map,g=[];for(c=0;c<h.length;c++)u.set(h[c],null);for(c=0;c<b.length;c++)o=b[c],r=u.has(o),r||g.push(o);return g},_legacyDifferenceOfArrays:function(b,h){return this.unique(b.filter(function(r){return h.indexOf(r)===-1}))},unique:function(b){return b.filter(function(h,r){return b.indexOf(h)===r})},nonunique:function(b){return this.unique(b.filter(function(h,r){return b.indexOf(h)!==r}))},arrayEquals:function(b,h,r){if(b===h)return!0;if(b.length!==h.length)return!1;r||(r=function(o,c){return o===c});for(let o=0,c=b.length;o<c;o++)if(!r(b[o],h[o]))return!1;return!0},removeEmptyElements:function(b){return b.filter(function(h){return!(h===""||h===null||h===void 0)})},_stringToArray:function(b){return this._isString(b)?this.removeEmptyElements(b.split(" ")):b},_isString:function(b){return typeof b=="string"||b instanceof String}},N.default},R,W),R.exports=I},1723:(R,W,d)=>{Promise.resolve().then(function(){var O=[d(757),d(5880)];(async I=>{(async()=>{(await I).start()})()}).apply(null,O)}).catch(d.oe)},3375:(R,W,d)=>{var O,I;O=[d(40)],I=d.dj.d(O,function(f){return class extends f.EventDispatcher{constructor(b){super(),this.running=!1,this.update(b)}update(b){this.running=b.Enabled,this.interruptible=b.Interruptible,this._orbitStepSize=b.OrbitStepSize,this._orbitNumSteps=b.OrbitNumSteps,this._iteration=0}setNextFrame(b,h,r){const o=this._orbitStepSize*Math.PI/180,c=new f.Quaternion;c.setFromAxisAngle(r.up,o),h.applyQuaternion(c),r.position.addVectors(b,h),this._iteration+=1,this._orbitNumSteps>0&&this._iteration>=this._orbitNumSteps&&(this.running=!1,this.dispatchEvent({type:"animationFinished"}))}}},R,W),R.exports=I},7736:(R,W,d)=>{var O,I;O=[d(40)],I=d.dj.d(O,function(f){return{uniforms:{u_outerColor:{value:new f.Vector3(.2,.2,.2)},u_innerColor:{value:new f.Vector3(.5,.5,.5)},u_focalPoint:{value:new f.Vector2(-.2,.4)},u_noiseAlpha:{value:.1},u_grainScale:{value:.001},u_noiseOffset:{value:0}},vertexShader:`varying vec2 vUv;
        void main() {
            gl_Position = vec4( position, 1.0 );
            vUv = vec2( position.x, position.y ) * 0.5 + 0.5;
        }`,fragmentShader:`
        //---------------------------------------------------------------------
        // Fragment shader for background gradient
        //---------------------------------------------------------------------
        
        // Copyright 2022 The MathWorks, Inc.
        
        uniform vec3 u_outerColor;
        uniform vec3 u_innerColor;
        uniform vec2 u_focalPoint;
        uniform float u_noiseAlpha;
        uniform float u_grainScale;
        uniform float u_noiseOffset;
        varying vec2 vUv;
        
        #ifdef USE_GRADIENT
            vec3 blendColor(vec3 color, vec3 blend);
            float blendValue(float base, float blend);
            float grain (vec2 tex, vec2 res, float frame);
            vec3 mod289(vec3 x);
            vec4 mod289(vec4 x);
            vec4 permute(vec4 x);
            vec4 taylorInvSqrt(vec4 r);
            vec3 fade(vec3 t);
            float perlinNoise(vec3 p, vec3 rep);
        #endif
        
        void main() {
            #ifdef USE_GRADIENT
                vec2 newVector = vec2(vUv - 0.5);
                newVector -= u_focalPoint;
                float distance = length(newVector);
                distance = smoothstep(0.0, 1.0, distance);
                vec3 color = mix(u_innerColor, u_outerColor, distance);
                if (u_noiseAlpha > 0.0 && u_grainScale > 0.0) {
                    float grainSize = 1.0 / u_grainScale;
                    float grainNoise = grain(vUv, vec2(grainSize, grainSize), 0.0);
                    vec3 grainColor = blendColor(color, vec3(grainNoise));
                    gl_FragColor = vec4(mix(color, grainColor, u_noiseAlpha),1.0);
                } else {
                    gl_FragColor = vec4(color,1.0);
                }
            #else
                gl_FragColor = vec4(u_outerColor,1.0);
            #endif
        }
        
        #ifdef USE_GRADIENT
            float blendValue( float base, float blend ) {
                return ( blend < 0.5 ) ? ( 2.0 * base * blend + base * base * ( 1.0 - 2.0 * blend )) : ( sqrt( base ) * ( 2.0 * blend - 1.0 ) + 2.0 * base * ( 1.0 - blend ));
            }
        
            vec3 blendColor( vec3 color, vec3 blend ) {
                return vec3(blendValue(color.r,blend.r), blendValue(color.g,blend.g), blendValue(color.b,blend.b));
            }
        
            float grain (vec2 tex, vec2 res, float frame ) {
                float multiplier = 2.5;
                vec2 mult = tex * res;
                float noise = perlinNoise(vec3(mult, u_noiseOffset), vec3(1.0 / tex * res, 1.0));
                return noise / 2.0 + 0.5;
            }
        
            vec3 mod289(vec3 x) {
                return x - floor(x * (1.0 / 289.0)) * 289.0;
            }
        
            vec4 mod289(vec4 x) {
                return x - floor(x * (1.0 / 289.0)) * 289.0;
            }
        
            vec4 permute(vec4 x) {
                return mod289(((x*34.0)+1.0)*x);
            }
        
            vec4 taylorInvSqrt(vec4 r) {
                return 1.79284291400159 - 0.85373472095314 * r;
            }
        
            vec3 fade(vec3 t) {
                return t*t*t*(t*(t*6.0-15.0)+10.0);
            }
        
            // Classic Perlin noise, periodic variant
            float perlinNoise(vec3 p, vec3 rep) {
                // Integer part, mod period
                vec3 pint0 = mod(floor(p), rep);
                // Integer part + 1, mod period
                vec3 pint1 = mod(pint0 + vec3(1.0), rep);
                pint0 = mod289(pint0);
                pint1 = mod289(pint1);
                // Fractional part for interpolation
                vec3 pfract0 = fract(p);
                // Fractional part - 1.0
                vec3 pfract1 = pfract0 - vec3(1.0);
                vec4 ix = vec4(pint0.x, pint1.x, pint0.x, pint1.x);
                vec4 iy = vec4(pint0.yy, pint1.yy);
                vec4 iz0 = pint0.zzzz;
                vec4 iz1 = pint1.zzzz;
        
                vec4 ixy = permute(permute(ix) + iy);
                vec4 ixy0 = permute(ixy + iz0);
                vec4 ixy1 = permute(ixy + iz1);
        
                vec4 gx0 = ixy0 * (1.0 / 7.0);
                vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;
                gx0 = fract(gx0);
                vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
                vec4 sz0 = step(gz0, vec4(0.0));
                gx0 -= sz0 * (step(0.0, gx0) - 0.5);
                gy0 -= sz0 * (step(0.0, gy0) - 0.5);
        
                vec4 gx1 = ixy1 * (1.0 / 7.0);
                vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;
                gx1 = fract(gx1);
                vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
                vec4 sz1 = step(gz1, vec4(0.0));
                gx1 -= sz1 * (step(0.0, gx1) - 0.5);
                gy1 -= sz1 * (step(0.0, gy1) - 0.5);
        
                vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
                vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
                vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
                vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
                vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
                vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
                vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
                vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);
        
                vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
                g000 *= norm0.x;
                g010 *= norm0.y;
                g100 *= norm0.z;
                g110 *= norm0.w;
                vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
                g001 *= norm1.x;
                g011 *= norm1.y;
                g101 *= norm1.z;
                g111 *= norm1.w;
        
                float n000 = dot(g000, pfract0);
                float n100 = dot(g100, vec3(pfract1.x, pfract0.yz));
                float n010 = dot(g010, vec3(pfract0.x, pfract1.y, pfract0.z));
                float n110 = dot(g110, vec3(pfract1.xy, pfract0.z));
                float n001 = dot(g001, vec3(pfract0.xy, pfract1.z));
                float n101 = dot(g101, vec3(pfract1.x, pfract0.y, pfract1.z));
                float n011 = dot(g011, vec3(pfract0.x, pfract1.yz));
                float n111 = dot(g111, pfract1);
        
                vec3 fadexyz = fade(pfract0);
                vec4 nz = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fadexyz.z);
                vec2 nyz = mix(nz.xy, nz.zw, fadexyz.y);
                float nxyz = mix(nyz.x, nyz.y, fadexyz.x);
                return 2.2 * nxyz;
            }
        #endif
            `}},R,W),R.exports=I},2588:(R,W,d)=>{var O,I;O=[d(40)],I=d.dj.d(O,function(f){return class{constructor(b,h){this.loaded=!1,this.memory=0,this.numElements=0,this.id=b,this.level=h.Level,this.parent=null,this.weight=0,this.overview=!1,this._mesh=null,this._depthMesh=null,this._center=new f.Vector3(h.Center[0],h.Center[1],h.Center[2]),this._vector=new f.Vector3,this._radius=h.Radius,this._sphere=new f.Sphere,this.info={id:-1,blockIndex:b,level:h.Level,index:h.Index,numBlocksToRead:1,outOfCore:!1,distance:1/0}}load(b,h,r,o,c){this.loaded=!0,this.visible=!0}unload(){this.memory=0,this.visible=!1,this.loaded=!1,this.overview=!1}isInView(b,h,r,o){return h.intersectsSphere(this._sphere)&&!this._isCulled(o)?this.loaded?(this.visible=!0,!1):(this.info.distance=this._measureDistance(b,r),!0):!1}setWeight(b,h,r,o,c){switch(this._sphere.set(this._center,this._radius),this._sphere.applyMatrix4(o),r.style){case"level":this.weight=this._validateLevel(r);break;case"threshold":if(this.level===1){this.weight=Number.MAX_VALUE;break}if(b.isPerspectiveCamera){const u=b.position.x-this._center.x,g=b.position.y-this._center.y,m=b.position.z-this._center.z,y=Math.sqrt(u*u+g*g+m*m),x=this._radius*c.height*.5/(Math.tan(b.fov/b.zoom*Math.PI/360)*y);this.weight=x}else{const u=b.position.x-this._center.x,g=b.position.y-this._center.y,m=b.position.z-this._center.z,y=Math.sqrt(u*u+g*g+m*m),x=2*this._radius*c.height/(y/b.zoom);this.weight=x}break}}copyMaterial(b,h,r,o){this._depthMesh!==null&&(this._depthMesh.material.dispose(),this._depthMesh.material=h.clone(),this._depthMesh.material.visible=!0),this._mesh!==null&&(this._mesh.material.dispose(),this._mesh.material=b.clone(),this._mesh.material.visible=!0,this.copyUniforms(b.uniforms,o))}copyGlobalUniforms(b){this._mesh.material.uniforms.u_depthTexture=b.u_depthTexture,this._mesh.material.uniforms.u_previousTexture=b.u_previousTexture,this._mesh.material.uniforms.u_passNumber=b.u_passNumber,this._mesh.material.uniforms.u_viewportSize=b.u_viewportSize,this._mesh.material.uniforms.u_cropMin=b.u_cropMin,this._mesh.material.uniforms.u_cropMax=b.u_cropMax,this._mesh.material.uniforms.u_colorBoxMatrix=b.u_colorBoxMatrix,this._mesh.material.uniforms.u_colorBoxColor=b.u_colorBoxColor,this._depthMesh.material.uniforms.u_depthTexture=b.u_depthTexture,this._depthMesh.material.uniforms.u_previousTexture=b.u_previousTexture,this._depthMesh.material.uniforms.u_passNumber=b.u_passNumber,this._depthMesh.material.uniforms.u_viewportSize=b.u_viewportSize,this._depthMesh.material.uniforms.u_cropMin=b.u_cropMin,this._depthMesh.material.uniforms.u_cropMax=b.u_cropMax}copyUniforms(b,h){}setClippingPlanes(b){this._depthMesh!==null&&(this._depthMesh.material.clippingPlanes=b),this._mesh!==null&&(this._mesh.material.clippingPlanes=b)}renderOrder(b,h){this._mesh!==null&&(this._mesh.renderOrder=b)}hideLevels(b,h){this.level!==b&&(this.level!==h?this.visible=!1:this.depthWrite=!1)}showLevels(b){this.level===b&&(this.visible=!0,this.depthWrite=!0)}_clearTransferFunctionTextures(){this._mesh!==null&&(this._mesh.material.uniforms.u_transferFunction.value!==null&&(this._mesh.material.uniforms.u_transferFunction.value.dispose(),this._mesh.material.uniforms.u_transferFunction.value=null),this._mesh.material.uniforms.u_overlayTransferFunction.value!==null&&(this._mesh.material.uniforms.u_overlayTransferFunction.value.dispose(),this._mesh.material.uniforms.u_overlayTransferFunction.value=null))}dispose(){this._mesh!==null&&(this._mesh.geometry.dispose(),this._mesh.material.dispose(),this._mesh.parent.remove(this._mesh),this._mesh=null),this._depthMesh!==null&&(this._depthMesh.geometry.dispose(),this._depthMesh.material.dispose(),this._depthMesh.parent.remove(this._depthMesh),this._depthMesh=null),this.memory=0}set visible(b){this._mesh!==null&&(this._mesh.visible=b),this._depthMesh!==null&&(this._depthMesh.visible=b)}get visible(){return this._mesh===null?!1:this._mesh.visible}set depthWrite(b){this._mesh!==null&&(this._mesh.material.depthWrite=b),this._depthMesh!==null&&(this._depthMesh.depthWrite=b)}get depthWrite(){return this._mesh===null?!1:this._mesh.material.depthWrite}_validateLevel(b){return this.level===b.level?1:0}_isCulled(b){let h=!1;if(b.numCropBoxes>0&&(this._vector.copy(this._sphere.center).clamp(b.cropMin,b.cropMax),b.cropExclude||this._vector.distanceToSquared(this._sphere.center)>this._sphere.radius*this._sphere.radius&&(h=!0)),!h&&b.numClippingPlanes>0)if(b.clipIntersection){h=!0;for(let r=0;r<b.clippingPlanes.length;r++)h=h&&b.clippingPlanes[r].distanceToPoint(this._sphere.center)<-this._sphere.radius}else for(let r=0;r<b.clippingPlanes.length;r++)h=h||b.clippingPlanes[r].distanceToPoint(this._sphere.center)<-this._sphere.radius;return h}_measureDistance(b,h){return b.isPerspectiveCamera?b.position.distanceTo(this._sphere.center):(this._sphere.center.sub(b.position).negate(),h.dot(this._sphere.center))}}},R,W),R.exports=I},1600:(R,W,d)=>{var O,I;O=[d(40),d(1952),d(8695),d(1270),d(562),d(7086)],I=d.dj.d(O,function(f,N,b,h,r,o){return class{constructor(u="image",g=.5){this._center=new f.Sphere,this.numLevels=0,this._level=0,this._scaleByLevel=[],this._levelMode="auto",this._blocks=[],this._blocksForLoading=[],this._levelChanged=!1,this._type=u,this._sendDataToServer=!1,this._opaque=!1,this.outOfCore=!1,this.levelOfDetail=!1,this.threshold=g,this.numBlocks=0,this._enabled=!0,this._blockPriorityQueue=new r,this._blocksOutsideView=[],this._lru=new o}set enabled(u){u?this._enabled=!0:(this._blocksForLoading=[],this._enabled=!1)}get enabled(){return this._enabled}setBlockList(u,g,m=!1){switch(this.levelOfDetail=m,u){case"full":if(this.clear(),this.numLevels=g.NumLevels,this.numLevels>0){for(let y=0;y<g.InstructionSet.length;y++)this._blocks.push(this._initTile(y,g.InstructionSet[y]));this.numBlocks=g.InstructionSet.length}if(this.levelOfDetail)for(let y=0;y<g.InstructionSet.length;y++)g.InstructionSet[y].Parent>-1&&(this._blocks[y].parent=this._blocks[g.InstructionSet[y].Parent]);break;case"partial":this.unloadFineLevels();break;case"reload":if(this.outOfCore)this.unload(!0);else for(let y=0;y<this._blocks.length;y++)this._blocks[y].loaded=!1,this._blocks[y].overview=!1;break}}setBoundingSphere(u,g,m){this._center.radius=g,this._center.center.fromArray(u),this._scaleByLevel=m}setResolutionLevel(u){if(u==="auto")this._levelMode="auto";else{this._levelMode="manual";const g=this._level;u==="fine"?this._level=1:u==="coarse"?this._level=this.numLevels:this._level=u,g!==this._level&&(this._levelChanged=!0)}}setRenderOrder(u){for(let g=0;g<this._blocks.length;g++)this._blocks[g].renderOrder(u,this.numLevels)}setOpaque(u){u!==this._opaque&&(this._opaque=u,this._opaque||this._hideOtherLevels(this._level))}packageData(u,g){this._levelMode==="auto"&&this._sendDataToServer&&u.push({id:g,level:this._level}),this._sendDataToServer=!1}copyMaterial(u,g,m,y){for(let x=0;x<this._blocks.length;x++)this._blocks[x].copyMaterial(u,g,m,y)}copyUniforms(u,g){for(let m=0;m<this._blocks.length;m++)this._blocks[m].copyUniforms(u,g)}setClippingPlanes(u){for(let g=0;g<this._blocks.length;g++)this._blocks[g].setClippingPlanes(u)}resetBlocks(u,g,m,y,x,w,C){this.outOfCore&&this.unload(!0),this._updateBlocksInView(u,g,m,y,x,w,C)}loadBlock(u,g,m,y,x,w){this.outOfCore&&this.unload(!0),this._blocks[g].load(u,m,y,x,w)}_setLevel(u,g,m,y){if(this._levelMode==="auto"){const x=this._level;if(this.numLevels>1)if(u.isPerspectiveCamera){const w=2*u.position.distanceTo(this._center.center),C=.5*u.zoom*this._center.radius;w<=C?this._level=1:w>=2*C?this._level=this.numLevels:this._level=Math.round((this.numLevels-1)*(w/C-1))+1}else{const w=Math.max(Math.abs((u.right-u.left)/y.width),Math.abs((u.top-u.bottom)/y.height))/u.zoom;if(this.outOfCore){this._level=this.numLevels;for(let C=0;C<this.numLevels;C++)if(this._scaleByLevel[C]>=w){this._level=C+1;break}}else{this._level=1;for(let C=0;C<this.numLevels;C++)this._scaleByLevel[C]<w&&(this._level=C+1)}}else this._level=this.numLevels;if(x!==this._level){for(let w=0;w<this._blocks.length;w++)this._blocks[w].showLevels(this.numLevels);this._levelChanged=!0,this._sendDataToServer=!0}}}_updateBlocksInView(u,g,m,y,x,w,C){if(this._blocksForLoading=[],this._blocksOutsideView=[],this._blockPriorityQueue.clear(),!this._enabled)return;let P="level";this._type==="pointcloud"&&(P="threshold"),P==="level"&&this._setLevel(u,g,m,y);const T={level:this._level,numLevels:this.numLevels,threshold:this.threshold,style:P};for(let M=0;M<this._blocks.length;M++)this._blocks[M].setWeight(u,x,T,w,y),this._blockPriorityQueue.push({index:M,level:this._blocks[M].level,weight:this._blocks[M].weight});for(;this._blockPriorityQueue.length()>0;){const z=this._blockPriorityQueue.pop().index;this._blocks[z].weight>T.threshold?this._blocks[z].isInView(u,g,m,C)?this._blocksForLoading.push(this._blocks[z].info):this._blocksOutsideView.push(z):((T.style==="threshold"||this.outOfCore)&&(this._blocks[z].visible=!1),this._blocksOutsideView.push(z))}this._blocksForLoading.length===0&&this._hideOtherLevels(this._level),this._blockPriorityQueue.clear()}getNextBlock(u,g){return this._blocksForLoading[u].outOfCore=this.outOfCore,this._blocksForLoading[u].id=g,this._blocksForLoading.splice(u,1)[0]}findNextBlock(){if(!this._enabled)return null;if(this._blocksForLoading.length>0){let u=0;if(this._blocksForLoading.length>1)if(this._type!=="pointcloud")for(let g=1;g<this._blocksForLoading.length;g++)this._blocksForLoading[g].distance<this._blocksForLoading[u].distance&&(u=g);else{const g=this._blocksForLoading[u].level;for(let m=1;m<this._blocksForLoading.length;m++)this._blocksForLoading[m].level===g&&this._blocksForLoading[m].distance<this._blocksForLoading[u].distance&&(u=m)}return this._lru.put(this._blocksForLoading[u].blockIndex),{numBlocksToRead:this._blocksForLoading.length,distance:this._blocksForLoading[u].distance,id:-1,index:u}}else return this._hideOtherLevels(this._level),null}getBlock(u){return this._blocks[u]}_hideOtherLevels(u){if(this._levelChanged){this._levelChanged=!1;const g=this._opaque===!0?this.numLevels:0;for(let m=0;m<this._blocks.length;m++)this._blocks[m].hideLevels(u,g)}}clear(){this._blocksForLoading=[],this._blocksOutsideView=[];for(let u=0;u<this._blocks.length;u++)this._blocks[u].dispose();this._blocks=[],this.numBlocks=0}clearBlockQueue(){this._blocksForLoading=[]}getMemoryUsed(){let u=0;for(let g=0;g<this._blocks.length;g++)u+=this._blocks[g].memory;return u}getNumElements(){let u=0;for(let g=0;g<this._blocks.length;g++)this._blocks[g].level===this._level&&(u+=this._blocks[g].numElements);return u}unload(u,g=1e3){if(u)if(this.outOfCore===!0)this.unloadEverything();else for(let m=0;m<this._blocks.length;m++)this._blocks[m].loaded===!0&&this._blocks[m].visible===!1&&this._blocks[m].unload();else if(this._type!=="pointcloud")for(let m=0;m<this._blocks.length;m++)this._blocks[m].level===this.numLevels||this._blocks[m].level===this._level||this._blocks[m].unload();else{let m=this.getMemoryUsed();for(;m>g;){let y=-1;this._blocksOutsideView.length>0&&(y=this._blocksOutsideView.pop()),y>=0&&(m=m-this._blocks[y].memory,this._blocks[y].unload())}}}unloadEverything(){for(let u=0;u<this._blocks.length;u++)this._blocks[u].unload()}unloadFineLevels(){for(let u=0;u<this._blocks.length;u++)this._blocks[u].level!==this.numLevels&&this._blocks[u].unload()}unloadCoarseLevel(){for(let u=0;u<this._blocks.length;u++)this._blocks[u].level===this.numLevels&&this._blocks[u].unload()}_initTile(u,g){switch(this._type){case"image":return new N(u,g);case"volume":return new b(u,g);case"pointcloud":return new h(u,g)}}}},R,W),R.exports=I},664:(R,W,d)=>{var O,I;O=[d(40),d(4868),d(1600)],I=d.dj.d(O,function(f,N,b){return class extends N{constructor(r,o,c,u,g){super(r,c,u,g),this._mesh.material.visible=!1}refreshData(r,o,c){this._setNumChannels(o.NumChannels),this._useData=o.DataModified,this._includeOverlay=o.OverlayDataModified;const u=this._includeOverlay===!0?"#define USE_OVERLAY":"",g=this._useData===!0?"#define BLEND_OVERLAY":"";this._overlayDefines=[u,g].join(`
`),this._updateOffset(Array.from(o.Offset)),this._updateScale(Array.from(o.Scale)),this._updateGeometry(null,0),this._clearTextures(),this._updateFragmentShader(),o.UseBinaryChannel===!0&&this._blocks.loadBlock(r,0,this._mesh,this._depthMesh,this._globalUniforms,this._getPropertiesForTiles())}_constructProperties(r,o){super._constructProperties(r,o),this._scale=new f.Vector3(1,1,1),this._priorScale=new f.Vector3(1,1,1),this._blocks=new b,this._tform=new f.Matrix4,this._matrix=new f.Matrix4,this._useData=!1}remove(){this._blocks.clear(),super.remove()}_updateFragmentShader(){super._updateFragmentShader(),this._blocks.copyMaterial(this._mesh.material,this._depthMesh.material,this._globalUniforms,this._getPropertiesForTiles())}_clearTextures(){this._texture!==null&&this._texture.dispose(),this._isDataEmpty=!0,this._texture=null,this._mesh.material.uniforms.u_data.value=this._texture,this._overlayTexture!==null&&this._overlayTexture.dispose(),this._isOverlayEmpty=!0,this._overlayTexture=null,this._mesh.material.uniforms.u_overlayData.value=this._overlayTexture,this._alphaTexture!==null&&this._alphaTexture.dispose(),this._alphaTexture=null,this._mesh.material.uniforms.u_alphaData.value=this._alphaTexture}_setProperties(r){this._blocks.setBlockList(r.ResetRequired,r.BlockList),this._blocks.setBoundingSphere(r.Center,r.Radius,r.ScaleFactor),this._blocks.setResolutionLevel(r.ResolutionLevel),this._blocks.setOpaque(r.Opaque),super._setProperties(r),this._blocks.copyUniforms(this._mesh.material.uniforms,this._getPropertiesForTiles())}autoMagFilter(r){this._magFilterStyle==="auto"&&this._magFilter!==r&&(this._magFilter=r,this._blocks.copyUniforms(this._mesh.material.uniforms,this._getPropertiesForTiles()))}_updateOffset(r){this._priorOffset.copy(this._offset),this._offset.fromArray(r)}_updateScale(r){this._priorScale.copy(this._scale),this._scale.fromArray(r)}_updateGeometry(r,o){(this._scale.distanceToSquared(this._priorScale)>1e-4||this._offset.distanceToSquared(this._priorOffset)>1e-4)&&(this._mesh.geometry.translate(-this._priorScale.x/2-this._priorOffset.x,-this._priorScale.y/2-this._priorOffset.y,-this._priorScale.z/2-this._priorOffset.z),this._mesh.geometry.scale(this._scale.x/this._priorScale.x,this._scale.y/this._priorScale.y,this._scale.z/this._priorScale.z),this._mesh.geometry.translate(this._scale.x/2+this._offset.x,this._scale.y/2+this._offset.y,this._scale.z/2+this._offset.z),this.quality(o))}_setClippingUniforms(r){super._setClippingUniforms(r),this._blocks.setClippingPlanes(r)}renderOrder(r){super.renderOrder(r),this._blocks.setRenderOrder(r)}resetBlocks(r,o,c,u,g){const m={numCropBoxes:this._numCropBoxes,numClippingPlanes:this._mesh.material.clippingPlanes.length,clippingPlanes:this._mesh.material.clippingPlanes,cropMin:this._globalUniforms.u_cropMin.value,cropMax:this._globalUniforms.u_cropMax.value,clipIntersection:this._clipIntersectionDefines!=="",cropExclude:this._cropDefines!==""};this._blocks.resetBlocks(r,o,c,u,g,this._tform,m)}clearBlockQueue(){this._blocks.clearBlockQueue()}loadBlock(r,o){this._blocks.loadBlock(r,o.blockIndex,this._mesh,this._depthMesh,this._globalUniforms,this._getPropertiesForTiles())}getNextBlock(r,o){return this._blocks.getNextBlock(r,o)}findNextBlock(){return this._mesh.visible?this._blocks.findNextBlock():null}crop(r,o){super.crop(r,o),this._blocks.copyMaterial(this._mesh.material,this._depthMesh.material,this._globalUniforms,this._getPropertiesForTiles())}updateWindowLevel(r){super.updateWindowLevel(r),this._blocks.copyUniforms(this._mesh.material.uniforms,this._getPropertiesForTiles())}getMemoryUsed(){return this._blocks.getMemoryUsed()}getMemoryRequired(){let r=0;this._useData&&(r+=this._numChannels),this._includeOverlay&&(r+=1),this._useAlphaData&&(r+=1);const o=this._blocks.getNumElements();return r*o/1e6}unload(r,o){this._mesh.visible?this._blocks.unload(r,o):this._blocks.unload(!0,o)}packageData(r,o){this._blocks.packageData(r,o)}_getPropertiesForTiles(){return{NumChannels:this._numChannels,UseData:this._useData,UseOverlay:this._includeOverlay,UseAlpha:this._useAlphaData,Mipmaps:this._mipmaps,MinFilter:this._filter,MagFilter:this._magFilter,OverlayFilter:this._overlayFilter,NumLevels:this._blocks.numLevels}}}},R,W),R.exports=I},6250:(R,W,d)=>{var O,I;O=[d(40),d(1374),d(2642)],I=d.dj.d(O,function(f,N,b){return class extends N{refreshData(r,o){}_constructProperties(r,o){super._constructProperties(r,o),this._blocks=new b("pointcloud",r.Threshold,r.PointBudget,r.MaxLevel),this._tform=new f.Matrix4}_setProperties(r){this._blocks.setBlockList(r.ResetRequired,r.BlockList),this._blocks.setBoundingSphere(r.Center,r.Radius,r.ScaleFactor),super._setProperties(r)}unload(r,o){this._blocks.unload(r,o)}renderOrder(r){super.renderOrder(r),this._blocks.setRenderOrder(r)}resetBlocks(r,o,c,u,g){const m={numCropBoxes:this._numCropBoxes};this._blocks.resetBlocks(r,o,c,u,g,this._tform,m),this._blocks.trimByPointBudget(r,o,c,m)}loadBlock(r,o){this._blocks.loadBlock(r,o.blockIndex,this._mesh,this._depthMesh,this._globalUniforms)}getNextBlock(r,o){return this._blocks.getNextBlock(r,o)}findNextBlock(){if(!this._mesh.visible)return null;let r=this._blocks.findNextBlock();return r!==null&&this._blocks.stopLoadingByPointBudget(r.index)&&(r=null),r}}},R,W),R.exports=I},3215:(R,W,d)=>{var O,I;O=[d(40),d(4544),d(3771),d(1600)],I=d.dj.d(O,function(f,N,b,h){return class extends b{constructor(o,c,u,g,m,y){super(o,u,m,y),this._overview=new N(g,u,m,y),this._deferredScene=c,this._blocks.outOfCore&&this._deferredScene.add(this._mesh)}refreshData(o,c,u){this._setNumChannels(c.NumChannels),this._useData=c.DataModified,this._includeOverlay=c.OverlayDataModified,this._overlayDefines=this._includeOverlay===!0?"#define USE_OVERLAY":"",this._updateOffset(Array.from(c.Offset)),this._updateScale(Array.from(c.Scale)),this._updateGeometry(c,u),this._clearTextures(),this._updateFragmentShader(),this._blocks.outOfCore&&this._overview.refreshData(o,c,u)}refreshProperties(o){this._blocks.outOfCore&&this._overview.refreshProperties(o),this._setProperties(o)}remove(){this._blocks.clear(),this._overview.remove(),super.remove()}clipIntersection(o){this._blocks.outOfCore&&this._overview.clipIntersection(o),super.clipIntersection(o)}lighting(o){this._blocks.outOfCore&&this._overview.lighting(o),super.lighting(o)}cameraStyle(o){this._blocks.outOfCore&&this._overview.cameraStyle(o),super.cameraStyle(o)}updateOnInteraction(o){this._blocks.outOfCore?(this._blocks.enabled=!o,this._overview.updateOnInteraction(o&&this._mesh.visible)):this._blocks.enabled=!0}_setProperties(o){this._blocks.setBlockList(o.ResetRequired,o.BlockList),this._blocks.setBoundingSphere(o.Center,o.Radius,o.ScaleFactor),this._blocks.setResolutionLevel(o.ResolutionLevel),this._outOfCoreRendering(o.OutOfCoreRendering),super._setProperties(o),this._blocks.copyUniforms(this._mesh.material.uniforms,this._getPropertiesForTiles())}_updateOffset(o){this._priorOffset.copy(this._offset),this._offset.fromArray(o)}_updateScale(o){this._priorScale.copy(this._scale),this._scale.fromArray(o)}_updateGeometry(o,c){(this._size.distanceToSquared(this._priorSize)>1e-4||this._offset.distanceToSquared(this._priorOffset)>1e-4||this._scale.distanceToSquared(this._priorScale)>1e-4)&&(this._mesh.geometry.translate(-this._priorScale.x/2-this._priorOffset.x,-this._priorScale.y/2-this._priorOffset.y,-this._priorScale.z/2-this._priorOffset.z),this._mesh.geometry.scale(this._scale.x/this._priorScale.x,this._scale.y/this._priorScale.y,this._scale.z/this._priorScale.z),this._mesh.geometry.translate(this._scale.x/2+this._offset.x,this._scale.y/2+this._offset.y,this._scale.z/2+this._offset.z),this._mesh.material.uniforms.u_size.value.set(this._size.x,this._size.y,this._size.z),this.quality(c))}_setClippingUniforms(o){super._setClippingUniforms(o),this._blocks.copyMaterial(this._mesh.material,this._depthMesh.material,this._globalUniforms,this._getPropertiesForTiles())}renderOrder(o){super.renderOrder(o),this._blocks.setRenderOrder(o)}resetBlocks(o,c,u,g,m){const y={numCropBoxes:this._numCropBoxes,numClippingPlanes:this._mesh.material.clippingPlanes.length,clippingPlanes:this._mesh.material.clippingPlanes,numSlicePlanes:this._renderingStyle===1?this._mesh.material.uniforms.slicePlanes.value.length/4:0,slicePlanes:this._mesh.material.uniforms.slicePlanes.value,tform:this._tform,cropMin:this._globalUniforms.u_cropMin.value,cropMax:this._globalUniforms.u_cropMax.value,clipIntersection:this._clipIntersectionDefines!=="",cropExclude:this._cropDefines!==""};this._blocks.resetBlocks(o,c,u,g,m,this._tform,y)}clearBlockQueue(){this._blocks.clearBlockQueue()}loadBlock(o,c){if(this._blocks.loadBlock(o,c.blockIndex,this._mesh,this._depthMesh,this._globalUniforms,this._getPropertiesForTiles()),this._blocks.outOfCore&&this._overview.stitchingNeeded){const u=this._blocks.getBlock(c.blockIndex);!u.overview&&u.level===this._blocks.numLevels&&(u.overview=!0,this._overview.stitchBuffer(o,this._getPropertiesForOverviewStitching(u)))}}getNextBlock(o,c){return this._blocks.getNextBlock(o,c)}findNextBlock(){return this._mesh.visible?this._blocks.findNextBlock():null}crop(o,c){this._blocks.outOfCore&&this._overview.crop(o,c),super.crop(o,c),this._blocks.copyMaterial(this._mesh.material,this._depthMesh.material,this._globalUniforms,this._getPropertiesForTiles())}colorInBox(o){this._blocks.outOfCore?this._overview.colorInBox(o):super.colorInBox(o)}getMemoryUsed(){return this._blocks.getMemoryUsed()+this._overview.getMemoryUsed()}quality(o){this._blocks.outOfCore&&this._overview!==void 0&&this._overview.quality(o),super.quality(o)}globalClippingPlanes(o,c){this._blocks.outOfCore&&this._overview!==void 0&&this._overview.globalClippingPlanes(o,c),super.globalClippingPlanes(o,c)}localClippingPlanes(o){this._blocks.outOfCore&&this._overview!==void 0&&this._overview.localClippingPlanes(o),super.localClippingPlanes(o)}copyClippingPlaneObjects(o){this._blocks.outOfCore&&this._overview.copyClippingPlaneObjects(o),super.copyClippingPlaneObjects(o)}updateWindowLevel(o){super.updateWindowLevel(o),this._blocks.copyUniforms(this._mesh.material.uniforms,this._getPropertiesForTiles())}getMemoryRequired(){let o=0;this._useData&&(o+=this._numChannels),this._includeOverlay&&(o+=1),this._useAlphaData&&(o+=1);const c=this._blocks.getNumElements();return o*c/1e6}unload(o,c){this._blocks.unload(o,c)}packageData(o,c){this._blocks.packageData(o,c)}_getPropertiesForTiles(){return{NumChannels:this._numChannels,UseData:this._useData,UseOverlay:this._includeOverlay,UseAlpha:this._useAlphaData,MinFilter:this._filter,MagFilter:this._filter,OverlayFilter:this._overlayFilter,NumLevels:this._blocks.numLevels}}_getPropertiesForOverviewStitching(o){return{NumChannels:this._numChannels,DataModified:this._useData,OverlayDataModified:this._includeOverlay,Size:o.size,TotalSize:o.totalSize,LocalOffset:o.localOffset}}_lightScattering(){}_slicePlanes(o,c){this._blocks.outOfCore&&this._overview!==void 0&&this._overview._slicePlanes(o,c),super._slicePlanes(o,this._scaleFactor)}copySlicePlaneObjects(o){super.copySlicePlaneObjects(o),this._blocks.outOfCore&&this._overview.copySlicePlaneObjects(o),this._blocks.copyUniforms(this._mesh.material.uniforms,this._getPropertiesForTiles())}_updateMatrix(o){this._tform.copy(o),this._mesh.matrix=o,this._depthMesh!==null&&(this._depthMesh.matrix=o,this._depthMesh.matrixWorldNeedsUpdate=!0),this._mesh.matrixWorldNeedsUpdate=!0}_constructProperties(o,c){super._constructProperties(o,c),this._scale=new f.Vector3(1,1,1),this._priorScale=new f.Vector3(1,1,1),this._blocks=new h("volume"),this._useData=!1,this._blendOp=f.NormalBlending,this._tform=new f.Matrix4,this._blockedDefines="#define USE_BLOCKED_RENDERING"}_outOfCoreRendering(o){const c=this._blendOp;this._blendOp=o===!0?f.NoBlending:f.NormalBlending,c!==this._blendOp&&(this._mesh.material.blending=this._blendOp,this._needsUpdate=!0,this._blocks.outOfCore=o,o?this._deferredScene!==void 0&&this._deferredScene.add(this._mesh):(this._overview.remove(),this._scene.add(this._mesh)))}_clearTextures(){this._texture!==null&&this._texture.dispose(),this._isDataEmpty=!0,this._texture=null,this._mesh.material.uniforms.u_data.value=this._texture,this._overlayTexture!==null&&this._overlayTexture.dispose(),this._isOverlayEmpty=!0,this._overlayTexture=null,this._mesh.material.uniforms.u_overlayData.value=this._overlayTexture,this._alphaTexture!==null&&this._alphaTexture.dispose(),this._alphaTexture=null,this._mesh.material.uniforms.u_alphaData.value=this._alphaTexture}_updateFragmentShader(){super._updateFragmentShader(),this._blocks.copyMaterial(this._mesh.material,this._depthMesh.material,this._globalUniforms,this._getPropertiesForTiles())}_getFragmentShader(o){let c=super._getFragmentShader(o);return c=[this._blockedDefines,c].join(`
`),c}}},R,W),R.exports=I},1240:(R,W,d)=>{var O,I;O=[d(40),d(2426),d(9501)],I=d.dj.d(O,function(f,N,b){return class extends f.EventDispatcher{constructor(r,o,c,u,g,m){super(),this._globalData=m,this.cameraStyle=r.Camera.Style;const y=o.clientWidth,x=o.clientHeight;this._perspectiveCamera=new f.PerspectiveCamera(r.Camera.ViewAngle,y/x,.1,Number.MAX_SAFE_INTEGER),this._orthographicCamera=new f.OrthographicCamera(-y/2,y/2,x/2,-x/2,0,Number.MAX_SAFE_INTEGER),this._activeCamera=this.cameraStyle==="orthographic"?this._orthographicCamera:this._perspectiveCamera,this._farScaleFactor=this.cameraStyle==="orthographic"?1:2,this._activeCamera.up.set(0,0,1),this._activeCamera.updateProjectionMatrix(),this._perspectiveCamera.layers.enable(1),this._orthographicCamera.layers.enable(1),this._frustum=new f.Frustum,this.boundingBox=new f.Box3(new f.Vector3,new f.Vector3),this._createElements(o,c),this._light=g,this._toolbar=new N(this._container,r.Mode,r.Tooltips),this._annotations=new b(u,this._container,this.boundingBox,r.Mode,r.Annotations),this.STATE={NONE:-1,ROTATE:0,ZOOMIN:1,ZOOMOUT:2,PAN:3,ANIMATE:4,SCISSORS:5,ANNOTATE:6,WINDOWLEVEL:7,SELECT:8,PLANETRANSLATE:9,PLANEROTATE:10,ANNOTATESNAP:11,ANNOTATEROTATE:12,CUBOID:13,CROPTRANSLATE:14,RECTANGLE:15,SCRIBBLE:16,CROSSHAIR:17,DATATIP:18,LABELTRANSLATE:19,PAINT:20},this._projectionScreenMatrix=new f.Matrix4,this._enabled=!1,this._enableRequired=!1,this.screen={left:0,top:0,width:0,height:0},this._priorScreen=null,this._windowResized=!1,this.target=new f.Vector3,this._autoUpdate=[!0,!0,!0,!0,!0],this._renderEvent={type:"render"},this._renderFrontLayerEvent={type:"renderFrontLayer"},this._startEvent={type:"interactionStarted"},this._defaultCameraEvent={type:"defaultCameraRestored"},this._resizeEvent={type:"windowResizing"},this._resizeEndEvent={type:"windowResized"},this._measureEvent={type:"measurePerformance"},this._resetEvent={type:"resetPerformance"},this._iterativeEvent={type:"updateIteration"},this._lazyLoadingEvent={type:"refreshLazyLoading"},this.EPS=1e-6,this._state=this.STATE.NONE,this._interactionStarted=!1,this.updateRequested=!1,this.iterativeUpdateRequested=!1,this.picking=!0,this._serverSidePickRequested=!1,this._lazyLoadingEnabled=!0,this.lazyLoadingRequired=!1,this.lazyLoadingRequested=!1,this._latentEventsEnabled=!1,this._latentEventRequested=!1,this._latentEventData=null,this._lastPosition=new f.Vector3,this._lastTarget=new f.Vector3,this._lastUpVector=new f.Vector3,this._lastZoom=1,this._keyPressed=!1,this._shiftPressed=!1,this._ctrlPressed=!1,this._altPressed=!1,this._aPressed=!1,this._xPressed=!1,this._yPressed=!1,this._zPressed=!1,this._mouseTarget=new f.Vector3,this._eye=new f.Vector3,this._movePrevious=new f.Vector2,this._moveCurrent=new f.Vector2,this._zoomStart=new f.Vector2,this._zoomEnd=new f.Vector2,this._panStart=new f.Vector2,this._panEnd=new f.Vector2,this._annotationStart=new f.Vector2,this._annotationEnd=new f.Vector2,this._windowLevelStart=new f.Vector2,this._windowLevelEnd=new f.Vector2,this._motionInitiated=!1,this._mouseLocation=new f.Vector2,this.boundingSphere=new f.Sphere,this._tightRadius=0,this._tightAspectRatio=1,this._tightFrustum=!1,this._zoomPercent=null,this._lastDepth=0,this._lastNonZeroDepth=0,this._lastNonZeroDepthScreenCoords=new f.Vector2,this._hitTarget=new f.Vector3,this._clickTarget=new f.Vector3,this._screenCoordinates=new f.Vector2,this._fillWithColor=!1,this._scrollTimeout=null,this._resizeTimeout=null,this._interactionTimestamp=Date.now(),this._lazyLoadingTimestamp=Date.now(),this._dataTipTimestamp=Date.now(),this._lazyLoadingEventLatency=200,this._duringInteractionEventLatency=r.HardwareSupport?50:100,this._afterInteractionEventLatency=250,this._resizeEventLatency=500,this._wireUpEventListeners();const w=this._container.getBoundingClientRect(),C=this._container.ownerDocument.documentElement;this.screen.width=Math.round(w.width),this.screen.height=Math.round(w.height),this.screen.left=w.left+window.pageXOffset-C.clientLeft,this.screen.top=w.top+window.pageYOffset-C.clientTop,this.resize(),this.update(),this._resetResizeSensor()}get camera(){return this._activeCamera}update(){this._eye.subVectors(this._activeCamera.position,this.target),this._toolbar.enableRotate&&this._rotateCamera(),this._toolbar.enableZoom&&this._zoomCamera(),this._toolbar.enablePan&&this._panCamera(),this._annotations.enabled&&this._updateAnnotation(),this._toolbar.enableWindowLevel&&this._updateWindowLevel(),this._toolbar.state===this.STATE.ANIMATE&&this._toolbar.setNextFrame(this.target,this._eye,this._activeCamera),this._latentEventsEnabled&&this._sendLatentEvent(),this.lazyLoadingRequired&&this._lazyLoadingEnabled&&this._sendLazyLoadingEvent(),this._serverSidePickRequested&&this._sendDataTipEvent(),this._windowResized||this._didCameraChange()||this.updateRequested?(this._activeCamera.lookAt(this.target),this._light.refresh(this._activeCamera.position,this._activeCamera.up,this.target,this.boundingSphere.radius),this._setCameraFar(),this._clearDepth(),this.updateRequested=!1,this._annotations.updateRequested=!1,this._interactionStarted&&this.dispatchEvent(this._measureEvent),this._windowResized?(this.dispatchEvent(this._resizeEvent),this._windowResized=!1,this._state===this.STATE.SCISSORS&&this._annotations.cleanUpScissors()):(this.dispatchEvent(this._renderEvent),this.copyCameraProperties())):this._annotations.updateRequested?(this._annotations.updateRequested=!1,this.dispatchEvent(this._renderFrontLayerEvent)):this._interactionStarted?this.dispatchEvent(this._resetEvent):this.iterativeUpdateRequested===!0&&this.dispatchEvent(this._iterativeEvent),this._enableRequired&&(this._enableRequired=!1,this._toolbar.enable(),this._annotations.enable(),this._enabled=!0),this._keyPressed=!1}mode(r,o){this._toolbar.update(r),this._annotations.updateInteractions(r,o),this._updatePointer(!1),this._updateColorFill()}updateDataTip(r){this._annotations.updateDataTipQueue(r),this._annotations.isDataTipQueueEmpty()||this._popDataTipQueue()}annotate(r){this._annotations.update(r)}updateAnnotationSettings(r){this._annotations.updateAnnotationSettings(r)}setUnits(r){this._annotations.setUnits(r)}setCrosshair(r){this._annotations.setCrosshair(r)}updateCrop(r,o){this._toolbar.updateCrop(r),this._annotations.updateCrop(r,o,this._globalData.cropType)}setZoomPercent(r){this.cameraStyle==="orthographic"&&(this._activeCamera.zoom=Math.max(Math.min(r*(this._activeCamera.right-this._activeCamera.left)/(100*this.screen.width),this._toolbar.zoomLimits.y),this._toolbar.zoomLimits.x),this._activeCamera.updateProjectionMatrix(),this._updateZoomPercent())}renderText(){this._annotations.renderText(this._activeCamera,this.screen)}editAnnotation(r){this._annotations.editAnnotation(r.Index)}getFrustum(){return this._updateProjectionMatrix(),this._frustum.setFromProjectionMatrix(this._projectionScreenMatrix),this._frustum}getEyeVector(){const r=new f.Vector3;return r.subVectors(this._activeCamera.position,this.target).normalize(),r}resize(){if(this.cameraStyle==="orthographic"&&this._toolbar.preserveZoom&&this._priorScreen!==null){const r=(this._activeCamera.right-this._activeCamera.left)/(this._priorScreen.width/this.screen.width),o=(this._activeCamera.top-this._activeCamera.bottom)/(this._priorScreen.height/this.screen.height);this._activeCamera.right=r/2,this._activeCamera.left=-r/2,this._activeCamera.top=o/2,this._activeCamera.bottom=-o/2,this._activeCamera.updateProjectionMatrix()}else this._updateFrustum(),this._activeCamera.updateProjectionMatrix(),this._updateZoomPercent();this._priorScreen!==null&&(this._priorScreen=null),this._toolbar.resize(this.screen)}packageCameraProperties(){return this._updateProjectionMatrix(),this.cameraStyle==="perspective"?{CameraPosition:[this._activeCamera.position.x,this._activeCamera.position.y,this._activeCamera.position.z],CameraTarget:[this.target.x,this.target.y,this.target.z],CameraUpVector:[this._activeCamera.up.x,this._activeCamera.up.y,this._activeCamera.up.z],CameraZoom:this._activeCamera.zoom,LightPosition:this._light.getPosition(),CameraViewAngle:this._activeCamera.fov,ProjectionMatrix:this._projectionScreenMatrix.elements,ScreenInfo:[this.screen.width,this.screen.height],ObjectInfo:[]}:{CameraPosition:[this._activeCamera.position.x,this._activeCamera.position.y,this._activeCamera.position.z],CameraTarget:[this.target.x,this.target.y,this.target.z],CameraUpVector:[this._activeCamera.up.x,this._activeCamera.up.y,this._activeCamera.up.z],CameraZoom:this._activeCamera.zoom,LightPosition:this._light.getPosition(),ProjectionMatrix:this._projectionScreenMatrix.elements,ScreenInfo:[this.screen.width,this.screen.height],ObjectInfo:[]}}packageCameraPropertiesIfChanged(){return this._didCameraChange()?this.packageCameraProperties():this.packageProjectionMatrix()}packageProjectionMatrix(){return this._updateProjectionMatrix(),this.cameraStyle==="perspective"?{ProjectionMatrix:this._projectionScreenMatrix.elements,ScreenInfo:[this.screen.width,this.screen.height],LightPosition:this._light.getPosition(),ObjectInfo:[]}:{ProjectionMatrix:this._projectionScreenMatrix.elements,ScreenInfo:[this.screen.width,this.screen.height],LightPosition:this._light.getPosition(),ObjectInfo:[]}}setCamera(r,o,c,u,g,m,y){let x=!1;r!==this.cameraStyle&&(this._activeCamera=r==="orthographic"?this._orthographicCamera:this._perspectiveCamera,this.cameraStyle=r,this._farScaleFactor=this.cameraStyle==="orthographic"?1:2,x=!0,this._updateFrustum(),this._activeCamera.updateProjectionMatrix()),this.cameraStyle==="perspective"&&(this._activeCamera.fov=m),this._activeCamera.position.set(o[0],o[1],o[2]),this._activeCamera.up.set(u[0],u[1],u[2]),this.target.set(c[0],c[1],c[2]),this._activeCamera.lookAt(this.target),this._activeCamera.zoom=g,this._autoUpdate=y,this.cameraStyle==="perspective"&&(x===!0&&this._autoUpdate[4]===!0?this._resetCameraFOV():this._activeCamera.fov=m),this._setCameraFar(),x===!0&&this._activeCamera.updateMatrixWorld(!0),this._updateZoomPercent()}setLight(r){this._light.update(r),this._light.reset(this._activeCamera.position,this._activeCamera.up,this.target,this.boundingSphere.radius)}fitCameraToBoundingSphere(){const o=this.boundingSphere.radius,c=this.target,u=new f.Vector3;this.boundingBox.getCenter(u),this.boundingBox.getBoundingSphere(this.boundingSphere);const g=new f.Vector3;this.boundingBox.getSize(g),this._tightRadius=Math.max(g.x,Math.max(g.y,g.z))/2;const m=this._activeCamera.position;(this._autoUpdate[0]||this._autoUpdate[1]||o<=0)&&this._updateFrustum(),this._toolbar.defaultPosition.copy(this._toolbar.defaultCameraVector).normalize().multiplyScalar(2*this.boundingSphere.radius).add(u),this._toolbar.defaultTarget.copy(u),Math.abs(this._toolbar.defaultCameraVector.normalize().dot(this._toolbar.defaultUp))>.999&&this._toolbar.defaultUp.set(0,-1,0);const y=new f.Vector3;this._autoUpdate[0]&&(m.x===0&&m.y===0&&m.z===0||m.x===1&&m.y===1&&m.z===1?(this._autoUpdate[2]&&this._activeCamera.up.copy(this._toolbar.defaultUp),y.copy(this._toolbar.defaultCameraVector).normalize().multiplyScalar(2*this.boundingSphere.radius).add(u)):y.subVectors(m,c).normalize().multiplyScalar(2*this.boundingSphere.radius).add(u),this._activeCamera.position.copy(y),this._light.reset(this._activeCamera.position,this._activeCamera.up,this.target,this.boundingSphere.radius)),this._annotations.updateBoundingBox(u,2*this.boundingSphere.radius),this._autoUpdate[1]&&(this._activeCamera.position.equals(u)?(this._activeCamera.lookAt(this.boundingBox.min),this.target.copy(this.boundingBox.min)):(this._activeCamera.lookAt(u),this.target.copy(u))),this._autoUpdate[3]&&this._setDefaultZoom(),this.cameraStyle==="perspective"&&this._autoUpdate[4]&&this._resetCameraFOV(),this._light.refresh(this._activeCamera.position,this._activeCamera.up,this.target,this.boundingSphere.radius),this._activeCamera.updateMatrixWorld(!0),this._setCameraFar()}updatePlanes(r,o,c,u,g,m,y){this._annotations.updatePlanes(r,o,c,m,y),this._toolbar.contextualUpdate(this._annotations.getClipState(),this._annotations.getSliceState()&&o.length<6,u,g)}setColor(r){this._toolbar.setColor(r),this._annotations.setColor(r)}set enabled(r){r?this._enableRequired=!0:(this._toolbar.disable(),this._annotations.disable(),this._enabled=!1)}get enabled(){return this._enabled}set lazyLoading(r){r?(this._lazyLoadingTimestamp=Date.now(),this._lazyLoadingEnabled=!0,this.lazyLoadingRequested=!0,this._annotations.isDataTipQueueEmpty()||(this._serverSidePickRequested=!0)):(this._lazyLoadingEnabled=!1,this._annotations.refreshDataTipQueue())}get lazyLoading(){return this._lazyLoadingEnabled&&this.lazyLoadingRequired}setScreenPosition(){this._onOverflowOrUnderflow()}copyCameraProperties(){this._lastPosition.copy(this._activeCamera.position),this._lastTarget.copy(this.target),this._lastUpVector.copy(this._activeCamera.up),this._lastZoom=this._activeCamera.zoom}setBoundingBox(r){const o=new f.Vector3(r[0][0],r[0][1],r[0][2]),c=new f.Vector3(r[1][0],r[1][1],r[1][2]);this.boundingBox.set(o,c)}copyAnnotations(r){this._annotations.copy()}setDepthAtLocation(r,o){this._lastDepth=r,r>0&&r<.999999&&(this._lastNonZeroDepth=r,this._lastNonZeroDepthScreenCoords.copy(o),this._depthToWorld(this._lastNonZeroDepth,o,this._hitTarget))}_depthToWorld(r,o,c){const u=new f.Vector4((o.x-.5)*2,(1-o.y-.5)*2,(r-.5)*2,1);u.applyMatrix4(this._activeCamera.projectionMatrixInverse),u.divideScalar(u.w),u.applyMatrix4(this._activeCamera.matrixWorld),c.copy(u)}_setClickLocation(r){this._lastDepth>0&&this._lastDepth<.999999?this._depthToWorld(this._lastDepth,r,this._clickTarget):this._clickTarget.copy(this.target)}_clearDepth(){this._lastDepth=0,this._fillWithColor===!1&&(this._lastNonZeroDepth=0,this._hitTarget.set(0,0,0)),this._annotations.hideMarker()}_onOverflowOrUnderflow(){const r=this._container.getBoundingClientRect(),o=this._container.ownerDocument.documentElement,c=r.left+window.pageXOffset-o.clientLeft,u=r.top+window.pageYOffset-o.clientTop,g=Math.round(r.width),m=Math.round(r.height);(g!==this.screen.width||this.screen.height!==m)&&(this._priorScreen===null&&(this._priorScreen={left:this.screen.left,top:this.screen.top,width:this.screen.width,height:this.screen.height}),this.screen.width=g,this.screen.height=m,this.screen.left=c,this.screen.top=u,this._interactionStarted===!1&&this._broadcastStartEvent(),this._windowResized=!0,window.clearTimeout(this._resizeTimeout),this._resizeTimeout=window.setTimeout(this._broadcastResizeEndEvent.bind(this),this._resizeEventLatency)),this._resetResizeSensor()}_resetResizeSensor(){this._expand.scrollLeft=1e7,this._expand.scrollTop=1e7,this._shrink.scrollLeft=1e7,this._shrink.scrollTop=1e7}_updateFrustum(){const r=this.screen.height,o=this.screen.width/this.screen.height,c=this.boundingSphere.radius===0?r:this.boundingSphere.radius;this.cameraStyle==="orthographic"?o>1?(this._activeCamera.top=c,this._activeCamera.bottom=-c,this._activeCamera.left=-c*o,this._activeCamera.right=c*o):(this._activeCamera.left=-c,this._activeCamera.right=c,this._activeCamera.top=c/o,this._activeCamera.bottom=-c/o):this._activeCamera.aspect=o}_updateProjectionMatrix(){this.boundingSphere.radius>0?this._projectionScreenMatrix.multiplyMatrices(this._activeCamera.projectionMatrix,this._activeCamera.matrixWorldInverse):this._projectionScreenMatrix.identity()}_didCameraChange(){return this._lastZoom!==this._activeCamera.zoom||this._lastPosition.distanceToSquared(this._activeCamera.position)>this.EPS||this._lastTarget.distanceToSquared(this.target)>this.EPS||this._lastUpVector.distanceToSquared(this._activeCamera.up)>this.EPS}_setCameraFar(){const r=this.boundingSphere.distanceToPoint(this._activeCamera.position),o=this.cameraStyle==="orthographic"?0:.1,c=Number.MAX_SAFE_INTEGER;this.boundingSphere.radius>0?this._tightFrustum===!0?(this._activeCamera.near=Math.max(o,r),this._activeCamera.far=Math.max(0,r)+2*this.boundingSphere.radius):(this._activeCamera.near=o,this._activeCamera.far=Math.max(0,2*r)+2*this.boundingSphere.radius):(this._activeCamera.near=o,this._activeCamera.far=c),this._activeCamera.updateProjectionMatrix()}_restoreDefaultCameraView(){this.copyCameraProperties(),this._activeCamera.position.copy(this._toolbar.defaultPosition),this.target.copy(this._toolbar.defaultTarget),this._activeCamera.up.copy(this._toolbar.defaultUp),this._activeCamera.lookAt(this.target),this._setDefaultZoom(),this._light.refresh(this._activeCamera.position,this._activeCamera.up,this.target,this.boundingSphere.radius),this._setCameraFar(),this._activeCamera.updateMatrixWorld(!0),this._broadcastDefaultViewEvent()}_setDefaultZoom(){if(this._toolbar.defaultFit&&this.boundingSphere.radius>0)if(this.cameraStyle==="orthographic"){const r=this._activeCamera.position.clone().sub(this.target).normalize(),o=this._activeCamera.up.clone().normalize(),c=new f.Vector3(1,0,0),u=new f.Vector3(0,1,0),g=new f.Vector3(0,0,1);let m=-1,y=-1;if(Math.abs(r.dot(g))>.9999?m=2:Math.abs(r.dot(c))>.9999?m=0:Math.abs(r.dot(u))>.9999&&(m=1),Math.abs(o.dot(u))>.9999?y=1:Math.abs(o.dot(c))>.9999?y=0:Math.abs(o.dot(g))>.9999&&(y=2),y===-1||m===-1)this._tightAspectRatio=1,this._activeCamera.zoom=this.boundingSphere.radius/this._tightRadius;else{let x,w;const C=new f.Vector3;switch(this.boundingBox.getSize(C),m){case 0:x=y===1?C.z:C.y;break;case 1:x=y===2?C.x:C.z;break;case 2:x=y===0?C.y:C.x;break}switch(y){case 0:w=C.x;break;case 1:w=C.y;break;case 2:w=C.z;break}this._tightAspectRatio=x/w;const P=this.screen.width/this.screen.height;let T;this._tightAspectRatio===P?T=x>w?w/2:x/2:this._tightAspectRatio>=P?P>1?T=x/2/P:T=x/2:P>1?T=w/2:T=w/2*P,this._activeCamera.zoom=this.boundingSphere.radius/T}}else this._tightAspectRatio=1,this._activeCamera.zoom=this.boundingSphere.radius/this._tightRadius;else this._activeCamera.zoom=1;this._updateZoomPercent()}_updateZoomPercent(){if(this.cameraStyle==="orthographic"){const r=this._zoomPercent;this._zoomPercent=this._activeCamera.zoom*(100*this.screen.width)/(this._activeCamera.right-this._activeCamera.left),this._zoomPercent>=1e3&&r<1e3?this.dispatchEvent({type:"autoMagFilterUpdated",filter:f.NearestFilter}):this._zoomPercent<1e3&&r>=1e3&&this.dispatchEvent({type:"autoMagFilterUpdated",filter:f.LinearFilter})}}_snapToAxes(r){this.copyCameraProperties();const o=this._toolbar.defaultTarget.distanceTo(this._toolbar.defaultPosition),c=new f.Vector3;switch(r.message){case 0:c.set(1,0,0),this._activeCamera.up.set(0,0,1);break;case 1:c.set(0,1,0),this._activeCamera.up.set(0,0,1);break;case 2:c.set(0,0,1),this._activeCamera.up.set(0,1,0);break}const u=new f.Vector3;let g=1;this._toolbar.rotateStyle==="pov"?(u.copy(this.target).sub(this._activeCamera.position).normalize(),u.dot(c)>0?g=u.dot(c)>.999?-1:1:g=u.dot(c)<-.999?1:-1,this.target.copy(c.multiplyScalar(g).multiplyScalar(this.target.distanceTo(this._activeCamera.position)).add(this._activeCamera.position))):(u.copy(this._activeCamera.position).sub(this.target).normalize(),g=u.dot(c)>.999?-1:1,this._activeCamera.position.copy(c.multiplyScalar(g).multiplyScalar(o).add(this._toolbar.defaultTarget)),this.target.copy(this._toolbar.defaultTarget)),this._activeCamera.lookAt(this.target),this._setDefaultZoom(),this._light.refresh(this._activeCamera.position,this._activeCamera.up,this.target,this.boundingSphere.radius),this._setCameraFar(),this._activeCamera.updateMatrixWorld(!0),this._broadcastDefaultViewEvent()}_rotateCamera(){const r=new f.Vector3,o=new f.Quaternion;r.set(this._moveCurrent.x-this._movePrevious.x,this._moveCurrent.y-this._movePrevious.y,0);let c=r.length();if(c){const u=new f.Vector3,g=new f.Vector3,m=new f.Vector3,y=new f.Vector3,x=new f.Vector3;switch(this._toolbar.rotateStyle){case"cursor":x.copy(this._clickTarget);break;case"orbit":x.copy(this.boundingSphere.center);break;default:x.copy(this.target)}if(g.subVectors(this._activeCamera.position,x).normalize(),m.copy(this._activeCamera.up).normalize(),y.crossVectors(m,g).normalize(),m.setLength(this._moveCurrent.y-this._movePrevious.y),y.setLength(this._moveCurrent.x-this._movePrevious.x),r.copy(m.add(y)),this._toolbar.rotateStyle==="roll")m.set(this._movePrevious.x,this._movePrevious.y,0),y.set(this._moveCurrent.x,this._moveCurrent.y,0),u.crossVectors(m,y).normalize(),u.dot(g)>0&&(c*=-1),c*=.5,u.copy(g);else{const w=new f.Vector3;w.subVectors(this._activeCamera.position,x),u.crossVectors(r,w).normalize()}if(c*=this._toolbar.rotateSpeed,this._toolbar.rotateStyle==="pov"&&(c=-c/2),o.setFromAxisAngle(u,c),this._toolbar.rotateStyle==="pov"){const w=Math.abs(g.dot(this._activeCamera.up));g.applyQuaternion(o);const C=Math.abs(g.dot(this._activeCamera.up));(C<.95||w>C)&&(this._eye.applyQuaternion(o),this.target.subVectors(this._activeCamera.position,this._eye),this._activeCamera.up.set(0,0,1))}else if(this._toolbar.rotateStyle==="roll")this._activeCamera.up.applyQuaternion(o);else{this._eye.applyQuaternion(o),this._activeCamera.up.applyQuaternion(o);const w=new f.Vector3,C=new f.Vector3;w.subVectors(this._activeCamera.position,x),C.subVectors(this.target,x),w.applyQuaternion(o),C.applyQuaternion(o),this._activeCamera.position.addVectors(x,w),this.target.addVectors(x,C)}this._movePrevious.copy(this._moveCurrent)}}_zoomCamera(){if(this._zoomEnd.distanceToSquared(this._zoomStart)>this.EPS){if(this._toolbar.zoomStyle==="dolly"){const r=(this._zoomEnd.y-this._zoomStart.y)*this._toolbar.dollySpeed,o=this._eye.clone();this._toolbar.dollyStyle==="hover"&&(o.z=0),o.multiplyScalar(r),this.target.add(o),this._activeCamera.position.add(o)}else{const r=1+(this._zoomEnd.y-this._zoomStart.y)*this._toolbar.zoomSpeed;if(r!==1&&r>0){const o=Math.max(Math.min(this._activeCamera.zoom/r,this._toolbar.zoomLimits.y),this._toolbar.zoomLimits.x);this._toolbar.zoomStyle==="cursor"&&this.cameraStyle==="orthographic"&&this._keyPressed===!1&&o!==this._activeCamera.zoom&&(r<1?this._cursorBasedZoom(r):this._toolbar.defaultFit&&(this._cursorBasedZoom(r),o<1?(this.target.copy(this._toolbar.defaultTarget),this._activeCamera.position.copy(this._toolbar.defaultPosition)):o<3&&(this.target.lerp(this._toolbar.defaultTarget,Math.pow((3-o)/2,10)),this._activeCamera.position.lerp(this._toolbar.defaultPosition,Math.pow((3-o)/2,10))))),this._activeCamera.zoom=o,this._updateZoomPercent()}}this._scrollTimeout!==null?this._zoomStart.lerp(this._zoomEnd,.5):this._zoomStart.copy(this._zoomEnd)}}_panCamera(){const r=new f.Vector2;if(r.copy(this._panEnd).sub(this._panStart),r.lengthSq()){const o=this._convertScreenMotionToWorldMotion(r,this._toolbar.panSpeed*(this._toolbar.rotateStyle==="pov"?.5:2));this._activeCamera.position.add(o),this.target.add(o),this._panStart.copy(this._panEnd)}}_updateWindowLevel(){if(this._windowLevelEnd.distanceToSquared(this._windowLevelStart)){const r=new f.Vector2;r.copy(this._windowLevelEnd).sub(this._windowLevelStart).multiplyScalar(this._toolbar.windowLevelSpeed),this._windowLevelStart.copy(this._windowLevelEnd),this._latentEventData=r,this._triggerLatentEvent(),this.updateRequested=!0}}_convertScreenMotionToWorldMotion(r,o){const c=new f.Vector3,u=new f.Vector3;return this.cameraStyle==="orthographic"?(r.x*=(this._activeCamera.right-this._activeCamera.left)/this._activeCamera.zoom,r.y*=(this._activeCamera.top-this._activeCamera.bottom)/this._activeCamera.zoom,c.setFromMatrixColumn(this._activeCamera.matrix,0),c.multiplyScalar(-r.x),u.setFromMatrixColumn(this._activeCamera.matrix,1),u.multiplyScalar(r.y),c.add(u)):(r.multiplyScalar(this._eye.length()*o),c.copy(this._eye).cross(this._activeCamera.up).setLength(r.x),c.add(u.copy(this._activeCamera.up).setLength(r.y))),c}_cursorBasedZoom(r){const o=new f.Vector3,c=this._mouseTarget.clone().sub(this.target),u=c.clone();c.projectOnVector(this._eye),u.sub(c).add(this.target),o.lerpVectors(this.target,u,1-r).sub(this.target),this.target.add(o),this._activeCamera.position.add(o)}_resetCameraFOV(){const r=this.screen.height,o=this.screen.width/this.screen.height,c=this.boundingSphere.radius===0?r:this.boundingSphere.radius,u=this.boundingSphere.distanceToPoint(this._activeCamera.position)+c;u>1.5*c?this._activeCamera.fov=2*Math.asin(c/u)*(180/Math.PI):this._activeCamera.fov=45,this._activeCamera.aspect=o}_updateAnnotation(){const r=new f.Vector3(this._annotationEnd.x-this._annotationStart.x,this._annotationEnd.y-this._annotationStart.y,0);r.lengthSq()&&(this._state===this.STATE.ANNOTATESNAP||this._state===this.STATE.CROSSHAIR||this._state===this.STATE.DATATIP?this._snapToLocation(r):this._state===this.STATE.SCRIBBLE?this._doScribble(r):this._state===this.STATE.LABELTRANSLATE?this._translateLabel(r):this._state===this.STATE.PAINT?this._doPaint(r):this._moveAnnotation(r),this._annotationStart.copy(this._annotationEnd),this._annotations.updateRequested=!0)}_snapToLocation(r){const o=this._eye.clone().normalize(),c=this._convertScreenMotionToWorldMotion(r,1);if(this._ctrlPressed===!0||this._state===this.STATE.CROSSHAIR)this._annotations.applyTransformation(r,this.boundingBox,this._shiftPressed,this._ctrlPressed,this._activeCamera,o,c);else if(this._lastDepth>0&&this._lastDepth<.999999){const u=new f.Vector3;this._depthToWorld(this._lastDepth,this._lastNonZeroDepthScreenCoords,u),this._state===this.STATE.DATATIP?(this._annotations.addDataTipToQueue(),this._serverSidePickRequested=!0):this.picking&&this._sendPickEvent(u),this._annotations.applyTransformation(u,this.boundingBox,this._shiftPressed,this._ctrlPressed,this._activeCamera,o,c)}this._triggerLatentEvent()}_doScribble(r){if(this._lastDepth>0&&this._lastDepth<.999999){const o=new f.Vector3;this._depthToWorld(this._lastDepth,this._lastNonZeroDepthScreenCoords,o),this._annotations.draw(o,r,"freehand",this.boundingBox,this._shiftPressed)}}_doPaint(r){this._annotations.draw(null,this._annotationEnd,"paint",this.boundingBox,!1),this._globalData.uniforms.u_currentPosition.value.x=this._annotationEnd.x,this._globalData.uniforms.u_currentPosition.value.y=1-this._annotationEnd.y}_translateLabel(r){const o=this._convertScreenMotionToWorldMotion(r,1);this._annotations.moveLabel(o,new f.Vector2(this.screen.width,this.screen.height),this._activeCamera)}_moveAnnotation(r){const o=new f.Vector3,c=this._eye.clone().normalize();if(this._state===this.STATE.PLANEROTATE||this._altPressed===!0&&this._state===this.STATE.CUBOID){let u=r.length();const g=new f.Vector3,m=new f.Quaternion,y=new f.Vector3;o.copy(this._activeCamera.up).normalize(),y.crossVectors(o,c).normalize(),o.setLength(r.y),y.setLength(-r.x),r.copy(o.add(y)),g.crossVectors(r,this._eye).normalize(),u*=this._toolbar.rotateSpeed,m.setFromAxisAngle(g,u),this._annotations.applyQuaternion(m,this._shiftPressed),this._state===this.STATE.PLANEROTATE?(this._triggerLatentEvent(),this.updateRequested=!0):(this._fillWithColor===!0&&this._broadcastColorFillEvent(!0),this._triggerLatentEvent())}else{const u=this._convertScreenMotionToWorldMotion(r,1);this._annotations.applyTransformation(r,this.boundingBox,this._shiftPressed,this._ctrlPressed,this._activeCamera,c,u,this._annotationStart,this._annotationEnd),this._triggerLatentEvent(),this._state===this.STATE.CROPTRANSLATE||this._state===this.STATE.PLANETRANSLATE?this.updateRequested=!0:this._fillWithColor===!0&&this._broadcastColorFillEvent(!0)}}_onPointerDown(r){if(this._annotations.contextMenuVisible=!1,this._toolbar.hideMessage(),this._enabled===!1)return;this._motionInitiated=!1,this._mouseLocation.set(r.pageX,r.pageY);const o=this._getMouseOnScreen(r.pageX,r.pageY);if((this._annotations.depthRequired===!0||this._toolbar.isStateDepthable())&&this._broadcastDepthRequestEvent(r,13),this._state===this.STATE.NONE)if(this._toolbar.state===this.STATE.ANIMATE&&this._toolbar.interruptAnimation(),this._toolbar.isStateHittable()&&r.button===0&&this._annotations.hitObject())this._state=this._annotations.getState(this._getMouseOnScreen(r.pageX,r.pageY),this._activeCamera);else if(this._toolbar.state===this.STATE.NONE)switch(r.button){case 0:this._toolbar.enableDefault&&(this._toolbar.enablePan&&r.ctrlKey?this._state=this.STATE.PAN:this._toolbar.enableRotate?this._state=this.STATE.ROTATE:this._toolbar.enablePan?this._state=this.STATE.PAN:this._toolbar.enableZoom?this._state=this.STATE.ZOOMIN:this._state=this.STATE.NONE);break;case 1:this._toolbar.enableDefault&&(this._state=this.STATE.ZOOMIN);break;default:this._state=this.STATE.NONE}else this._state=this._toolbar.state;switch(this._screenCoordinates.copy(o),this._state){case this.STATE.ROTATE:if(!this._toolbar.enableRotate)return;this._moveCurrent.copy(this._getMouseOnCircle(r.pageX,r.pageY)),this._movePrevious.copy(this._moveCurrent),this._toolbar.rotateStyle==="cursor"&&(this._broadcastDepthRequestEvent(r,25),this._setClickLocation(o));break;case this.STATE.ZOOMIN:if(!this._toolbar.enableZoom)return;if(this.cameraStyle==="orthographic"&&this._toolbar.enablePan&&this._toolbar.zoomStyle==="cursor"){const c=new f.Vector3;this._depthToWorld(.001,o,c);const u=o.clone();u.y-=1;const g=new f.Vector3;this._depthToWorld(.001,u,g),g.sub(c).normalize(),this._annotations.updateProjection(this._activeCamera,this.target,g),this._annotations.draw(c,o,"zoom",this.boundingBox,!1);return}else this._toolbar.zoomStyle==="cursor"&&this._depthToWorld(1,o,this._mouseTarget),this._zoomStart.copy(o),this._zoomEnd.copy(this._zoomStart);break;case this.STATE.ZOOMOUT:if(!this._toolbar.enableZoom)return;this._toolbar.zoomStyle==="cursor"&&this._depthToWorld(1,o,this._mouseTarget),this._zoomStart.copy(o),this._zoomEnd.copy(this._zoomStart);break;case this.STATE.PAN:if(!this._toolbar.enablePan)return;this._panStart.copy(o),this._panEnd.copy(this._panStart);break;case this.STATE.CUBOID:this._onAnnotationClick(o),this._updateColorFill(),this._fillWithColor===!0&&(this._interactionStarted=!0);return;case this.STATE.CROSSHAIR:this._onAnnotationClick(o),this._snapCrosshairToMouse(o);return;case this.STATE.ANNOTATESNAP:case this.STATE.ANNOTATEROTATE:case this.STATE.DATATIP:case this.STATE.LABELTRANSLATE:this._onAnnotationClick(o);return;case this.STATE.PLANETRANSLATE:case this.STATE.PLANEROTATE:case this.STATE.CROPTRANSLATE:this._onAnnotationClick(o);break;case this.STATE.SCISSORS:r.button===2&&(this._annotations.stopDrawing(),this._state=this.STATE.NONE,this._toolbar.clearState());return;case this.STATE.ANNOTATE:if(this._annotations.isNclickAnnotation(this._toolbar.annotateStyle)&&r.button===2){this._cleanUpAnnotations();return}if((r.button===0||this._toolbar.annotateStyle==="angle"&&r.button===2)&&this._lastNonZeroDepth>0){switch(this.picking&&this._sendPickEvent(this._hitTarget),this._annotations.draw(this._hitTarget,o,this._toolbar.annotateStyle,this.boundingBox,!1),this._toolbar.annotateStyle){case"rectangle":this._state=this.STATE.RECTANGLE;break;case"freehand":this._state=this.STATE.SCRIBBLE;break;case"data-tip":this._state=this.STATE.DATATIP,this._annotations.addDataTipToQueue(),this._serverSidePickRequested=!0;break;case"paint":this._state=this.STATE.PAINT,this._annotationStart.copy(o),this._annotationEnd.copy(this._annotationStart),this._globalData.uniforms.u_currentPosition.value.x=this._annotationEnd.x,this._globalData.uniforms.u_currentPosition.value.y=1-this._annotationEnd.y,this.dispatchEvent({type:"paintBrushStarted",activated:!0});return;default:this._state=this.STATE.ANNOTATESNAP}this._onAnnotationClick(o)}return;case this.STATE.WINDOWLEVEL:this._windowLevelStart.copy(o),this._windowLevelEnd.copy(this._windowLevelStart),this._startLatentEvents();return;default:return}this._interactionStarted=!0}_onPointerMove(r){if(this._enabled===!1)return;r.preventDefault();const o=this._getMouseOnScreen(r.pageX,r.pageY);(this._annotations.depthRequired===!0||this._toolbar.isStateDepthable())&&this._broadcastDepthRequestEvent(r,13),this._toolbar.show(),this._toolbar.isStateAnnotatable()?this._toolbar.annotateStyle==="paint"?(this._globalData.uniforms.u_currentPosition.value.set(o.x,1-o.y),this._annotations.showPaintBrush()):this._lastNonZeroDepth>0&&(this._toolbar.annotateStyle==="cuboid"?(this._annotations.showCuboid(this._hitTarget,this.boundingSphere.radius),this._fillWithColor===!0&&this._broadcastColorFillEvent(!1)):this._toolbar.annotateStyle!=="rectangle"&&this._toolbar.annotateStyle!=="data-tip"&&this._annotations.showMarker(this._hitTarget)):this._annotations.hideDrawingTools();const c=new f.Vector3;switch(this._state){case this.STATE.NONE:this._annotations.onPointerMove(o,this._activeCamera,this._toolbar.isStateHittable(),this._toolbar.state===this.STATE.ANNOTATE,this.boundingSphere.radius,this.screen),this._updatePointer(this._annotations.hitObject()),this._toolbar.objectInfo&&(this._serverSidePickRequested=!0);return;case this.STATE.SCISSORS:this._depthToWorld(.001,o,c),this._annotations.followDrawing(c,o,this.boundingBox,this._shiftPressed);return;case this.STATE.ANNOTATE:this._annotations.isMulticlickAnnotation(this._toolbar.annotateStyle)&&this._lastNonZeroDepth>0&&this._annotations.followDrawing(this._hitTarget,o,this.boundingBox,this._shiftPressed);return;case this.STATE.ZOOMIN:if(!this._toolbar.enableZoom)return;if(this.cameraStyle==="orthographic"&&this._toolbar.enablePan&&this._toolbar.zoomStyle==="cursor"){this._depthToWorld(.001,o,c),this._annotations.followDrawing(c,o,this.boundingBox,!1);const u=this._annotations.getZoomBox();(u.width>.02&&u.height>.02||!(this._globalData.uniforms.u_screenRectangle.value.x===0&&this._globalData.uniforms.u_screenRectangle.value.y===0&&this._globalData.uniforms.u_screenRectangle.value.z===1&&this._globalData.uniforms.u_screenRectangle.value.w===1))&&(this._globalData.uniforms.u_screenRectangle.value.x=u.x-u.z/2,this._globalData.uniforms.u_screenRectangle.value.y=1-(u.y+u.w/2),this._globalData.uniforms.u_screenRectangle.value.z=u.x+u.z/2,this._globalData.uniforms.u_screenRectangle.value.w=1-(u.y-u.w/2));return}break;case this.STATE.RECTANGLE:this._lastNonZeroDepth>0&&this._annotations.followDrawing(this._hitTarget,o,this.boundingBox,!1);return;case this.STATE.SELECT:return}switch(!this._motionInitiated&&(r.pageX!==this._mouseLocation.x||r.pageY!==this._mouseLocation.y)&&(this._motionInitiated=!0,this._state===this.STATE.ANNOTATESNAP||this._state===this.STATE.SCRIBBLE||this._state===this.STATE.CROSSHAIR||this._state===this.STATE.DATATIP||this._state===this.STATE.LABELTRANSLATE||this._state===this.STATE.PAINT||this._state===this.STATE.CUBOID&&this._fillWithColor===!1||this._broadcastStartEvent()),this._state){case this.STATE.ROTATE:if(!this._toolbar.enableRotate)return;this._moveCurrent.copy(this._getMouseOnCircle(r.pageX,r.pageY));break;case this.STATE.ZOOMIN:case this.STATE.ZOOMOUT:if(!this._toolbar.enableZoom)return;this._zoomEnd.copy(o);break;case this.STATE.PAN:if(!this._toolbar.enablePan)return;this._panEnd.copy(o);break;case this.STATE.PLANETRANSLATE:case this.STATE.PLANEROTATE:case this.STATE.ANNOTATESNAP:case this.STATE.CROSSHAIR:case this.STATE.SCRIBBLE:case this.STATE.CROPTRANSLATE:case this.STATE.CUBOID:case this.STATE.DATATIP:case this.STATE.LABELTRANSLATE:case this.STATE.PAINT:this._annotationEnd.copy(o);return;case this.STATE.WINDOWLEVEL:this._windowLevelEnd.copy(o);return;default:return}this._triggerLatentEvent()}_onPointerLeave(r){this._enabled!==!1&&(r.preventDefault(),this._toolbar.hide(),this._annotations.onPointerLeave(),this._fillWithColor===!0&&(this._fillWithColor=!1,this.dispatchEvent({type:"colorBoxUpdated",message:this._fillWithColor}),this.updateRequested=!0))}_onPointerDouble(r){if(this._enabled!==!1)switch(r.preventDefault(),this._toolbar.state){case this.STATE.SCISSORS:this._annotations.stopDrawing(),this._state=this.STATE.NONE,this._toolbar.updateState(this.STATE.NONE);break;case this.STATE.ANNOTATE:this._annotations.drawing&&this._annotations.isNclickAnnotation(this._toolbar.annotateStyle)&&(this._annotations.undoDrawing(),this._cleanUpAnnotations());break;case this.STATE.WINDOWLEVEL:this.dispatchEvent({type:"interactionEnded",name:"DisplayRangeDouble"});break;case this.STATE.SELECT:this._state=this.STATE.NONE,this._selectObject("ObjectSelected",this._getClickType(r));break}}_onKeyRelease(r){switch(this._onKeyPressAndRelease(r),r.key){case"Escape":this._state===this.STATE.SCISSORS?this._annotations.cleanUpScissors():this._annotations.isMulticlickAnnotation(this._toolbar.annotateStyle)&&(this._state=this.STATE.NONE,this._annotations.continueAnnotating||this._toolbar.clearState(),this._clearDepth(),this._annotations.abortDrawing());break;case"Backspace":(this._state===this.STATE.SCISSORS||this._annotations.isNclickAnnotation(this._toolbar.annotateStyle))&&this._annotations.undoDrawing();break}}_onKeyPress(r){switch(this._onKeyPressAndRelease(r),r.key){case"+":case"=":this._onKeyZoom(.025);break;case"-":case"_":this._onKeyZoom(-.025);break}this._keyPressed=!0}_onKeyPressAndRelease(r){if(r.shiftKey!==this._shiftPressed)switch(this._shiftPressed=r.shiftKey,this._state){case this.STATE.PLANEROTATE:case this.STATE.CUBOID:{const o=new f.Quaternion;o.identity(),this._annotations.applyQuaternion(o,this._shiftPressed),this._triggerLatentEvent(),this._state===this.STATE.PLANEROTATE?this.updateRequested=!0:this._fillWithColor===!0&&this._broadcastColorFillEvent(!0);break}case this.STATE.ANNOTATE:if(this._annotations.isMulticlickAnnotation(this._toolbar.annotateStyle)&&this._lastNonZeroDepth>0){const o=this._getMouseOnScreen(r.pageX,r.pageY);this._annotations.followDrawing(this._hitTarget,o,this.boundingBox,this._shiftPressed)}break}switch(r.ctrlKey!==this._ctrlPressed&&(this._ctrlPressed=r.ctrlKey),r.altKey!==this._altPressed&&(this._altPressed=r.altKey),r.key){case"a":case"A":this._aPressed=r.type==="keydown";break;case"x":case"X":this._xPressed=r.type==="keydown";break;case"y":case"Y":this._yPressed=r.type==="keydown";break;case"z":case"Z":this._zPressed=r.type==="keydown";break}}_onPointerEnter(r){r.preventDefault(),this._updateColorFill(),this._annotations.onPointerEnter()}_onPointerUp(r){const o=this._state;if(this._state=this.STATE.NONE,this._enabled===!1)return;r.preventDefault();const c=this._getMouseOnScreen(r.pageX,r.pageY);let u=!1,g=!1;switch(o){case this.STATE.SCISSORS:if(this._state=this.STATE.SCISSORS,r.button===0){const m=new f.Vector3;this._depthToWorld(.001,c,m),this._annotations.draw(m,c,this._toolbar.annotateStyle==="scissors"?"scissors":"",this.boundingBox,this._shiftPressed)}return;case this.STATE.CUBOID:case this.STATE.ANNOTATEROTATE:case this.STATE.SCRIBBLE:case this.STATE.CROSSHAIR:case this.STATE.ANNOTATESNAP:case this.STATE.RECTANGLE:case this.STATE.DATATIP:if(o===this.STATE.CUBOID&&(this._fillWithColor===!0&&(g=!0),this._updateColorFill()),this._annotationStart.copy(c),this._annotationEnd.copy(c),u=!0,this._annotations.drawing)if(this._annotations.clickCounter>=this._toolbar.maxAllowedClicks){this._cleanUpAnnotations();return}else{this._state=this._toolbar.state,this._annotations.onPointerUp(!0);return}if(g)break;this._broadcastEndEvent(!0,!1),r.button!==2&&this._annotations.onPointerUp(!1),this._motionInitiated=!1;return;case this.STATE.PLANETRANSLATE:case this.STATE.PLANEROTATE:case this.STATE.CROPTRANSLATE:this._annotationStart.copy(c),this._annotationEnd.copy(c),u=!0;break;case this.STATE.ZOOMIN:this._globalData.uniforms.u_screenRectangle.value.set(0,0,1,1),this._annotations.stopDrawing();break;case this.STATE.WINDOWLEVEL:this._interactionStarted=!1,this._motionInitiated=!1,this.dispatchEvent({type:"interactionEnded",name:"DisplayRangeChanged"});return;case this.STATE.LABELTRANSLATE:this._interactionStarted=!1,this._motionInitiated=!1,r.button!==2&&this._annotations.onPointerUp(!1);return;case this.STATE.SELECT:this._selectObject("ObjectSelected",this._getClickType(r));return;case this.STATE.PAINT:this.dispatchEvent({type:"paintBrushFinished",name:"PaintBrushFinished",message:this._annotations.cleanUpPaintBrush()});return}if(this._interactionStarted&&(this._motionInitiated||u))this._broadcastEndEvent(u,this._motionInitiated),this._motionInitiated=!1;else if(this._interactionStarted=!1,r.type==="pointerup"&&r.button!==2)if(o===this.STATE.ZOOMIN){const m=this._annotations.getZoomBox();if(this.cameraStyle==="orthographic"&&this._toolbar.enablePan&&this._toolbar.zoomStyle==="cursor"&&m.width>.02&&m.height>.02){const y=Math.max(m.width,m.height),x=new f.Vector2(m.x,m.y);this._activeCamera.zoom/=y,x.subScalar(.5).divideScalar(y).addScalar(.5),this._panStart.copy(x),this._panEnd.set(.5,.5)}else this._toolbar.zoomStyle==="cursor"&&this._depthToWorld(1,this._getMouseOnScreen(r.pageX,r.pageY),this._mouseTarget),this._zoomStart.set(0,0),this._zoomEnd.set(0,-.1);this._broadcastEndEvent(u,!0)}else o===this.STATE.ZOOMOUT?(this._toolbar.zoomStyle==="cursor"&&this._depthToWorld(1,this._getMouseOnScreen(r.pageX,r.pageY),this._mouseTarget),this._zoomStart.set(0,0),this._zoomEnd.set(0,.1),this._broadcastEndEvent(u,!0)):this.dispatchEvent({type:"clickReleased",message:{}});r.button!==2&&this._annotations.onPointerUp(!0)}_onWheel(r){if(this._enabled!==!1){if(this._annotations.contextMenuVisible=!1,r.preventDefault(),this._toolbar.state===this.STATE.ANNOTATE&&this._toolbar.annotateStyle==="cuboid"&&(this._aPressed||this._xPressed||this._yPressed||this._zPressed)){this._annotations.scrollCuboid(this.boundingSphere.radius,r.deltaY,this._xPressed||this._aPressed,this._yPressed||this._aPressed,this._zPressed||this._aPressed),this._fillWithColor===!0?(this._interactionStarted===!1&&this._broadcastStartEvent(),window.clearTimeout(this._scrollTimeout),this._scrollTimeout=window.setTimeout(this._broadcastEndEvent.bind(this),this._afterInteractionEventLatency),this._broadcastColorFillEvent(!1)):this._annotations.updateRequested=!0;return}(this._toolbar.state===this.STATE.ZOOMIN||this._toolbar.state===this.STATE.ZOOMOUT||this._toolbar.enableDefault&&this._toolbar.enableZoom&&this._toolbar.isStateZoomable())&&(this._interactionStarted===!1?this._broadcastStartEvent():this._triggerLatentEvent(),this._zoomStart.y-=r.deltaY*25e-5*(r.ctrlKey===!0?10:1),this._toolbar.zoomStyle==="cursor"&&this._depthToWorld(1,this._getMouseOnScreen(r.pageX,r.pageY),this._mouseTarget),this._toolbar.objectInfo&&(this._serverSidePickRequested=!0),window.clearTimeout(this._scrollTimeout),this._scrollTimeout=window.setTimeout(this._broadcastEndEvent.bind(this),this._afterInteractionEventLatency))}}_onContextMenu(r){r.preventDefault(),this._onPointerMove(r);const o=-1;if(this._annotations.isMouseOnObject()){const c=this._annotations.showContextMenu(r);if(c===null)return;this.dispatchEvent(c)}else this.dispatchEvent({type:"contextMenuClicked",message:{Position:[r.pageX,r.pageY],ID:o}})}_getMouseOnScreen(r,o){const c=new f.Vector2;return c.set((r-this.screen.left)/this.screen.width,(o-this.screen.top)/this.screen.height),c}_getMouseOnCircle(r,o){const c=new f.Vector2;return c.set((r-this.screen.width*.5-this.screen.left)/(this.screen.width*.5),(this.screen.height+2*(this.screen.top-o))/this.screen.width),c}_sendLazyLoadingEvent(){this.lazyLoadingRequested&&Date.now()>this._lazyLoadingTimestamp+this._lazyLoadingEventLatency&&(this._lazyLoadingTimestamp=Date.now(),this.lazyLoadingRequested=!1,this.dispatchEvent(this._lazyLoadingEvent))}_startLatentEvents(){this._interactionTimestamp=Date.now(),this._latentEventRequested=!1,this._latentEventsEnabled=!0}_sendLatentEvent(){if(this._latentEventRequested){let r=!1;switch(Date.now()>this._interactionTimestamp+this._duringInteractionEventLatency&&(this._interactionTimestamp=Date.now(),this._latentEventRequested=!1,r=!0),this._state){case this.STATE.NONE:case this.STATE.ROTATE:case this.STATE.ZOOMIN:case this.STATE.ZOOMOUT:case this.STATE.PAN:this.dispatchEvent({type:"interactionUpdating",name:"CameraMoving",notifyUser:r});break;case this.STATE.PLANEROTATE:case this.STATE.PLANETRANSLATE:this.dispatchEvent(this._annotations.getPlaneChangeEventData(r));break;case this.STATE.CROPTRANSLATE:this.dispatchEvent(this._annotations.getCropChangeEventData(r));break;case this.STATE.WINDOWLEVEL:this.dispatchEvent({type:"interactionUpdating",name:"DisplayRangeChanging",notifyUser:r,data:this._latentEventData});break;case this.STATE.ANNOTATESNAP:case this.STATE.CROSSHAIR:case this.STATE.CUBOID:case this.STATE.SCRIBBLE:case this.STATE.DATATIP:this.dispatchEvent(this._annotations.getAnnotationMovingEventData(r));break}}}_triggerLatentEvent(){this._latentEventRequested=!0}_broadcastStartEvent(){this._interactionStarted=!0,this._startLatentEvents(),this.dispatchEvent(this._startEvent)}_broadcastEndEvent(r,o){this._latentEventsEnabled=!1,this._interactionStarted=!1,this._scrollTimeout=null,r?this.dispatchEvent(this._annotations.getInteractionEndedEventData(o)):this.dispatchEvent({type:"interactionEnded",name:"CameraMoved"})}_broadcastColorFillEvent(r){this.dispatchEvent(this._annotations.getColorFillEventData(r,!1)),this.updateRequested=!0}_broadcastResizeEndEvent(){this._interactionStarted=!1,this.dispatchEvent(this._resizeEndEvent)}_broadcastDepthRequestEvent(r,o){this.dispatchEvent({type:"depthRequested",message:this._getMouseOnScreen(r.pageX,r.pageY),windowSize:o})}_broadcastDefaultViewEvent(){this._state===this.STATE.SCISSORS&&this._annotations.cleanUpScissors(),this.dispatchEvent(this._defaultCameraEvent)}_sendDataTipEvent(){Date.now()>this._dataTipTimestamp+this._lazyLoadingEventLatency&&(this._dataTipTimestamp=Date.now(),this._annotations.isDataTipQueueEmpty()?(this._interactionStarted||(this._serverSidePickRequested=!1),this._selectObject("ObjectInfoUpdated","none")):this._popDataTipQueue())}_popDataTipQueue(){const r=this._annotations.popDataTipQueue();if(r!==null){const o=new f.Vector3;o.fromArray(r.getPosition()),this._sendPickEvent(o,!0,r.ID,"DataTipRequested","none"),this._serverSidePickRequested=!1}}_sendPickEvent(r,o=!1,c=-1,u="none",g="none"){this.dispatchEvent({type:"pointPickRequested",message:{point:r,sendToServer:o,clickType:g,eventName:u,id:c}})}_selectObject(r,o,c=new f.Vector3){this._lastDepth>0&&this._lastDepth<.999999?(this._depthToWorld(this._lastNonZeroDepth,this._lastNonZeroDepthScreenCoords,c),this._sendPickEvent(c,!0,-1,r,o)):this._interactionStarted||this._sendPickEvent(null,!0,-1,r,o)}_modeChanged(r){this._state===this.STATE.SCISSORS&&(this._state=this.STATE.NONE,this._annotations.cleanUpScissors()),this._updateColorFill(),this._annotations.hideDrawingTools(),this._annotations.clearCounter(),this._updatePointer(!1),this.dispatchEvent(r)}_getClickType(r){if(r.type==="dblclick")return"double";switch(r.button){case 0:return r.shiftKey?"shift":r.ctrlKey?"ctrl":r.altKey?"alt":"left";case 1:return"middle";case 2:return"right"}}_updatePointer(r){switch(this._toolbar.state){case this.STATE.PAN:this._canvas.style.cursor="grab";break;case this.STATE.ZOOMIN:this._canvas.style.cursor="zoom-in";break;case this.STATE.ZOOMOUT:this._canvas.style.cursor="zoom-out";break;case this.STATE.ROTATE:this._canvas.style.removeProperty("cursor"),this._canvas.className="iptRotateCursor";break;case this.STATE.SCISSORS:this._canvas.style.cursor="crosshair";break;case this.STATE.WINDOWLEVEL:this._canvas.style.cursor="move";break;case this.STATE.ANNOTATE:r===!0?this._canvas.style.cursor="default":this._canvas.style.cursor="crosshair";break;default:this._canvas.style.cursor="default";break}}_updateColorFill(){const r=this._annotations.fillWithColor===!0&&(this._state===this.STATE.CUBOID||this._toolbar.state===this.STATE.ANNOTATE&&this._toolbar.annotateStyle==="cuboid");r!==this._fillWithColor&&(this._fillWithColor=r,this.dispatchEvent({type:"colorBoxUpdated",message:this._fillWithColor}),this._fillWithColor===!1&&(this.updateRequested=!0))}_cleanUpAnnotations(){this._state=this.STATE.NONE,this._annotations.continueAnnotating||this._toolbar.clearState(),this._broadcastEndEvent(!0,!1),this._clearDepth(),this._annotations.stopDrawing()}_onAnnotationClick(r){this._annotations.onPointerDown(this._shiftPressed,this._ctrlPressed),this._annotationStart.copy(r),this._annotationEnd.copy(this._annotationStart),this._startLatentEvents()}_snapCrosshairToMouse(r){const o=this._annotations.getCrosshairPosition();o.project(this._activeCamera),o.x=(o.x+1)/2,o.y=1-(o.y+1)/2;const c=new f.Vector2;c.x=r.x-o.x,c.y=r.y-o.y;const u=this._convertScreenMotionToWorldMotion(c,1);this._annotations.applyTransformation(c,this.boundingBox,this._shiftPressed,this._ctrlPressed,this._activeCamera,this._eye.clone().normalize(),u),this._triggerLatentEvent(),this._annotations.updateRequested=!0}_broadcastEvent(r){this.dispatchEvent(r)}_onKeyZoom(r){this._ctrlPressed&&(this._toolbar.state===this.STATE.ZOOMIN||this._toolbar.state===this.STATE.ZOOMOUT||this._toolbar.enableDefault&&this._toolbar.enableZoom&&this._toolbar.isStateZoomable())&&(this._zoomStart.y+=r)}_createElements(r,o){this._container=r,this._canvas=o,this._canvas.setAttribute("tabindex",0),this._xLabel=document.createElement("div"),this._xLabel.className="iptOrientationAxesLabel iptOrientationAxesX",this._container.appendChild(this._xLabel),this._yLabel=document.createElement("div"),this._yLabel.className="iptOrientationAxesLabel iptOrientationAxesY",this._container.appendChild(this._yLabel),this._zLabel=document.createElement("div"),this._zLabel.className="iptOrientationAxesLabel iptOrientationAxesZ",this._container.appendChild(this._zLabel),this._expand=document.createElement("div"),this._expand.className="iptExpandOverflow",this._container.appendChild(this._expand),this._expand.appendChild(document.createElement("div")),this._shrink=document.createElement("div"),this._shrink.className="iptShrinkOverflow",this._container.appendChild(this._shrink),this._shrink.appendChild(document.createElement("div"))}_wireUpEventListeners(){this._pointerDownHandler=this._onPointerDown.bind(this),this._pointerMoveHandler=this._onPointerMove.bind(this),this._pointerUpHandler=this._onPointerUp.bind(this),this._scrollHandler=this._onWheel.bind(this),this._doubleClickHandler=this._onPointerDouble.bind(this),this._contextMenuHandler=this._onContextMenu.bind(this),this._pointerEnterHandler=this._onPointerEnter.bind(this),this._pointerLeaveHandler=this._onPointerLeave.bind(this),this._keyPressHandler=this._onKeyPress.bind(this),this._keyReleaseHandler=this._onKeyRelease.bind(this),this._overflowHandler=this._onOverflowOrUnderflow.bind(this),this._canvas.addEventListener("pointerdown",this._pointerDownHandler),this._canvas.addEventListener("dblclick",this._doubleClickHandler),this._canvas.addEventListener("contextmenu",this._contextMenuHandler),this._container.addEventListener("pointerleave",this._pointerLeaveHandler),this._container.addEventListener("pointerenter",this._pointerEnterHandler),this._container.addEventListener("wheel",this._scrollHandler,{passive:!1}),this._container.ownerDocument.addEventListener("keydown",this._keyPressHandler),this._container.ownerDocument.addEventListener("keyup",this._keyReleaseHandler),this._container.ownerDocument.addEventListener("pointermove",this._pointerMoveHandler),this._container.ownerDocument.addEventListener("pointerup",this._pointerUpHandler),this._expand.addEventListener("scroll",this._overflowHandler),this._shrink.addEventListener("scroll",this._overflowHandler),this._toolbar.addEventListener("homeClicked",this._restoreDefaultCameraView.bind(this)),this._toolbar.addEventListener("axesClicked",this._snapToAxes.bind(this)),this._toolbar.addEventListener("widgetAdded",this._broadcastEvent.bind(this)),this._toolbar.addEventListener("modeChanged",this._modeChanged.bind(this)),this._toolbar.addEventListener("animationFinished",this._broadcastEvent.bind(this)),this._toolbar.addEventListener("messageClosed",this._broadcastEvent.bind(this)),this._annotations.addEventListener("scissorsFinished",this._broadcastEvent.bind(this)),this._annotations.addEventListener("annotationsCopied",this._broadcastEvent.bind(this)),this._annotations.addEventListener("annotationEdited",this._broadcastEvent.bind(this)),this._annotations.addEventListener("paintBrushEnabled",this._broadcastEvent.bind(this)),this._annotations.addEventListener("pointerdown",this._pointerDownHandler),this._light.addEventListener("lightsUpdated",this._broadcastEvent.bind(this))}dispose(){this.iterativeUpdateRequested=!1,this._toolbar.dispose(),this._light.dispose(),this._annotations.dispose(),this._canvas.removeEventListener("pointerdown",this._pointerDownHandler),this._canvas.removeEventListener("dblclick",this._doubleClickHandler),this._canvas.removeEventListener("contextmenu",this._contextMenuHandler),this._container.removeEventListener("pointerleave",this._pointerLeaveHandler),this._container.removeEventListener("pointerenter",this._pointerEnterHandler),this._container.removeEventListener("wheel",this._scrollHandler,{passive:!1}),this._canvas.ownerDocument.removeEventListener("keydown",this._keyPressHandler),this._container.ownerDocument.removeEventListener("keyup",this._keyReleaseHandler),this._container.ownerDocument.removeEventListener("pointermove",this._pointerMoveHandler),this._container.ownerDocument.removeEventListener("pointerup",this._pointerUpHandler),this._expand.removeEventListener("scroll",this._overflowHandler),this._shrink.removeEventListener("scroll",this._overflowHandler)}}},R,W),R.exports=I},1082:(R,W,d)=>{var O,I;O=[d(40)],I=d.dj.d(O,function(f){return class{constructor(b,h,r,o){this._needsUpdate=!1,this._mesh=null,this._texture=null,this._overlayTexture=null,this._alphaTexture=null,this._scene=b,this._depthScene=h,this._depthMesh=null,this._layer=0,this._globalUniforms=o.uniforms,this._localClipping=!1,this._isDataEmpty=!0,this._isOverlayEmpty=!0,this._clippingPlanes=Object.freeze([]),this._numCropBoxes=o.cropBox.length>0?1:0,this._cropExclude=o.cropBoxExclude,this._colorInBox=!1,this._clipIntersection=!1,this._pickable=!0,this._globalData=o,this._constructProperties(r,o),this.add(r,o)}refreshProperties(b){this._setProperties(b)}remove(){this._scene.remove(this._mesh),this._mesh.material.dispose(),this._mesh.geometry.dispose(),this._depthMesh!==null&&(this._depthScene.remove(this._depthMesh),this._depthMesh.material.dispose()),this._texture!==null&&this._texture.dispose(),this._overlayTexture!==null&&this._overlayTexture.dispose(),this._alphaTexture!==null&&this._alphaTexture.dispose()}getMemoryUsed(){return 0}getMemoryRequired(){return this.getMemoryUsed()}unload(b,h){}resetBlocks(){}clearBlockQueue(){}findNextBlock(){return null}quality(b){}globalClippingPlanes(b,h){}clipIntersection(b){}lighting(b){}cameraStyle(b){}updateOnInteraction(b){}crop(b,h){}colorInBox(b){}add(b,h){}packageData(b,h){}updateWindowLevel(b){}getWindowLevel(){return null}pick(b,h,r,o,c,u){if(this._pickable&&this._mesh!==null&&this._mesh.visible&&!this._clipped(r)){const g=[];this._mesh.raycast(b,g),g.length>0&&(g.sort((m,y)=>m.distance-y.distance),h.push({point:g[0].point.toArray(),distance:r.distanceTo(g[0].point),object:u,picked:!0,id:g[0].faceIndex}))}}_clipped(b){let h=!1;if(this._numCropBoxes>0)switch(this._globalData.cropType){case"box":{const r=b.clone().clamp(this._globalUniforms.u_cropMin.value,this._globalUniforms.u_cropMax.value);this._cropDefines===""?r.distanceToSquared(b)>0&&(h=!0):r.distanceToSquared(b)===0&&(h=!0);break}case"sphere":{this._cropDefines===""?this._globalUniforms.u_cropCenter.value.distanceToSquared(b)>this._globalUniforms.u_cropRadius.value*this._globalUniforms.u_cropRadius.value&&(h=!0):this._globalUniforms.u_cropCenter.value.distanceToSquared(b)<=this._globalUniforms.u_cropRadius.value*this._globalUniforms.u_cropRadius.value&&(h=!0);break}case"cylinder":{const r=Math.pow(this._globalUniforms.u_cropCenter.value.x-b.x,2)+Math.pow(this._globalUniforms.u_cropCenter.value.y-b.y,2),o=Math.abs(this._globalUniforms.u_cropCenter.value.z-b.z);this._cropDefines===""?(r>this._globalUniforms.u_cropRadius.value*this._globalUniforms.u_cropRadius.value||o>this._globalUniforms.u_cropHeight/2)&&(h=!0):r<=this._globalUniforms.u_cropRadius.value*this._globalUniforms.u_cropRadius.value&&o<=this._globalUniforms.u_cropHeight/2&&(h=!0);break}default:break}if(!h&&this._mesh.material.clippingPlanes.length>0){const r=this._mesh.material.clippingPlanes;if(this._clipIntersection){h=!0;for(let o=0;o<r.length;o++)h=h&&r[o].distanceToPoint(b)<0}else for(let o=0;o<r.length;o++)h=h||r[o].distanceToPoint(b)<0}return h}_constructProperties(){}copyClippingPlaneObjects(b){this._clippingPlanes=b,this._localClipping&&(this._mesh.material.clippingPlanes=this._clippingPlanes,this._depthMesh!==null&&(this._depthMesh.material.clippingPlanes=this._clippingPlanes))}autoMagFilter(b){}_setGlobalUniforms(b){b.u_depthTexture=this._globalUniforms.u_depthTexture,b.u_previousTexture=this._globalUniforms.u_previousTexture,b.u_passNumber=this._globalUniforms.u_passNumber,b.u_viewportSize=this._globalUniforms.u_viewportSize,b.u_cropMin=this._globalUniforms.u_cropMin,b.u_cropMax=this._globalUniforms.u_cropMax,b.u_colorBoxMatrix=this._globalUniforms.u_colorBoxMatrix,b.u_colorBoxColor=this._globalUniforms.u_colorBoxColor,b.u_cropCenter=this._globalUniforms.u_cropCenter,b.u_cropRadius=this._globalUniforms.u_cropRadius,b.u_cropHeight=this._globalUniforms.u_cropHeight}_visible(b){this._mesh.visible=b,this._depthMesh!==null&&(this._depthMesh.visible=b)}_transform(b){const h=this._initTransform(b);this._updateMatrix(h)}_initTransform(b){const h=new f.Matrix4;return h.set(b[0][0],b[0][1],b[0][2],b[0][3],b[1][0],b[1][1],b[1][2],b[1][3],b[2][0],b[2][1],b[2][2],b[2][3],b[3][0],b[3][1],b[3][2],b[3][3]),h}_updateMatrix(b){this._mesh.matrix=b,this._depthMesh!==null&&(this._depthMesh.matrix=b)}_initColor(b){return new f.Color(b[0],b[1],b[2])}renderOrder(b){this._mesh.renderOrder=b,this._depthMesh!==null&&(this._depthMesh.renderOrder=b)}_initPlanes(b){const h=new Float32Array(b),r=[];let o=0;if(h.length>0){o=h.length/4;for(let c=0;c<o;c++)r[c]=new f.Plane(new f.Vector3(h[c*4],h[c*4+1],h[c*4+2]),h[c*4+3]);this._clippingPlanes=r}else this._clippingPlanes=Object.freeze([])}_setLayer(b){this._layer=b,this._mesh.layers.set(this._layer),this._depthMesh!==null&&this._depthMesh.layers.set(this._layer)}_setPickable(b){this._pickable=b}_setCropTypeDefines(b){switch(b){case"box":return"#define CROP_TYPE 0";case"sphere":return"#define CROP_TYPE 1";case"cylinder":return"#define CROP_TYPE 2";default:return"#define CROP_TYPE 0"}}}},R,W),R.exports=I},4868:(R,W,d)=>{var O,I;O=[d(40),d(1082),d(9925)],I=d.dj.d(O,function(f,N,b){return class extends N{refreshData(r,o,c){let u=o.NumChannels!==this._numChannels;this._setNumChannels(o.NumChannels);const g=Array.from(o.Size),m=Array.from(o.OverlaySize),y=o.DataModified,x=o.OverlayDataModified,w=o.AlphaDataModified,C=o.UseAlphaData;if(!y&&!x&&!w)return;const P=new Uint8Array(r);this._updateSize(g,m),this._updateGeometry(o,c);let T=0;y&&(this._texture!==null&&this._texture.dispose(),this._isDataEmpty=Math.max(...g)===0,this._isDataEmpty?this._texture=null:(T=this._numChannels*this._size.x*this._size.y*this._size.z,this._initTexture(P.slice(0,T),this._size)),this._mesh.material.uniforms.u_data.value=this._texture),w&&(this._alphaTexture!==null&&this._alphaTexture.dispose(),C?(this._initAlphaTexture(P.slice(T,T+this._size.x*this._size.y*this._size.z),this._size),T+=this._size.x*this._size.y*this._size.z):this._alphaTexture=null,this._mesh.material.uniforms.u_alphaData.value=this._alphaTexture),x&&(this._overlayTexture!==null&&this._overlayTexture.dispose(),this._isOverlayEmpty=Math.max(...m)===0,this._isOverlayEmpty?(this._overlayTexture=null,this._includeOverlay&&(this._includeOverlay=!1,this._overlayDefines="",u=!0)):(this._initOverlayTexture(P.slice(T,P.length),this._size),this._includeOverlay||(this._includeOverlay=!0,this._overlayDefines="#define USE_OVERLAY",u=!0)),this._mesh.material.uniforms.u_overlayData.value=this._overlayTexture),u&&this._updateFragmentShader()}add(r,o){this._texture=null,this._overlayTexture=null,this._alphaTexture=null;const c=f.UniformsUtils.clone(this._shader.uniforms);c.u_data.value=this._texture,c.u_overlayData.value=this._overlayTexture,c.u_alphaData.value=this._alphaTexture,this._setGlobalUniforms(c);const u=new f.PlaneGeometry;u.scale(this._size.x,this._size.y,this._size.z),u.translate(this._size.x/2+this._offset.x,this._size.y/2+this._offset.y,this._size.z/2+this._offset.z),this._mesh=new f.Mesh(u,this._initMaterial(c)),this._mesh.visible=r.Visible,this._mesh.matrixAutoUpdate=!1,this._mesh.matrix=this._initTransform(Array.from(r.Transform)),this._mesh.layers.set(this._layer),this._scene.add(this._mesh),this.quality(o.renderingStepSize),this._initDepthMesh(c,u,r),this.globalClippingPlanes(o.globalClippingPlanes,o.globalClipping),this._setProperties(r)}clipIntersection(r){this._clipIntersection=r,this._clipIntersectionDefines=r===!0?"#define CLIP_INTERSECTION":"",this._updateFragmentShader()}_updateSize(r,o){this._priorSize.copy(this._size),Math.max(...r)>0?this._size.set(r[0],r[1],1):Math.max(...o)>0?this._size.set(o[0],o[1],1):this._size.set(1,1,1)}_setNumChannels(r){switch(r){case 1:this._shaderDefines="",this._numChannels=1;break;case 2:this._shaderDefines="",this._numChannels=1;break;case 3:this._shaderDefines="#define RGB_SHADER",this._numChannels=3;break;case 4:this._shaderDefines=["#define RGB_SHADER","#define RGBA_SHADER"].join(`
`),this._numChannels=4;break}}crop(r,o){this._numCropBoxes=o===!0?1:0,this._cropDefines=r===!0?"#define CROP_EXCLUDE":"",this._cropTypeDefines=this._setCropTypeDefines(this._globalData.cropType),this._updateFragmentShader()}getMemoryUsed(){let r=0;return this._texture!==null&&(r+=this._size.x*this._size.y*this._numChannels/1e6),this._overlayTexture!==null&&(r+=this._size.x*this._size.y/1e6),this._alphaTexture!==null&&(r+=this._size.x*this._size.y/1e6),r}colorInBox(r){this._colorBoxDefines=r===!0?"#define COLOR_BOX":"",this._updateFragmentShader()}globalClippingPlanes(r,o){this._localClipping=!o,o?this._setClippingUniforms(r):this._setClippingUniforms(this._clippingPlanes)}updateWindowLevel(r){const o=Math.max(this._mesh.material.uniforms.u_clim.value.y-this._mesh.material.uniforms.u_clim.value.x+r.x,0),c=this._mesh.material.uniforms.u_clim.value.x+o/2+r.y;this._mesh.material.uniforms.u_clim.value.x=c-o/2,this._mesh.material.uniforms.u_clim.value.y=this._mesh.material.uniforms.u_clim.value.x+o}getWindowLevel(){return this._mesh!==null?this._mesh.material.uniforms.u_clim.value.toArray():null}_setClippingUniforms(r){this._mesh.material.clippingPlanes=r,this._depthMesh.material.clippingPlanes=r}_initDepthMesh(r,o,c){const u=new f.ShaderMaterial({transparent:!0,clipping:!0,uniforms:r,defines:this._shader.defines,premultipliedAlpha:!0,vertexShader:this._shader.vertexShader,fragmentShader:this._getFragmentShader(!0),side:f.DoubleSide});this._depthMesh=new f.Mesh(o,u),this._depthMesh.visible=c.Visible,this._depthMesh.matrixAutoUpdate=!1,this._depthMesh.matrix=this._initTransform(Array.from(c.Transform)),this._depthMesh.layers.set(this._layer),this._depthScene.add(this._depthMesh)}localClippingPlanes(r){this._initPlanes(r),this._localClipping&&this._setClippingUniforms(this._clippingPlanes)}copyClippingPlaneObjects(r){this._clippingPlanes=r,this._localClipping&&this._setClippingUniforms(this._clippingPlanes)}setSliceProperties(r){this._setSize(Array.from(r.Size)),this._transform(Array.from(r.Transform)),this._setLayer(r.Layer),this._mesh.material.uniforms.u_sliceAlpha.value=r.Alpha}setPropertiesFromVolume(r){this._clim(r.ColorLimits),this._climOverlay(r.OverlayColorLimits),this._colormap(Array.from(r.Colormap),Array.from(r.Alphamap)),this._overlayTransferFunction(Array.from(r.OverlayColormap),Array.from(r.OverlayAlphamap)),this.localClippingPlanes(r.ClippingPlanes),this._needsUpdate&&(this._needsUpdate=!1,this._updateFragmentShader())}setVolumeInverseMatrix(r){this._mesh.material.uniforms.u_inverseVolumeModelMatrix.value.copy(r)}setVolumeDataTextures(r,o,c,u){this._mesh.material.uniforms.u_data.value=r,this._mesh.material.uniforms.u_overlayData.value=o,this._mesh.material.uniforms.u_alphaData.value=c,this._mesh.material.uniforms.u_volumeSize.value.copy(u)}setVolumeDefines(r,o,c){this._shaderDefines=r,this._overlayDefines=o,this._alphaDataDefines=c,this._volumeDefines="#define SAMPLE_VOLUME",this._updateFragmentShader()}_setSize(r){this._updateSize(r,r),this._updateGeometry(null,0)}_initColormapTexture(r,o){const g=new Uint8Array(1024);for(let y=0;y<256;y++)g[y*4]=r[0][y],g[y*4+1]=r[1][y],g[y*4+2]=r[2][y],g[y*4+3]=o[y];const m=new f.DataTexture(g,1,256,f.RGBAFormat,f.UnsignedByteType);return m.needsUpdate=!0,m}_overlayTransferFunction(r,o){this._mesh.material.uniforms.u_overlayTransferFunction.value!==null&&this._mesh.material.uniforms.u_overlayTransferFunction.value.dispose(),this._mesh.material.uniforms.u_overlayTransferFunction.value=this._initColormapTexture(r,o)}_updateFragmentShader(){this._mesh.material.fragmentShader=this._getFragmentShader(!1),this._mesh.material.needsUpdate=!0,this._depthMesh!==null&&(this._depthMesh.material.fragmentShader=this._getFragmentShader(!0),this._depthMesh.material.needsUpdate=!0)}_getFragmentShader(r){let o=this._replaceConstants(this._shader.fragmentShader,this._numCropBoxes);return o=[this._hardwareDefines,this._shaderDefines,this._overlayDefines,this._alphaDataDefines,this._clipIntersectionDefines,this._volumeDefines,this._cropDefines,this._colorBoxDefines,this._cropTypeDefines,o].join(`
`),r&&(o=["#define DEPTH_SHADER",o].join(`
`)),o}_replaceConstants(r,o){return r.replace(/NUM_CROP_BOXES/g,o)}_initMaterial(r){return new f.ShaderMaterial({transparent:!0,clipping:!0,uniforms:r,defines:this._shader.defines,vertexShader:this._shader.vertexShader,fragmentShader:this._getFragmentShader(!1),blending:this._blendOp,depthTest:!0,depthFunc:f.AlwaysDepth,depthWrite:!0,side:f.DoubleSide})}_setProperties(r){this._visible(r.Visible),this._transform(Array.from(r.Transform)),this._setAlphaData(r.UseAlphaData),this._clim(r.ColorLimits),this._climOverlay(r.OverlayColorLimits),this._setPickable(r.Pickable),this._setLayer(r.Layer),this._colormap(Array.from(r.Colormap),Array.from(r.Alphamap)),this._overlayTransferFunction(Array.from(r.OverlayColormap),Array.from(r.OverlayAlphamap)),this.localClippingPlanes(r.ClippingPlanes),this._interpolation(r.Interpolation,r.Mipmaps),this._needsUpdate&&(this._needsUpdate=!1,this._updateFragmentShader())}_initTexture(r,o){switch(this._texture=new f.DataTexture(r,o.x,o.y),this._texture.type=f.UnsignedByteType,this._texture.generateMipmaps=this._mipmaps,this._texture.unpackAlignment=1,this._texture.minFilter=this._filter,this._texture.magFilter=this._magFilter,this._numChannels){case 1:this._texture.format=f.RedFormat;break;case 2:this._texture.format=f.RGFormat;break;case 3:this._texture.format=f.RGBFormat;break;case 4:this._texture.format=f.RGBAFormat;break}}_initOverlayTexture(r,o){this._overlayTexture=new f.DataTexture(r,o.x,o.y),this._overlayTexture.format=f.RedFormat,this._overlayTexture.type=f.UnsignedByteType,this._overlayTexture.minFilter=this._overlayFilter,this._overlayTexture.magFilter=f.NearestFilter,this._overlayTexture.generateMipmaps=this._mipmaps,this._overlayTexture.unpackAlignment=1,this._overlayTexture.needsUpdate=!0}_initAlphaTexture(r,o){this._alphaTexture=new f.DataTexture(r,o.x,o.y),this._alphaTexture.format=f.AlphaFormat,this._alphaTexture.type=f.UnsignedByteType,this._alphaTexture.minFilter=this._filter,this._alphaTexture.magFilter=f.NearestFilter,this._alphaTexture.generateMipmaps=this._mipmaps,this._alphaTexture.unpackAlignment=1,this._alphaTexture.needsUpdate=!0}_interpolation(r,o){this._mipmaps=o,this._magFilterStyle=r,this._mipmaps===!0?this._filter=r==="nearest"?f.LinearMipmapNearestFilter:f.LinearMipmapLinearFilter:this._filter=r==="nearest"?f.NearestFilter:f.LinearFilter,this._overlayFilter=f.NearestFilter,r==="auto"?this._magFilter=this._globalUniforms.u_autoMagFilter.value:r==="bilinear"?this._magFilter=f.LinearFilter:this._magFilter=f.NearestFilter,this._texture!==null&&(this._texture.minFilter!==this._filter||this._texture.magFilter!==this._magFilter)&&(this._texture.minFilter=this._filter,this._texture.magFilter=this._magFilter,this._texture.generateMipmaps=this._mipmaps,this._texture.needsUpdate=!0),this._overlayTexture!==null&&this._overlayTexture.minFilter!==this._overlayFilter&&(this._overlayTexture.minFilter=this._overlayFilter,this._overlayTexture.generateMipmaps=!1,this._overlayTexture.needsUpdate=!0),this._alphaTexture!==null&&this._alphaTexture.minFilter!==this._filter&&(this._alphaTexture.minFilter=this._filter,this._alphaTexture.generateMipmaps=this._mipmaps,this._alphaTexture.needsUpdate=!0)}autoMagFilter(r){this._magFilterStyle==="auto"&&this._texture!==null&&this._texture.magFilter!==r&&(this._texture.magFilter=r,this._texture.needsUpdate=!0)}_colormap(r,o){this._mesh.material.uniforms.u_transferFunction.value!==null&&this._mesh.material.uniforms.u_transferFunction.value.dispose(),this._mesh.material.uniforms.u_transferFunction.value=this._initColormapTexture(r,o)}_clim(r){this._mesh.material.uniforms.u_clim.value.fromArray(r)}_climOverlay(r){this._mesh.material.uniforms.u_overlayclim.value.fromArray(r)}_setAlphaData(r){r!==this._useAlphaData&&(this._useAlphaData=r,this._alphaDataDefines=this._useAlphaData===!0?"#define USE_ALPHA_DATA":"",this._needsUpdate=!0)}_getBufferLength(r){let o=0;const c=r.OverlaySize,u=r.Size;return Math.max(...u)>0&&(o+=u[0]*u[1]*u[2]*r.NumChannels),Math.max(...c)>0&&(o+=c[0]*c[1]*c[2]),o}_constructProperties(r,o){this._size=new f.Vector3(1,1,1),this._priorSize=new f.Vector3(1,1,1),this._offset=new f.Vector3(.5,.5,.5),this._priorOffset=new f.Vector3(.5,.5,.5),this._includeOverlay=!1,this._overlayFilter=f.NearestFilter,this._useAlphaData=!1,this._alphaTexture=null,this._scaleFactor=[1,1,1],this._blendOp=f.NormalBlending,this._magFilterStyle="auto",this._layer=r.Layer,this._shader=b,this._filter=f.LinearFilter,this._magFilter=f.NearestFilter,this._mipmaps=r.Mipmaps,this._setNumChannels(r.NumChannels),this._clipIntersection=o.clipIntersection,this._clipIntersectionDefines=o.clipIntersection===!0?"#define CLIP_INTERSECTION":"",this._cropDefines=o.cropBoxExclude===!0?"#define CROP_EXCLUDE":"",this._cropTypeDefines=this._setCropTypeDefines(o.cropType),this._colorBoxDefines="",this._alphaDataDefines="",this._overlayDefines="",this._volumeDefines="",this._hardwareDefines=o.hardwareSupport===!0?"#define HARDWARE_WEBGL":""}_updateGeometry(r,o){(this._size.distanceToSquared(this._priorSize)>1e-4||this._offset.distanceToSquared(this._priorOffset)>1e-4)&&(this._mesh.geometry.translate(-this._priorSize.x/2-this._priorOffset.x,-this._priorSize.y/2-this._priorOffset.y,-this._priorSize.z/2-this._priorOffset.z),this._mesh.geometry.scale(this._size.x/this._priorSize.x,this._size.y/this._priorSize.y,this._size.z/this._priorSize.z),this._mesh.geometry.translate(this._size.x/2+this._offset.x,this._size.y/2+this._offset.y,this._size.z/2+this._offset.z),this.quality(o))}}},R,W),R.exports=I},9925:(R,W,d)=>{var O,I;O=[d(40)],I=d.dj.d(O,function(f){return{defines:{TOLERANCE:1e-6},uniforms:{u_visible:{value:1},u_clim:{value:new f.Vector2(0,1)},u_data:{value:null},u_transferFunction:{value:null},u_alphaData:{value:null},u_overlayData:{value:null},u_overlayTransferFunction:{value:null},u_overlayclim:{value:new f.Vector2(0,1)},u_passNumber:{value:0},u_depthTexture:{value:null},u_previousTexture:{value:null},u_viewportSize:{value:new f.Vector2(1,1)},u_cropMin:{value:new f.Vector3(0,0,0)},u_cropMax:{value:new f.Vector3(1,1,1)},u_volumeSize:{value:new f.Vector3(0,0,0)},u_sliceAlpha:{value:1},u_inverseVolumeModelMatrix:{value:new f.Matrix4}},vertexShader:`varying vec2 vUv;
        varying vec3 vClipPosition;
        varying vec3 vWorldCoords; 
        
        void main() {
            vec4 mvPosition = vec4( position, 1.0 );
        
            vec4 worldCoords = modelMatrix * mvPosition;
            vWorldCoords = worldCoords.xyz;
        
            mvPosition = modelViewMatrix * mvPosition;
            vClipPosition = - mvPosition.xyz;
        
            gl_Position = projectionMatrix * mvPosition;
        
            vUv = uv;
        }`,fragmentShader:`
        //---------------------------------------------------------------------
        // Fragment shader for grayscale and rgb volume rendering
        //---------------------------------------------------------------------
        
        // Copyright 2023 The MathWorks, Inc.
        
        precision highp float;
        precision highp sampler2D;
        precision highp sampler3D;
        
        #ifdef SAMPLE_VOLUME
            uniform sampler3D u_data;
            uniform sampler3D u_overlayData;
            uniform sampler3D u_alphaData;
            uniform vec3 u_volumeSize;
            uniform mat4 u_inverseVolumeModelMatrix;
            uniform float u_sliceAlpha;
        #else
            uniform sampler2D u_data;
            uniform sampler2D u_overlayData;
            uniform sampler2D u_alphaData;
        #endif
        
        uniform sampler2D u_transferFunction;
        
        uniform mat4 modelMatrix;
        uniform mat4 modelViewMatrix;
        
        // Overlay uniforms
        uniform sampler2D u_overlayTransferFunction;
        
        uniform sampler2D u_depthTexture;
        uniform int u_passNumber;
        uniform vec2 u_viewportSize;
        uniform sampler2D u_previousTexture;
        
        varying vec2 vUv;
        varying vec3 vClipPosition;
        varying vec3 vWorldCoords; 
        
        #ifndef RGB_SHADER
            // Uniform to control dynamic range
            uniform vec2 u_clim;
        #endif
        
        uniform vec2 u_overlayclim;
        
        #if NUM_CLIPPING_PLANES > 0
            uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
        #endif
        
        #if NUM_CROP_BOXES > 0
            uniform vec3 u_cropMin;
            uniform vec3 u_cropMax;
            uniform vec3 u_cropCenter;
            uniform float u_cropRadius;
            uniform float u_cropHeight;
        #endif
        
        #ifdef COLOR_BOX
            uniform mat4 u_colorBoxMatrix;
            uniform vec3 u_colorBoxColor;
        #endif
        
        #ifdef SAMPLE_VOLUME
        
            vec3 worldToTex (vec3 loc) {
                // Convert world coordinates into local texture coodinates
                // of the volume
                vec4 localCoords = u_inverseVolumeModelMatrix * vec4( loc, 1.0 );
                return (localCoords.xyz - 0.5) / u_volumeSize;
            }
        
        #endif
        
        vec4 packDepthToRGBA( float depth ) {
            vec3 packFactors = vec3( 256.0 * 256.0 * 256.0, 256.0 * 256.0,  256.0 );
            float shiftRight8 = 1.0 / 256.0; // Handle overflow
            float packUpscale = 256.0 / 255.0; // fraction -> 0..1 (including 1)
            
            vec4 rgba = vec4( fract(depth * packFactors), depth);
            rgba.yzw -= rgba.xyz * shiftRight8;
            return rgba * packUpscale;
        }
        
        void setDepth () {
            if (u_passNumber == 2 ) {
                float prevDepth = texture(u_previousTexture, gl_FragCoord.xy / u_viewportSize).x;
                if (gl_FragCoord.z < prevDepth + TOLERANCE) {
                    discard;
                }
            }
            gl_FragColor = packDepthToRGBA(gl_FragCoord.z);
            gl_FragDepth = gl_FragCoord.z;
        }
        
        void testDepth () {
            if (u_passNumber == 1 ) {
                float priorDepth = texture( u_depthTexture, gl_FragCoord.xy / u_viewportSize ).x;
                float accumulatedDepth = texture( u_previousTexture, gl_FragCoord.xy / u_viewportSize ).x;
        
                // Should be between current depth and previous depth to be included
                if (gl_FragCoord.z > priorDepth + TOLERANCE  || gl_FragCoord.z < accumulatedDepth + TOLERANCE ) {
                    discard;
                }
            }
        }
        
        #ifdef COLOR_BOX
        
            vec4 colorInBox (vec4 color) {
                vec4 pos = u_colorBoxMatrix * vec4(vWorldCoords, 1.0);
                vec3 s = step(vec3(-0.5), pos.xyz) - step(vec3(0.5), pos.xyz);
                if ((s.x * s.y * s.z) > 0.0) {
                    color.rgb = u_colorBoxColor;
                }
                return color;
            }
        
        #endif
        
        #ifdef USE_OVERLAY
        
            #ifdef SAMPLE_VOLUME
                float sampleOverlay (vec3 coords) {
                    return texture(u_overlayData, worldToTex(coords)).r;
                }
            #else
                float sampleOverlay (vec2 texcoords) {
                    return texture(u_overlayData, texcoords.xy).r;
                }
            #endif
        
            vec4 applyOverlayColormap (float val) {
                float scaledVal = (val - u_overlayclim[0]) / (u_overlayclim[1] - u_overlayclim[0]);
                vec4 color = texture(u_overlayTransferFunction, vec2(0,scaledVal));
                return color;
            }
        
            float getOverlayAlpha (float val) {
                vec4 color = applyOverlayColormap(val);
                return color.a;
            }
        
        #endif
        
        #ifdef RGB_SHADER
        
            #ifdef USE_VOLUME
                vec4 sampleTexture (vec3 coords) {
                    vec4 color = texture(u_data, worldToTex(coords)).rgba;
                    #ifndef RGBA_SHADER
                        #ifdef USE_ALPHA_DATA
                            // Sample color at location, then sample alpha data at
                            // same location
                            color.a = texture(u_alphaData, worldToTex(coords)).a;
                        #else
                            color.a = u_sliceAlpha;
                        #endif
                    #endif
                    #ifdef COLOR_BOX
                        return colorInBox( color );
                    #else
                        return color;
                    #endif
                }
            #else
                vec4 sampleTexture (vec2 texcoords) {
                    vec4 color = texture(u_data, texcoords.xy).rgba;
                    #ifndef RGBA_SHADER
                        #ifdef USE_ALPHA_DATA
                            // Sample color at location, then sample alpha data at
                            // same location
                            color.a = texture(u_alphaData, texcoords.xy).a;
                        #else
                            color.a = texture(u_transferFunction, vec2(0.0,0.0)).a;
                        #endif
                    #endif
                    #ifdef COLOR_BOX
                        return colorInBox( color );
                    #else
                        return color;
                    #endif
                }
            #endif
        
        #else
        
            #ifdef SAMPLE_VOLUME
                float sampleIntensity (vec3 coords) {
                    return texture(u_data, worldToTex(coords)).r;
                }
        
                vec4 applyColormap (float val, vec3 coords) {
                    float scaledVal = (val - u_clim[0]) / (u_clim[1] - u_clim[0]);
                    vec4 color = texture(u_transferFunction, vec2(0,scaledVal));
                    #ifdef USE_ALPHA_DATA
                        color.a = texture(u_alphaData, worldToTex(coords)).a;
                    #else
                        color.a = u_sliceAlpha;
                    #endif
                    #ifdef COLOR_BOX
                        return colorInBox( color );
                    #else
                        return color;
                    #endif
                }
        
                vec4 sampleTexture (vec3 coords) {
                    return applyColormap( sampleIntensity(coords), coords );
                }
            #else
                float sampleIntensity (vec2 texcoords) {
                    return texture(u_data, texcoords.xy).r;
                }
        
                vec4 applyColormap (float val, vec2 texcoords) {
                    float scaledVal = (val - u_clim[0]) / (u_clim[1] - u_clim[0]);
                    vec4 color = texture(u_transferFunction, vec2(0,scaledVal));
                    #ifdef USE_ALPHA_DATA
                        color.a = texture(u_alphaData, texcoords.xy).a;
                    #else
                        color.a = texture(u_transferFunction, vec2(0,val)).a;
                    #endif
                    #ifdef COLOR_BOX
                        return colorInBox( color );
                    #else
                        return color;
                    #endif
                }
        
                vec4 sampleTexture (vec2 texcoords) {
                    return applyColormap( sampleIntensity(texcoords), texcoords );
                }
            #endif
            
        #endif
        
        bool outsideCropBox () {
            #if NUM_CROP_BOXES > 0
                
                #if CROP_TYPE == 0
                    vec3 s = step(u_cropMin, vWorldCoords) - step(u_cropMax, vWorldCoords);
                    #ifdef CROP_EXCLUDE
                        return bool(s.x * s.y * s.z);
                    #else
                        return bool(1.0 - (s.x * s.y * s.z));
                    #endif
                #endif
        
                // For a point p on the object and a point c as the center of the sphere,
                // Check if abs(p.xyz - r.xyz) > radius (distance of p from center is greater than radius)
                // If so, then the point lies outside the sphere. Otherwise it lies within the sphere.
        
                #if CROP_TYPE == 1
                    float dist = distance(vWorldCoords, u_cropCenter);
                    #ifdef CROP_EXCLUDE
                        return (dist <= u_cropRadius);
                    #else
                        return (dist > u_cropRadius);
                    #endif
                #endif
        
                // For a point p on the object and a point c as the center of the cylinder,
                // Check if abs(p.xy - r.xy) > radius (distance of p from center is greater than radius)
                // If so, then the point lies outside the curved surface of the cylinder along the x-y plane. 
                // Otherwise it lies within the curved surface of the cylinder.
                // Check if abs(p.z - c.z) > height / 2.0f (distance of p from the center along the z-axis is greater than height of the cylinder/2)
                // If so, then the point lies outside the end caps of the cylinder.
                // If either of these conditions are met, then the point lies outside the cylinder.
        
                #if CROP_TYPE == 2
                    float distanceXYPlane = distance(vec2(vWorldCoords.x, vWorldCoords.y), vec2(u_cropCenter.x, u_cropCenter.y));
                    float distanceZAxis = abs(vWorldCoords.z - u_cropCenter.z);
        
                    #ifdef CROP_EXCLUDE
                        return (distanceXYPlane <= u_cropRadius && distanceZAxis <= (u_cropHeight / 2.0f));
                    #else
                        return (distanceXYPlane > u_cropRadius || distanceZAxis > (u_cropHeight / 2.0f));
                    #endif
                #endif
            #else
                return false;
            #endif
        }
        
        bool clipped () {
            // Returns true if the location in world coordinates should be 
            // clipped (discard or not rendered).
            bool culled = outsideCropBox();
            #if NUM_CLIPPING_PLANES > 0
        
            vec4 plane;
        
                #ifdef CLIP_INTERSECTION
                    culled = true;
        
                    #pragma unroll_loop_start
                    for ( int i = 0; i < NUM_CLIPPING_PLANES; i++ ) {
                        plane = clippingPlanes[ i ];
                        culled = dot( vClipPosition, plane.xyz ) > plane.w && culled;
                    }
                    #pragma unroll_loop_end
                #else
                    #pragma unroll_loop_start
                    for ( int i = 0; i < NUM_CLIPPING_PLANES; i++ ) {
                        plane = clippingPlanes[ i ];
                        culled = dot( vClipPosition, plane.xyz ) > plane.w || culled;
                    }
                    #pragma unroll_loop_end
                #endif
            #endif
            return culled;
        }
        
        void main() {
        
            if (clipped()) {
                discard;
            }
        
            #ifdef DEPTH_SHADER
                setDepth();
            #else
                testDepth();
            #endif
        
            #ifdef USE_OVERLAY
                #ifdef BLEND_OVERLAY
                    // Sample from overlay texture
                    #ifdef SAMPLE_VOLUME
                        vec4 overlay =  applyOverlayColormap(sampleOverlay( vWorldCoords ));
                        vec4 color = sampleTexture( vWorldCoords );
                    #else
                        vec4 overlay =  applyOverlayColormap(sampleOverlay( vUv ));
                        vec4 color = sampleTexture( vUv );
                    #endif
                    gl_FragColor.rgb = (color.rgb * (1.0 - overlay.a) ) + (overlay.rgb * overlay.a);
                    gl_FragColor.a = color.a;
                #else
                    #ifdef SAMPLE_VOLUME
                        gl_FragColor = applyOverlayColormap(sampleOverlay( vWorldCoords ));
                    #else
                        gl_FragColor = applyOverlayColormap(sampleOverlay( vUv ));
                    #endif
                #endif
            #else
                #ifdef SAMPLE_VOLUME
                    gl_FragColor = sampleTexture( vWorldCoords );
                #else
                    gl_FragColor = sampleTexture( vUv );
                #endif
            #endif
        
            if (gl_FragColor.a < 0.05) {
                discard;
            }
        
        }`}},R,W),R.exports=I},1952:(R,W,d)=>{var O,I;O=[d(40),d(2588)],I=d.dj.d(O,function(f,N){return class extends N{constructor(h,r){super(h,r),this._size=new f.Vector3(r.Size[0],r.Size[1],r.Size[2]),this._scale=new f.Vector3(r.Scale[0],r.Scale[1],r.Scale[2]),this._offset=new f.Vector3(r.Offset[0],r.Offset[1],r.Offset[2]),this.numElements=r.Size[0]*r.Size[1]*r.Size[2],this._texture=null,this._overlayTexture=null,this._alphaTexture=null}load(h,r,o,c,u){if(this._mesh===null){const g=new f.PlaneGeometry;g.scale(this._size.x*this._scale.x,this._size.y*this._scale.y,this._size.z*this._scale.z),g.translate(this._size.x*this._scale.x/2+.5+this._offset.x,this._size.y*this._scale.y/2+.5+this._offset.y,this._size.z*this._scale.z/2+.5+this._offset.z),this._mesh=new f.Mesh(g,r.material.clone()),this._depthMesh=new f.Mesh(g,o.material.clone()),this._clearTransferFunctionTextures(),this.copyGlobalUniforms(c),this._mesh.renderOrder=u.NumLevels>1&&this.level===u.NumLevels?r.renderOrder-1:r.renderOrder,r.add(this._mesh),o.add(this._depthMesh)}else this._mesh.material.dispose(),this._depthMesh.material.dispose(),this._mesh.material=r.material.clone(),this._depthMesh.material=o.material.clone(),this.copyGlobalUniforms(c);this._mesh.material.visible=!0,this._depthMesh.material.visible=!0,this.copyUniforms(r.material.uniforms,u),this.memory=h.byteLength/1e6,this._initTextures(h,u),this.loaded=!0,this.visible=!0}renderOrder(h,r){super.renderOrder(r>1&&this.level===r?h-1:h,r)}_initTextures(h,r){this._clearTextures();const o=new Uint8Array(h);let c=0;r.UseData&&(c=r.NumChannels*this._size.x*this._size.y*this._size.z,this._initTexture(o.slice(0,c),this._size,r)),r.UseAlpha&&(this._initAlphaTexture(o.slice(c,c+this._size.x*this._size.y*this._size.z),this._size,r),c+=this._size.x*this._size.y*this._size.z),r.UseOverlay&&this._initOverlayTexture(o.slice(c,o.length),this._size,r),this._setTextures()}copyMaterial(h,r,o,c){super.copyMaterial(h,r,o,c),this._mesh!==null&&(this.copyGlobalUniforms(o),this._setTextures())}copyUniforms(h,r){this._mesh!==null&&(this._mesh.material.uniforms.u_transferFunction.value=h.u_transferFunction.value,this._mesh.material.uniforms.u_clim.value=h.u_clim.value,this._mesh.material.uniforms.u_overlayclim.value=h.u_overlayclim.value,this._mesh.material.uniforms.u_overlayTransferFunction.value=h.u_overlayTransferFunction.value,this._interpolation(r))}_initTexture(h,r,o){switch(this._texture=new f.DataTexture(h,r.x,r.y),this._texture.type=f.UnsignedByteType,this._texture.generateMipmaps=o.Mipmaps,this._texture.unpackAlignment=1,this._texture.minFilter=o.MinFilter,this._texture.magFilter=o.MagFilter,o.NumChannels){case 1:this._texture.format=f.RedFormat;break;case 2:this._texture.format=f.RGFormat;break;case 3:this._texture.format=f.RGBFormat;break;case 4:this._texture.format=f.RGBAFormat;break}}_initOverlayTexture(h,r,o){this._overlayTexture=new f.DataTexture(h,r.x,r.y),this._overlayTexture.format=f.RedFormat,this._overlayTexture.type=f.UnsignedByteType,this._overlayTexture.minFilter=o.OverlayFilter,this._overlayTexture.magFilter=f.NearestFilter,this._overlayTexture.generateMipmaps=!1,this._overlayTexture.unpackAlignment=1,this._overlayTexture.needsUpdate=!0}_initAlphaTexture(h,r,o){this._alphaTexture=new f.DataTexture(h,r.x,r.y),this._alphaTexture.format=f.AlphaFormat,this._alphaTexture.type=f.UnsignedByteType,this._alphaTexture.minFilter=o.MinFilter,this._alphaTexture.magFilter=f.NearestFilter,this._alphaTexture.generateMipmaps=o.Mipmaps,this._alphaTexture.unpackAlignment=1,this._alphaTexture.needsUpdate=!0}_setTextures(){this._mesh.material.uniforms.u_data.value=this._texture,this._mesh.material.uniforms.u_alphaData.value=this._alphaTexture,this._mesh.material.uniforms.u_overlayData.value=this._overlayTexture}_interpolation(h){this._texture!==null&&(this._texture.minFilter!==h.MinFilter||this._texture.magFilter!==h.MagFilter)&&(this._texture.minFilter=h.MinFilter,this._texture.magFilter=h.MagFilter,this._texture.generateMipmaps=h.Mipmaps,this._texture.needsUpdate=!0),this._overlayTexture!==null&&this._overlayTexture.minFilter!==h.OverlayFilter&&(this._overlayTexture.minFilter=h.OverlayFilter,this._overlayTexture.generateMipmaps=!1,this._overlayTexture.needsUpdate=!0),this._alphaTexture!==null&&this._alphaTexture.minFilter!==h.MinFilter&&(this._alphaTexture.minFilter=h.MinFilter,this._alphaTexture.generateMipmaps=h.Mipmaps,this._alphaTexture.needsUpdate=!0)}_clearTextures(){this._texture!==null&&(this._texture.dispose(),this._texture=null),this._overlayTexture!==null&&(this._overlayTexture.dispose(),this._overlayTexture=null),this._alphaTexture!==null&&(this._alphaTexture.dispose(),this._alphaTexture=null)}_measureDistance(h,r){return h.position.distanceTo(this._sphere.center)}unload(){super.unload(),this.dispose()}dispose(){this._clearTransferFunctionTextures(),this._clearTextures(),super.dispose()}}},R,W),R.exports=I},3734:(R,W,d)=>{var O,I;O=[d(40)],I=d.dj.d(O,function(f){const N=new f.Box3,b=new f.Vector3;return class extends f.InstancedBufferGeometry{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const r=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],o=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],c=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(c),this.setAttribute("position",new f.Float32BufferAttribute(r,3)),this.setAttribute("uv",new f.Float32BufferAttribute(o,2))}applyMatrix4(r){const o=this.attributes.instanceStart,c=this.attributes.instanceEnd;return o!==void 0&&(o.applyMatrix4(r),c.applyMatrix4(r),o.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(r){let o;r instanceof Float32Array?o=r:Array.isArray(r)&&(o=new Float32Array(r));const c=new f.InstancedInterleavedBuffer(o,6,1);return this.setAttribute("instanceStart",new f.InterleavedBufferAttribute(c,3,0)),this.setAttribute("instanceEnd",new f.InterleavedBufferAttribute(c,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(r){let o;r instanceof Float32Array?o=r:Array.isArray(r)&&(o=new Float32Array(r));const c=new f.InstancedInterleavedBuffer(o,6,1);return this.setAttribute("instanceColorStart",new f.InterleavedBufferAttribute(c,3,0)),this.setAttribute("instanceColorEnd",new f.InterleavedBufferAttribute(c,3,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new f.Box3);const r=this.attributes.instanceStart,o=this.attributes.instanceEnd;r!==void 0&&o!==void 0&&(this.boundingBox.setFromBufferAttribute(r),N.setFromBufferAttribute(o),this.boundingBox.union(N))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new f.Sphere),this.boundingBox===null&&this.computeBoundingBox();const r=this.attributes.instanceStart,o=this.attributes.instanceEnd;if(r!==void 0&&o!==void 0){const c=this.boundingSphere.center;this.boundingBox.getCenter(c);let u=0;for(let g=0,m=r.count;g<m;g++)b.fromBufferAttribute(r,g),u=Math.max(u,c.distanceToSquared(b)),b.fromBufferAttribute(o,g),u=Math.max(u,c.distanceToSquared(b));this.boundingSphere.radius=Math.sqrt(u),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}}},R,W),R.exports=I},7086:(R,W,d)=>{var O,I;O=[],I=d.dj.d(O,function(){return class{constructor(){this.cache=new Map,this.head={idx:0,prev:null,next:null},this.tail={idx:0,prev:null,next:null},this.head.next=this.tail,this.tail.prev=this.head}_remove(N){const b=N.prev,h=N.next;b.next=h,h.prev=b}_add(N){const b=this.tail.prev;b.next=N,this.tail.prev=N,N.prev=b,N.next=this.tail}put(N){this.cache.has(N)&&this._remove(this.cache.get(N));const b={idx:N,prev:null,next:null};this._add(b),this.cache.set(N,b)}getNext(){if(this.cache.size>0){const N=this.head.next,b=N.idx;return this._remove(N),this.cache.delete(N.key),b}else return 0}}},R,W),R.exports=I},4191:(R,W,d)=>{var O,I;O=[d(40)],I=d.dj.d(O,function(f){return class extends f.EventDispatcher{constructor(b,h){super(),this._scene=b,this._globalData=h,this._lights=[],this._quaternions=[],this._modes=[],this._initialized=!1,this._ambientLight=new f.AmbientLight(16777215,.3),this._scene.add(this._ambientLight),this._numLights=1,this._numVisibleLights=1,this._add()}getPosition(){const b=[];for(let h=0;h<this._numLights;h++)this._lights[h].position.toArray(b,h*3);return b}reset(b,h,r,o){const c=new f.Vector3;let u=!1;for(let g=0;g<this._numLights;g++)this._resetLight(b,h,r,o,c,this._lights[g],this._quaternions[g],this._modes[g]),u===!1&&this._lights[g].visible===!0&&(u=!0,this._globalData.uniforms.u_primaryLight.value=this._lights[g].position,this._globalData.uniforms.u_primaryLightIntensity.value=this._lights[g].intensity);this._initialized=!0,this._updateSecondayLights()}refresh(b,h,r,o){const c=new f.Vector3;let u=!1;for(let g=0;g<this._numLights;g++)this._refreshLight(b,h,r,o,c,this._lights[g],this._quaternions[g],this._modes[g]),u===!1&&this._lights[g].visible===!0&&(u=!0,this._globalData.uniforms.u_primaryLight.value=this._lights[g].position,this._globalData.uniforms.u_primaryLightIntensity.value=this._lights[g].intensity);this._updateSecondayLights()}update(b){let h=!1;const r=this._numVisibleLights,o=Array.from(b.LightColor);b.Lighting!==this._globalData.lighting&&(this._globalData.lighting=b.Lighting,h=!0),this._updateAmbient(b.Lighting,o,b.AmbientLight),this._updatePoint(b.Lighting,o,b.NumLights,b.Light),r!==this._numVisibleLights&&(h=!0),this._globalData.numLights=this._numVisibleLights,h===!0&&this._broadcastEvent()}_updateAmbient(b,h,r){this._globalData.uniforms.u_lightColor.value.set(h[0],h[1],h[2],1),this._globalData.uniforms.u_ambientStrength.value=r;const o=new f.Color(h[0],h[1],h[2]);this._ambientLight.color=o,this._ambientLight.intensity=b===!0?1:r}_updatePoint(b,h,r,o){const c=new f.Color(h[0],h[1],h[2]);let u=0;if(r>this._lights.length)for(let g=this._lights.length;g<r;g++)this._add();else if(r<this._lights.length)for(let g=r;g<this._lights.length;g++)this._lights[g].visible=!1,this._globalData.uniforms.lights[g].enabled=!1;if(r===1)this._lights[0].color=c,this._lights[0].intensity=o.Intensity,this._lights[0].visible=b&&o.Enabled,this._globalData.uniforms.u_primaryLightIntensity.value=o.Intensity,this._modes[0]=o.PositionMode,this._globalData.uniforms.lights[0].size=o.Size,this._globalData.uniforms.lights[0].intensity=o.Intensity,this._globalData.uniforms.lights[0].enabled=o.Enabled,u+=o.Enabled===!0?1:0,o.PositionMode==="manual"&&this._lights[0].position.fromArray(Array.from(o.Position));else for(let g=0;g<r;g++)this._lights[g].color=c,this._lights[g].intensity=o[g].Intensity,this._lights[g].visible=b&&o[g].Enabled,this._modes[g]=o[g].PositionMode,this._globalData.uniforms.lights[g].size=o[g].Size,this._globalData.uniforms.lights[g].intensity=o[g].Intensity,this._globalData.uniforms.lights[g].enabled=o[g].Enabled,u+=o[g].Enabled===!0?1:0,o[g].PositionMode==="manual"&&this._lights[g].position.fromArray(Array.from(o[g].Position));this._numVisibleLights=u,this._numLights=r}_resetLight(b,h,r,o,c,u,g,m){if(m==="auto")if(this._initialized){const y=new f.Vector3;c.copy(b).sub(r).normalize(),y.copy(u.position).sub(r).normalize(),g.setFromUnitVectors(c,y),this._refreshLight(b,h,r,o,c,u,g,m)}else u.position.copy(b),g.identity();else this._refreshLight(b,h,r,o,c,u,g,m)}_refreshLight(b,h,r,o,c,u,g,m){switch(m){case"headlight":u.position.copy(b),g.identity();break;case"right":if(o>0){const y=new f.Vector3,x=h.clone();c.copy(b).sub(r).normalize(),y.crossVectors(c,x.normalize()).negate(),c.add(y).add(x).multiplyScalar(o),u.position.addVectors(r,c),g.identity()}break;case"left":if(o>0){const y=new f.Vector3,x=h.clone();c.copy(b).sub(r).normalize(),y.crossVectors(c,x.normalize()),c.add(y).add(x).multiplyScalar(o),u.position.addVectors(r,c),g.identity()}break;case"target-behind":c.copy(b).sub(r),u.position.subVectors(r,c),g.identity();break;case"target-above":c.copy(h).normalize().multiplyScalar(o),u.position.addVectors(r,c),g.identity();break;case"target-below":c.copy(h).normalize().negate().multiplyScalar(o),u.position.addVectors(r,c),g.identity();break;case"target-right":if(o>0){const y=new f.Vector3,x=h.clone();c.copy(b).sub(r).normalize(),y.crossVectors(c,x.normalize()).negate().multiplyScalar(o),u.position.addVectors(r,y),g.identity()}break;case"target-left":if(o>0){const y=new f.Vector3,x=h.clone();c.copy(b).sub(r).normalize(),y.crossVectors(c,x.normalize()).multiplyScalar(o),u.position.addVectors(r,y),g.identity()}break;case"camera-above":c.copy(h).normalize().multiplyScalar(o),u.position.addVectors(b,c),g.identity();break;case"auto":o>0&&(c.copy(b).sub(r).normalize(),c.applyQuaternion(g).multiplyScalar(o),u.position.addVectors(r,c));break}}_updateSecondayLights(){let b=null,h=null;if(this._numVisibleLights>1){let r=!1,o=0;b=new Array((this._numVisibleLights-1)*3),h=new Array(this._numVisibleLights-1);for(let c=0;c<this._numLights;c++)this._lights[c].visible===!0&&(r===!0?(this._lights[c].position.toArray(b,o*3),h[o]=this._lights[c].intensity,o+=1):r=!0)}this._globalData.uniforms.u_secondaryLight.value=b,this._globalData.uniforms.u_secondaryLightIntensity.value=h}_broadcastEvent(){this.dispatchEvent({type:"lightsUpdated",message:{numLights:this._numVisibleLights}})}_add(){const b=new f.PointLight,h=new f.Quaternion;this._scene.add(b),this._lights.push(b),this._quaternions.push(h),this._modes.push("new");const r={enabled:b.visible,position:b.position,intensity:b.intensity,size:.2};this._globalData.uniforms.lights.push(r)}dispose(){this._numLights=0,this._globalData.uniforms.lights=[],this._ambientLight=null,this._lights=[],this._quaternions=[],this._modes=[]}}},R,W),R.exports=I},8855:(R,W,d)=>{var O,I;O=[d(40),d(9242)],I=d.dj.d(O,function(f,N){return class extends N{refreshData(h,r){const o=new Float32Array(h);this._isDataEmpty=o.length===0,this._memoryUsed=o.length*4/1e6,this._mesh.geometry.dispose();const c=this._initGeometry(o,r.NumVertices,r.ColorByVertex,r.NumSeparators);this._mesh.geometry=c,this._depthMesh.geometry=c}add(h,r){const o=this._initGeometry([],0,h.ColorByVertex,0);this._initMesh(h,o),this.globalClippingPlanes(r.globalClippingPlanes,r.globalClipping),this._setProperties(h)}_constructMesh(h,r,o){this._mesh=new f.LineSegments(h,this._initMaterial(!1,r,o)),this._depthMesh=new f.LineSegments(h,this._initMaterial(!0,r,o))}_initMaterial(h,r,o){const c=new f.LineBasicMaterial({color:o,opacity:r.Alpha,transparent:!0,premultipliedAlpha:h,depthTest:!0,depthWrite:!0,clipIntersection:this._clipIntersection,side:f.FrontSide});return h?(c.blending=f.NoBlending,c.onBeforeCompile=this._addDepthToShader.bind(this)):c.onBeforeCompile=this._addPeelToShader.bind(this),c.customProgramCacheKey=this._setProgramCacheKey.bind(this),c}_colorStyle(h,r){h===!1&&(this._mesh.material.color=r),this._colorByVertex!==h&&(this._setMaterialColor(h,r),this._colorByVertex=h)}_setMaterialColor(h,r){h?this._mesh.material.color=new f.Color(1,1,1):this._mesh.material.color=r,this._mesh.material.vertexColors=h,this._mesh.material.needsUpdate=!0}_setProperties(h){this._mesh.material.opacity=h.Alpha;const r=this._initColor(Array.from(h.Color));this._colorStyle(h.ColorByVertex,r),this._visible(h.Visible),this._transform(Array.from(h.Transform)),this.localClippingPlanes(h.ClippingPlanes),this._setPickable(h.Pickable),this._setLayer(h.Layer)}_initGeometry(h,r,o,c){const u=new f.BufferGeometry,g=[];if(c>0)for(let m=0;m<c-1;m++)for(let y=h[m];y<h[m+1]-1;y++)g.push(y,y+1);else for(let m=0;m<r-1;m++)g.push(m,m+1);return o?(u.setIndex(g),u.setAttribute("position",new f.Float32BufferAttribute(h.slice(c,3*r+c),3)),u.setAttribute("color",new f.Float32BufferAttribute(h.slice(3*r+c,6*r+c),3))):(u.setIndex(g),u.setAttribute("position",new f.Float32BufferAttribute(h.slice(c,3*r+c),3))),u.computeBoundingBox(),u.computeBoundingSphere(),u}}},R,W),R.exports=I},2670:(R,W,d)=>{var O,I;O=[d(2119),d(1711),d(1919)],I=d.dj.d(O,function(f,N,b){return class{constructor(r){this._messageServiceChannel="/images-threejs-ui/"+r,this._started=!1,this.viewer=new f(this._messageServiceChannel),this._binaryChannel=b.createStream(r+"Binary"),this._connectedHandle=N.on("connected",this.start.bind(this)),N.start()}stop(){this._started===!0&&(N.unsubscribe(this._messageServiceChannel,this._messageReceived,this),N.stop(),this._started=!1)}start(){this._connectedHandle.remove(),this._started!==!0&&N.subscribe(this._messageServiceChannel,this._messageReceived,this).then(this._connectBinaryChannels.bind(this))}_connectBinaryChannels(){this._binaryChannel.start(this._binaryDataReceived.bind(this)).then(this._validateViewer.bind(this))}_validateViewer(){this.viewer.validateWebGraphics(),this._started=!0}_binaryDataReceived(r){try{this.viewer.setBinaryData(r.data)}catch(o){console.log("Error during binary channel data update"),this._throwError(r,o)}}_messageReceived(r){if(r.data==="stop"){this.stop();return}try{const o=r.data.Args===void 0?{}:r.data.Args;o.Token=r.data.Token,this.viewer[r.data.Type](o)}catch(o){console.log("Error during message service communication"),this._throwError(r,o)}}_throwError(r,o){const c={Token:"ErrorThrown",Message:{Name:o.name,Message:o.message,Stack:r.data.Type}};N.publish(this._messageServiceChannel,c)}}},R,W),R.exports=I},6116:(R,W,d)=>{var O,I;O=[d(40)],I=d.dj.d(O,function(f){return class extends f.EventDispatcher{constructor(){super(),this._hardLimit=3800,this.limit=1e3,this.used=0,this._required=0}setLimit(b){this.limit=b*1e3}requiredOverLimit(){return this._required>this.limit}clear(){this.used=0,this._required=0}refresh(b,h){this.used=0,this._required=0;for(let r=0;r<b.length;r++)this.used+=b[r].getMemoryUsed(),this._required+=b[r].getMemoryRequired();if(this.used>this._hardLimit)for(let r=0;r<b.length;r++)b[r].unload(!0);else if(this.used>this.limit)for(let r=0;r<b.length;r++)b[r].unload(!1)}}},R,W),R.exports=I},4544:(R,W,d)=>{var O,I;O=[d(40),d(3771)],I=d.dj.d(O,function(f,N){return class extends N{refreshData(h,r,o){this.stitchingNeeded=!r.UseBinaryChannel,this._clearTextures(),r.UseBinaryChannel===!0?(this._clearBuffer(),super.refreshData(h,r,o)):this._initBuffer(r,o)}updateOnInteraction(h){h&&(this._textureUpdateNeeded===!0&&(this._textureUpdateNeeded=!1,this._instructionSet!==null&&super.refreshData(this._buffer,this._instructionSet,this._stepSize)),this._visible(h))}stitchBuffer(h,r){const o=new Uint8Array(h);let c=[Math.ceil(this._instructionSet.Size[0]*(r.Size.x/r.TotalSize.x)),Math.ceil(this._instructionSet.Size[1]*(r.Size.y/r.TotalSize.y)),Math.ceil(this._instructionSet.Size[2]*(r.Size.z/r.TotalSize.z))],u=[Math.floor(r.LocalOffset.x*(this._instructionSet.Size[0]/r.TotalSize.x)),Math.floor(r.LocalOffset.y*(this._instructionSet.Size[1]/r.TotalSize.y)),Math.floor(r.LocalOffset.z*(this._instructionSet.Size[2]/r.TotalSize.z))],g=r.Size.toArray(),m=Array.from(this._instructionSet.Size);const y=g[0]*g[1]*g[2];let x=m[0]*m[1]*m[2],w=u[0]+m[0]*u[1]+m[0]*m[1]*u[2],C=0;if(r.DataModified===!0)switch(r.NumChannels){case 1:for(let P=0;P<c[2];P++)for(let T=0;T<c[1];T++)for(let M=0;M<c[0];M++)C=Math.round((M+.5)*(g[0]/c[0])-.5)+g[0]*Math.round((T+.5)*(g[1]/c[1])-.5)+g[0]*g[1]*Math.round((P+.5)*(g[2]/c[2])-.5),this._buffer[M+m[0]*T+m[0]*m[1]*P+w]=o[C];break;case 2:for(let P=0;P<c[2];P++)for(let T=0;T<c[1];T++)for(let M=0;M<c[0];M++)C=Math.round((M+.5)*(g[0]/c[0])-.5)+g[0]*Math.round((T+.5)*(g[1]/c[1])-.5)+g[0]*g[1]*Math.round((P+.5)*(g[2]/c[2])-.5),this._buffer[M+m[0]*T+m[0]*m[1]*P+w]=o[C],this._buffer[M+m[0]*T+m[0]*m[1]*P+w+x]=o[C+y];break;case 3:for(let P=0;P<c[2];P++)for(let T=0;T<c[1];T++)for(let M=0;M<c[0];M++)C=Math.round((M+.5)*(g[0]/c[0])-.5)+g[0]*Math.round((T+.5)*(g[1]/c[1])-.5)+g[0]*g[1]*Math.round((P+.5)*(g[2]/c[2])-.5),this._buffer[(M+m[0]*T+m[0]*m[1]*P+w)*r.NumChannels]=o[C*r.NumChannels],this._buffer[(M+m[0]*T+m[0]*m[1]*P+w)*r.NumChannels+1]=o[C*r.NumChannels+1],this._buffer[(M+m[0]*T+m[0]*m[1]*P+w)*r.NumChannels+2]=o[C*r.NumChannels+2];break;case 4:for(let P=0;P<c[2];P++)for(let T=0;T<c[1];T++)for(let M=0;M<c[0];M++)C=Math.round((M+.5)*(g[0]/c[0])-.5)+g[0]*Math.round((T+.5)*(g[1]/c[1])-.5)+g[0]*g[1]*Math.round((P+.5)*(g[2]/c[2])-.5),this._buffer[(M+m[0]*T+m[0]*m[1]*P+w)*r.NumChannels]=o[C*r.NumChannels],this._buffer[(M+m[0]*T+m[0]*m[1]*P+w)*r.NumChannels+1]=o[C*r.NumChannels+1],this._buffer[(M+m[0]*T+m[0]*m[1]*P+w)*r.NumChannels+2]=o[C*r.NumChannels+2],this._buffer[(M+m[0]*T+m[0]*m[1]*P+w)*r.NumChannels+3]=o[C*r.NumChannels+3];break}if(r.OverlayDataModified===!0){let P=0,T=0;c=[Math.ceil(this._instructionSet.OverlaySize[0]*(r.Size.x/r.TotalSize.x)),Math.ceil(this._instructionSet.OverlaySize[1]*(r.Size.y/r.TotalSize.y)),Math.ceil(this._instructionSet.OverlaySize[2]*(r.Size.z/r.TotalSize.z))],u=[Math.floor(r.LocalOffset.x*(this._instructionSet.OverlaySize[0]/r.TotalSize.x)),Math.floor(r.LocalOffset.y*(this._instructionSet.OverlaySize[1]/r.TotalSize.y)),Math.floor(r.LocalOffset.z*(this._instructionSet.OverlaySize[2]/r.TotalSize.z))],g=r.Size.toArray(),m=Array.from(this._instructionSet.OverlaySize),x=m[0]*m[1]*m[2],w=u[0]+m[0]*u[1]+m[0]*m[1]*u[2],r.DataModified===!0&&(P=r.NumChannels*y,T=r.NumChannels*x);for(let M=0;M<c[2];M++)for(let z=0;z<c[1];z++)for(let Y=0;Y<c[0];Y++)C=Math.round((Y+.5)*(g[0]/c[0])-.5)+g[0]*Math.round((z+.5)*(g[1]/c[1])-.5)+g[0]*g[1]*Math.round((M+.5)*(g[2]/c[2])-.5),this._buffer[Y+m[0]*z+m[0]*m[1]*M+w+T]=o[C+P]}this._textureUpdateNeeded=!0}_clearBuffer(){this._textureUpdateNeeded=!1,this._buffer=null}_initBuffer(h,r){this._instructionSet=h,this._stepSize=r,this._buffer!==null&&(this._textureUpdateNeeded=!0),this._buffer=new Uint8Array(this._getBufferLength(h))}_clearTextures(){this._texture!==null&&this._texture.dispose(),this._isDataEmpty=!0,this._texture=null,this._mesh.material.uniforms.u_data.value=this._texture,this._overlayTexture!==null&&this._overlayTexture.dispose(),this._isOverlayEmpty=!0,this._overlayTexture=null,this._mesh.material.uniforms.u_overlayData.value=this._overlayTexture,this._alphaTexture!==null&&this._alphaTexture.dispose(),this._alphaTexture=null,this._mesh.material.uniforms.u_alphaData.value=this._alphaTexture}_initDepthMesh(h,r,o){}_lightScattering(){}_constructProperties(h,r){super._constructProperties(h,r),this._scale=new f.Vector3(1,1,1),this._priorScale=new f.Vector3(1,1,1),this._tform=new f.Matrix4,this._buffer=null,this._instructionSet=null,this._stepSize=null,this._textureUpdateNeeded=!1,this.stitchingNeeded=!1}_updateGeometry(h,r){super._updateGeometry(h,r),this._applyAdditionalTransformation(h)}_applyAdditionalTransformation(h){const r=Array.from(h.OverviewOffset),o=Array.from(h.OverviewScale),c=new f.Matrix4,u=new f.Matrix4;c.makeScale(o[0],o[1],o[2]),u.setPosition(r[0]+.5,r[1]+.5,r[2]+.5),this._matrix.makeTranslation(-.5,-.5,-.5),this._matrix.premultiply(c),this._matrix.premultiply(u),this._updateMatrix(this._tform)}_updateMatrix(h){this._tform.copy(h);const r=new f.Matrix4;r.multiplyMatrices(this._tform,this._matrix),this._mesh.matrix=r,this._depthMesh!==null&&(this._depthMesh.matrix=r,this._depthMesh.matrixWorldNeedsUpdate=!0),this._mesh.matrixWorldNeedsUpdate=!0}}},R,W),R.exports=I},1270:(R,W,d)=>{var O,I;O=[d(40),d(2588)],I=d.dj.d(O,function(f,N){return class extends N{constructor(h,r){super(h,r),this.info={id:-1,blockIndex:h,level:r.Level,index:r.Index,numBlocksToRead:1,outOfCore:!1,distance:1/0,numPoints:r.NumPoints}}load(h,r,o,c){const u=new Float32Array(h),g=Math.round(u.length/6);if(this._mesh===null){const m=new f.BufferGeometry;m.setAttribute("position",new f.Float32BufferAttribute(u.slice(0,g*3),3)),m.setAttribute("color",new f.Float32BufferAttribute(u.slice(g*3,u.length),3)),m.setDrawRange(0,g),m.computeBoundingBox(),this._mesh=new f.Points(m,r.material.clone()),this._mesh.material.vertexColors=!0,this._depthMesh=new f.Points(m,o.material.clone()),this._mesh.renderOrder=r.renderOrder,r.add(this._mesh),o.add(this._depthMesh)}else this._mesh.material.dispose(),this._depthMesh.material.dispose(),this._mesh.material=r.material.clone(),this._depthMesh.material=o.material.clone();this.memory=h.byteLength/1e6,this.loaded=!0,this.visible=!0}isInView(h,r,o,c){return r.intersectsSphere(this._sphere)&&!this._isCulled(c)?this.loaded?(this.visible=!0,!1):(h.isPerspectiveCamera?this.info.distance=h.position.distanceTo(this._sphere.center)/h.zoom:(this._sphere.center.sub(h.position).negate(),this.info.distance=o.dot(this._sphere.center)),!0):!1}isInViewCheck(h,r,o,c){return!!(r.intersectsSphere(this._sphere)&&!this._isCulled(c))}unload(){this._mesh!==null&&(this._mesh.geometry.dispose(),this._mesh.material.dispose(),this._mesh.geometry=null,this._mesh.parent.remove(this._mesh),this._mesh=null),this._depthMesh!==null&&(this._depthMesh.geometry.dispose(),this._depthMesh.material.dispose(),this._depthMesh.geometry=null,this._depthMesh.parent.remove(this._depthMesh),this._depthMesh=null),this.visible=!1,this.loaded=!1,this.memory=0}}},R,W),R.exports=I},2642:(R,W,d)=>{var O,I;O=[d(40),d(1600)],I=d.dj.d(O,function(f,N){return class extends N{constructor(h,r,o,c){super(h,r),this._pointBudget=o,this.numPointsToLoad=0,this._maxLevel=c}getNumPointsLoaded(){let h=0;for(let r=0;r<this._blocks.length;r++)this._blocks[r].loaded&&(h+=this._blocks[r].info.numPoints);return h}trimByPointBudget(h,r,o,c){let u=this.getNumPointsLoaded();for(;u>this._pointBudget;){const g=this._lru.getNext();this._blocks[g].isInViewCheck(h,r,o,c)&&this._blocks[g].weight>this.threshold?this._lru.put(this._blocks[g].info.blockIndex):this._blocks[g].unload(),u=u-this._blocks[g].info.numPoints}this._numPointsToLoad=0,console.log(this.getNumPointsLoaded())}stopLoadingByPointBudget(h){let r=!1;return this._numPointsToLoad=this._numPointsToLoad+this._blocksForLoading[h].numPoints,(this._numPointsToLoad>this._pointBudget||this._blocksForLoading[h].level>this._maxLevel)&&(this._blocksForLoading=[],r=!0),r}}},R,W),R.exports=I},1374:(R,W,d)=>{var O,I;O=[d(40),d(9242)],I=d.dj.d(O,function(f,N){return class extends N{add(h,r){this._count=-1;const o=this._emptyGeometry();this._initMesh(h,o),this.globalClippingPlanes(r.globalClippingPlanes,r.globalClipping),this._setProperties(h)}refreshData(h,r){const o=new Float32Array(h);if(this._isDataEmpty=o.length===0,this._memoryUsed=o.length*4/1e6,this._isDataEmpty===!0)this._mesh.geometry.dispose(),this._mesh.geometry=this._emptyGeometry();else{const c=r.ColorByVertex===!0?Math.round(o.length/6):Math.round(o.length/3);this._count===c&&r.ColorByVertex===this._mesh.geometry.hasAttribute("color")?this._mesh.geometry=this._updateGeometry(o,c,r):(this._mesh.geometry.dispose(),this._mesh.geometry=this._initGeometry(o,c,r))}this._depthMesh.geometry=this._mesh.geometry}pick(h,r,o,c,u,g){if(this._pickable&&this._mesh!==null&&this._mesh.visible&&!this._clipped(o)){this._mesh.geometry.boundingSphere===null&&this._mesh.geometry.computeBoundingSphere();const m=this._mesh.geometry.boundingSphere.clone(),y=new f.Vector3,x=new f.Vector3,w=new f.Matrix4().copy(this._mesh.matrixWorld).invert(),C=h.camera.position.clone().applyMatrix4(w);let P=Number.MAX_SAFE_INTEGER,T,M=1,z=!1,Y=this._mesh.material.size;if(this._mesh.material.sizeAttenuation||(Y=Math.max(1.5*Y,4),h.camera.type==="OrthographicCamera"?Y*=m.radius/(Math.min(u.width,u.height)*h.camera.zoom):(z=!0,Y*=Math.tan(h.camera.fov*Math.PI/360)/(u.height*h.camera.zoom))),m.applyMatrix4(this._mesh.matrixWorld),m.radius+=this._mesh.material.size,h.ray.intersectsSphere(m)===!1)return;Y=Y/((this._mesh.scale.x+this._mesh.scale.y+this._mesh.scale.z)/3);const X=Y*Y;let S=!1,F=-1,k=this._mesh.geometry.attributes.position.count;k>this._dataStriding&&this._stridingFactor>1&&(k=Math.ceil(k/this._stridingFactor));for(let G=0;G<k;G++)y.fromBufferAttribute(this._mesh.geometry.attributes.position,G),z&&(M=C.distanceToSquared(y)),T=y.distanceToSquared(o),T<X*M&&(S=!0,T<P&&(P=T,F=G));S&&(x.fromBufferAttribute(this._mesh.geometry.attributes.position,F).applyMatrix4(this._mesh.matrixWorld),P=x.distanceTo(o),r.push({point:x.toArray(),distance:P,object:g,picked:!0,id:F}))}}_constructProperties(h,r){super._constructProperties(h,r),this._setCustomCode()}_emptyGeometry(){const h=new f.BufferGeometry;return h.setAttribute("position",new f.Float32BufferAttribute([],3)),h.setAttribute("color",new f.Float32BufferAttribute([],3)),this._count=0,h.computeBoundingBox(),h}_initGeometry(h,r,o){const c=new f.BufferGeometry;return o.ColorByVertex?(c.setAttribute("position",new f.Float32BufferAttribute(h.slice(0,r*3),3)),c.setAttribute("color",new f.Float32BufferAttribute(h.slice(r*3,h.length),3))):c.setAttribute("position",new f.Float32BufferAttribute(h,3)),this._count=r,this._shuffle(c,o.ColorByVertex),c.setDrawRange(0,this._count),c.computeBoundingBox(),c}_updateGeometry(h,r,o){const c=this._mesh.geometry,u=c.getAttribute("position");if(u.copyArray(h.slice(0,r*3)),u.needsUpdate=!0,o.ColorByVertex){const g=c.getAttribute("color");g.copyArray(h.slice(r*3,h.length)),g.needsUpdate=!0}return this._shuffle(c,o.ColorByVertex),c.computeBoundingBox(),c}_shuffle(h,r){if(h.attributes.position.count>this._dataStriding&&this._stridingFactor>1){const o=h.attributes.position.count,c=Math.ceil(o/this._stridingFactor);let u,g,m,y,x;if(r===!0)for(u=0;u<c;u++)g=Math.floor(Math.random()*(o-u))+u,m=h.attributes.position.array[u*3],y=h.attributes.position.array[u*3+1],x=h.attributes.position.array[u*3+2],h.attributes.position.array[u*3]=h.attributes.position.array[g*3],h.attributes.position.array[u*3+1]=h.attributes.position.array[g*3+1],h.attributes.position.array[u*3+2]=h.attributes.position.array[g*3+2],h.attributes.position.array[g*3]=m,h.attributes.position.array[g*3+1]=y,h.attributes.position.array[g*3+2]=x,m=h.attributes.color.array[u*3],y=h.attributes.color.array[u*3+1],x=h.attributes.color.array[u*3+2],h.attributes.color.array[u*3]=h.attributes.color.array[g*3],h.attributes.color.array[u*3+1]=h.attributes.color.array[g*3+1],h.attributes.color.array[u*3+2]=h.attributes.color.array[g*3+2],h.attributes.color.array[g*3]=m,h.attributes.color.array[g*3+1]=y,h.attributes.color.array[g*3+2]=x;else for(u=0;u<c;u++)g=Math.floor(Math.random()*(o-u))+u,m=h.attributes.position.array[u*3],y=h.attributes.position.array[u*3+1],x=h.attributes.position.array[u*3+2],h.attributes.position.array[u*3]=h.attributes.position.array[g*3],h.attributes.position.array[u*3+1]=h.attributes.position.array[g*3+1],h.attributes.position.array[u*3+2]=h.attributes.position.array[g*3+2],h.attributes.position.array[g*3]=m,h.attributes.position.array[g*3+1]=y,h.attributes.position.array[g*3+2]=x}}updateOnInteraction(h){h&&this._mesh.geometry.attributes.position.count>this._dataStriding&&this._stridingFactor>1?(this._mesh.geometry.setDrawRange(0,Math.ceil(this._mesh.geometry.attributes.position.count/this._stridingFactor)),this._mesh.material.size=this._stridePointSize,this._depthMesh.material.size=this._stridePointSize):(this._mesh.geometry.setDrawRange(0,this._count),this._setPointSize(this._pointSize))}_constructMesh(h,r,o){this._mesh=new f.Points(h,this._initMaterial(!1,r,o)),this._depthMesh=new f.Points(h,this._initMaterial(!0,r,o))}_initMaterial(h,r,o){const c=new f.PointsMaterial({color:o,opacity:r.Alpha,transparent:!0,depthTest:!0,depthWrite:!0,premultipliedAlpha:h,clipIntersection:this._clipIntersection,side:f.DoubleSide});return c.size=r.PointSize,h?(c.blending=f.NoBlending,c.onBeforeCompile=this._addDepthToShader.bind(this)):c.onBeforeCompile=this._addPeelToShader.bind(this),c.customProgramCacheKey=this._setProgramCacheKey.bind(this),c}_setMaterialColor(h,r){h?this._mesh.material.color=new f.Color(1,1,1):this._mesh.material.color=r,this._mesh.material.vertexColors=h,this._mesh.material.needsUpdate=!0}_setPointSize(h){this._mesh.material.size=h,this._depthMesh.material.size=h,this._pointSize=h}_setCustomCode(){this._customCode=`
                float dist = length(2.0 * gl_PointCoord - 1.0);
                if (dist > 1.0) {
                    discard;
                }`}_attenuateSize(h){const r=this._mesh.material.sizeAttenuation!==h;this._mesh.material.sizeAttenuation=h,this._depthMesh.material.sizeAttenuation=h,r===!0&&(this._mesh.material.needsUpdate=!0,this._depthMesh.material.needsUpdate=!0)}_setProperties(h){this._dataStriding=h.DataStriding,this._stridingFactor=h.StridingFactor,this._stridePointSize=h.StridePointSize,this._mesh.material.opacity=h.Alpha;const r=this._initColor(Array.from(h.Color));this._colorStyle(h.ColorByVertex,r),this._setPointSize(h.PointSize),this._attenuateSize(h.AttenuateSize),this._setPickable(h.Pickable),this._setLayer(h.Layer),this._visible(h.Visible),this._transform(Array.from(h.Transform)),this.localClippingPlanes(h.ClippingPlanes)}}},R,W),R.exports=I},562:(R,W,d)=>{var O,I;O=[],I=d.dj.d(O,function(){return class{constructor(){this.heap=[]}getLeftChildIndex(N){return 2*N+1}getRightChildIndex(N){return 2*N+2}getParentIndex(N){return Math.floor((N-1)/2)}hasLeftChild(N){return this.getLeftChildIndex(N)<this.heap.length}hasRightChild(N){return this.getRightChildIndex(N)<this.heap.length}hasParent(N){return this.getParentIndex(N)>=0}leftChild(N){return this.heap[this.getLeftChildIndex(N)]}rightChild(N){return this.heap[this.getRightChildIndex(N)]}parent(N){return this.heap[this.getParentIndex(N)]}swap(N,b){const h=this.heap[N];this.heap[N]=this.heap[b],this.heap[b]=h}peek(){return this.heap.length===0?null:this.heap[0]}peekBottom(){return this.heap.length===0?null:this.heap[this.heap.length-1]}removeBottom(){return this.heap.length===0?null:this.heap.length===1?this.heap.pop():this.heap.pop()}pop(){if(this.heap.length===0)return null;if(this.heap.length===1)return this.heap.pop();const N=this.heap[0];return this.heap[0]=this.heap.pop(),this.heapifyDown(),N}push(N){this.heap.push(N),this.heapifyUp()}heapifyUp(){let N=this.heap.length-1;for(;this.hasParent(N)&&(this.parent(N).level>this.heap[N].level||this.parent(N).level===this.heap[N].level&&this.parent(N).weight<this.heap[N].weight);){const b=this.getParentIndex(N);this.swap(b,N),N=b}}heapifyDown(){let N=0;for(;this.hasLeftChild(N);){let b=this.getLeftChildIndex(N);if(this.hasRightChild(N)&&(this.rightChild(N).level<this.leftChild(N).level||this.rightChild(N).level===this.leftChild(N).level&&this.rightChild(N).weight>this.leftChild(N).weight)&&(b=this.getRightChildIndex(N)),this.heap[N].level<this.heap[b].level||this.heap[N].level===this.heap[b].level&&this.heap[N].weight>this.heap[b].weight)break;this.swap(N,b),N=b}}length(){return this.heap.length}clear(){this.heap=[]}}},R,W),R.exports=I},9242:(R,W,d)=>{var O,I;O=[d(40),d(1082)],I=d.dj.d(O,function(f,N){return class extends N{refreshData(h,r){const o=new Float32Array(h);this._isDataEmpty=o.length===0,this._memoryUsed=o.length*4/1e6,this._mesh.geometry.dispose();const c=r.ColorByVertex===!0?Math.round(o.length/2):Math.round(o.length),u=this._initGeometry(o,c,r.ColorByVertex);this._mesh.geometry=u,this._depthMesh.geometry=u}add(h,r){const o=this._initGeometry([],0,h.ColorByVertex);this._rendererType(h,h.Wireframe),this._initMesh(h,o),this.globalClippingPlanes(r.globalClippingPlanes,r.globalClipping),this._setProperties(h)}getMemoryUsed(){return this._memoryUsed}globalClippingPlanes(h,r){this._localClipping=!r,r?(this._mesh.material.clippingPlanes=h,this._depthMesh.material.clippingPlanes=h):(this._mesh.material.clippingPlanes=this._clippingPlanes,this._depthMesh.material.clippingPlanes=this._clippingPlanes)}clipIntersection(h){this._clipIntersection=h,this._mesh.material.clipIntersection=h,this._depthMesh.material.clipIntersection=h}crop(h,r){this._cropExclude=h,this._numCropBoxes=r===!0?1:0,this._mesh.material.needsUpdate=!0,this._depthMesh.material.needsUpdate=!0}colorInBox(h){this._colorInBox=h,this._mesh.material.needsUpdate=!0}_constructProperties(h,r){this._renderingStyle=0,this._wireframe=!1,this._colorByVertex=!1,this._clipIntersection=r.clipIntersection,this._clippingPlanes=Object.freeze([]),this._customCode="",this._memoryUsed=0}_rendererType(h,r){const o=this._renderingStyle;this._wireframe=r,r===!0?this._renderingStyle=1:this._renderingStyle=0,this._mesh!==null&&(this._renderingStyle!==o&&this._initMesh(h,this._mesh.geometry),this._renderingStyle===1&&(this._mesh.material.wireframe=this._wireframe,this._depthMesh.material.wireframe=this._wireframe))}_initMesh(h,r){let o=null;this._mesh!==null&&(this._scene.remove(this._mesh,this._depthMesh),o=this._mesh.material.clippingPlanes,this._mesh.material.dispose(),this._depthMesh.material.dispose());const c=this._initColor(Array.from(h.Color));this._constructMesh(r,h,c),this._setMaterialColor(this._colorByVertex,c),this._mesh.material.vertexColors=this._colorByVertex,this._mesh.visible=h.Visible,this._mesh.matrixAutoUpdate=!1,this._mesh.matrix=this._initTransform(Array.from(h.Transform)),this._scene.add(this._mesh),this._depthMesh.visible=h.Visible,this._depthMesh.matrixAutoUpdate=!1,this._depthMesh.matrix=this._initTransform(Array.from(h.Transform)),this._depthScene.add(this._depthMesh),o!==null&&(this._mesh.material.clippingPlanes=o,this._depthMesh.material.clippingPlanes=o)}_constructMesh(h,r,o){switch(this._renderingStyle){case 0:this._mesh=new f.Mesh(h,this._initMaterial(!1,r,o)),this._depthMesh=new f.Mesh(h,this._initMaterial(!0,r,o));break;case 1:this._mesh=new f.Mesh(h,this._initMaterial(!1,r,o)),this._depthMesh=new f.Mesh(h,this._initMaterial(!0,r,o));break}}_initMaterial(h,r,o){let c;switch(this._renderingStyle){case 0:c=new f.MeshStandardMaterial({color:o,emissive:o,opacity:r.Alpha,transparent:!0,premultipliedAlpha:h,depthTest:!0,depthWrite:!0,clipIntersection:this._clipIntersection,side:f.DoubleSide});break;case 1:c=new f.MeshBasicMaterial({color:o,opacity:r.Alpha,transparent:!0,wireframe:this._wireframe,premultipliedAlpha:h,depthTest:!0,depthWrite:!0,clipIntersection:this._clipIntersection,side:f.DoubleSide});break}return h?(c.blending=f.NoBlending,c.onBeforeCompile=this._addDepthToShader.bind(this)):c.onBeforeCompile=this._addPeelToShader.bind(this),c.customProgramCacheKey=this._setProgramCacheKey.bind(this),c}_colorStyle(h,r){h===!1&&(this._mesh.material.color=r),this._colorByVertex!==h&&(this._setMaterialColor(h,r),this._colorByVertex=h)}_setMaterialColor(h,r){h?(this._mesh.material.color=new f.Color(1,1,1),this._renderingStyle===0&&(this._mesh.material.emissive=new f.Color(0,0,0))):(this._mesh.material.color=r,this._renderingStyle===0&&(this._mesh.material.emissive=new f.Color(0,0,0))),this._mesh.material.vertexColors=h,this._mesh.material.needsUpdate=!0}_specular(h,r){this._renderingStyle===0&&(this._mesh.material.roughness=1-h,this._mesh.material.metalness=r)}_setProperties(h){this._mesh.material.opacity=h.Alpha;const r=this._initColor(Array.from(h.Color));this._rendererType(h,h.Wireframe,h.Points),this._colorStyle(h.ColorByVertex,r),this._visible(h.Visible),this._specular(h.Shininess,h.Metalness),this._transform(Array.from(h.Transform)),this.localClippingPlanes(h.ClippingPlanes),this._setLayer(h.Layer)}_initGeometry(h,r,o){const c=new f.BufferGeometry;return o?(c.setAttribute("position",new f.Float32BufferAttribute(h.slice(0,r),3)),c.setAttribute("color",new f.Float32BufferAttribute(h.slice(r,h.length),3))):c.setAttribute("position",new f.Float32BufferAttribute(h,3)),c.computeBoundingBox(),c.computeVertexNormals(),c}localClippingPlanes(h){this._initPlanes(h),this._localClipping&&(this._mesh.material.clippingPlanes=this._clippingPlanes,this._depthMesh.material.clippingPlanes=this._clippingPlanes)}_addDepthToShader(h){this._compileCustomCode(h,`if (u_passNumber == 2 ) {
                float prevDepth = texture( u_previousTexture, gl_FragCoord.xy / u_viewportSize ).x;
                if (gl_FragCoord.z < prevDepth + TOLERANCE ){
                    discard;
                }
            }
            gl_FragColor = packDepthToRGBA(gl_FragCoord.z);
            }`)}_addPeelToShader(h){this._compileCustomCode(h,`if (u_passNumber == 1 ) {
                    float priorDepth = texture( u_depthTexture, gl_FragCoord.xy / u_viewportSize ).x;
                    float accumulatedDepth = texture( u_previousTexture, gl_FragCoord.xy / u_viewportSize ).x;

                    // Should be between current depth and previous depth to be included
                    if (gl_FragCoord.z > priorDepth + TOLERANCE  || gl_FragCoord.z < accumulatedDepth + TOLERANCE ) {
                        discard;
                    }
                }
            }`)}_compileCustomCode(h,r){this._setGlobalUniforms(h.uniforms);const o=this._numCropBoxes>0||this._colorInBox===!0?"varying vec3 v_worldCoords;":"",c=this._numCropBoxes>0?`uniform vec3 u_cropMin;
            uniform vec3 u_cropMax;
            uniform vec3 u_cropCenter;
            uniform float u_cropRadius;
            uniform float u_cropHeight;`:"",u=this._colorInBox===!0?`uniform mat4 u_colorBoxMatrix;
            uniform vec3 u_colorBoxColor;`:"",g=h.fragmentShader.includes("<packing>")===!0?"":"#include <packing>";h.fragmentShader=[g,o,c,u,`#define TOLERANCE 0.000001
                uniform vec2 u_viewportSize;
                uniform sampler2D u_depthTexture;
                uniform sampler2D u_previousTexture;
                uniform int u_passNumber;
                ${h.fragmentShader}`].join(`
`);let m="",y="";this._colorInBox===!0&&(m=`vec4 pos = u_colorBoxMatrix * vec4(v_worldCoords, 1.0);
                vec3 s = step(vec3(-0.5), pos.xyz) - step(vec3(0.5), pos.xyz);
                if ((s.x * s.y * s.z) > 0.0) {
                    gl_FragColor.rgb = u_colorBoxColor;
                }`),this._numCropBoxes>0&&(this._cropExclude===!0?(this._globalData.cropType==="box"&&(y=`vec3 s = step(u_cropMin, v_worldCoords) - step(u_cropMax, v_worldCoords);
                        if (s.x * s.y * s.z > 0.0) {
                            discard;
                        }`),this._globalData.cropType==="sphere"&&(y=`float distanceFromWorldCoordsToCenter = distance(v_worldCoords, u_cropCenter);
                        if (distanceFromWorldCoordsToCenter <= u_cropRadius) {
                            discard;
                        }`),this._globalData.cropType==="cylinder"&&(y=`float distanceXYPlane = distance(vec2(v_worldCoords.x, v_worldCoords.y), vec2(u_cropCenter.x, u_cropCenter.y));
                        float distanceZAxis = abs(v_worldCoords.z - u_cropCenter.z);
                        if (distanceXYPlane <= u_cropRadius && distanceZAxis <= (u_cropHeight / 2.0f)) {
                            discard;
                        }`)):(this._globalData.cropType==="box"&&(y=`vec3 s = step(u_cropMin, v_worldCoords) - step(u_cropMax, v_worldCoords);
                        if (1.0 - (s.x * s.y * s.z) > 0.0) {
                            discard;
                        }`),this._globalData.cropType==="sphere"&&(y=`float distanceFromWorldCoordsToCenter = distance(v_worldCoords, u_cropCenter);
                        if (distanceFromWorldCoordsToCenter > u_cropRadius) {
                            discard;
                        }`),this._globalData.cropType==="cylinder"&&(y=`float distanceXYPlane = distance(vec2(v_worldCoords.x, v_worldCoords.y), vec2(u_cropCenter.x, u_cropCenter.y));
                        float distanceZAxis = abs(v_worldCoords.z - u_cropCenter.z);
                        if (distanceXYPlane > u_cropRadius || distanceZAxis > (u_cropHeight / 2.0f)) {
                            discard;
                        }`)));const x=[this._customCode,m,y,r].join(`
`);h.fragmentShader=h.fragmentShader.replace(/}$/gm,x),h.vertexShader=`varying vec3 v_worldCoords; 
                ${h.vertexShader}`,h.vertexShader=h.vertexShader.replace(/}$/gm,`vec4 worldCoords = modelMatrix * vec4(position, 1.0);
                v_worldCoords = worldCoords.xyz;
            }`)}_setProgramCacheKey(){return this._numCropBoxes>0?this._cropExclude===!0?this._colorInBox===!0?"5":"2":this._colorInBox===!0?"4":"1":this._colorInBox===!0?"3":"0"}}},R,W),R.exports=I},2426:(R,W,d)=>{var O,I;O=[d(40),d(3375),d(2574),d(3460),d(3902),d(8554)],I=d.dj.d(O,function(f,N,b,h,r,o){return class extends f.EventDispatcher{constructor(u,g,m){super(),this.STATE={NONE:-1,ROTATE:0,ZOOMIN:1,ZOOMOUT:2,PAN:3,ANIMATE:4,SCISSORS:5,ANNOTATE:6,WINDOWLEVEL:7,SELECT:8},this.state=this.STATE.NONE,this._visible=!0,this._opaque=!1,this._enabled=!0,this.defaultTarget=new f.Vector3,this.defaultPosition=new f.Vector3,this.defaultUp=new f.Vector3(0,0,1),this.defaultCameraVector=new f.Vector3,this._enableAxes=!0,this._enableHome=!0,this.enableDefault=!0,this.defaultFit=!1,this._enableSelect=!1,this.objectInfo=!1,this.enableRotate=!0,this.rotateSpeed=4,this.rotateStyle=g.Rotate.Style,this.enableZoom=!0,this.zoomSpeed=2,this.dollySpeed=.4,this.zoomStyle=g.Zoom.Style,this.dollyStyle=g.Zoom.DollyStyle,this.zoomLimits=new f.Vector2(.001,5e5),this.preserveZoom=g.Zoom.PreserveOnResize,this.enablePan=!0,this.panSpeed=.5,this._enableClipping=!0,this._enableSlice=!0,this._allowClipping=!0,this._allowSlice=!0,this._showScissors=!0,this._showCrop=!0,this._allowCrop=!0,this._allowScissors=!0,this._animation=new N(g.Animate),this._enablePoint=!0,this._enableLine=!0,this._enableAngle=!0,this._enablePolygon=!0,this._enableCuboid=!0,this._annotateNumElements=2,this._annotateHeadliner="point",this._annotateChild="line",this._annotateShowDropdown=!1,this._annotateDropDownPosition=0,this._annotateNumToRight=0,this.maxAllowedClicks=0,this.enableWindowLevel=!0,this._allowWindowLevel=!0,this.windowLevelSpeed=1,this._augmentHeadliner=null,this._augmentDropDownPosition=0,this._augmentNumElements=0,this._toolbarNumElements=0,this._colorSum=1,this._tooltips=m,this._wireUpToolbarElements(u),this._message=new b(u),this._message.addEventListener("messageClosed",this._messageClosed.bind(this)),this.update(g)}update(u){this._animation.update(u.Animate),this.defaultCameraVector.set(u.Default.CameraVector[0],u.Default.CameraVector[1],u.Default.CameraVector[2]),this.rotateStyle=u.Rotate.Style,this.zoomStyle=u.Zoom.Style,this.dollyStyle=u.Zoom.DollyStyle,this.zoomLimits.set(u.Zoom.Limits[0],u.Zoom.Limits[1]),this.preserveZoom=u.Zoom.PreserveOnResize,this._visible=u.Toolbar,this.state=u.CurrentMode,this.enableRotate=u.Rotate.Enabled,this.enableZoom=u.Zoom.Enabled,this.enablePan=u.Pan.Enabled,this.enableDefault=u.Default.Enabled,this._enableAxes=u.Default.SnapToAxes,this.defaultFit=u.Default.Fit,this._enableSelect=u.Select.Enabled,this.objectInfo=u.Select.ObjectInfo,this._enableClipping=u.Clipping.Add&&u.Clipping.Enabled,this._enableSlice=u.Slice.Add&&u.Slice.Enabled,this.enableWindowLevel=u.WindowLevel.Enabled,this._showCrop=u.Crop.Visible,this._showAnnotate=u.Annotate.Visible,u.Annotate.Style==="default"?(this.annotateStyle=this._annotateHeadliner,this._annotateShowDropdown=!0):(this.annotateStyle=u.Annotate.Style,this._annotateShowDropdown=!1),this._showScissors=u.Scissors.Visible&&this.annotateStyle!=="scissors",this.zoomStyle==="dolly"?(this._zoomInElement.style.backgroundSize="0px 0px, 20px 20px",this._zoomOutElement.style.backgroundSize="0px 0px, 20px 20px",this._zoomInTooltip.content={text:this._tooltips[8]},this._zoomOutTooltip.content={text:this._tooltips[7]}):(this._zoomInElement.style.backgroundSize="20px 20px, 0px 0px",this._zoomOutElement.style.backgroundSize="20px 20px, 0px 0px",this._zoomInTooltip.content={text:this._tooltips[3]},this._zoomOutTooltip.content={text:this._tooltips[2]}),this._updateMessage(u.Message),this._updateAnnotateButton(),this._updateToolbar()}clearState(){this.updateState(this.STATE.NONE),this._showInternal()}show(){this._opaque||!this._enabled||!this._visible||this._message.visible||(this._opaque=!0,this._showInternal())}hide(){this._opaque=!1,this._hideInternal()}hideMessage(){this._message.hide(),this.show()}contextualUpdate(u,g,m,y){this._allowClipping=u,this._allowSlice=g;const x=this._allowWindowLevel;this._allowWindowLevel=y;const w=this._allowScissors;this._allowScissors=m,this._allowScissors!==w?(this.state===this.STATE.SCISSORS&&this.updateState(this.STATE.NONE),this._updateToolbar()):this._allowWindowLevel!==x?(this.state===this.STATE.WINDOWLEVEL&&this.updateState(this.STATE.NONE),this._updateToolbar()):(this._updateAugmentHeadliner(),this._hideAugmentDropDown(),this._toolbarNumElements===0&&this._updateToolbar())}updateCrop(u){const g=this._allowCrop;this._allowCrop=!u,this._allowCrop!==g&&(this._updateAugmentHeadliner(),this._hideAugmentDropDown()),this._toolbarNumElements===0&&this._updateToolbar()}resize(u){this._message.resize(u)}setColor(u){this._colorSum=u[0]+u[1]+u[2],this._colorSum>2?r.setTheme(o.LIGHT):r.setTheme(o.DARK),this._message.setColor(this._colorSum),this._rotateElement.style.filter=this._colorSum>2?"invert(0%)":"invert(100%)",this._panElement.style.filter=this._colorSum>2?"invert(0%)":"invert(100%)",this._zoomInElement.style.filter=this._colorSum>2?"invert(0%)":"invert(100%)",this._zoomOutElement.style.filter=this._colorSum>2?"invert(0%)":"invert(100%)",this._homeElement.style.filter=this._colorSum>2?"invert(0%)":"invert(100%)",this._clippingElement.style.filter=this._colorSum>2?"invert(0%)":"invert(100%)",this._sliceElement.style.filter=this._colorSum>2?"invert(0%)":"invert(100%)",this._cropElement.style.filter=this._colorSum>2?"invert(0%)":"invert(100%)",this._scissorsElement.style.filter=this._colorSum>2?"invert(0%)":"invert(100%)",this._windowLevelElement.style.filter=this._colorSum>2?"invert(0%)":"invert(100%)",this._selectElement.style.filter=this._colorSum>2?"invert(0%)":"invert(100%)",this._annotateElement.style.filter=this._colorSum>2?"invert(0%)":"invert(100%)",this._annotateDropDownChild.style.filter=this._colorSum>2?"invert(0%)":"invert(100%)",this._augmentArrow.style.filter=this._colorSum>2?"invert(0%)":"invert(100%)",this._annotateArrow.style.filter=this._colorSum>2?"invert(0%)":"invert(100%)",this._xAxisElement.style.color=this._colorSum<.7||this._colorSum>2?"#B7312C":"#FF7A74",this._yAxisElement.style.color=this._colorSum<.7||this._colorSum>2?"#008013":"#94EF84",this._zAxisElement.style.color=this._colorSum<.7||this._colorSum>2?"#1656A7":"#54B6FF",this._toolbarBackgroundElement.style.backgroundColor=this._colorSum>2?"white":"black",this._augmentBackgroundElement.style.backgroundColor=this._colorSum>2?"white":"black",this._annotateBackgroundElement.style.backgroundColor=this._colorSum>2?"white":"black"}enable(){this._enabled=!0}disable(){this.hide(),this._enabled=!1}interruptAnimation(){this._animation.interruptible===!0&&this.updateState(this.STATE.NONE)}setNextFrame(u,g,m){this._animation.running===!0&&this._animation.setNextFrame(u,g,m)}updateState(u){this.state=u,this.dispatchEvent({type:"modeChanged",message:this.state}),this._makeAxisLabelsPickable()}isStateZoomable(){return this.state===this.STATE.NONE||this.state===this.STATE.ROTATE||this.state===this.STATE.PAN||this.state===this.STATE.WINDOWLEVEL||this.state===this.STATE.SELECT||this.isStateAnnotatable()}isStateHittable(){return this.state===this.STATE.NONE||this.isStateAnnotatable()}isStateAnnotatable(){return this.state===this.STATE.ANNOTATE}isStateDepthable(){return this.objectInfo===!0||this.state===this.STATE.SELECT||this.isStateAnnotatable()}_updateToolbar(){let u=0;this._toolbarNumElements=0,this._visible?(this.hide(),this._message.enabled?(this._messageElement.style.right=u+"px",this._messageElement.style.pointerEvents="auto",this._messageElement.style.opacity=.9,u=u+22,this._toolbarNumElements+=1):(this._messageElement.style.visibility="hidden",this._messageElement.style.pointerEvents="none"),this.enableRotate||this.enableZoom||this.enablePan?(this._enableHome=!0,this._homeElement.style.right=u+"px",this._homeElement.style.visibility="visible",this._homeElement.style.pointerEvents="auto",u=u+22,this._toolbarNumElements+=1):(this._enableHome=!1,this._homeElement.style.visibility="hidden",this._homeElement.style.pointerEvents="none"),this.enableZoom?(this._zoomOutElement.style.right=u+"px",u=u+22,this._zoomInElement.style.right=u+"px",u=u+22,this._zoomInElement.style.visibility="visible",this._zoomOutElement.style.visibility="visible",this._zoomInElement.style.pointerEvents="auto",this._zoomOutElement.style.pointerEvents="auto",this._toolbarNumElements+=2):(this._zoomOutElement.style.visibility="hidden",this._zoomInElement.style.visibility="hidden",this._zoomOutElement.style.pointerEvents="none",this._zoomInElement.style.pointerEvents="none"),this.enablePan?(this._panElement.style.right=u+"px",this._panElement.style.visibility="visible",this._panElement.style.pointerEvents="auto",u=u+22,this._toolbarNumElements+=1):(this._panElement.style.visibility="hidden",this._panElement.style.pointerEvents="none"),this.enableRotate?(this._rotateElement.style.right=u+"px",this._rotateElement.style.visibility="visible",this._rotateElement.style.pointerEvents="auto",u=u+22,this._toolbarNumElements+=1):(this._rotateElement.style.visibility="hidden",this._rotateElement.style.pointerEvents="none"),this._enableSelect?(this._selectElement.style.right=u+"px",this._selectElement.style.visibility="visible",this._selectElement.style.pointerEvents="auto",u=u+22,this._toolbarNumElements+=1):(this._selectElement.style.visibility="hidden",this._selectElement.style.pointerEvents="none"),this._showAnnotate?(this._updateAnnotateDropdown(u),u=u+22,this._toolbarNumElements+=1):(this._annotateElement.style.visibility="hidden",this._annotateElement.style.pointerEvents="none"),this._augmentDropDownPosition=u,this._augmentElement.style.right=this._augmentDropDownPosition+"px",this._updateAugmentHeadliner(),this._hideAugmentDropDown(),this._hideAnnotateDropDown(),this._makeAxisLabelsPickable(),this._opaque===!0?this.show():this.hide()):(this._homeElement.style.visibility="hidden",this._zoomOutElement.style.visibility="hidden",this._zoomInElement.style.visibility="hidden",this._panElement.style.visibility="hidden",this._rotateElement.style.visibility="hidden",this._clippingElement.style.visibility="hidden",this._sliceElement.style.visibility="hidden",this._cropElement.style.visibility="hidden",this._scissorsElement.style.visibility="hidden",this._windowLevelElement.style.visibility="hidden",this._selectElement.style.visibility="hidden",this._annotateElement.style.visibility="hidden",this._augmentArrow.style.visibility="hidden",this._messageElement.style.visibility="hidden")}_updateElement(u,g,m,y){return m?(g!==u&&(u.style.top=y+"px",y=y+22),u.style.visibility="visible",u.style.pointerEvents="auto"):(u.style.visibility="hidden",u.style.pointerEvents="none"),y}_updateAugmentHeadliner(){let u=0;this.state===this.STATE.SCISSORS||this.state===this.STATE.WINDOWLEVEL?(this._augmentHeadliner=this.state===this.STATE.SCISSORS?this._scissorsElement:this._windowLevelElement,this._augmentHeadliner.style.top=u+"px",u=u+22):(this._augmentHeadliner=null,this._allowSlice?this._enableSlice&&(this._augmentHeadliner=this._sliceElement,this._sliceElement.style.top=u+"px",u=u+22):this._showScissors&&this._allowScissors?(this._augmentHeadliner=this._scissorsElement,this._scissorsElement.style.top=u+"px",u=u+22):this._enableClipping&&this._allowClipping?(this._augmentHeadliner=this._clippingElement,this._clippingElement.style.top=u+"px",u=u+22):this._showCrop&&this._allowCrop?(this._augmentHeadliner=this._cropElement,this._cropElement.style.top=u+"px",u=u+22):this.enableWindowLevel&&this._allowWindowLevel&&(this._augmentHeadliner=this._windowLevelElement,this._windowLevelElement.style.top=u+"px",u=u+22)),u=this._updateElement(this._sliceElement,this._augmentHeadliner,this._enableSlice&&this._allowSlice,u),u=this._updateElement(this._scissorsElement,this._augmentHeadliner,this._showScissors&&this._allowScissors&&!this._allowSlice,u),u=this._updateElement(this._clippingElement,this._augmentHeadliner,this._enableClipping&&this._allowClipping&&!this._allowSlice,u),u=this._updateElement(this._cropElement,this._augmentHeadliner,this._showCrop&&this._allowCrop&&!this._allowSlice,u),u=this._updateElement(this._windowLevelElement,this._augmentHeadliner,this.enableWindowLevel&&this._allowWindowLevel,u),this._augmentNumElements=u/22,this._augmentNumElements>1?(this._augmentBackgroundElement.style.top="28px",this._augmentBackgroundElement.style.height=u-28+"px",this._toolbarElement.style.width=(this._toolbarNumElements+1)*22+"px"):this._augmentNumElements===1?(this._augmentBackgroundElement.style.top="28px",this._augmentBackgroundElement.style.height="0px",this._toolbarElement.style.width=(this._toolbarNumElements+1)*22+"px"):(this._augmentBackgroundElement.style.top="28px",this._augmentBackgroundElement.style.height="0px",this._toolbarElement.style.width=this._toolbarNumElements*22+"px")}_updateAnnotateDropdown(u){this._annotateElement.style.visibility="visible",this._annotateElement.style.pointerEvents="auto",this._annotateDropdownElement.style.right=u+"px",this._annotateDropDownChild.style.top="22px",this._annotateBackgroundElement.style.top="28px",this._annotateBackgroundElement.style.height="16px"}_showInternal(){this._message.enabled&&!this._message.visible&&(this._messageElement.style.visibility="visible"),this.enableRotate&&(this._rotateElement.style.opacity=.5,this._rotateElement.style.pointerEvents="auto"),this.enablePan&&(this._panElement.style.opacity=.5,this._panElement.style.pointerEvents="auto"),this.enableZoom&&(this._zoomInElement.style.opacity=.5,this._zoomInElement.style.pointerEvents="auto",this._zoomOutElement.style.opacity=.5,this._zoomOutElement.style.pointerEvents="auto"),this._enableHome&&(this._homeElement.style.opacity=.5,this._homeElement.style.pointerEvents="auto"),this._enableSelect&&(this._selectElement.style.opacity=.5,this._selectElement.style.pointerEvents="auto"),this._showAnnotate&&(this._annotateElement.style.opacity=.5,this._annotateElement.style.pointerEvents="auto",this._annotateShowDropdown?this._annotateArrow.style.opacity=.5:this._annotateArrow.style.opacity=0),this._augmentHeadliner!==null&&(this._augmentHeadliner.style.opacity=.5,this._augmentHeadliner.style.pointerEvents="auto",this._augmentNumElements>1&&(this._augmentArrow.style.opacity=.5)),(this._toolbarNumElements>0||this._augmentNumElements>0)&&(this._toolbarBackgroundElement.style.visibility="visible"),this._setSelectedOpacity()}_hideInternal(){this._message.visible&&(this._messageElement.style.visibility="hidden"),this.enableRotate&&(this._rotateElement.style.opacity=0,this._rotateElement.style.pointerEvents="none"),this.enablePan&&(this._panElement.style.opacity=0,this._panElement.style.pointerEvents="none"),this.enableZoom&&(this._zoomInElement.style.opacity=0,this._zoomInElement.style.pointerEvents="none",this._zoomOutElement.style.opacity=0,this._zoomOutElement.style.pointerEvents="none"),this._enableHome&&(this._homeElement.style.opacity=0,this._homeElement.style.pointerEvents="none"),this._enableSelect&&(this._selectElement.style.opacity=0,this._selectElement.style.pointerEvents="none"),this._showAnnotate&&(this._annotateElement.style.opacity=0,this._annotateElement.style.pointerEvents="none"),this._toolbarBackgroundElement.style.visibility="hidden",this._hideAugmentDropDown(),this._hideAnnotateDropDown(),this._augmentHeadliner!==null&&(this._augmentHeadliner.style.opacity=0,this._augmentHeadliner.style.pointerEvents="none"),this._augmentArrow.style.opacity=0,this._annotateArrow.style.opacity=0}_makeAxisLabelsPickable(){const u=this._enableAxes&&this.state!==this.STATE.ANIMATE?"visible":"none";this._xAxisElement.style.pointerEvents=u,this._yAxisElement.style.pointerEvents=u,this._zAxisElement.style.pointerEvents=u}_setSelectedOpacity(){switch(this.state){case 0:this._rotateElement.style.opacity=1;break;case 1:this._zoomInElement.style.opacity=1;break;case 2:this._zoomOutElement.style.opacity=1;break;case 3:this._panElement.style.opacity=1;break;case 5:this.annotateStyle==="scissors"?this._annotateElement.style.opacity=1:this._scissorsElement.style.opacity=1;break;case 6:this._annotateElement.style.opacity=1;break;case 7:this._windowLevelElement.style.opacity=1;break;case 8:this._selectElement.style.opacity=1;break;default:break}}_homeClicked(){this.state===this.STATE.ANIMATE&&this.updateState(this.STATE.NONE),this.dispatchEvent({type:"homeClicked"})}_messageClicked(){this._message.show(),this.hide()}_rotateClicked(){this.updateState(this.state===this.STATE.ROTATE?this.STATE.NONE:this.STATE.ROTATE),this._showInternal()}_panClicked(){this.updateState(this.state===this.STATE.PAN?this.STATE.NONE:this.STATE.PAN),this._showInternal()}_zoomInClicked(){this.updateState(this.state===this.STATE.ZOOMIN?this.STATE.NONE:this.STATE.ZOOMIN),this._showInternal()}_zoomOutClicked(){this.updateState(this.state===this.STATE.ZOOMOUT?this.STATE.NONE:this.STATE.ZOOMOUT),this._showInternal()}_clippingClicked(){this.updateState(this.STATE.NONE),this._hideAugmentDropDown(),this._showInternal(),this.dispatchEvent({type:"widgetAdded",name:"ClippingPlaneAdded"})}_sliceClicked(){this.updateState(this.STATE.NONE),this._hideAugmentDropDown(),this._showInternal(),this.dispatchEvent({type:"widgetAdded",name:"SlicePlaneAdded"})}_cropClicked(){this.updateState(this.STATE.NONE),this._hideAugmentDropDown(),this._showInternal(),this.dispatchEvent({type:"widgetAdded",name:"CropBoxAdded"})}_scissorsClicked(){this.updateState(this.state===this.STATE.SCISSORS?this.STATE.NONE:this.STATE.SCISSORS),this._augmentHeadliner=this._scissorsElement,this._updateAugmentHeadliner(),this._hideAugmentDropDown(),this._showInternal()}_windowLevelClicked(){this.updateState(this.state===this.STATE.WINDOWLEVEL?this.STATE.NONE:this.STATE.WINDOWLEVEL),this._augmentHeadliner=this._windowLevelElement,this._updateAugmentHeadliner(),this._hideAugmentDropDown(),this._showInternal()}_selectClicked(){this.updateState(this.state===this.STATE.SELECT?this.STATE.NONE:this.STATE.SELECT),this._showInternal()}_annotateClicked(){this.annotateStyle==="scissors"?this.updateState(this.state===this.STATE.SCISSORS?this.STATE.NONE:this.STATE.SCISSORS):this.updateState(this.state===this.STATE.ANNOTATE?this.STATE.NONE:this.STATE.ANNOTATE),this._hideAnnotateDropDown(),this._showInternal()}_annotateChildClicked(){switch(this._annotateChild){case"point":this.annotateStyle="point",this._annotateHeadliner="point",this._annotateChild="line",this._annotateDropDownChild.className="iptToolbarButton iptToolbarLine",this._annotateChildTooltip.content={text:this._tooltips[12]};break;case"line":this.annotateStyle="line",this._annotateHeadliner="line",this._annotateChild="point",this._annotateDropDownChild.className="iptToolbarButton iptToolbarPoint",this._annotateChildTooltip.content={text:this._tooltips[11]};break;case"data-tip":this.annotateStyle="data-tip",this._annotateHeadliner="data-tip",this._annotateChild="line",this._annotateDropDownChild.className="iptToolbarButton iptToolbarDataTip",this._annotateChildTooltip.content={text:this._tooltips[21]};break}this._updateAnnotateButton(),this.updateState(this.STATE.ANNOTATE),this._hideAnnotateDropDown(),this._showInternal()}_xClicked(){this.dispatchEvent({type:"axesClicked",message:0})}_yClicked(){this.dispatchEvent({type:"axesClicked",message:1})}_zClicked(){this.dispatchEvent({type:"axesClicked",message:2})}_xHovered(u){u.type==="pointerenter"?this._xAxisElement.style.color=this._colorSum<.7||this._colorSum>2?"#FF7A74":"#FF9D9A":this._xAxisElement.style.color=this._colorSum<.7||this._colorSum>2?"#B7312C":"#FF7A74"}_yHovered(u){u.type==="pointerenter"?this._yAxisElement.style.color=this._colorSum<.7||this._colorSum>2?"#94EF84":"#CBFFBE":this._yAxisElement.style.color=this._colorSum<.7||this._colorSum>2?"#008013":"#94EF84"}_zHovered(u){u.type==="pointerenter"?this._zAxisElement.style.color=this._colorSum<.7||this._colorSum>2?"#54B6FF":"#83CAFF":this._zAxisElement.style.color=this._colorSum<.7||this._colorSum>2?"#1656A7":"#54B6FF"}_homeHovered(u){this._onHover(u.type,this._homeElement,!1)}_messageHovered(u){u.type==="pointerenter"?(this._messageElement.style.opacity=1,this._fadeToolbar(!0)):(this._messageElement.style.opacity=.9,this._fadeToolbar(!1))}_rotateHovered(u){this._onHover(u.type,this._rotateElement,this.state===this.STATE.ROTATE)}_panHovered(u){this._onHover(u.type,this._panElement,this.state===this.STATE.PAN)}_zoomInHovered(u){this._onHover(u.type,this._zoomInElement,this.state===this.STATE.ZOOMIN)}_zoomOutHovered(u){this._onHover(u.type,this._zoomOutElement,this.state===this.STATE.ZOOMOUT)}_clippingHovered(u){this._enableClipping&&this._allowClipping?(u.type==="pointerenter"&&this._augmentHeadliner===this._clippingElement&&this._showAugmentDropDown(),this._onHover(u.type,this._clippingElement,!1)):this._clippingElement.style.opacity=0}_sliceHovered(u){this._enableSlice&&this._allowSlice?this._onHover(u.type,this._sliceElement,!1):this._sliceElement.style.opacity=0}_cropHovered(u){this._showCrop&&this._allowCrop?(u.type==="pointerenter"&&this._augmentHeadliner===this._cropElement&&this._showAugmentDropDown(),this._onHover(u.type,this._cropElement,!1)):this._cropElement.style.opacity=0}_scissorsHovered(u){this._showScissors&&this._allowScissors?(u.type==="pointerenter"&&this._augmentHeadliner===this._scissorsElement&&this._showAugmentDropDown(),this._onHover(u.type,this._scissorsElement,this.state===this.STATE.SCISSORS)):this._scissorsElement.style.opacity=0}_windowLevelHovered(u){this.enableWindowLevel&&this._allowWindowLevel?(u.type==="pointerenter"&&this._augmentHeadliner===this._windowLevelElement&&this._showAugmentDropDown(),this._onHover(u.type,this._windowLevelElement,this.state===this.STATE.WINDOWLEVEL)):this._windowLevelElement.style.opacity=0}_selectHovered(u){this._onHover(u.type,this._selectElement,this.state===this.STATE.SELECT)}_annotateHovered(u){this.annotateStyle==="scissors"?this._onHover(u.type,this._annotateElement,this.state===this.STATE.SCISSORS):this._onHover(u.type,this._annotateElement,this.state===this.STATE.ANNOTATE),this._annotateShowDropdown&&this._showAnnotateDropDown()}_annotateChildHovered(u){u.type==="pointerenter"?this._onHover(u.type,this._annotateDropDownChild,!1):this._fadeToolbar(!1)}_onHover(u,g,m){u==="pointerenter"?(g.style.opacity=m?1:.7,this._fadeToolbar(!0)):(g.style.opacity=m?1:.5,this._fadeToolbar(!1))}_fadeToolbar(u){const g=u===!0?this._colorSum>2?.8:.6:.4;this._toolbarBackgroundElement.style.opacity=g,this._annotateBackgroundElement.style.opacity=g,this._augmentBackgroundElement.style.opacity=g}_showAugmentDropDown(){this._augmentNumElements>1&&(this._enableSlice&&this._allowSlice?(this._sliceElement.style.opacity=.5,this._sliceElement.style.pointerEvents="auto",this._enableClipping&&(this._clippingElement.style.opacity=0,this._clippingElement.style.pointerEvents="none"),this._showCrop&&(this._cropElement.style.opacity=0,this._cropElement.style.pointerEvents="none"),this._showScissors&&(this._scissorsElement.style.opacity=0,this._scissorsElement.style.pointerEvents="none")):(this._enableClipping&&this._allowClipping&&(this._clippingElement.style.opacity=.5,this._clippingElement.style.pointerEvents="auto"),this._showScissors&&this._allowScissors&&(this._scissorsElement.style.opacity=.5,this._scissorsElement.style.pointerEvents="auto"),this._showCrop&&(this._cropElement.style.opacity=.5,this._cropElement.style.pointerEvents="auto")),this.enableWindowLevel&&this._allowWindowLevel&&(this._windowLevelElement.style.opacity=.5,this._windowLevelElement.style.pointerEvents="auto"),this._augmentArrow.style.opacity=0,this._augmentBackgroundElement.style.visibility="visible",this._toolbarBackgroundElement.style.borderRadius=this._toolbarNumElements>0?"6px 6px 6px 0px":"6px 6px 0px 0px")}_hideAugmentDropDown(){this._showScissors&&this._augmentHeadliner!==this._scissorsElement&&(this._scissorsElement.style.opacity=0,this._scissorsElement.style.pointerEvents="none"),this._enableClipping&&this._augmentHeadliner!==this._clippingElement&&(this._clippingElement.style.opacity=0,this._clippingElement.style.pointerEvents="none"),this._enableSlice&&this._augmentHeadliner!==this._sliceElement&&(this._sliceElement.style.opacity=0,this._sliceElement.style.pointerEvents="none"),this._showCrop&&this._augmentHeadliner!==this._cropElement&&(this._cropElement.style.opacity=0,this._cropElement.style.pointerEvents="none"),this.enableWindowLevel&&this._augmentHeadliner!==this._windowLevelElement&&(this._windowLevelElement.style.opacity=0,this._windowLevelElement.style.pointerEvents="none"),this._augmentElement.style.pointerEvents="none",this._opaque===!0&&this._augmentNumElements>1?this._augmentArrow.style.opacity=.5:this._augmentArrow.style.opacity=0,this._augmentBackgroundElement.style.visibility="hidden",this._toolbarBackgroundElement.style.borderRadius="6px 6px 6px 6px"}_showAnnotateDropDown(){this._annotateShowDropdown&&(this._annotateDropDownChild.style.opacity=.5,this._annotateDropDownChild.style.pointerEvents="auto",this._annotateArrow.style.opacity=0,this._annotateBackgroundElement.style.visibility="visible",this._augmentHeadliner===null&&(this._toolbarBackgroundElement.style.borderRadius=this._toolbarNumElements>1?"6px 6px 6px 0px":"6px 6px 0px 0px"))}_hideAnnotateDropDown(){this._annotateDropDownChild.style.opacity=0,this._annotateDropDownChild.style.pointerEvents="none",this._opaque===!0&&this._showAnnotate&&this._annotateShowDropdown?this._annotateArrow.style.opacity=.5:this._annotateArrow.style.opacity=0,this._annotateBackgroundElement.style.visibility="hidden",this._toolbarBackgroundElement.style.borderRadius="6px 6px 6px 6px"}_animationStopped(u){this.dispatchEvent(u)}_updateAnnotateButton(){switch(this.annotateStyle){case"point":this._annotateElement.className="iptToolbarButton iptToolbarPoint",this._annotateTooltip.content={text:this._tooltips[11]},this.maxAllowedClicks=1;break;case"line":this._annotateElement.className="iptToolbarButton iptToolbarLine",this._annotateTooltip.content={text:this._tooltips[12]},this.maxAllowedClicks=1;break;case"angle":this._annotateElement.className="iptToolbarButton iptToolbarAngle",this._annotateTooltip.content={text:this._tooltips[13]},this.maxAllowedClicks=3;break;case"elevation":this._annotateElement.className="iptToolbarButton iptToolbarHeight",this._annotateTooltip.content={text:this._tooltips[16]},this.maxAllowedClicks=1;break;case"polyline":case"polygon":this._annotateElement.className="iptToolbarButton iptToolbarPolygon",this._annotateTooltip.content={text:this._tooltips[14]},this.maxAllowedClicks=Number.MAX_SAFE_INTEGER;break;case"cuboid":this._annotateElement.className="iptToolbarButton iptToolbarCuboid",this._annotateTooltip.content={text:this._tooltips[15]},this.maxAllowedClicks=1;break;case"rectangle":this._annotateElement.className="iptToolbarButton iptToolbarRectangle",this._annotateTooltip.content={text:this._tooltips[18]},this.maxAllowedClicks=1;break;case"freehand":this._annotateElement.className="iptToolbarButton iptToolbarFreehand",this._annotateTooltip.content={text:this._tooltips[19]},this.maxAllowedClicks=Number.MAX_SAFE_INTEGER;break;case"scissors":this._annotateElement.className="iptToolbarButton iptToolbarCut",this._annotateTooltip.content={text:this._tooltips[17]},this.maxAllowedClicks=Number.MAX_SAFE_INTEGER;break;case"data-tip":this._annotateElement.className="iptToolbarButton iptToolbarDataTip",this._annotateTooltip.content={text:this._tooltips[21]},this.maxAllowedClicks=1;break;case"paint":this._annotateElement.className="iptToolbarButton iptToolbarPaint",this._annotateTooltip.content={text:this._tooltips[24]},this.maxAllowedClicks=1;break}}_updateMessage(u){if(this._message.update(u),this._message.enabled)switch(u.Icon){case"warning":this._messageElement.className="iptToolbarButton iptToolbarWarning";break;case"error":this._messageElement.className="iptToolbarButton iptToolbarError";break;case"info":this._messageElement.className="iptToolbarButton iptToolbarInfo";break}}_messageClosed(u){this._updateToolbar(),u.message?this.dispatchEvent(u):this.show()}_wireUpToolbarElements(u){this._toolbarElement=document.createElement("div"),this._toolbarElement.className="iptToolbar",u.appendChild(this._toolbarElement),this._toolbarBackgroundElement=document.createElement("div"),this._toolbarBackgroundElement.className="iptBackground",this._toolbarBackgroundElement.style.transitionProperty="opacity",this._toolbarBackgroundElement.style.transitionDuration="2s",this._toolbarBackgroundElement.style.transitionTimingFunction="ease-in-out",this._toolbarElement.appendChild(this._toolbarBackgroundElement),this._augmentElement=document.createElement("div"),this._augmentElement.className="iptToolbarDropdown",this._toolbarElement.appendChild(this._augmentElement),this._augmentBackgroundElement=document.createElement("div"),this._augmentBackgroundElement.className="iptBackground",this._augmentBackgroundElement.style.borderRadius="0px 0px 6px 6px",this._augmentBackgroundElement.style.transitionProperty="opacity",this._augmentBackgroundElement.style.transitionDuration="2s",this._augmentBackgroundElement.style.transitionTimingFunction="ease-in-out",this._augmentElement.appendChild(this._augmentBackgroundElement),this._scissorsElement=document.createElement("div"),this._scissorsElement.className="iptToolbarButton iptToolbarScissors",this._augmentElement.appendChild(this._scissorsElement),this._windowLevelElement=document.createElement("div"),this._windowLevelElement.className="iptToolbarButton iptToolbarWindowLevel",this._augmentElement.appendChild(this._windowLevelElement),this._sliceElement=document.createElement("div"),this._sliceElement.className="iptToolbarButton iptToolbarSlice",this._augmentElement.appendChild(this._sliceElement),this._clippingElement=document.createElement("div"),this._clippingElement.className="iptToolbarButton iptToolbarClipping",this._augmentElement.appendChild(this._clippingElement),this._cropElement=document.createElement("div"),this._cropElement.className="iptToolbarButton iptToolbarCrop",this._augmentElement.appendChild(this._cropElement),this._augmentArrow=document.createElement("div"),this._augmentArrow.className="iptToolbarArrow",this._augmentElement.appendChild(this._augmentArrow),this._homeElement=document.createElement("div"),this._homeElement.className="iptToolbarButton iptToolbarHome",this._toolbarElement.appendChild(this._homeElement),this._annotateDropdownElement=document.createElement("div"),this._annotateDropdownElement.className="iptToolbarDropdown",this._annotateDropdownElement.style.height="44px",this._toolbarElement.appendChild(this._annotateDropdownElement),this._annotateBackgroundElement=document.createElement("div"),this._annotateBackgroundElement.className="iptBackground",this._annotateBackgroundElement.style.borderRadius="0px 0px 6px 6px",this._annotateBackgroundElement.style.transitionProperty="opacity",this._annotateBackgroundElement.style.transitionDuration="2s",this._annotateBackgroundElement.style.transitionTimingFunction="ease-in-out",this._annotateDropdownElement.appendChild(this._annotateBackgroundElement),this._annotateElement=document.createElement("div"),this._annotateElement.className="iptToolbarButton iptToolbarPoint",this._annotateDropdownElement.appendChild(this._annotateElement),this._annotateDropDownChild=document.createElement("div"),this._annotateDropDownChild.className="iptToolbarButton iptToolbarLine",this._annotateDropdownElement.appendChild(this._annotateDropDownChild),this._annotateArrow=document.createElement("div"),this._annotateArrow.className="iptToolbarArrow",this._annotateDropdownElement.appendChild(this._annotateArrow),this._rotateElement=document.createElement("div"),this._rotateElement.className="iptToolbarButton iptToolbarRotate",this._toolbarElement.appendChild(this._rotateElement),this._panElement=document.createElement("div"),this._panElement.className="iptToolbarButton iptToolbarPan",this._toolbarElement.appendChild(this._panElement),this._zoomInElement=document.createElement("div"),this._zoomInElement.className="iptToolbarButton iptToolbarZoomIn",this._toolbarElement.appendChild(this._zoomInElement),this._zoomOutElement=document.createElement("div"),this._zoomOutElement.className="iptToolbarButton iptToolbarZoomOut",this._toolbarElement.appendChild(this._zoomOutElement),this._selectElement=document.createElement("div"),this._selectElement.className="iptToolbarButton iptToolbarSelect",this._toolbarElement.appendChild(this._selectElement),this._messageElement=document.createElement("div"),this._messageElement.className="iptToolbarButton iptToolbarError",this._toolbarElement.appendChild(this._messageElement),this._xAxisElement=u.getElementsByClassName("iptOrientationAxesX")[0],this._yAxisElement=u.getElementsByClassName("iptOrientationAxesY")[0],this._zAxisElement=u.getElementsByClassName("iptOrientationAxesZ")[0];try{this._rotateTooltip=h.createTooltip({referenceNode:this._rotateElement,content:{text:this._tooltips[4]}}),this._panTooltip=h.createTooltip({referenceNode:this._panElement,content:{text:this._tooltips[1]}}),this._homeTooltip=h.createTooltip({referenceNode:this._homeElement,content:{text:this._tooltips[0]}}),this._zoomInTooltip=h.createTooltip({referenceNode:this._zoomInElement,content:{text:this._tooltips[3]}}),this._zoomOutTooltip=h.createTooltip({referenceNode:this._zoomOutElement,content:{text:this._tooltips[2]}}),this._clipTooltip=h.createTooltip({referenceNode:this._clippingElement,content:{text:this._tooltips[5]}}),this._sliceTooltip=h.createTooltip({referenceNode:this._sliceElement,content:{text:this._tooltips[6]}}),this._cropTooltip=h.createTooltip({referenceNode:this._cropElement,content:{text:this._tooltips[9]}}),this._scissorsTooltip=h.createTooltip({referenceNode:this._scissorsElement,content:{text:this._tooltips[10]}}),this._windowLevelTooltip=h.createTooltip({referenceNode:this._windowLevelElement,content:{text:this._tooltips[20]}}),this._annotateTooltip=h.createTooltip({referenceNode:this._annotateElement,content:{text:this._tooltips[11]}}),this._annotateChildTooltip=h.createTooltip({referenceNode:this._annotateDropDownChild,content:{text:this._tooltips[12]}}),this._messageTooltip=h.createTooltip({referenceNode:this._messageElement,content:{text:this._tooltips[22]}}),this._selectTooltip=h.createTooltip({referenceNode:this._selectElement,content:{text:this._tooltips[23]}})}catch(g){}this._xAxisElement.addEventListener("click",this._xClicked.bind(this)),this._yAxisElement.addEventListener("click",this._yClicked.bind(this)),this._zAxisElement.addEventListener("click",this._zClicked.bind(this)),this._xAxisElement.addEventListener("pointerenter",this._xHovered.bind(this)),this._yAxisElement.addEventListener("pointerenter",this._yHovered.bind(this)),this._zAxisElement.addEventListener("pointerenter",this._zHovered.bind(this)),this._xAxisElement.addEventListener("pointerleave",this._xHovered.bind(this)),this._yAxisElement.addEventListener("pointerleave",this._yHovered.bind(this)),this._zAxisElement.addEventListener("pointerleave",this._zHovered.bind(this)),this._homeElement.addEventListener("click",this._homeClicked.bind(this)),this._rotateElement.addEventListener("click",this._rotateClicked.bind(this)),this._panElement.addEventListener("click",this._panClicked.bind(this)),this._zoomOutElement.addEventListener("click",this._zoomOutClicked.bind(this)),this._zoomInElement.addEventListener("click",this._zoomInClicked.bind(this)),this._clippingElement.addEventListener("click",this._clippingClicked.bind(this)),this._sliceElement.addEventListener("click",this._sliceClicked.bind(this)),this._cropElement.addEventListener("click",this._cropClicked.bind(this)),this._scissorsElement.addEventListener("click",this._scissorsClicked.bind(this)),this._windowLevelElement.addEventListener("click",this._windowLevelClicked.bind(this)),this._annotateElement.addEventListener("click",this._annotateClicked.bind(this)),this._annotateDropDownChild.addEventListener("click",this._annotateChildClicked.bind(this)),this._messageElement.addEventListener("click",this._messageClicked.bind(this)),this._selectElement.addEventListener("click",this._selectClicked.bind(this)),this._homeElement.addEventListener("pointerenter",this._homeHovered.bind(this)),this._rotateElement.addEventListener("pointerenter",this._rotateHovered.bind(this)),this._panElement.addEventListener("pointerenter",this._panHovered.bind(this)),this._zoomOutElement.addEventListener("pointerenter",this._zoomOutHovered.bind(this)),this._zoomInElement.addEventListener("pointerenter",this._zoomInHovered.bind(this)),this._clippingElement.addEventListener("pointerenter",this._clippingHovered.bind(this)),this._sliceElement.addEventListener("pointerenter",this._sliceHovered.bind(this)),this._cropElement.addEventListener("pointerenter",this._cropHovered.bind(this)),this._scissorsElement.addEventListener("pointerenter",this._scissorsHovered.bind(this)),this._windowLevelElement.addEventListener("pointerenter",this._windowLevelHovered.bind(this)),this._annotateElement.addEventListener("pointerenter",this._annotateHovered.bind(this)),this._annotateDropDownChild.addEventListener("pointerenter",this._annotateChildHovered.bind(this)),this._messageElement.addEventListener("pointerenter",this._messageHovered.bind(this)),this._selectElement.addEventListener("pointerenter",this._selectHovered.bind(this)),this._homeElement.addEventListener("pointerleave",this._homeHovered.bind(this)),this._rotateElement.addEventListener("pointerleave",this._rotateHovered.bind(this)),this._panElement.addEventListener("pointerleave",this._panHovered.bind(this)),this._zoomOutElement.addEventListener("pointerleave",this._zoomOutHovered.bind(this)),this._zoomInElement.addEventListener("pointerleave",this._zoomInHovered.bind(this)),this._clippingElement.addEventListener("pointerleave",this._clippingHovered.bind(this)),this._sliceElement.addEventListener("pointerleave",this._sliceHovered.bind(this)),this._cropElement.addEventListener("pointerleave",this._cropHovered.bind(this)),this._scissorsElement.addEventListener("pointerleave",this._scissorsHovered.bind(this)),this._windowLevelElement.addEventListener("pointerleave",this._windowLevelHovered.bind(this)),this._annotateElement.addEventListener("pointerleave",this._annotateHovered.bind(this)),this._annotateDropDownChild.addEventListener("pointerleave",this._annotateChildHovered.bind(this)),this._augmentElement.addEventListener("pointerleave",this._hideAugmentDropDown.bind(this)),this._annotateDropdownElement.addEventListener("pointerleave",this._hideAnnotateDropDown.bind(this)),this._animation.addEventListener("animationFinished",this._animationStopped.bind(this)),this._messageElement.addEventListener("pointerleave",this._messageHovered.bind(this)),this._selectElement.addEventListener("pointerleave",this._selectHovered.bind(this))}dispose(){this._message.dispose(),this._homeElement.removeEventListener("click",this._homeClicked.bind(this)),this._rotateElement.removeEventListener("click",this._rotateClicked.bind(this)),this._panElement.removeEventListener("click",this._panClicked.bind(this)),this._zoomOutElement.removeEventListener("click",this._zoomOutClicked.bind(this)),this._zoomInElement.removeEventListener("click",this._zoomInClicked.bind(this)),this._clippingElement.removeEventListener("click",this._clippingClicked.bind(this)),this._sliceElement.removeEventListener("click",this._sliceClicked.bind(this)),this._messageElement.removeEventListener("click",this._messageClicked.bind(this)),this._selectElement.removeEventListener("click",this._selectClicked.bind(this)),this._homeElement.removeEventListener("pointerenter",this._homeHovered.bind(this)),this._rotateElement.removeEventListener("pointerenter",this._rotateHovered.bind(this)),this._panElement.removeEventListener("pointerenter",this._panHovered.bind(this)),this._zoomOutElement.removeEventListener("pointerenter",this._zoomOutHovered.bind(this)),this._zoomInElement.removeEventListener("pointerenter",this._zoomInHovered.bind(this)),this._clippingElement.removeEventListener("pointerenter",this._clippingHovered.bind(this)),this._sliceElement.removeEventListener("pointerenter",this._sliceHovered.bind(this)),this._messageElement.removeEventListener("pointerenter",this._messageHovered.bind(this)),this._selectElement.removeEventListener("pointerenter",this._selectHovered.bind(this)),this._homeElement.removeEventListener("pointerleave",this._homeHovered.bind(this)),this._rotateElement.removeEventListener("pointerleave",this._rotateHovered.bind(this)),this._panElement.removeEventListener("pointerleave",this._panHovered.bind(this)),this._zoomOutElement.removeEventListener("pointerleave",this._zoomOutHovered.bind(this)),this._zoomInElement.removeEventListener("pointerleave",this._zoomInHovered.bind(this)),this._clippingElement.removeEventListener("pointerleave",this._clippingHovered.bind(this)),this._sliceElement.removeEventListener("pointerleave",this._sliceHovered.bind(this)),this._messageElement.removeEventListener("pointerleave",this._messageHovered.bind(this)),this._selectElement.removeEventListener("pointerleave",this._selectHovered.bind(this)),this._rotateTooltip.destroy(),this._panTooltip.destroy(),this._homeTooltip.destroy(),this._zoomInTooltip.destroy(),this._zoomOutTooltip.destroy(),this._clipTooltip.destroy(),this._sliceTooltip.destroy(),this._cropTooltip.destroy(),this._scissorsTooltip.destroy(),this._windowLevelTooltip.destroy(),this._annotateTooltip.destroy(),this._messageTooltip.destroy(),this._selectTooltip.destroy()}}},R,W),R.exports=I},2119:(R,W,d)=>{var O,I;O=[d(40),d(1711),d(5989),d(1240),d(3771),d(9242),d(1374),d(6250),d(3215),d(4868),d(664),d(8855),d(3252),d(2554),d(855),d(4121),d(4191),d(773),d(6116)],I=d.dj.d(O,function(f,N,b,h,r,o,c,u,g,m,y,x,w,C,P,T,M,z,Y){return class{constructor(S){this._renderer=null,this._composer=null,this._scene=null,this._depthScene=null,this._deferredScene=null,this._overviewScene=null,this._annotationScene=null,this._controls=null,this._memory=null,this._wireframe=null,this._grid=null,this._canvas=null,this._context=null,this._scaleBar=null,this._spinner=null,this._children=[],this._messageServiceChannel=S,this._token=null,this._binaryChannelInstructionSet=[],this._animationID=null,this._nextBlockToRead=null,this._numBlocksToRead=0,this._hasReadingStarted=!1,this._waitingForBlock=!1,this._waitingToSync=!1,this._sendObjectDataToServer=!1,this.ready=!1,this._isEmpty=!0,this._busy=!1,this._fitCameraToSceneRequired=!1,this._alwaysUpdateOnInteraction=!1,this._globalData={globalClipping:!0,globalClippingPlanes:Object.freeze([]),clipIntersection:!1,cropBox:Object.freeze([]),cropBoxExclude:!1,cropType:"box",lighting:!0,numLights:1,volumeIterator:-1,hardwareSupport:!0,webGPUSupport:!1,renderingStepSize:1,cameraStyle:"orthographic",uniforms:{u_passNumber:{value:0},u_depthTexture:{value:new f.DepthTexture},u_previousTexture:{value:new f.DepthTexture},u_viewportSize:{value:new f.Vector2(1,1)},u_cameraPosition:{value:new f.Vector3},u_cameraTarget:{value:new f.Vector3},u_primaryLight:{value:new f.Vector3},u_lightColor:{value:new f.Vector4},u_ambientStrength:{value:.3},u_primaryLightIntensity:{value:.6},u_secondaryLight:{value:null},u_secondaryLightIntensity:{value:null},u_lightRaySteps:{value:.5},u_deferredTexture:{value:new f.Texture},u_currentPosition:{value:new f.Vector2},u_cropMin:{value:new f.Vector3},u_cropMax:{value:new f.Vector3},u_colorBoxMatrix:{value:new f.Matrix4},u_colorBoxColor:{value:new f.Color},u_screenRectangle:{value:new f.Vector4(0,0,1,1)},u_autoMagFilter:{value:f.LinearFilter},u_cropCenter:{value:new f.Vector3},u_cropRadius:{value:0},u_cropHeight:{value:0},lights:[]}},this._currentObjectData={id:-1,slicePlanes:Object.freeze([]),clippingPlanes:Object.freeze([])},this._renderingQuality=10,this._renderingQualityDuringMotion=5,this._renderingQualityMin=9,this._renderingQualityCeiling=9,this._dynamicallyAdjustQuality=!0,this._autoScatterQuality=!0,this._renderingPixelRatio=1,this._timestamp=performance.now(),this._rollingFrameRate=[],this._renderFrontLayerOnly=!1}start(S){this._init(S),this._updateScene(S),this._updateAxes(S.Axes),this._controls.updateAnnotationSettings(S.Annotations),this.animate(),this.ready=!0,this._publishResponse("ClientStarted",{})}drawnow(S){if(!this.ready)return;this._waitingToSync=!0,this._token=S.Token;const F=Array.from(S.BoundingBox);if(this._busyInternal(S.Busy===!0,F.length===0),this._remove(S.RemovedIndices),Object.prototype.hasOwnProperty.call(S.Mode,"Default")&&this._controls.mode(S.Mode,!1),this._composer.setDepth(S.NumDepthPasses,S.DepthRequired,S.SeparateDepthPassRequired),this._controls.copyCameraProperties(),S.UpdateScene===!0&&this._updateScene(S.SceneData),Object.prototype.hasOwnProperty.call(S.Axes,"Box")&&this._updateAxes(S.Axes),this._nextBlockToRead=null,this._binaryChannelInstructionSet=S.InstructionSet,this._renderFrontLayerOnly=!1,Object.prototype.hasOwnProperty.call(S.Annotations,"DataUpdateRequired")&&(this._controls.updateAnnotationSettings(S.Annotations),S.Annotations.DataUseBinaryChannel&&this._binaryChannelInstructionSet.unshift({Index:-1,Type:"Annotations"})),(this._binaryChannelInstructionSet.length>0||S.RemovedIndices.length>0)&&(this._controls.lazyLoading=!1),this._updateCurrentObject(S.CurrentObject),S.NumObjects>0){for(let k=0;k<S.NumObjects;k++){const G=S["ObjectData"+k];if(G.IsNewObject){let H;switch(G.Type){case"volume":this._globalData.volumeIterator+=1,H=new r(this._scene,this._depthScene,G,this._globalData);break;case"surface":H=new o(this._scene,this._depthScene,G,this._globalData);break;case"points":H=new c(this._scene,this._depthScene,G,this._globalData),this._alwaysUpdateOnInteraction=!0;break;case"blockedpoints":H=new u(this._scene,this._depthScene,G,this._globalData),this._sendObjectDataToServer=!0,this._controls.lazyLoadingRequired=!0;break;case"blockedvolume":H=new g(this._scene,this._deferredScene,this._depthScene,this._overviewScene,G,this._globalData),this._sendObjectDataToServer=!0,this._controls.lazyLoadingRequired=!0;break;case"internalimage":H=new m(this._scene,this._depthScene,G,this._globalData);break;case"image":H=new y(this._scene,this._deferredScene,this._depthScene,G,this._globalData),this._sendObjectDataToServer=!0,this._controls.lazyLoadingRequired=!0;break;case"line":H=new x(this._scene,this._depthScene,G,this._globalData);break;case"wideline":H=new w(this._scene,this._depthScene,G,this._globalData);break}H.renderOrder(this._children.length+1),this._children.push(H)}else this._children[G.Index].refreshProperties(G)}F.length!==0&&(this._isEmpty=F[0].every(k=>k===0)&&F[1].every(k=>k===0),this._controls.setBoundingBox(F),this._fitCameraToSceneRequired=!0),this._checkEmptyInstructionSet(S.EmptyInstructionSet)}this._lookForReadableBlock()}drawfast(S){this._waitingToSync=!0,Object.prototype.hasOwnProperty.call(S.Mode,"Default")&&this._controls.mode(S.Mode,!0),Object.prototype.hasOwnProperty.call(S.Axes,"Box")&&this._updateAxes(S.Axes),this._nextBlockToRead=null,this._renderFrontLayerOnly=!0,Object.prototype.hasOwnProperty.call(S.Annotations,"DataUpdateRequired")&&(this._controls.updateAnnotationSettings(S.Annotations),S.Annotations.DataUseBinaryChannel&&(this._renderFrontLayerOnly=!(this._binaryChannelInstructionSet.length>0),this._binaryChannelInstructionSet.unshift({Index:-1,Type:"Annotations"}))),this._binaryChannelInstructionSet.length>0&&(this._controls.lazyLoading=!1),this._waitingForBlock||this._lookForReadableBlock()}mode(S){this._controls.mode(S,!0),this._publishResponse(S.Token,{})}setBinaryData(S){if(this.ready)if(this._nextBlockToRead!==null)if(Object.prototype.hasOwnProperty.call(this._nextBlockToRead,"outOfCore")){const F=this._nextBlockToRead.outOfCore;this._children[this._nextBlockToRead.id].loadBlock(S,this._nextBlockToRead),this._stopLazyLoading(),this._measureMemory(),this._waitingForSync?this._lookForReadableBlock():F?(this._lookForReadableBlock(),this.renderDeferredLayer()):this._controls.updateRequested=!0}else this._nextBlockToRead.Index===-1?this._controls.annotate(S):this._children[this._nextBlockToRead.Index].refreshData(S,this._nextBlockToRead,this._globalData.renderingStepSize),this._stopLazyLoading(),this._lookForReadableBlock(),this._composer.clearPaintPass();else this._stopLazyLoading(),this._waitingToSync?this._lookForReadableBlock():this._controls.lazyLoadingRequested=!0}stopDataTransfer(){this._stopLazyLoading(),this._waitingToSync&&(this._controls.lazyLoading=!1,this._lookForReadableBlock())}busy(S){this.ready&&(this._busyInternal(S.Busy,!S.Busy),S.Busy||(this._controls.lazyLoadingRequested=!0,this._composer.clearPaintPass()))}clear(S){if(!this.ready)throw new Error("Viewer not ready");this._clearScene(),this._sceneControls(this._composer.getAxesVisibility(),this._scaleBar.visible,this._wireframe.visible),this._controls.enabled=!1,this._setSpinnerProgress(100),this._composer.clearPaintPass(),this.render()}updateDataTip(S){this._controls.updateDataTip(S)}copyAnnotations(S){this._controls.copyAnnotations()}editAnnotation(S){this._controls.editAnnotation(S)}openDevTools(){window.cefclient.openDevTools()}_publishResponse(S,F){if(this._messageServiceChannel!==null){const k={Token:S,Message:F};N.publish(this._messageServiceChannel,k)}}_stopLazyLoading(){this._nextBlockToRead=null,this._waitingForBlock=!1}_busyInternal(S,F){this._busy=S,this._setSpinnerProgress(S?0:100),this._controls.enabled=F&&!this._isEmpty}_remove(S){if(S.length!==0){if(S.length===void 0)this._removeChild(S);else for(let F=S.length-1;F>=0;F--)this._removeChild(S[F]);for(let F=0;F<this._children.length;F++)this._children[F].renderOrder(F+1);this._isEmpty=this._isEmpty||!(this._children.length>0),this._isEmpty&&this._sceneControls(this._composer.getAxesVisibility(),this._scaleBar.visible,this._wireframe.visible)}}_removeChild(S){S<this._children.length&&(this._children[S].remove(),this._children.splice(S,1))}_updateCurrentObject(S){if(!Object.prototype.hasOwnProperty.call(S,"ID")){this._currentObjectData.id=-1,this._currentObjectData.clippingPlanes=Object.freeze([]),this._currentObjectData.slicePlanes=Object.freeze([]);return}this._currentObjectData.id=S.ID,this._currentObjectData.clippingPlanes=this._createPlanes(S.ClippingPlanes),this._currentObjectData.slicePlanes=this._createPlanes(S.SlicePlanes),this._globalData.globalClipping?this._controls.updatePlanes(this._globalData.globalClippingPlanes,this._currentObjectData.slicePlanes,S.SlicePlaneInteractions,S.ScissorsAllowed,S.WindowLevelAllowed,Array.from(S.Transform),Array.from(S.BoundingBox)):this._controls.updatePlanes(this._currentObjectData.clippingPlanes,this._currentObjectData.slicePlanes,S.SlicePlaneInteractions,S.ScissorsAllowed,S.WindowLevelAllowed,Array.from(S.Transform),Array.from(S.BoundingBox))}_checkEmptyInstructionSet(S){let F;const k=S.length;for(let G=0;G<k;G++)F=S.shift(),this._children[F.Index].refreshData([],F,this._globalData.renderingStepSize)}_createPlanes(S){const F=new Float32Array(S),k=[];let G=0;if(F.length>0){G=F.length/4;for(let H=0;H<G;H++)k[H]=new f.Plane(new f.Vector3(F[H*4],F[H*4+1],F[H*4+2]),F[H*4+3]);return k}else return Object.freeze([])}_updateScene(S){if(this._memory.setLimit(S.MemoryLimit),this._renderQuality(S.Quality),this._composer.setAntialiasing(S.Antialiasing),this._clippingPlanes(S.Culling.ClippingPlanes,S.Culling.GlobalClipping,S.Culling.ClipIntersection),this._cropBox(S.Culling.CropRegion,S.Culling.CropExclude,S.Culling.CropType),this._composer.setDepthPeel(S.DepthPeeling,S.ViewDepth),this._composer.setMaxSize(Array.from(S.MaxCanvasSize),this._renderingPixelRatio),this._composer.setDeferredStyle(S.CompositionStyle,S.OutOfCoreRendering),this._controls.cameraStyle!==S.Camera.Style){this._globalData.cameraStyle=S.Camera.Style;for(let F=0;F<this._children.length;F++)this._children[F].cameraStyle(this._globalData.cameraStyle)}this._controls.setCamera(S.Camera.Style,Array.from(S.Camera.Position),Array.from(S.Camera.Target),Array.from(S.Camera.UpVector),S.Camera.Zoom,S.Camera.ViewAngle,Array.from(S.Camera.AutoMode)),this._updateLight(S.Light)}_updateAxes(S){this._scaleBar.units=S.ScaleBarUnits,this._scaleBar.setStyle(S.ScaleBarStyle),this._controls.setUnits(S.ScaleBarUnits),this._composer.setAxesLabels(S.OrientationAxesLabels),this._backgroundColor(Array.from(S.BackgroundColor),Array.from(S.GradientColor),S.GradientBackground),this._composer.setDenoising(S.Denoising,S.DenoisingSigma,S.DenoisingThreshold),this._grid.update(S.Grid),this._sceneControls(S.OrientationAxes,S.ScaleBar,S.Box),this._controls.setCrosshair(S.Crosshair)}_updateLight(S){this._composer.setIterativeControls(S.CinematicRendering,S.NumIterations),this._controls.setLight(S)}_updateChildLighting(S){for(let F=0;F<this._children.length;F++)this._children[F].lighting(S.message.numLights)}_backgroundColor(S,F,k){this._composer.setColor(S,F,k),this._grid.setColor(S),this._controls.setColor(S),this._scaleBar.setColor(S),this._wireframe.setColor(S)}_renderQuality(S){switch(S){case"high":this._renderingQuality=10,this._renderingQualityDuringMotion=9,this._dynamicallyAdjustQuality=!1;break;case"medium":this._renderingQuality=9,this._renderingQualityDuringMotion=8,this._dynamicallyAdjustQuality=!1;break;case"low":this._renderingQuality=5,this._renderingQualityDuringMotion=4,this._dynamicallyAdjustQuality=!1;break;case"auto":this._renderingQuality=9,this._renderingQualityDuringMotion=5,this._dynamicallyAdjustQuality=!0;break;default:this._renderingQuality=S,this._renderingQualityDuringMotion=S,this._dynamicallyAdjustQuality=!1;break}this._setQuality(this._renderingQuality)}_setSpinnerProgress(S){this._spinner.setDeterminant(S)}_sceneControls(S,F,k){this._composer.setAxesVisibility(S,this._isEmpty,this._controls.screen.width,this._controls.screen.height),this._scaleBar.setVisible(F,this._isEmpty,this._composer.getAxesVisibility()),this._wireframe.setVisible(k,this._isEmpty),this._grid.setVisible(this._isEmpty)}_clippingPlanes(S,F,k){const G=new Float32Array(S),H=[];let q=0;if(F)if(G.length>0){q=G.length/4;for(let Q=0;Q<q;Q++)H[Q]=new f.Plane(new f.Vector3(G[Q*4],G[Q*4+1],G[Q*4+2]),G[Q*4+3]);this._globalData.globalClippingPlanes=H}else this._globalData.globalClippingPlanes=Object.freeze([]);if(k!==this._globalData.clipIntersection){this._globalData.clipIntersection=k;for(let Q=0;Q<this._children.length;Q++)this._children[Q].clipIntersection(this._globalData.clipIntersection)}const ce=this._globalData.globalClipping;if(this._globalData.globalClipping=F,!(ce===!1&&F===!1))for(let Q=0;Q<this._children.length;Q++)this._children[Q].globalClippingPlanes(this._globalData.globalClippingPlanes,F)}_cropBox(S,F,k){const G=this._globalData.cropBox.length>0,H=this._globalData.cropBoxExclude,q=S.length>0,ce=this._globalData.cropBox.length,Q=S.length;if(this._globalData.cropBoxExclude=F,q)switch(k){case"box":{this._globalData.uniforms.u_cropMin.value.fromArray(S[0]),this._globalData.uniforms.u_cropMax.value.fromArray(S[1]);break}case"sphere":{this._globalData.uniforms.u_cropRadius.value=S[3],this._globalData.uniforms.u_cropCenter.value.x=S[0],this._globalData.uniforms.u_cropCenter.value.y=S[1],this._globalData.uniforms.u_cropCenter.value.z=S[2];break}case"cylinder":{this._globalData.uniforms.u_cropRadius.value=S[3],this._globalData.uniforms.u_cropHeight.value=S[4],this._globalData.uniforms.u_cropCenter.value.x=S[0],this._globalData.uniforms.u_cropCenter.value.y=S[1],this._globalData.uniforms.u_cropCenter.value.z=S[2];break}default:this._globalData.uniforms.u_cropMin.value.fromArray(S[0]),this._globalData.uniforms.u_cropMax.value.fromArray(S[1])}if(this._globalData.cropBox=S,this._globalData.cropType=k,this._controls.updateCrop(q,S),G!==q||ce!==Q||H!==this._globalData.cropBoxExclude)for(let ne=0;ne<this._children.length;ne++)this._children[ne].crop(this._globalData.cropBoxExclude,q)}_clearScene(){this._controls.lazyLoading=!1,this._stopLazyLoading(),this._scene.clear(),this._depthScene.clear(),this._deferredScene.clear(),this._overviewScene.clear();for(let S=0;S<this._children.length;S++)this._children[S].remove();this._memory.clear(),this._children=[],this._isEmpty=!0}validateWebGraphics(){let S,F=null;const k={premultipliedAlpha:!1,depth:!0,antialias:!0,stencil:!0,precision:"highp",powerPreference:"high-performance",preserveDrawingBuffer:!0};try{this._canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),this._canvas.addEventListener("webglcontextlost",this._handleContextLost.bind(this),!1),this._canvas.addEventListener("webglcontextrestored",this._handleContextRestored.bind(this),!1),this._context=this._canvas.getContext("webgl2",k),F=this._context.getExtension("WEBGL_debug_renderer_info");let G=null;const H=navigator.gpu;try{G=navigator.connection.downlink}catch(q){}S={Renderer:this._context.getParameter(this._context.RENDERER),Vendor:this._context.getParameter(this._context.VENDOR),Version:this._context.getParameter(this._context.VERSION),UnmaskedVendor:this._context.getParameter(F.UNMASKED_VENDOR_WEBGL),RendererDevice:this._context.getParameter(F.UNMASKED_RENDERER_WEBGL),WebGL2Supported:this._context!==null,WebGPUSupported:H!==void 0,MaxTextureSize:this._context.getParameter(this._context.MAX_TEXTURE_SIZE),Max3DTextureSize:this._context.getParameter(this._context.MAX_3D_TEXTURE_SIZE),DevicePixelRatio:window.devicePixelRatio,DownlinkSpeed:G,Browser:navigator.userAgent}}catch(G){S={WebGL2Supported:!1,ErrorMessage:G.message}}this._publishResponse("ClientInitialized",S)}_init(S){const F=document.getElementsByClassName("iptViewer3D")[0];this._canvas.style.display="block",F.appendChild(this._canvas),this._scene=new f.Scene,this._depthScene=new f.Scene,this._deferredScene=new f.Scene,this._overviewScene=new f.Scene,this._annotationScene=new f.Scene;const k=new f.Scene;this._globalData.hardwareSupport=S.HardwareSupport,this._globalData.webGPUSupport=S.WebGPUSupport;const G=Array.from(S.Axes.BackgroundColor),H=new f.Color(G[0],G[1],G[2]);this._renderer=new f.WebGLRenderer({canvas:this._canvas,context:this._context,premultipliedAlpha:!1,antialias:!0,stencil:!0,precision:"highp",powerPreference:"high-performance",preserveDrawingBuffer:!0});const q=F.clientWidth,ce=F.clientHeight;this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.setSize(q,ce),this._renderer.localClippingEnabled=!0,this._renderer.autoClear=!1,this._memory=new Y(this._canvas),this._scaleBar=new C(F),this._spinner=new b(F,S.IsPublishing),this._wireframe=new P(k),this._grid=new T(S.Axes.Grid),k.add(this._grid);const Q=new M(this._scene,this._globalData);this._controls=new h(S,F,this._canvas,this._annotationScene,Q,this._globalData),this._globalData.cameraStyle=this._controls.cameraStyle,this._composer=new z(this._renderer,F,H,this._scene,this._depthScene,this._annotationScene,this._deferredScene,this._overviewScene,k,this._globalData,this._controls.screen),this._globalData.uniforms.u_viewportSize.value.set(this._controls.screen.width,this._controls.screen.height),this._globalData.uniforms.u_cameraPosition.value=this._controls.camera.position,this._globalData.uniforms.u_cameraTarget.value=this._controls.target,this._busyInternal(S.Busy,!S.Busy),this._controls.addEventListener("interactionStarted",this._startControlChanging.bind(this)),this._controls.addEventListener("interactionUpdating",this._broadcastToServer.bind(this)),this._controls.addEventListener("interactionEnded",this._onInteractionCompletion.bind(this)),this._controls.addEventListener("clickReleased",this._onClickRelease.bind(this)),this._controls.addEventListener("render",this.render.bind(this)),this._controls.addEventListener("renderFrontLayer",this.renderFrontLayer.bind(this)),this._controls.addEventListener("windowResizing",this._onWindowResize.bind(this)),this._controls.addEventListener("windowResized",this._broadcastResizeEvent.bind(this)),this._controls.addEventListener("measurePerformance",this._measurePerformance.bind(this)),this._controls.addEventListener("resetPerformance",this._resetPerformanceMeasurement.bind(this)),this._controls.addEventListener("contextMenuClicked",this._broadcastContextMenuEvent.bind(this)),this._controls.addEventListener("defaultCameraRestored",this._broadcastMovedEvent.bind(this)),this._controls.addEventListener("widgetAdded",this._broadcastWidgetAddedEvent.bind(this)),this._controls.addEventListener("messageClosed",this._broadcastMessageClosedEvent.bind(this)),this._controls.addEventListener("modeChanged",this._reactToModeChange.bind(this)),this._controls.addEventListener("animationFinished",this._animationStopped.bind(this)),this._controls.addEventListener("depthRequested",this._getDepthAtLocation.bind(this)),this._controls.addEventListener("updateIteration",this.renderIterativeLayer.bind(this)),this._controls.addEventListener("lightsUpdated",this._updateChildLighting.bind(this)),this._controls.addEventListener("scissorsFinished",this._broadcastScissorsEvent.bind(this)),this._controls.addEventListener("annotationsCopied",this._broadcastCopyEvent.bind(this)),this._controls.addEventListener("annotationEdited",this._broadcastEditEvent.bind(this)),this._controls.addEventListener("colorBoxChanged",this._reactToColorBoxChange.bind(this)),this._controls.addEventListener("colorBoxUpdated",this._reactToColorBoxUpdate.bind(this)),this._controls.addEventListener("refreshLazyLoading",this._refreshLazyLoading.bind(this)),this._controls.addEventListener("pointPickRequested",this._pick.bind(this)),this._controls.addEventListener("autoMagFilterUpdated",this._updateAutoMagFilter.bind(this)),this._controls.addEventListener("paintBrushEnabled",this._enablePaintBrush.bind(this)),this._controls.addEventListener("paintBrushStarted",this._activatePaintBrush.bind(this)),this._controls.addEventListener("paintBrushFinished",this._onInteractionCompletion.bind(this)),this._scaleBar.addEventListener("scaleBarEdited",this._reactToScaleBarUpdate.bind(this))}dispose(){cancelAnimationFrame(this._animationID),this._clearScene(),this._composer.dispose(),this._controls.dispose()}_getDepthAtLocation(S){this._controls.setDepthAtLocation(this._composer.getDepthAtLocation(S.message,S.windowSize),S.message)}_updateAutoMagFilter(S){this._globalData.uniforms.u_autoMagFilter.value=S.filter;for(let F=0;F<this._children.length;F++)this._children[F].autoMagFilter(S.filter)}_handleContextLost(S){S.preventDefault(),cancelAnimationFrame(this._animationID),this._clearScene(),this._controls._enabled=!1,this._composer.dispose(),this._publishResponse("WebGLContextLost",{})}_handleContextRestored(S){}_enablePaintBrush(S){this._composer.enablePaintPass(S.enabled,S.color,S.opacity,S.brushSize)}_activatePaintBrush(S){this._composer.activatePaintPass(S.activated)}_startControlChanging(){this._composer.outOfCoreRendering&&(this._controls.lazyLoading=!1),this._updateChildrenOnInteraction(!0),this._setSpinnerProgress(100),this._setQuality(this._renderingQualityDuringMotion),this._rollingFrameRate=[],this._resetPerformanceMeasurement()}_onInteractionCompletion(S){switch(S.name){case"CameraMoved":this._cleanupInteraction(),this._broadcastMovedEvent(),this._controls.lazyLoadingRequested=!0;break;case"AnnotationMoved":S.redraw?this._cleanupInteraction():this._updateChildrenOnInteraction(!1),this._publishResponse(S.name,S.message);break;case"ClippingPlanesChanged":this._cleanupInteraction(),this._publishResponse(S.name,this._packageClippingPlanes(S.message)),this._controls.lazyLoadingRequested=!0;break;case"SlicePlanesChanged":this._cleanupInteraction(),this._publishResponse(S.name,this._packageSlicePlanes(S.message)),this._controls.lazyLoadingRequested=!0;break;case"DisplayRangeChanged":this._cleanupInteraction(),this._publishResponse(S.name,this._children[this._currentObjectData.id].getWindowLevel());break;case"DisplayRangeDouble":this._cleanupInteraction(),this._publishResponse("DisplayRangeChanged","auto");break;case"CropRegionChanged":this._cleanupInteraction(),this._publishResponse(S.name,this._packageCropBox()),this._controls.lazyLoadingRequested=!0;break;case"CrosshairMoved":this._updateChildrenOnInteraction(!1),this._publishResponse(S.name,S.message);break;case"PaintBrushFinished":this._busyInternal(!0,!1),this._composer.activatePaintPass(!1),this._publishResponse(S.name,S.message);break}}_onClickRelease(){this._controls.iterativeUpdateRequested===!0&&(this._controls.iterativeUpdateRequested=!1,this._setSpinnerProgress(100)),this._publishResponse("ClickReleased",{})}_broadcastMovedEvent(){this._publishResponse("CameraMoved",this._packageEventData(this._controls.packageCameraProperties())),this._controls.lazyLoadingRequested=!0}_broadcastToServer(S){switch(S.name){case"CameraMoving":S.notifyUser&&this._publishResponse(S.name,this._packageEventData(this._controls.packageCameraProperties())),this._controls.lazyLoadingRequested=!0;break;case"DisplayRangeChanging":if(this._currentObjectData.id<0)return;this._children[this._currentObjectData.id].updateWindowLevel(S.data),S.notifyUser&&this._publishResponse(S.name,this._children[this._currentObjectData.id].getWindowLevel());break;case"CrosshairMoving":case"AnnotationMoving":S.notifyUser&&this._publishResponse(S.name,S.message);break;case"CropRegionChanging":switch(this._controls.lazyLoadingRequested=!0,this._globalData.cropType){case"box":{this._globalData.uniforms.u_cropMin.value.copy(S.message.cropMin),this._globalData.uniforms.u_cropMax.value.copy(S.message.cropMax);break}case"sphere":{this._globalData.uniforms.u_cropCenter.value.copy(S.message.center),this._globalData.uniforms.u_cropRadius.value=S.message.radius;break}case"cylinder":{this._globalData.uniforms.u_cropCenter.value.copy(S.message.center),this._globalData.uniforms.u_cropRadius.value=S.message.radius,this._globalData.uniforms.u_cropHeight.value=S.message.height;break}}S.notifyUser&&this._publishResponse(S.name,this._packageCropBox()),this._controls.lazyLoadingRequested=!0;break;case"SlicePlanesChanging":if(this._currentObjectData.id<0)return;this._currentObjectData.slicePlanes[S.message.id].copy(S.message.plane),this._children[this._currentObjectData.id].copySlicePlaneObjects(this._currentObjectData.slicePlanes),S.notifyUser&&this._publishResponse(S.name,this._packageSlicePlanes(S.message.id)),this._controls.lazyLoadingRequested=!0;break;case"ClippingPlanesChanging":if(this._globalData.globalClipping){this._globalData.globalClippingPlanes[S.message.id].copy(S.message.plane);for(let F=0;F<this._children.length;F++)this._children[F].globalClippingPlanes(this._globalData.globalClippingPlanes,this._globalData.globalClipping)}else{if(this._currentObjectData.id<0)return;this._currentObjectData.clippingPlanes[S.message.id].copy(S.message.plane),this._children[this._currentObjectData.id].copyClippingPlaneObjects(this._currentObjectData.clippingPlanes)}S.notifyUser&&this._publishResponse(S.name,this._packageClippingPlanes(S.message.id)),this._controls.lazyLoadingRequested=!0;break}}_packageEventData(S){if(this._sendObjectDataToServer)for(let F=0;F<this._children.length;F++)this._children[F].packageData(S.ObjectInfo,F);return S=Object.assign({MemoryUsed:this._memory.used},S),S}_broadcastScissorsEvent(S){this._busyInternal(!0,!1),this._publishResponse("ScissorsFinished",S.message)}_broadcastCopyEvent(S){this._publishResponse("AnnotationsCopied",S.message)}_broadcastEditEvent(S){this._publishResponse("AnnotationEdited",S.message)}_broadcastContextMenuEvent(S){this._publishResponse("ContextMenuClicked",S.message)}_broadcastMessageClosedEvent(S){this._publishResponse("MessageClosed",S.message)}_broadcastWidgetAddedEvent(S){this._updateChildrenOnInteraction(!1),this._publishResponse(S.name,{})}_reactToModeChange(S){this._publishResponse("ModeChanged",S.message)}_animationStopped(S){this._publishResponse("AnimationFinished",S.message)}_reactToColorBoxChange(S){this._globalData.uniforms.u_colorBoxColor.value.copy(S.message.boxColor),this._globalData.uniforms.u_colorBoxMatrix.value.copy(S.message.boxMatrix)}_reactToColorBoxUpdate(S){for(let F=0;F<this._children.length;F++)this._children[F].colorInBox(S.message)}_reactToScaleBarUpdate(S){this._controls.setZoomPercent(S.message),this._broadcastMovedEvent()}_packageClippingPlanes(S){return this._globalData.globalClipping?{ClippingPlane:[this._globalData.globalClippingPlanes[S].normal.x,this._globalData.globalClippingPlanes[S].normal.y,this._globalData.globalClippingPlanes[S].normal.z,this._globalData.globalClippingPlanes[S].constant],Index:S+1}:{ClippingPlane:[this._currentObjectData.clippingPlanes[S].normal.x,this._currentObjectData.clippingPlanes[S].normal.y,this._currentObjectData.clippingPlanes[S].normal.z,this._currentObjectData.clippingPlanes[S].constant],Index:S+1}}_packageSlicePlanes(S){return{SlicePlane:[this._currentObjectData.slicePlanes[S].normal.x,this._currentObjectData.slicePlanes[S].normal.y,this._currentObjectData.slicePlanes[S].normal.z,this._currentObjectData.slicePlanes[S].constant],Index:S+1}}_packageCropBox(){switch(this._globalData.cropType){case"box":return{Min:this._globalData.uniforms.u_cropMin.value.toArray(),Max:this._globalData.uniforms.u_cropMax.value.toArray()};case"sphere":return{Center:this._globalData.uniforms.u_cropCenter.value.toArray(),Radius:this._globalData.uniforms.u_cropRadius.value};case"cylinder":return{Center:this._globalData.uniforms.u_cropCenter.value.toArray(),Radius:this._globalData.uniforms.u_cropRadius.value,Height:this._globalData.uniforms.u_cropHeight.value}}return null}_onWindowResize(){this._controls.resize(),this._composer.setSize(this._controls.screen.width,this._controls.screen.height),this._sceneControls(this._composer.getAxesVisibility(),this._scaleBar.visible,this._wireframe.visible),this._clientInitiatedUpdate(),this._controls.lazyLoadingRequested=!0}_broadcastResizeEvent(){this._cleanupInteraction(),this._publishResponse("WindowResized",this._packageEventData(this._controls.packageCameraProperties()))}_cleanupInteraction(){this._updateChildrenOnInteraction(!1),this._setQuality(this._renderingQuality),this._clientInitiatedUpdate(),this._composer.outOfCoreRendering&&(this._clearBlockQueue(),this._controls.lazyLoading=!0)}_updateChildrenOnInteraction(S){if(this._alwaysUpdateOnInteraction||this._composer.iterativeRendering||this._composer.outOfCoreRendering){this._composer.outOfCoreRendering&&(this._nextBlockToRead=null,this._hasReadingStarted=!1,this._numBlocksToRead=0);for(let F=0;F<this._children.length;F++)this._children[F].updateOnInteraction(S)}this._composer.updateOnInteraction(S)}_clientInitiatedUpdate(){this._busy||(this._controls.updateRequested=!0)}_refreshLazyLoading(){if(this._waitingToSync)return;if(this._composer.outOfCoreRendering&&this._waitingForBlock){this._nextBlockToRead=null,this._numBlocksToRead=0;return}const S=this._controls.getFrustum(),F=this._controls.getEyeVector();for(let k=0;k<this._children.length;k++)this._children[k].resetBlocks(this._controls.camera,S,F,this._controls.screen,this._controls._boundingSphere);this._controls.updateRequested=!0,this._numBlocksToRead=0}_clearBlockQueue(){for(let S=0;S<this._children.length;S++)this._children[S].clearBlockQueue()}_lookForReadableBlock(){if(!(this._nextBlockToRead!==null||this._waitingForBlock)){if(this._waitingToSync)if(this._binaryChannelInstructionSet.length>0){const S={id:this._binaryChannelInstructionSet[0].Index};this._nextBlockToRead=this._binaryChannelInstructionSet.shift(),this._waitingForBlock=!0,this._publishResponse("BinaryDataRequested",S)}else this._renderFrontLayerOnly?(this._scaleBar.render(this._controls.camera,this._controls.screen.width,this._controls.screen.height),this._busyInternal(!1,!0),this.renderFrontLayer(),this._publishResponse(this._token,{}),this._controls.lazyLoading?this._controls.lazyLoadingRequested=!0:this._controls.lazyLoading=!0):(this._fitCameraToSceneRequired&&(this._wireframe.setPosition(this._controls.boundingBox),this._grid.setPosition(this._controls.boundingBox),this._controls.fitCameraToBoundingSphere()),this._setQuality(this._renderingQuality),this._updateChildrenOnInteraction(!1),this._sceneControls(this._composer.getAxesVisibility(),this._scaleBar.visible,this._wireframe.visible),this._busyInternal(!1,!0),this._measureMemory(),this._fitCameraToSceneRequired?(this._fitCameraToSceneRequired=!1,this._publishResponse(this._token,this._packageEventData(this._controls.packageCameraPropertiesIfChanged())),this.render()):(this._publishResponse(this._token,this._packageEventData(this._controls.packageProjectionMatrix())),this._controls.updateRequested=!0),this._controls.lazyLoading?this._controls.lazyLoadingRequested=!0:(this._clearBlockQueue(),this._controls.lazyLoading=!0)),this._waitingToSync=!1;else if(this._controls.lazyLoading){let S=null,F=null,k=0;for(let G=this._children.length-1;G>=0;G--)S=this._children[G].findNextBlock(),S!==null&&(k+=S.numBlocksToRead,(F===null||S.distance<F.distance)&&(F=S,F.id=G));F!==null?(this._hasReadingStarted||(this._hasReadingStarted=!0),this._numBlocksToRead===0&&(this._numBlocksToRead=k),this._setSpinnerProgress(this._numBlocksToRead>10?Math.max(Math.floor((this._numBlocksToRead-k)/this._numBlocksToRead*100),1):0),this._waitingForBlock=!0,this._nextBlockToRead=this._children[F.id].getNextBlock(F.index,F.id),this._publishResponse("DeferredDataRequested",{MemoryUsed:this._memory.used,Data:this._nextBlockToRead})):(this._composer.clearPaintPass(),this._hasReadingStarted&&(this._hasReadingStarted=!1,this._numBlocksToRead=0,this._composer.outOfCoreRendering&&(this._composer.clearOverview=!0),this._setSpinnerProgress(100),this._publishResponse("DeferredDataRequested",this._packageEventData({ObjectInfo:[],Data:null})),this._composer.outOfCoreRendering||(this._controls.updateRequested=!0)))}}}_pick(S){if(S.message.point===null||S.message.clickType==="double"){S.message.sendToServer&&this._publishResponse(S.message.eventName,{objectInfo:[],clickType:S.message.clickType,id:S.message.id});return}const F=S.message.point.clone(),k=F.clone().sub(this._controls.camera.position).normalize(),G=new f.Raycaster(this._controls.camera.position,k);G.camera=this._controls.camera;const H=[];for(let q=0;q<this._children.length;q++)this._children[q].pick(G,H,F,this._controls.boundingSphere,this._controls.screen,q);H.sort((q,ce)=>q.distance-ce.distance);for(let q=0;q<H.length;q++)if(H[q].picked&&H[q].distance<.1*this._controls.boundingSphere.radius){F.fromArray(H[q].point);break}S.message.point.copy(F),S.message.sendToServer&&this._publishResponse(S.message.eventName,{objectInfo:H,clickType:S.message.clickType,id:S.message.id})}_measureMemory(){this._memory.refresh(this._children,this._renderer.info)}_measurePerformance(){if(!this._dynamicallyAdjustQuality)return;const S=1e3/(performance.now()-this._timestamp);if(this._rollingFrameRate.push(S),this._rollingFrameRate.length>5){this._rollingFrameRate.splice(0,1);let F=0;for(let k=0;k<this._rollingFrameRate.length;k++)F+=this._rollingFrameRate[k];F/=this._rollingFrameRate.length,F<10?this._reduceQuality(2):F<20?this._reduceQuality(1):F>55&&this._renderingQualityDuringMotion<7&&this._renderingQualityDuringMotion<this._renderingQualityCeiling&&(this._renderingQualityDuringMotion=Math.min(this._renderingQualityDuringMotion+1,7),this._setQuality(this._renderingQualityDuringMotion),this._rollingFrameRate=[])}this._timestamp=performance.now()}_reduceQuality(S){this._renderingQualityDuringMotion>1&&(this._renderingQualityDuringMotion=Math.max(this._renderingQualityDuringMotion-S,0),this._renderingQualityMin===this._renderingQualityDuringMotion&&(this._renderingQualityCeiling=this._renderingQualityDuringMotion),this._renderingQualityMin=Math.min(this._renderingQualityMin,this._renderingQualityDuringMotion),this._setQuality(this._renderingQualityDuringMotion),this._rollingFrameRate=[])}_resetPerformanceMeasurement(){this._timestamp=performance.now()}_setQuality(S){switch(S){case 0:this._setQualityParameters(16,2,.05,1,!1,.001,!1);break;case 1:this._setQualityParameters(16,2,.1,1,!1,.001,this._composer.depthPeelAllowed);break;case 2:this._setQualityParameters(16,2,.1,2,!1,.001,this._composer.depthPeelAllowed);break;case 3:this._setQualityParameters(8,2,.1,2,!1,.001,this._composer.depthPeelAllowed);break;case 4:this._setQualityParameters(4,2,.2,2,!1,.001,this._composer.depthPeelAllowed);break;case 5:this._setQualityParameters(2,2,.2,2,!1,.001,this._composer.depthPeelAllowed);break;case 6:this._setQualityParameters(2,1.5,.2,3,!1,.001,this._composer.depthPeelAllowed);break;case 7:this._setQualityParameters(2,1,.4,4,!1,.001,this._composer.depthPeelAllowed);break;case 8:this._setQualityParameters(1,1,.5,5,!1,.001,this._composer.depthPeelAllowed);break;case 9:this._setQualityParameters(1,1,1,50,!0,1e-4,this._composer.depthPeelAllowed);break;case 10:this._setQualityParameters(1,.2,1,50,!0,1e-4,this._composer.depthPeelAllowed);break;case 11:this._setQualityParameters(1,.1,1,100,!0,1e-4,this._composer.depthPeelAllowed);break}}_setQualityParameters(S,F,k,G,H,q,ce){const Q=this._renderingPixelRatio,ne=this._globalData.renderingStepSize;if(this._renderingPixelRatio=S,this._globalData.renderingStepSize=F,this._globalData.uniforms.u_lightRaySteps.value=k,this._composer.setQualityParameters(G,H,q,ce),ne!==this._globalData.renderingStepSize)for(let he=0;he<this._children.length;he++)this._children[he].quality(this._globalData.renderingStepSize);Q!==this._renderingPixelRatio&&this._composer.setPixelRatio(this._renderingPixelRatio)}render(){this._scaleBar.render(this._controls.camera,this._controls.screen.width,this._controls.screen.height),this._composer.render(this._controls.camera,this._globalData.uniforms),this._controls.renderText(),this._controls.iterativeUpdateRequested=this._composer.iterativeRendering,this._lookForReadableBlock()}renderFrontLayer(){this._controls.renderText(),this._composer.renderOverlay(this._controls.camera,this._globalData.uniforms)}renderDeferredLayer(){this._composer.renderDeferredLayer(this._controls.camera,this._globalData.uniforms)}renderIterativeLayer(){const S=this._composer.getIterativeProgress();this._setSpinnerProgress(S),S>=100?this._controls.iterativeUpdateRequested=!1:this._composer.renderIterativeLayer(this._controls.camera,this._globalData.uniforms)}animate(){this._controls.update(),this._animationID=requestAnimationFrame(this.animate.bind(this))}setScreenPosition(){this._controls.setScreenPosition()}testWebGLContext(){this._renderer.forceContextLoss(),setTimeout(function(){this._renderer.forceContextRestore()}.bind(this),1e3)}}},R,W),R.exports=I},3771:(R,W,d)=>{var O,I;O=[d(40),d(1082),d(4868),d(678)],I=d.dj.d(O,function(f,N,b,h){return class extends N{refreshData(o,c,u){let g=c.NumChannels!==this._numChannels;this._setNumChannels(c.NumChannels);const m=Array.from(c.Size),y=Array.from(c.OverlaySize),x=c.DataModified,w=c.OverlayDataModified,C=c.AlphaDataModified,P=c.UseAlphaData;if(!x&&!w&&!C)return;const T=new Uint8Array(o);this._priorSize.copy(this._size),this._updateSize(m,y),this._updateGeometry(c,u);let M=0;x&&(this._texture!==null&&this._texture.dispose(),this._isDataEmpty=Math.max(...m)===0,this._isDataEmpty?this._texture=null:(M=this._numChannels*this._size.x*this._size.y*this._size.z,this._initTexture(T.slice(0,M),this._size)),this._mesh.material.uniforms.u_data.value=this._texture),C&&(this._alphaTexture!==null&&this._alphaTexture.dispose(),P?(this._initAlphaTexture(T.slice(M,M+this._size.x*this._size.y*this._size.z),this._size),M+=this._size.x*this._size.y*this._size.z):this._alphaTexture=null,this._mesh.material.uniforms.u_alphaData.value=this._alphaTexture),w&&(this._overlayTexture!==null&&this._overlayTexture.dispose(),this._isOverlayEmpty=Math.max(...y)===0,this._isOverlayEmpty?(this._overlayTexture=null,this._includeOverlay&&(this._includeOverlay=!1,this._overlayDefines="",g=!0)):(this._initOverlayTexture(T.slice(M,T.length),this._size),this._includeOverlay||(this._includeOverlay=!0,this._overlayDefines="#define USE_OVERLAY",g=!0)),this._mesh.material.uniforms.u_overlayData.value=this._overlayTexture),g&&this._updateFragmentShader(),this._setDataSliceTextures()}add(o,c){this._texture=null,this._overlayTexture=null,this._alphaTexture=null;const u=f.UniformsUtils.clone(this._shader.uniforms);u.u_data.value=this._texture,u.u_overlayData.value=this._overlayTexture,u.u_alphaData.value=this._alphaTexture,u.u_size.value.copy(this._size),this._setGlobalUniforms(u);const g=new f.BoxGeometry;g.scale(this._size.x,this._size.y,this._size.z),g.translate(this._size.x/2+this._offset.x,this._size.y/2+this._offset.y,this._size.z/2+this._offset.z),this._mesh=new f.Mesh(g,this._initMaterial(u)),this._mesh.visible=o.Visible,this._mesh.matrixAutoUpdate=!1,this._mesh.matrix=this._initTransform(Array.from(o.Transform)),this._scene.add(this._mesh),this.quality(c.renderingStepSize),this._initDepthMesh(u,g,o),this.globalClippingPlanes(c.globalClippingPlanes,c.globalClipping),this._setProperties(o)}pick(o,c,u,g,m,y){if(this._pickable&&this._mesh!==null&&this._mesh.visible&&!this._clipped(u)){const x=[];if(this._mesh.raycast(o,x),x.length>0)if(x.sort((w,C)=>w.distance-C.distance),this._renderingStyle===1){const w=this._mesh.material.uniforms.slicePlanes.value,C=w.length/4;if(C===0)return;const P=new f.Plane,T=new f.Vector3;let M=Number.MAX_SAFE_INTEGER,z;for(let Y=0;Y<C;Y++)P.setComponents(w[4*Y],w[4*Y+1],w[4*Y+2],w[4*Y+3]).applyMatrix4(this._mesh.matrixWorld),z=Math.abs(P.distanceToPoint(u)),z<M&&(M=z,P.projectPoint(u,T));c.push({point:T.toArray(),distance:M,object:y,picked:!0,id:-1})}else c.push({point:u.toArray(),distance:0,object:y,picked:!1,id:-1})}}copySlicePlaneObjects(o){let c=null;const u=o.length,g=new f.Matrix4,m=new f.Plane;if(u>0)if(c=new Float32Array(o.length*4),this._scaleFactor[0]>1||this._scaleFactor[1]>1||this._scaleFactor[2]>1){g.makeScale(1/this._scaleFactor[0],1/this._scaleFactor[1],1/this._scaleFactor[2]);for(let y=0;y<u;y++)m.copy(o[y]).applyMatrix4(g),c[y*4]=m.normal.x,c[y*4+1]=m.normal.y,c[y*4+2]=m.normal.z,c[y*4+3]=m.constant}else for(let y=0;y<u;y++)c[y*4]=o[y].normal.x,c[y*4+1]=o[y].normal.y,c[y*4+2]=o[y].normal.z,c[y*4+3]=o[y].constant;this._mesh.material.uniforms.slicePlanes.value=c,this._numSlicePlanes!==u&&(this._numSlicePlanes=u,this._updateFragmentShader())}clipIntersection(o){if(this._clipIntersection=o,this._clipIntersectionDefines=o===!0?"#define CLIP_INTERSECTION":"",this._updateFragmentShader(),this._useDataSlices)for(let c=0;c<this._dataSlices.length;c++)this._dataSlices[c].clipIntersection(o)}lighting(o){this._lightingDefines=o>0?"#define USE_LIGHTING":"",this._renderingStyle===7&&this._setLayer(this._layer),this._numSecondaryLights=o-1,this._updateFragmentShader()}cameraStyle(o){this._cameraDefines=o==="perspective"?"#define USE_PERSPECTIVE_CAMERA":"",this._updateFragmentShader()}updateWindowLevel(o){const c=Math.max(this._mesh.material.uniforms.u_clim.value.y-this._mesh.material.uniforms.u_clim.value.x+o.x,0),u=this._mesh.material.uniforms.u_clim.value.x+c/2+o.y;this._mesh.material.uniforms.u_clim.value.x=u-c/2,this._mesh.material.uniforms.u_clim.value.y=this._mesh.material.uniforms.u_clim.value.x+c}getWindowLevel(){return this._mesh!==null?this._mesh.material.uniforms.u_clim.value.toArray():null}_updateSize(o,c){const u=this._smallVolumeScaleFactor!==1;Math.max(...o)>0?this._size.set(o[0],o[1],o[2]):Math.max(...c)>0?this._size.set(c[0],c[1],c[2]):this._size.set(1,1,1);const g=Math.sqrt(Math.pow(this._size.x,2)+Math.pow(this._size.y,2)+Math.pow(this._size.z,2));this._smallVolumeScaleFactor=g<50?g/100:1;const m=this._smallVolumeScaleFactor!==1;this._smallVolumeDefines=m===!0?"#define USE_SMALL_VOLUME":"",m!==u&&this._updateFragmentShader()}_setNumChannels(o){switch(o){case 1:this._shaderDefines="",this._numChannels=1;break;case 2:this._shaderDefines="",this._numChannels=1;break;case 3:this._shaderDefines="#define RGB_SHADER",this._numChannels=3;break;case 4:this._shaderDefines=["#define RGB_SHADER","#define RGBA_SHADER"].join(`
`),this._numChannels=4;break}}getMemoryUsed(){let o=0;return this._texture!==null&&(o+=this._size.x*this._size.y*this._size.z*this._numChannels/1e6),this._overlayTexture!==null&&(o+=this._size.x*this._size.y*this._size.z/1e6),this._alphaTexture!==null&&(o+=this._size.x*this._size.y*this._size.z/1e6),o}quality(o){this._mesh.material.uniforms.u_relativeStepSize.value=o*this._smallVolumeScaleFactor}updateOnInteraction(o){this._mesh.material.uniforms.u_interactionStarted.value=o?1:0}crop(o,c){if(this._numCropBoxes=c===!0?1:0,this._cropDefines=o===!0?"#define CROP_EXCLUDE":"",this._cropTypeDefines=this._setCropTypeDefines(this._globalData.cropType),this._updateFragmentShader(),this._useDataSlices)for(let u=0;u<this._dataSlices.length;u++)this._dataSlices[u].crop(o,c)}colorInBox(o){if(this._colorBoxDefines=o===!0?"#define COLOR_BOX":"",this._updateFragmentShader(),this._useDataSlices)for(let c=0;c<this._dataSlices.length;c++)this._dataSlices[c].colorInBox(o)}_depthSensitivity(o){this._mesh.material.uniforms.u_depthSensitivity.value=o}_specular(o,c){this._mesh.material.uniforms.u_specularStrength.value=o,this._mesh.material.uniforms.u_shininess.value=c}globalClippingPlanes(o,c){if(this._localClipping=!c,c?this._setClippingUniforms(o):this._setClippingUniforms(this._clippingPlanes),this._useDataSlices)for(let u=0;u<this._dataSlices.length;u++)this._dataSlices[u].globalClippingPlanes(o,c)}_setClippingUniforms(o){const c=o!==null?o.length:0;let u=null;if(c!==0){u=new Float32Array(c*4);for(let g=0;g<c;g++)u[g*4]=o[g].normal.x,u[g*4+1]=o[g].normal.y,u[g*4+2]=o[g].normal.z,u[g*4+3]=o[g].constant}this._mesh.material.clippingPlanes=o,this._mesh.material.uniforms.worldCoordClippingPlanes.value=u,this._depthMesh!==null&&(this._depthMesh.material.clippingPlanes=o,this._depthMesh.material.uniforms.worldCoordClippingPlanes.value=u)}_initDepthMesh(o,c,u){const g=new f.ShaderMaterial({transparent:!0,clipping:!0,uniforms:o,defines:this._shader.defines,premultipliedAlpha:!0,vertexShader:this._shader.vertexShader,fragmentShader:this._getFragmentShader(!0),side:f.BackSide});this._depthMesh=new f.Mesh(c,g),this._depthMesh.visible=u.Visible,this._depthMesh.matrixAutoUpdate=!1,this._depthMesh.matrix=this._initTransform(Array.from(u.Transform)),this._depthScene.add(this._depthMesh)}localClippingPlanes(o){if(this._initPlanes(o),this._localClipping&&this._setClippingUniforms(this._clippingPlanes),this._useDataSlices)for(let c=0;c<this._dataSlices.length;c++)this._dataSlices[c].localClippingPlanes(o)}copyClippingPlaneObjects(o){this._clippingPlanes=o,this._localClipping&&this._setClippingUniforms(this._clippingPlanes)}_rendererType(o){const c=this._renderingStyle;switch(o){case"VolumeRendering":this._renderingStyle=0,this._renderingDefines="#define USE_VOLUME_RENDERING",this._cinematicDefines="",this._gradientOpacityDefines="";break;case"SlicePlanes":this._renderingStyle=1,this._renderingDefines="#define USE_SLICE_PLANES",this._cinematicDefines="";break;case"MaximumIntensityProjection":this._renderingStyle=2,this._renderingDefines="#define USE_MAXIP",this._cinematicDefines="";break;case"MinimumIntensityProjection":this._renderingStyle=3,this._renderingDefines="#define USE_MINIP",this._cinematicDefines="";break;case"Isosurface":this._renderingStyle=4,this._renderingDefines="#define USE_ISOSURFACE",this._cinematicDefines="";break;case"GradientOpacity":this._renderingStyle=5,this._renderingDefines="#define USE_VOLUME_RENDERING",this._cinematicDefines="",this._gradientOpacityDefines="#define USE_GRADIENT_OPACITY";break;case"LightScattering":this._renderingStyle=6,this._renderingDefines="#define USE_VOLUME_RENDERING",this._gradientOpacityDefines="",this._cinematicDefines=this._hardwareDefines==="#define HARDWARE_WEBGL"?"#define USE_LIGHT_SCATTERING":"";break;case"CinematicRendering":this._renderingStyle=7,this._renderingDefines="#define USE_VOLUME_RENDERING",this._gradientOpacityDefines="",this._cinematicDefines=`#define USE_CINEMATIC_RENDERING
#define USE_LIGHT_SCATTERING`;break}this._renderingStyle!==c&&(this._needsUpdate=!0)}_overlayRendererType(o){const c=this._overlayRenderingStyle;switch(o){case"VolumeOverlay":this._overlayRenderingStyle=0,this._overlayRenderingDefines="",this._overlayGradientDefines="",this._overlayFilter=f.LinearFilter;break;case"GradientOverlay":this._overlayRenderingStyle=1,this._overlayRenderingDefines="",this._overlayGradientDefines="#define USE_GRADIENT_OVERLAY",this._overlayFilter=f.LinearFilter;break;case"LabelOverlay":this._overlayRenderingStyle=2,this._overlayRenderingDefines="#define USE_LABEL_OVERLAY",this._overlayGradientDefines="",this._overlayFilter=f.NearestFilter;break}this._overlayRenderingStyle!==c&&(this._needsUpdate=!0,this._overlayTexture!==null&&(this._overlayTexture.minFilter=this._overlayTexture.magFilter=this._overlayFilter,this._overlayTexture.needsUpdate=!0))}_lightScattering(o){o==="auto"?this._mesh.material.uniforms.u_lightRaySteps=this._globalUniforms.u_lightRaySteps:this._mesh.material.uniforms.u_lightRaySteps={value:o}}_initColormapTexture(o,c){const m=new Uint8Array(1024);for(let x=0;x<256;x++)m[x*4]=o[0][x],m[x*4+1]=o[1][x],m[x*4+2]=o[2][x],m[x*4+3]=c[x];const y=new f.DataTexture(m,1,256,f.RGBAFormat,f.UnsignedByteType);return y.needsUpdate=!0,y}_slicePlanes(o,c){let u=null;const g=o.length/4,m=new f.Matrix4,y=new f.Plane;if(g>0)if(c[0]>1||c[1]>1||c[2]>1){u=new Float32Array(o.length),m.makeScale(1/c[0],1/c[1],1/c[2]);for(let x=0;x<g;x++)y.setComponents(o[x*4],o[x*4+1],o[x*4+2],o[x*4+3]).applyMatrix4(m),u[x*4]=y.normal.x,u[x*4+1]=y.normal.y,u[x*4+2]=y.normal.z,u[x*4+3]=y.constant}else u=Array.from(o);this._scaleFactor=c,this._mesh.material.uniforms.slicePlanes.value=u,this._numSlicePlanes!==g&&(this._numSlicePlanes=g,this._needsUpdate=!0)}_overlayTransferFunction(o,c){this._mesh.material.uniforms.u_overlayTransferFunction.value!==null&&this._mesh.material.uniforms.u_overlayTransferFunction.value.dispose(),this._mesh.material.uniforms.u_overlayTransferFunction.value=this._initColormapTexture(o,c)}_updateFragmentShader(){this._mesh.material.fragmentShader=this._getFragmentShader(!1),this._mesh.material.needsUpdate=!0,this._depthMesh!==null&&(this._depthMesh.material.fragmentShader=this._getFragmentShader(!0),this._depthMesh.material.needsUpdate=!0)}_getFragmentShader(o){let c=this._replaceConstants(this._shader.fragmentShader,this._numSlicePlanes,this._numSecondaryLights,this._numCropBoxes);return c=[this._hardwareDefines,this._renderingDefines,this._shaderDefines,this._overlayDefines,this._overlayRenderingDefines,this._overlayGradientDefines,this._alphaDataDefines,this._clipIntersectionDefines,this._lightingDefines,this._cameraDefines,this._smallVolumeDefines,this._cinematicDefines,this._gradientOpacityDefines,this._cropDefines,this._colorBoxDefines,this._cropTypeDefines,c].join(`
`),o?c=["#define DEPTH_SHADER",c].join(`
`):c=[this._isosurfaceDefines,c].join(`
`),c}_replaceConstants(o,c,u,g){return o.replace(/NUM_SLICE_PLANES/g,c).replace(/NUM_SECONDARY_LIGHTS/g,u).replace(/NUM_CROP_BOXES/g,g)}_initMaterial(o){return new f.ShaderMaterial({transparent:!0,clipping:!0,uniforms:o,defines:this._shader.defines,vertexShader:this._shader.vertexShader,fragmentShader:this._getFragmentShader(!1),blending:this._blendOp,depthTest:!0,depthFunc:f.AlwaysDepth,depthWrite:!0,side:f.BackSide})}_setProperties(o){if(this._setDataSlices(o,o.DataSlices),this._visible(o.Visible),this._slicePlanes(new Float32Array(o.SlicePlanes),Array.from(o.DownsampleLevel)),this._transform(Array.from(o.Transform)),this._gradientOpacity(Array.from(o.GradientOpacityLimits)),this._isosurface(o.Isovalue,o.SmoothIsosurface),this._rendererType(o.RenderingStyle),this._overlayRendererType(o.OverlayRenderingStyle),this._lightScattering(o.ScatterQuality),this._setAlphaData(o.UseAlphaData),this._rgbAnchorColor(o.RGBAnchorColor),this._colormap(Array.from(o.Colormap),Array.from(o.Alphamap)),this._clim(o.ColorLimits),this._climOverlay(o.OverlayColorLimits),this._overlayTransferFunction(Array.from(o.OverlayColormap),Array.from(o.OverlayAlphamap)),this.localClippingPlanes(o.ClippingPlanes),this._interpolation(o.Interpolation),this._depthSensitivity(o.DepthSensitivity),this._specular(o.Specular,o.Shininess),this._anisotropy(),this._setPickable(o.Pickable),this._setLayer(o.Layer),this._useDataSlices)for(let c=0;c<this._dataSlices.length;c++)this._dataSlices[c].setPropertiesFromVolume(o);this._needsUpdate&&(this._needsUpdate=!1,this._updateFragmentShader())}_initTexture(o,c){switch(this._texture=new f.DataTexture3D(o,c.x,c.y,c.z),this._texture.type=f.UnsignedByteType,this._texture.generateMipmaps=!1,this._texture.unpackAlignment=1,this._texture.minFilter=this._filter,this._texture.magFilter=this._filter,this._numChannels){case 1:this._texture.format=f.RedFormat;break;case 2:this._texture.format=f.RGFormat;break;case 3:this._texture.format=f.RGBFormat;break;case 4:this._texture.format=f.RGBAFormat;break}}_initOverlayTexture(o,c){this._overlayTexture=new f.DataTexture3D(o,c.x,c.y,c.z),this._overlayTexture.format=f.RedFormat,this._overlayTexture.type=f.UnsignedByteType,this._overlayTexture.minFilter=this._overlayFilter,this._overlayTexture.magFilter=this._overlayFilter,this._overlayTexture.generateMipmaps=!1,this._overlayTexture.unpackAlignment=1,this._overlayTexture.needsUpdate=!0}_initAlphaTexture(o,c){this._alphaTexture=new f.DataTexture3D(o,c.x,c.y,c.z),this._alphaTexture.format=f.AlphaFormat,this._alphaTexture.type=f.UnsignedByteType,this._alphaTexture.minFilter=this._filter,this._alphaTexture.magFilter=this._filter,this._alphaTexture.generateMipmaps=!1,this._alphaTexture.unpackAlignment=1,this._alphaTexture.needsUpdate=!0}_interpolation(o){this._filter=o==="bilinear"?f.LinearFilter:f.NearestFilter,this._texture!==null&&this._texture.magFilter!==this._filter&&(this._texture.minFilter=this._texture.magFilter=this._filter,this._texture.needsUpdate=!0),this._alphaTexture!==null&&this._alphaTexture.magFilter!==this._filter&&(this._alphaTexture.minFilter=this._alphaTexture.magFilter=this._filter,this._alphaTexture.needsUpdate=!0)}_gradientOpacity(o){this._mesh.material.uniforms.u_gradientOpacityLimits.value=new f.Vector2(o[0],o[1])}_isosurface(o,c){this._mesh.material.uniforms.u_isovalue.value=o[0];const u=this._isoalpha;this._isoalpha=o[1],this._mesh.material.uniforms.u_isoalpha.value=this._isoalpha,(c!==this._smoothIsosurface||this._isoalpha===1&&u!==1||this._isoalpha!==1&&u===1)&&(this._smoothIsosurface=c,this._isosurfaceDefines=[this._smoothIsosurface===!0?"#define REFINE_ISOSURFACE":"",this._isoalpha<1?"#define TRANSPARENT_ISOSURFACE":""].join(`
`),this._needsUpdate=!0)}_colormap(o,c){this._mesh.material.uniforms.u_transferFunction.value!==null&&this._mesh.material.uniforms.u_transferFunction.value.dispose(),this._mesh.material.uniforms.u_transferFunction.value=this._initColormapTexture(o,c)}_clim(o){this._mesh.material.uniforms.u_clim.value.fromArray(o)}_climOverlay(o){this._mesh.material.uniforms.u_overlayclim.value.fromArray(o)}_anisotropy(){const o=new f.Vector3;o.setFromMatrixScale(this._mesh.matrix),o.x=Math.abs(o.x),o.y=Math.abs(o.y),o.z=Math.abs(o.z);let c=o.x;c=o.y<c?o.y:c,c=o.z<c?o.z:c,o.divideScalar(c),this._mesh.material.uniforms.u_anisotropy.value.copy(o)}_setAlphaData(o){o!==this._useAlphaData&&(this._useAlphaData=o,this._alphaDataDefines=this._useAlphaData===!0?"#define USE_ALPHA_DATA":"",this._needsUpdate=!0)}_rgbAnchorColor(o){this._mesh.material.uniforms.u_rgbAnchorColor.value.fromArray(o)}_getBufferLength(o){let c=0;const u=o.OverlaySize,g=o.Size;return Math.max(...g)>0&&(c+=g[0]*g[1]*g[2]*o.NumChannels),Math.max(...u)>0&&(c+=u[0]*u[1]*u[2]),c}_constructProperties(o,c){this._globalData=c,this._size=new f.Vector3(1,1,1),this._priorSize=new f.Vector3(1,1,1),this._offset=new f.Vector3(.5,.5,.5),this._priorOffset=new f.Vector3(.5,.5,.5),this._matrix=new f.Matrix4,this._smallVolumeScaleFactor=1,this._smallVolumeDefines="",this._includeOverlay=!1,this._renderingStyle=0,this._overlayRenderingStyle=2,this._overlayFilter=f.NearestFilter,this._useAlphaData=!1,this._smoothIsosurface=!0,this._isoalpha=1,this._numSlicePlanes=0,this._numSecondaryLights=c.numLights-1,this._scaleFactor=[1,1,1],this._blendOp=f.NoBlending,this._layer=0,this._shader=h,c.volumeIterator<20&&(this._shader.uniforms.u_jitter.value=c.volumeIterator/5e4),this._filter=f.LinearFilter,this._setNumChannels(o.NumChannels),this._isosurfaceDefines="#define REFINE_ISOSURFACE",this._renderingDefines="#define USE_VOLUME_RENDERING",this._clipIntersection=c.clipIntersection,this._clipIntersectionDefines=c.clipIntersection===!0?"#define CLIP_INTERSECTION":"",this._lightingDefines=c.lighting===!0?"#define USE_LIGHTING":"",this._cropDefines=c.cropBoxExclude===!0?"#define CROP_EXCLUDE":"",this._cropTypeDefines=this._setCropTypeDefines(c.cropType),this._colorBoxDefines="",this._alphaDataDefines="",this._overlayDefines="",this._overlayRenderingDefines="#define USE_LABEL_OVERLAY",this._overlayGradientDefines="",this._hardwareDefines=c.hardwareSupport===!0?"#define HARDWARE_WEBGL":"",this._cameraDefines=c.cameraStyle==="perspective"?"#define USE_PERSPECTIVE_CAMERA":"",this._cinematicDefines="",this._gradientOpacityDefines="",this._useDataSlices=!1,this._dataSlices=[]}_setGlobalUniforms(o){super._setGlobalUniforms(o),o.u_lightColor=this._globalUniforms.u_lightColor,o.u_primaryLight=this._globalUniforms.u_primaryLight,o.u_cameraTarget=this._globalUniforms.u_cameraTarget,o.u_ambientStrength=this._globalUniforms.u_ambientStrength,o.u_primaryLightIntensity=this._globalUniforms.u_primaryLightIntensity,o.u_lightRaySteps=this._globalUniforms.u_lightRaySteps,o.u_deferredTexture=this._globalUniforms.u_deferredTexture,o.u_secondaryLight=this._globalUniforms.u_secondaryLight,o.u_secondaryLightIntensity=this._globalUniforms.u_secondaryLightIntensity}_updateGeometry(o,c){(this._size.distanceToSquared(this._priorSize)>1e-4||this._offset.distanceToSquared(this._priorOffset)>1e-4)&&(this._mesh.geometry.translate(-this._priorSize.x/2-this._priorOffset.x,-this._priorSize.y/2-this._priorOffset.y,-this._priorSize.z/2-this._priorOffset.z),this._mesh.geometry.scale(this._size.x/this._priorSize.x,this._size.y/this._priorSize.y,this._size.z/this._priorSize.z),this._mesh.geometry.translate(this._size.x/2+this._offset.x,this._size.y/2+this._offset.y,this._size.z/2+this._offset.z),this._mesh.material.uniforms.u_size.value.set(this._size.x,this._size.y,this._size.z),this.quality(c))}_setLayer(o){this._layer=o;const c=this._renderingStyle===7&&this._lightingDefines!==""?16:0;this._mesh.layers.set(this._layer+c),this._depthMesh!==null&&this._depthMesh.layers.set(this._layer+c)}_setDataSliceTransformation(){const o=this._mesh.matrix.clone();o.invert();for(let c=0;c<this._dataSlices.length;c++)this._dataSlices[c].setVolumeInverseMatrix(o)}_setDataSliceTextures(){for(let o=0;o<this._dataSlices.length;o++)this._dataSlices[o].setVolumeDataTextures(this._texture,this._overlayTexture,this._alphaTexture,this._size),this._dataSlices[o].setVolumeDefines(this._shaderDefines,this._overlayDefines,this._alphaDataDefines)}_setDataSlices(o,c){if(c!==void 0){if(c.NumSlices<this._dataSlices.length)for(let u=0;u<this._dataSlices.length;u++)this._dataSlices[u].remove();for(let u=0;u<this._dataSlices.length;u++)this._dataSlices[u]._visible(!1);if(c.NumSlices===0){this._useDataSlices=!1;for(let u=0;u<this._dataSlices.length;u++)this._dataSlices[u].remove();this._dataSlices=[]}else if(c.NumSlices<this._dataSlices.length)for(let u=c.NumSlices;u<this._dataSlices.length;u++)this._dataSlices[u].remove();else if(c.NumSlices>this._dataSlices.length){let u;for(let g=this._dataSlices.length;g<c.NumSlices;g++)u=new b(this._scene,this._depthScene,o,this._globalData),u._visible(!1),this._dataSlices.push(u)}if(c.NumSlices>0)if(this._useDataSlices=!0,this._setDataSliceTextures(),this._setDataSliceTransformation(),c.NumSlices===1)this._dataSlices[0].setSliceProperties(c.Slices),this._dataSlices[0]._visible(!0);else for(let u=0;u<this._dataSlices.length;u++)this._dataSlices[u].setSliceProperties(c.Slices[u]),this._dataSlices[u]._visible(!0)}}}},R,W),R.exports=I},678:(R,W,d)=>{var O,I;O=[d(40)],I=d.dj.d(O,function(f){return{defines:{TOLERANCE:1e-6},uniforms:{u_size:{value:new f.Vector3(1,1,1)},u_anisotropy:{value:new f.Vector3(1,1,1)},u_visible:{value:1},u_clim:{value:new f.Vector2(0,1)},u_isovalue:{value:.15},u_isoalpha:{value:1},u_primaryLight:{value:new f.Vector3(1,1,1)},u_lightColor:{value:new f.Vector4(1,1,1,1)},u_ambientStrength:{value:.3},u_primaryLightIntensity:{value:.6},u_specularStrength:{value:.2},u_shininess:{value:16},u_cameraTarget:{value:new f.Vector3},u_data:{value:null},u_transferFunction:{value:null},u_alphaData:{value:null},u_relativeStepSize:{value:1},u_lightRaySteps:{value:.5},u_gradientOpacityLimits:{value:new f.Vector2(0,.3)},u_secondaryLight:{value:null},u_secondaryLightIntensity:{value:null},u_rgbAnchorColor:{value:new f.Vector3(0,0,0)},slicePlanes:{value:null},worldCoordClippingPlanes:{value:null},u_overlayData:{value:null},u_overlayTransferFunction:{value:null},u_overlayclim:{value:new f.Vector2(0,1)},u_passNumber:{value:0},u_depthTexture:{value:null},u_previousTexture:{value:null},u_viewportSize:{value:new f.Vector2(1,1)},u_depthSensitivity:{value:.01},u_interactionStarted:{value:0},u_jitter:{value:0},u_offset:{value:new f.Vector3(0,0,0)},u_totalSize:{value:new f.Vector3(1,1,1)},u_deferredTexture:{value:null},u_cropMin:{value:new f.Vector3(0,0,0)},u_cropMax:{value:new f.Vector3(1,1,1)},u_cropCenter:{value:new f.Vector3(.5,.5,.5)},u_cropRadius:{value:0},u_cropHeight:{value:0}},vertexShader:`varying vec4 v_nearpos;
        varying vec4 v_farpos;
        varying vec3 v_position;
        
        flat varying vec3 v_localCameraPosition;
        flat varying vec3 v_localLightPosition;
        flat varying vec3 v_localCameraTarget;
        flat varying mat4 inverseModelMatrix;
        
        uniform vec3 u_primaryLight;
        uniform vec3 u_cameraTarget;
        
        void main() {
            // Prepare transforms to map to "camera view". See also:
            // https://threejs.org/docs/#api/renderers/webgl/WebGLProgram
            mat4 inverseModelViewMatrix = inverse(modelViewMatrix);
            inverseModelMatrix = inverse(modelMatrix);
        
            // Project local vertex coordinate to camera position. Then do a step
            // backward (in cam coords) to the near clipping plane, and project back. Do
            // the same for the far clipping plane. This gives us all the information we
            // need to calculate the ray and truncate it to the viewing cone.
            vec4 pos4 = vec4(position, 1.0);
            vec4 posCameraCoordinates = modelViewMatrix * pos4;
        
            // Intersection of ray and near clipping plane (z = -1 in clip coords)
            posCameraCoordinates.z = -posCameraCoordinates.w;
            v_nearpos = inverseModelViewMatrix * posCameraCoordinates;
        
            // Intersection of ray and far clipping plane (z = +1 in clip coords)
            posCameraCoordinates.z = posCameraCoordinates.w;
            v_farpos = inverseModelViewMatrix * posCameraCoordinates;
        
            // Set position as varying in local coordinates
            v_position = position;
        
            // Set vertex position in world coordinates projected into camera coordinates
            gl_Position = projectionMatrix * viewMatrix * modelMatrix * pos4;
        
            vec4 localCameraPosition = inverse(modelMatrix) * vec4(cameraPosition, 1.0);
            vec4 localLightPosition = inverse(modelMatrix) * vec4(u_primaryLight, 1.0);
            vec4 localCameraTarget = inverse(modelMatrix) * vec4(u_cameraTarget, 1.0);
        
            v_localCameraPosition = localCameraPosition.xyz;
            v_localLightPosition = localLightPosition.xyz;
            v_localCameraTarget = localCameraTarget.xyz;
        }`,fragmentShader:`
        //---------------------------------------------------------------------
        // Fragment shader for grayscale and rgb volume rendering
        //---------------------------------------------------------------------
        
        // Copyright 2021-2023 The MathWorks, Inc.
        
        // Specify precision when using floats and data textures
        precision highp float;
        precision mediump sampler3D;
        
        // Varying uniforms computed by the vertex shader and interpolated
        // for the corresponding fragment
        varying vec3 v_position;
        varying vec4 v_nearpos;
        varying vec4 v_farpos;
        flat varying vec3 v_localCameraPosition;
        flat varying vec3 v_localLightPosition;
        flat varying vec3 v_localCameraTarget;
        flat varying mat4 inverseModelMatrix;
        
        uniform mat4 modelMatrix;
        uniform mat4 modelViewMatrix;
        uniform mat4 projectionMatrix;
        
        // Data texture uniform
        uniform sampler3D u_data;
        uniform sampler3D u_overlayData;
        uniform sampler3D u_alphaData;
        
        // Size (dims 1-3) of data texture
        uniform vec3 u_size;
        
        // Step size along ray through volume. Increase this to take more 
        // steps and improve quality at the cost of performance
        uniform float u_relativeStepSize;
        uniform float u_lightRaySteps;
        
        // Uniforms used with depth peeling
        uniform sampler2D u_depthTexture;
        uniform int u_passNumber;
        uniform vec2 u_viewportSize;
        uniform sampler2D u_previousTexture;
        uniform float u_depthSensitivity;
        uniform float u_interactionStarted;
        
        // Internal constants
        const int refinementSteps = 8;
        #ifdef USE_CINEMATIC_RENDERING
            const int maxLightRaySteps = 200;
        #else
            const int maxLightRaySteps = 100;
        #endif
        
        // Lighting uniforms (position, color, etc. not currently exposed)
        uniform vec4 u_lightColor;
        uniform vec3 u_primaryLight;
        uniform float u_primaryLightIntensity;
        uniform vec3 u_cameraTarget;
        uniform float u_ambientStrength;
        uniform float u_specularStrength;
        uniform float u_shininess;
        
        // Isosurface uniforms
        uniform float u_isovalue;
        #ifdef TRANSPARENT_ISOSURFACE
            uniform float u_isoalpha;
        #endif
        
        // Texture to sample transfer function
        uniform sampler2D u_transferFunction;
        
        #ifdef RGB_SHADER
            uniform vec3 u_rgbAnchorColor;
        #endif
        
        #ifndef RGB_SHADER
            // Uniform to control dynamic range
            uniform vec2 u_clim;
        #endif
        uniform vec2 u_overlayclim;
        
        #ifdef COLOR_BOX
            uniform mat4 u_colorBoxMatrix;
            uniform vec3 u_colorBoxColor;
        #endif
        
        const float gradientWeight = 100.0;
        uniform float u_jitter;
        uniform vec3 u_anisotropy;
        
        #ifdef USE_BLOCKED_RENDERING
            uniform vec3 u_offset;
            uniform vec3 u_totalSize;
            uniform sampler2D u_deferredTexture;
        #endif
        
        // Gradient opacity uniforms
        uniform vec2 u_gradientOpacityLimits;
        
        // Overlay uniforms
        uniform sampler2D u_overlayTransferFunction;
        
        #if NUM_CLIPPING_PLANES > 0
            uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
            uniform vec4 worldCoordClippingPlanes[ NUM_CLIPPING_PLANES ];
        #endif
        
        #if NUM_SLICE_PLANES > 0
            uniform vec4 slicePlanes[ NUM_SLICE_PLANES ];
        #endif
        
        #if NUM_SECONDARY_LIGHTS > 0
            uniform vec3 u_secondaryLight[ NUM_SECONDARY_LIGHTS ];
            uniform float u_secondaryLightIntensity[ NUM_SECONDARY_LIGHTS ];
        #endif
        
        #if NUM_CROP_BOXES > 0
            uniform vec3 u_cropMin;
            uniform vec3 u_cropMax;
            uniform vec3 u_cropCenter;
            uniform float u_cropRadius;
            uniform float u_cropHeight;
        #endif
        
        //---------------------------------------------------------------------
        // Utility functions
        //---------------------------------------------------------------------
        
        vec3 texToLocal (vec3 loc) {
            // Convert texture coordinates to local coordinates.
            // Texture coordinates span the range [0 1], local
            // coordiantes span the range [0.5 n + 0.5] where n
            // is the number of voxels along that dimension.
            return (loc * u_size) + 0.5;
        }
        
        vec3 localToTex (vec3 loc) {
            // Convert texture coordinates to local coordinates.
            // Texture coordinates span the range [0 1], local
            // coordiantes span the range [0.5 n + 0.5] where n
            // is the number of voxels along that dimension.
            return (loc - 0.5) / u_size;
        }
        
        vec3 texToWorld (vec3 loc) {
            // Convert texture coordinates to world coordinates.
            // Texture coordinates span [0 1] across the texture. To convert
            // to local coordinates, we multiple texture coordinates by the
            // size of the texture in each dimension. Then, we use the
            // modelMatrix to convert local coordinates to world coordinates.
            vec4 worldCoords = modelMatrix * vec4( texToLocal(loc), 1.0 );
            return worldCoords.xyz;
        }
        
        vec3 worldToLocal (vec3 loc) {
            // Convert world coordinates to local coordinates.
            // Texture coordinates span [0 1] across the texture. To convert
            // to local coordinates, we multiple texture coordinates by the
            // size of the texture in each dimension. Then, we use the
            // modelMatrix to convert local coordinates to world coordinates.
            vec4 localCoords = inverseModelMatrix * vec4( loc, 1.0 );
            #ifdef USE_BLOCKED_RENDERING
                return localCoords.xyz + u_offset;
            #else
                return localCoords.xyz;
            #endif
        }
        
        float computeDepth (vec3 loc) {
            // Project local coordinate (after converting from texture to local)
            // into camera position, then apply projection matrix to move into
            // clipping space. Convert clipping space into normalized device 
            // coordinates and compute depth relative to gl_DepthRange. This is
            // how gl_FragCoord.z is computed.
            vec4 locInCameraCoords = modelViewMatrix * vec4( texToLocal(loc), 1.0 );
            vec4 locInClipSpaceCoords = projectionMatrix * locInCameraCoords;
            float normalizedDeviceCoordsDepth = locInClipSpaceCoords.z / locInClipSpaceCoords.w;
        
            return ( ( ( gl_DepthRange.diff * normalizedDeviceCoordsDepth ) + gl_DepthRange.near + gl_DepthRange.far ) / 2.0) - u_jitter;
        }
        
        vec4 packDepthToRGBA( float depth ) {
            vec3 packFactors = vec3( 256.0 * 256.0 * 256.0, 256.0 * 256.0,  256.0 );
            float shiftRight8 = 1.0 / 256.0; // Handle overflow
            float packUpscale = 256.0 / 255.0; // fraction -> 0..1 (including 1)
            
            vec4 rgba = vec4( fract(depth * packFactors), depth);
            rgba.yzw -= rgba.xyz * shiftRight8;
            return rgba * packUpscale;
        }
        
        vec4 packTwoFloatsToRGBA( float a, float b) {
            float packFactors = 256.0;
            float shiftRight8 = 1.0 / 256.0;
            float packUpscale = 256.0 / 255.0;
            vec4 rgba = vec4(fract(a * packFactors), a, fract(b * packFactors), b);
            rgba.g -= rgba.r * shiftRight8;
            rgba.a -= rgba.b * shiftRight8;
            return rgba * packUpscale;
        }
        
        void setDepth (vec3 loc) {
            float depth = computeDepth(loc);
        
            if (u_passNumber == 2 ) {
                float prevDepth = texture(u_previousTexture, gl_FragCoord.xy / u_viewportSize).x;
                if (depth < prevDepth + TOLERANCE) {
                    discard;
                }
            }
        
            gl_FragDepth = depth;
            gl_FragColor = packDepthToRGBA(depth);
        }
        
        float sampleDepth (vec2 screenPosition) {
            return texture(u_depthTexture, screenPosition).x;
        }
        
        void testDepth (vec3 loc) {
            float depth = computeDepth(loc);
        
            float priorDepth = sampleDepth( gl_FragCoord.xy / u_viewportSize );
            float accumulatedDepth = texture(u_previousTexture, gl_FragCoord.xy / u_viewportSize).x;
        
            // Should be between current depth and previous depth to be included
            if (depth > priorDepth + TOLERANCE || depth < accumulatedDepth + TOLERANCE) {
                discard;
            }
        }
        
        float applyGradientOpacity (float alpha, float grad) {
            // When using gradient opacity, the relative step size should be 1.0.
            // Other alpha compositing routines adjust alpha by the relative
            // step size. We aren't doing that here because the step size
            // already impacts the absolute difference between the value of
            // the current location and the value of the previous location.
            return alpha * clamp( abs(grad) / (u_gradientOpacityLimits[1] - u_gradientOpacityLimits[0]), 0.0, 1.0 );
        }
        
        float adjustAlpha (float alpha, float dist) {
            return 1.0 - pow(1.0 - alpha, dist);
        }
        
        void blendColorToOutput(vec4 color) {
            // Premultiply alpha into color to keep gl_FragColor premultipled
            gl_FragColor.rgb += (color.rgb * color.a) * (1.0 - gl_FragColor.a);
            gl_FragColor.a += color.a * (1.0 - gl_FragColor.a);
        }
        
        #ifdef COLOR_BOX
        
            vec4 colorInBox (vec4 color, vec3 loc) {
                vec4 pos = u_colorBoxMatrix * vec4(texToWorld(loc), 1.0);
                vec3 s = step(vec3(-0.5), pos.xyz) - step(vec3(0.5), pos.xyz);
                if ((s.x * s.y * s.z) > 0.0) {
                    color.rgb = u_colorBoxColor;
                }
                return color;
            }
        
        #endif
        
        #ifdef RGB_SHADER
        
            vec3 rgb2xyz (vec3 color) {
                vec3 tmp;
                tmp.x = ( color.r > 0.04045 ) ? pow( ( color.r + 0.055 ) / 1.055, 2.4 ) : color.r / 12.92;
                tmp.y = ( color.g > 0.04045 ) ? pow( ( color.g + 0.055 ) / 1.055, 2.4 ) : color.g / 12.92,
                tmp.z = ( color.b > 0.04045 ) ? pow( ( color.b + 0.055 ) / 1.055, 2.4 ) : color.b / 12.92;
                return 100.0 * tmp *
                    mat3( 0.4124, 0.3576, 0.1805,
                        0.2126, 0.7152, 0.0722,
                        0.0193, 0.1192, 0.9505 );
            }
        
            vec3 xyz2lab (vec3 color) {
                vec3 n = color / vec3( 95.047, 100, 108.883 );
                vec3 v;
                v.x = ( n.x > 0.008856 ) ? pow( n.x, 1.0 / 3.0 ) : ( 7.787 * n.x ) + ( 16.0 / 116.0 );
                v.y = ( n.y > 0.008856 ) ? pow( n.y, 1.0 / 3.0 ) : ( 7.787 * n.y ) + ( 16.0 / 116.0 );
                v.z = ( n.z > 0.008856 ) ? pow( n.z, 1.0 / 3.0 ) : ( 7.787 * n.z ) + ( 16.0 / 116.0 );
                return vec3(( 116.0 * v.y ) - 16.0, 500.0 * ( v.x - v.y ), 200.0 * ( v.y - v.z ));
            }
        
            vec3 rgb2lab (vec3 color) {
                vec3 lab = xyz2lab( rgb2xyz( color ) );
                return vec3( lab.x / 100.0, 0.5 + 0.5 * ( lab.y / 127.0 ), 0.5 + 0.5 * ( lab.z / 127.0 ));
            }
        
            float gradient (vec3 val1, vec3 val2) {
                return distance( rgb2lab(val1), rgb2lab(val2) );
            }
        
        #endif
        
        //---------------------------------------------------------------------
        // Texture sampling functions
        //---------------------------------------------------------------------
        #ifdef USE_OVERLAY
            float sampleOverlay (vec3 texcoords) {
                return texture(u_overlayData, texcoords.xyz).r;
            }
        
            vec4 applyOverlayColormap (float val) {
                float scaledVal = (val - u_overlayclim[0]) / (u_overlayclim[1] - u_overlayclim[0]);
                vec4 color = texture(u_overlayTransferFunction, vec2(0,scaledVal));
                return color;
            }
        
            float getOverlayAlpha (float val) {
                vec4 color = applyOverlayColormap(val);
                return color.a;
            }
        #endif
        
        #ifdef USE_BLOCKED_RENDERING
            vec4 sampleDeferredTexture (vec2 screenPosition) {
                return texture(u_deferredTexture, screenPosition).rgba;
            }
        #endif
        
        #ifdef RGB_SHADER
        
            float sampleIntensity (vec3 texcoords) {
                // Return luminance for RGB volumes
                return rgb2lab(texture(u_data, texcoords.xyz).rgb).x;
            }
        
            vec4 sampleTexture (vec3 texcoords) {
                #ifdef RGBA_SHADER
                    vec4 color = texture(u_data, texcoords.xyz).rgba;
                #else
                    vec4 color = texture(u_data, texcoords.xyz).rgba;
                    #ifdef USE_ALPHA_DATA
                        // Sample color at location, then sample alpha data at
                        // same location
                        color.a = texture(u_alphaData, texcoords.xyz).a;
                    #else
                        // Sample color at location, then sample alphamap based on the minimum
                        // distance in LAB space to black and a specified anchor color
                        float alpha = min(gradient(color.rgb,u_rgbAnchorColor),gradient(color.rgb,vec3(0.0)));
                        color.a = texture(u_transferFunction, vec2(0,alpha)).a;
                    #endif
                #endif
                #ifdef COLOR_BOX
                    return colorInBox( color, texcoords );
                #else
                    return color;
                #endif
            }
        
        #else
        
            float sampleIntensity (vec3 texcoords) {
                return texture(u_data, texcoords.xyz).r;
            }
        
            vec4 applyColormap (float val, vec3 texcoords) {
                float scaledVal = (val - u_clim[0]) / (u_clim[1] - u_clim[0]);
                vec4 color = texture(u_transferFunction, vec2(0,scaledVal));
                #ifdef USE_ALPHA_DATA
                    color.a = texture(u_alphaData, texcoords.xyz).a;
                #else
                    color.a = texture(u_transferFunction, vec2(0,val)).a;
                #endif
                #ifdef COLOR_BOX
                    return colorInBox( color, texcoords );
                #else
                    return color;
                #endif
            }
        
            vec4 sampleTexture (vec3 texcoords) {
                return applyColormap( sampleIntensity(texcoords), texcoords );
            }
            
        #endif
        
        //---------------------------------------------------------------------
        // Clipping and slicing functions
        //---------------------------------------------------------------------
        bool outsideCropBox (vec3 loc) {
            #if NUM_CROP_BOXES > 0
                vec3 worldLoc = texToWorld(loc);
        
                #if CROP_TYPE == 0
                    vec3 s = step(u_cropMin, worldLoc) - step(u_cropMax, worldLoc);
                    #ifdef CROP_EXCLUDE
                        return bool(s.x * s.y * s.z);
                    #else
                        return bool(1.0 - (s.x * s.y * s.z));
                    #endif
                #endif        
                
                // For a point p on the object and a point c as the center of the sphere,
                // Check if abs(p.xyz - r.xyz) > radius (distance of p from center is greater than radius)
                // If so, then the point lies outside the sphere. Otherwise it lies within the sphere.
        
                #if CROP_TYPE == 1
                    float dist = distance(worldLoc, u_cropCenter);
                    #ifdef CROP_EXCLUDE
                        return (dist <= u_cropRadius);
                    #else
                        return (dist > u_cropRadius);
                    #endif
                #endif
        
                // For a point p on the object and a point c as the center of the cylinder,
                // Check if abs(p.xy - r.xy) > radius (distance of p from center is greater than radius)
                // If so, then the point lies outside the curved surface of the cylinder along the x-y plane. 
                // Otherwise it lies within the curved surface of the cylinder.
                // Check if abs(p.z - c.z) > height / 2.0f (distance of p from the center along the z-axis is greater than height of the cylinder/2)
                // If so, then the point lies outside the end caps of the cylinder.
                // If either of these conditions are met, then the point lies outside the cylinder.
        
                #if CROP_TYPE == 2
                    float distanceXYPlane = distance(vec2(worldLoc.x, worldLoc.y), vec2(u_cropCenter.x, u_cropCenter.y));
                    float distanceZAxis = abs(worldLoc.z - u_cropCenter.z);
                    #ifdef CROP_EXCLUDE
                        return (distanceXYPlane <= u_cropRadius && distanceZAxis <= (u_cropHeight / 2.0f));
                    #else
                        return (distanceXYPlane > u_cropRadius || distanceZAxis > (u_cropHeight / 2.0f));
                    #endif
                #endif
            #else
                return false;
            #endif
        }
        
        bool clipped (vec3 loc) {
            // Returns true if the location in world coordinates should be 
            // clipped (discard or not rendered).
            bool culled = outsideCropBox(loc);
            #if NUM_CLIPPING_PLANES > 0
        
            // Convert texture coordinates to camera coordinates.
            // Texture coordinates span [0 1] across the texture. To convert
            // to local coordinates, we multiple texture coordinates by the
            // size of the texture in each dimension. Then, we use the
            // modelViewMatrix to convert local coordinates to camera coordinates.
            // the clipping planes are set in camera coordinates
            vec4 cameraCoords = modelViewMatrix * vec4( texToLocal(loc), 1.0 );
            vec3 clipPosition = -cameraCoords.xyz;
            vec4 plane;
        
                #ifdef CLIP_INTERSECTION
                    culled = true;
        
                    #pragma unroll_loop_start
                    for ( int i = 0; i < NUM_CLIPPING_PLANES; i++ ) {
                        plane = clippingPlanes[ i ];
                        culled = dot( clipPosition, plane.xyz ) > plane.w && culled;
                    }
                    #pragma unroll_loop_end
                #else
                    #pragma unroll_loop_start
                    for ( int i = 0; i < NUM_CLIPPING_PLANES; i++ ) {
                        plane = clippingPlanes[ i ];
                        culled = dot( clipPosition, plane.xyz ) > plane.w || culled;
                    }
                    #pragma unroll_loop_end
                #endif
            #endif
            return culled;
        }
        
        vec4 clipNormal (vec3 loc) {
            // Return a vector that describes the normal vector of
            // the clipping planes impacting the location. With clip
            // intersection turned on, this vector is the sum of vectors
            // that aren't clipping the location. Without clip
            // intersection, the vector is a sum of normals of the planes
            // that are clipping the location.
            vec4 clipNorm;
            #if NUM_CLIPPING_PLANES > 0
        
            // Convert texture coordinates to camera coordinates.
            vec4 cameraCoords = modelViewMatrix * vec4( texToLocal(loc), 1.0 );
            vec3 clipPosition = -cameraCoords.xyz;
        
                #ifdef CLIP_INTERSECTION
                    bool tempCulled = false;
                    bool culled = true;
                    vec4 plane;
                    vec4 worldPlane;
        
                    #pragma unroll_loop_start
                    for ( int i = 0; i < NUM_CLIPPING_PLANES; i++ ) {
                        plane = clippingPlanes[ i ];
                        worldPlane = worldCoordClippingPlanes[ i ];
                        tempCulled = dot( clipPosition, plane.xyz ) > plane.w;
                        culled = tempCulled && culled;
                        clipNorm.xyz += worldToLocal(worldPlane.xyz) * float(!tempCulled);
                    }
                    #pragma unroll_loop_end
        
                    clipNorm.w = float(culled);
                    return clipNorm;
                #else
                    bool tempCulled = false;
                    bool culled = false;
                    vec4 plane;
                    vec4 worldPlane;
        
                    #pragma unroll_loop_start
                    for ( int i = 0; i < NUM_CLIPPING_PLANES; i++ ) {
                        plane = clippingPlanes[ i ];
                        worldPlane = worldCoordClippingPlanes[ i ];
                        tempCulled = dot( clipPosition, plane.xyz ) > plane.w;
                        culled = tempCulled || culled;
                        clipNorm.xyz += worldToLocal(worldPlane.xyz) * float(tempCulled);
                    }
                    #pragma unroll_loop_end
        
                    clipNorm.w = float(culled);
                    return clipNorm;
                #endif
            #else
                return clipNorm;
            #endif
        }
        
        bool intersectSlice (vec3 loc, float tol) {
            // Returns true if the location intersects any of the
            // slice planes to within the tolerance tol. The location
            // be in local voxel coordinates.
            #ifdef USE_BLOCKED_RENDERING
                loc = loc + u_offset;
            #endif
            vec4 loc4 = vec4(loc, 1.0);
            bool TF = false;
        
            vec4 plane;
        
            #pragma unroll_loop_start
            for ( int i = 0; i < NUM_SLICE_PLANES; i++ ) {
                plane = slicePlanes[ i ];
                TF = TF || (dot(loc4, vec4(plane.xyz, plane.w - tol) ) < 0.0 && 
                     dot(loc4, vec4(plane.xyz, plane.w + tol) ) > 0.0 );
            }
            #pragma unroll_loop_end
        
            return TF;
        }
        
        //---------------------------------------------------------------------
        // Lighting functions
        //---------------------------------------------------------------------
        vec3 getDataEdgeNormal (vec3 loc) {
            // Search the neighborhood of the location to compute the
            // normal if the location is near or the edge of the volume
            vec3 step = 1.7 * u_relativeStepSize / u_size;
            vec4 val1 = clipNormal(loc + vec3(-step.x, 0.0, 0.0));
            vec4 val2 = clipNormal(loc + vec3(+step.x, 0.0, 0.0)); 
            vec4 val3 = clipNormal(loc + vec3(0.0, -step.y, 0.0)); 
            vec4 val4 = clipNormal(loc + vec3(0.0, +step.y, 0.0)); 
            vec4 val5 = clipNormal(loc + vec3(0.0, 0.0, -step.z)); 
            vec4 val6 = clipNormal(loc + vec3(0.0, 0.0, +step.z));
        
            #ifdef CLIP_INTERSECTION
                float sum = val1.a + val2.a + val3.a + val4.a + val5.a + val6.a;
                vec4 totalVal = (val1 + val2 + val3 + val4 + val5 + val6) * float(sum > 0.5);
                return totalVal.xyz;
            #else
                // Don't normalize this vector. Normalizing an all zero vector
                // returns something that isn't all zeros. We expect this to
                // be all zeros often when we aren't near an edge.
                vec4 totalVal = (val1 + val2 + val3 + val4 + val5 + val6);
                return totalVal.xyz;
            #endif
        }
        
        vec3 getCropEdgeNormal (vec3 loc) {
            // Search the neighborhood of the location to compute the
            // normal if the location is near or the edge of the crop box
            vec3 step = 3.0 * u_relativeStepSize / u_size;
            vec3 val;
            val.x += float(outsideCropBox(loc + vec3(-step.x, 0.0, 0.0)));
            val.x -= float(outsideCropBox(loc + vec3(+step.x, 0.0, 0.0))); 
            val.y += float(outsideCropBox(loc + vec3(0.0, -step.y, 0.0))); 
            val.y -= float(outsideCropBox(loc + vec3(0.0, +step.y, 0.0))); 
            val.z += float(outsideCropBox(loc + vec3(0.0, 0.0, -step.z))); 
            val.z -= float(outsideCropBox(loc + vec3(0.0, 0.0, +step.z)));
            return val;
        }
        
        vec3 getDataGradientNormal (vec3 loc) {
            // Search the neighborhood of the location to compute the
            // normal based on the intensity of the surrounding
            // neighborhood.
            #ifdef USE_SMALL_VOLUME
                // For small volumes, we take much smaller steps. Scale the
                // lighting step to match
                vec3 step = 1.5 * u_relativeStepSize / u_size;
                vec3 edge = 1.0 * u_relativeStepSize / u_size;
            #else
                vec3 step = 1.5 / u_size;
                vec3 edge = 1.0 / u_size;
            #endif
        
            vec3 val1;
            vec3 val2;
            #ifdef USE_BLOCKED_RENDERING
                // Identify offset if we are near a block edge to move away from the
                // block edge. We can get a better approximation of the gradient for
                // lighting at the offset location than right at the block edge
                vec3 offset;
                offset.x = float(loc.x - step.x < 0.0) - float(loc.x + step.x > 1.0);
                offset.y = float(loc.y - step.y < 0.0) - float(loc.y + step.y > 1.0);
                offset.z = float(loc.z - step.z < 0.0) - float(loc.z + step.z > 1.0);
                offset *= step;
        
                // Get location in voxel coordinates relative to the entire blockedImage.
                // We will use this to determine if we are at the edge of the entire volume
                vec3 locInBlock = (loc * u_size) + u_offset;
                vec3 volMax = u_totalSize;
            #else
                vec3 offset;
                vec3 locInBlock = loc;
                vec3 volMax = vec3(1.0, 1.0, 1.0);
            #endif
        
            #ifdef USE_ALPHA_DATA
                val1.x = texture(u_alphaData, loc + vec3(-step.x, 0.0, 0.0) + offset).a - (float(locInBlock.x - edge.x < 0.0) * gradientWeight);
                val2.x = texture(u_alphaData, loc + vec3(+step.x, 0.0, 0.0) + offset).a - (float(locInBlock.x + edge.x > volMax.x) * gradientWeight);
                val1.y = texture(u_alphaData, loc + vec3(0.0, -step.y, 0.0) + offset).a - (float(locInBlock.y - edge.y < 0.0) * gradientWeight);
                val2.y = texture(u_alphaData, loc + vec3(0.0, +step.y, 0.0) + offset).a - (float(locInBlock.y + edge.y > volMax.y) * gradientWeight);
                val1.z = texture(u_alphaData, loc + vec3(0.0, 0.0, -step.z) + offset).a - (float(locInBlock.z - edge.z < 0.0) * gradientWeight);
                val2.z = texture(u_alphaData, loc + vec3(0.0, 0.0, +step.z) + offset).a - (float(locInBlock.z + edge.z > volMax.z) * gradientWeight);
            #else
                val1.x = sampleIntensity(loc + vec3(-step.x, 0.0, 0.0) + offset) - (float(locInBlock.x - edge.x < 0.0) * gradientWeight);
                val2.x = sampleIntensity(loc + vec3(+step.x, 0.0, 0.0) + offset) - (float(locInBlock.x + edge.x > volMax.x) * gradientWeight);
                val1.y = sampleIntensity(loc + vec3(0.0, -step.y, 0.0) + offset) - (float(locInBlock.y - edge.y < 0.0) * gradientWeight);
                val2.y = sampleIntensity(loc + vec3(0.0, +step.y, 0.0) + offset) - (float(locInBlock.y + edge.y > volMax.y) * gradientWeight);
                val1.z = sampleIntensity(loc + vec3(0.0, 0.0, -step.z) + offset) - (float(locInBlock.z - edge.z < 0.0) * gradientWeight);
                val2.z = sampleIntensity(loc + vec3(0.0, 0.0, +step.z) + offset) - (float(locInBlock.z + edge.z > volMax.z) * gradientWeight);
            #endif
            vec3 n = val1 - val2;
            return normalize(n);
        }
        
        #ifdef USE_LIGHT_SCATTERING
            float lightTransmittance (vec3 loc, vec3 viewRay) {
                // Measure light transmittance, the ratio of light that reaches the
                // current location to the light that is transmitted through it
                float T = 1.0;
                vec4 color;
        
                // Get light direction in texture coordinates
                vec3 lightTexCoords = localToTex(v_localLightPosition);
                vec3 lightDir = normalize(lightTexCoords - loc);
                float dist = length(lightTexCoords - loc);
        
                // Standard box intersection calculation. In our case, we are in
                // texture coordinates so the box limits are zeros and ones.
                vec3 inverseLightDir = 1.0 / lightDir;
                vec3 tminTemp = (vec3(0) - loc) * inverseLightDir;
                vec3 tmaxTemp = (vec3(1) - loc) * inverseLightDir;
                vec3 tmin = min(tminTemp, tmaxTemp);
                vec3 tmax = max(tminTemp, tmaxTemp);
                float t0 = max(tmin.x, max(tmin.y, tmin.z));
                float t1 = min(tmax.x, min(tmax.y, tmax.z));
        
                // If the light is located inside the texture, we should stop at the
                // light and not where the ray intersects the texture bounding box (which 
                // would be past the light)
                t1 = min(t1, dist);
        
                // Get the location in texture coordinates where we should stop the ray trace
                vec3 endLoc = loc + (lightDir * t1);
        
                // Limit the number of steps to a constant number. We may want to tweak this 
                // during interactions
                int nsteps = int(float(maxLightRaySteps) * t1 / sqrt(3.0));
        
                // Set the step size
                vec3 step = (endLoc - loc) / float(nsteps);
                float relativeStepSize = length(step * u_size) * dot( u_anisotropy, abs(viewRay) ) / dot(vec3(1.0,1.0,1.0),abs(viewRay));
        
                // TODO - We need to figure out how to tweak this coefficient
                const float ABSORPTION = 0.1;
                int maxSteps = min(int(float(maxLightRaySteps) * u_lightRaySteps),nsteps);
        
                for (int i = 0; i < maxSteps; i++) {
                    // Move to next step towards light source
                    loc += step;
        
                    // Sample transmittance based on the opacity at each step
                    color = sampleTexture(loc);
        
                    // Accumulate absorption
                    T *= exp( -ABSORPTION * float( !clipped(loc) ) * color.a * relativeStepSize);
                }
        
                return T;
            }
        
            float henyeyGreenstein (float g, float cosineTheta) {
                // Henyey-Greenstein phase function for modeling light scatter
                return (1.0 - (g * g)) / (4.0 * 3.141592653 * pow(1.0 + (g * g) - (2.0 * g * cosineTheta), 1.5));
            }
        
            float inScatter (vec3 lightDir, vec3 viewDir, float light) {
                // Estimate the amount of light that is scattered back along
                // the camera ray using an approximation of the Henyey-Greenstein 
                // function
                float cosineTheta = dot(-lightDir,viewDir);
                float g = 0.7;
                float hg = henyeyGreenstein(g, cosineTheta);
        
                return light * (1.0 - exp(-hg));
            }    
        #endif
        
        #ifdef USE_OVERLAY
            
            vec3 getOverlayGradientNormal (vec3 loc) {
                // Search the neighborhood of the location to compute the
                // normal based on the intensity of the surrounding
                // neighborhood.
                #ifdef USE_SMALL_VOLUME
                    // For small volumes, we take much smaller steps. Scale the
                    // lighting step to match
                    vec3 step = 1.5 * u_relativeStepSize / u_size;
                    vec3 edge = 1.0 * u_relativeStepSize / u_size;
                #else
                    vec3 step = 1.5 / u_size;
                    vec3 edge = 1.0 / u_size;
                #endif
                vec3 val1;
                vec3 val2;
                #ifdef USE_BLOCKED_RENDERING
                    val1.x = getOverlayAlpha(sampleOverlay(loc + vec3(-step.x, 0.0, 0.0)));
                    val2.x = getOverlayAlpha(sampleOverlay(loc + vec3(+step.x, 0.0, 0.0)));
                    val1.y = getOverlayAlpha(sampleOverlay(loc + vec3(0.0, -step.y, 0.0)));
                    val2.y = getOverlayAlpha(sampleOverlay(loc + vec3(0.0, +step.y, 0.0)));
                    val1.z = getOverlayAlpha(sampleOverlay(loc + vec3(0.0, 0.0, -step.z)));
                    val2.z = getOverlayAlpha(sampleOverlay(loc + vec3(0.0, 0.0, +step.z)));
                #else
                    val1.x = getOverlayAlpha(sampleOverlay(loc + vec3(-step.x, 0.0, 0.0))) - (float(loc.x - edge.x < 0.0) * gradientWeight);
                    val2.x = getOverlayAlpha(sampleOverlay(loc + vec3(+step.x, 0.0, 0.0))) - (float(loc.x + edge.x > 1.0) * gradientWeight);
                    val1.y = getOverlayAlpha(sampleOverlay(loc + vec3(0.0, -step.y, 0.0))) - (float(loc.y - edge.y < 0.0) * gradientWeight);
                    val2.y = getOverlayAlpha(sampleOverlay(loc + vec3(0.0, +step.y, 0.0))) - (float(loc.y + edge.y > 1.0) * gradientWeight);
                    val1.z = getOverlayAlpha(sampleOverlay(loc + vec3(0.0, 0.0, -step.z))) - (float(loc.z - edge.z < 0.0) * gradientWeight);
                    val2.z = getOverlayAlpha(sampleOverlay(loc + vec3(0.0, 0.0, +step.z))) - (float(loc.z + edge.z > 1.0) * gradientWeight);
                #endif
                vec3 n = val1 - val2;
                return normalize(n);
            }
        
            vec3 getOverlayNormal (vec3 loc) {
                vec3 dataGradient = getOverlayGradientNormal(loc);
                vec3 edgeGradient;
                #if NUM_CLIPPING_PLANES > 0
                    edgeGradient += getDataEdgeNormal(loc);
                #endif
                #if NUM_CROP_BOXES > 0
                    edgeGradient += getCropEdgeNormal(loc);
                #endif
                return normalize((gradientWeight * edgeGradient) + dataGradient);
            }
        
        #endif
        
        vec3 getNormal (vec3 loc) {
            vec3 dataGradient = getDataGradientNormal(loc);
            vec3 edgeGradient;
            #if NUM_CLIPPING_PLANES > 0
                edgeGradient += getDataEdgeNormal(loc);
            #endif
            #if NUM_CROP_BOXES > 0
                edgeGradient += getCropEdgeNormal(loc);
            #endif
            return normalize((gradientWeight * edgeGradient) + dataGradient);
        }
        
        vec4 applyLighting (vec4 color, vec3 loc, vec3 viewRay, float lightStrength) {
            // Calculate color by incorporating lighting
        
            // Get vector that approximates the normal vector of the surface
            #ifdef USE_OVERLAY
                vec4 volColor = sampleTexture(loc);
                vec4 overlayColor = applyOverlayColormap(sampleOverlay(loc));
                vec3 surfaceNormal;
        
                if (volColor.a > overlayColor.a) {
                    surfaceNormal = getNormal(loc);
                } else {
                    surfaceNormal = getOverlayNormal(loc);
                }
            #else
                vec3 surfaceNormal = getNormal(loc);
            #endif
        
            // View direction - viewRay needs to be normalized, but it is already
            // done in the main program
        
            // Flip normal so it points towards viewer
            float Nselect = float(dot(surfaceNormal, viewRay) > 0.0);
            surfaceNormal = (2.0 * Nselect - 1.0) * surfaceNormal; // == Nselect * surfaceNormal - (1.0-Nselect)*surfaceNormal;
        
            // Get light direction and prevent zero division
            #ifdef USE_PERSPECTIVE_CAMERA
                vec3 lightDir = normalize(texToLocal(loc) - v_localLightPosition); 
            #else
                vec3 lightDir = normalize(v_localCameraTarget - v_localLightPosition);
            #endif
        
            float diffuseStrength = u_primaryLightIntensity;
            float specularStrength = u_specularStrength;
            float shininess = u_shininess;
        
            // Make custom modifications to lighting parameters based on the rendering style
            #ifdef USE_OVERLAY
                specularStrength = 0.0;
            #else
                #ifdef USE_ISOSURFACE
                    shininess = 2.0 * u_shininess;
                #endif
            #endif
        
            // Calculate lighting properties
            #ifdef USE_LIGHT_SCATTERING
                // For light scattering, diffuse light is approximated by ray tracing
                // from the current location back to the light source
                float lambertTerm = lightStrength * diffuseStrength;
                float scatterTerm = inScatter(normalize(texToLocal(loc) - v_localLightPosition), viewRay, lightStrength * diffuseStrength);
            #else
                float lambertTerm = clamp(dot(surfaceNormal, lightDir), 0.0, 1.0) * diffuseStrength;
                float scatterTerm = 0.0;
            #endif
        
            // An alternate way to compute the specular term is:
            // float specularTerm = pow(max(dot(reflect(-lightDir, surfaceNormal), viewRay), 0.0), shininess);
            // The alternate way produces more sudden reflections at some low angles.
            float specularTerm = pow(clamp(dot(normalize(lightDir + viewRay),surfaceNormal), 0.0, 1.0), shininess) * specularStrength;
        
            #ifdef USE_CINEMATIC_RENDERING
                vec4 finalColor = packTwoFloatsToRGBA( lambertTerm, specularTerm + scatterTerm );
            #else
                lambertTerm = clamp(lambertTerm, 0.0, 1.0);
                specularTerm = clamp(specularTerm * diffuseStrength, 0.0, 1.0);
        
                #ifndef USE_LIGHT_SCATTERING
                    #if NUM_SECONDARY_LIGHTS > 0
                        vec3 light;
                        float intensity;
                        #pragma unroll_loop_start
                        for ( int i = 0; i < NUM_SECONDARY_LIGHTS; i++ ) {
                            light = u_secondaryLight[ i ];
                            intensity = u_secondaryLightIntensity[ i ];
                            light = worldToLocal(light); 
                            #ifdef USE_PERSPECTIVE_CAMERA
                                lightDir = normalize(texToLocal(loc) - light); 
                            #else
                                lightDir = normalize(v_localCameraTarget - light);
                            #endif
                            lambertTerm += clamp(dot(surfaceNormal, lightDir), 0.0, 1.0) * intensity;
                            specularTerm += pow(clamp(dot(normalize(lightDir + viewRay),surfaceNormal), 0.0, 1.0), shininess) * specularStrength * intensity;
                        }
                        #pragma unroll_loop_end
                        lambertTerm = clamp(lambertTerm, 0.0, 1.0);
                        specularTerm = clamp(specularTerm, 0.0, 1.0);
                    #endif
                #endif
        
                vec4 ambientColor = u_lightColor * u_ambientStrength;
                vec4 diffuseColor = u_lightColor * lambertTerm;
                vec4 specularColor = u_lightColor * specularTerm;
                vec4 scatterColor = u_lightColor * scatterTerm;
        
                // Calculate final color by combining different components
                // Some implementations sum all three light components before multiplying
                // with the color. This keeps the color from getting saturated. If we
                // pull out the specularColor term and add it later, it can create a
                // color lighter than the original color, giving a glossy effect.
                vec4 finalColor = ( color * (ambientColor + diffuseColor) + specularColor + scatterColor );
        
                // Keep the previous transparency
                finalColor.a = color.a;
        
            #endif
        
            return finalColor;
        }
        
        //---------------------------------------------------------------------
        // Ray marching functions
        //---------------------------------------------------------------------
        vec3 renderVolume (vec3 startLoc, vec3 step, int nsteps, vec3 viewRay, int maxSteps) {
        
            // Initialize transparent pixel
            #ifdef USE_BLOCKED_RENDERING
                blendColorToOutput(sampleDeferredTexture( gl_FragCoord.xy / u_viewportSize ));
            #else
                gl_FragColor = vec4(0.0);
            #endif
            vec4 color = vec4(0.0);
            float anisotropicStepSize = u_relativeStepSize * dot( u_anisotropy, abs(viewRay) ) / dot(vec3(1.0,1.0,1.0),abs(viewRay));
            vec3 loc = startLoc;
            vec3 finalLoc = startLoc;
            bool lightingNeeded = false;
            bool depthSet = false;
            #ifdef USE_GRADIENT_OPACITY
                #ifdef USE_BLOCKED_RENDERING
                    #ifdef RGB_SHADER
                        vec3 priorVal = sampleTexture(loc).rgb;
                    #else
                        float priorVal = sampleIntensity(loc);
                    #endif
                #else
                    #ifdef RGB_SHADER
                        vec3 priorVal;
                    #else
                        float priorVal = 0.0;
                    #endif
                #endif
            #endif
            float notClipped = 1.0;
        
            #ifdef USE_OVERLAY
                vec4 overlay = vec4(0.0);
                // For label overlay, we want to start with a negative value, so even
                // hitting a zero will trigger adding the sample to the color. Use a 
                // start value of -1.0. For gradient opacity, just keep it at 0.0
                #ifdef USE_LABEL_OVERLAY
                    float priorOverlay = -1.0;
                #else
                    float priorOverlay = 0.0;
                #endif
            #endif
        
            #ifdef USE_LIGHT_SCATTERING
                float lightStrength = 0.0;
            #endif
        
            for (int i = 0; i < maxSteps; i++) {
                if (i >= nsteps) {
                    return finalLoc;
                }
        
                notClipped = float(!clipped(loc));
        
                #ifdef USE_OVERLAY
                    // Sample from overlay texture
                    float overlayVal = sampleOverlay(loc);
                    overlay =  applyOverlayColormap(overlayVal);
                    overlay.a = overlay.a * notClipped;
                #endif
                
                #ifdef RGB_SHADER
                    // Sample from the 3D RGB texture
                    color = sampleTexture(loc);
                    color.a = color.a * notClipped;
                    #ifdef USE_GRADIENT_OPACITY
                        color.a = applyGradientOpacity(color.a, gradient(color.rgb, priorVal));
                        priorVal = color.rgb;
                    #else
                        color.a = adjustAlpha(color.a, anisotropicStepSize);
                    #endif
                #else
                    // Sample from the 3D texture
                    float val = sampleIntensity(loc);
                    color = applyColormap(val, loc);
                    color.a = color.a * notClipped;
        
                    #ifdef USE_GRADIENT_OPACITY
                        color.a = applyGradientOpacity(color.a, val - priorVal);
                        priorVal = val;
                    #else
                        color.a = adjustAlpha(color.a, anisotropicStepSize);
                    #endif
        
                    #ifndef DEPTH_SHADER
                        #ifdef USE_LIGHTING
                            #ifndef USE_CINEMATIC_RENDERING
                                #ifdef USE_LIGHT_SCATTERING
                                    lightStrength = lightTransmittance(loc, viewRay);
                                    color = applyLighting(color, loc, viewRay, lightStrength);
                                #else
                                    color = applyLighting(color, loc, viewRay, 1.0);
                                #endif
                            #endif
                        #endif
                    #endif
                #endif
        
                blendColorToOutput(color);
        
                #ifdef USE_OVERLAY
                    #ifdef USE_LABEL_OVERLAY
                        if ( abs(overlayVal - priorOverlay) > TOLERANCE ) {
                            vec4 priorColor =  applyOverlayColormap(priorOverlay);
        
                            priorColor.a = notClipped * (1.0 - pow(1.0 - priorColor.a, 1.0));
                            overlay.a = notClipped * (1.0 - pow(1.0 - overlay.a, 1.0));
                            #ifndef DEPTH_SHADER
                                #ifdef USE_LIGHTING
                                    #ifndef USE_CINEMATIC_RENDERING
                                        #ifdef USE_LIGHT_SCATTERING
                                            overlay = applyLighting(overlay, loc, viewRay, lightStrength);
                                            priorColor = applyLighting(priorColor, loc, viewRay, lightStrength);
                                        #else
                                            overlay = applyLighting(overlay, loc, viewRay, 1.0);
                                            priorColor = applyLighting(priorColor, loc, viewRay, 1.0);
                                        #endif
                                    #endif
                                #endif
                            #endif
                            // Blend intensity with overlay
                            blendColorToOutput(priorColor);
                            blendColorToOutput(overlay);
                        }
                    #else
                        #ifdef USE_GRADIENT_OVERLAY
                            overlay.a = applyGradientOpacity(overlay.a, overlayVal - priorOverlay);
                        #else
                            overlay.a = adjustAlpha(overlay.a, anisotropicStepSize);
                        #endif
                        // Blend intensity with overlay
                        #ifndef DEPTH_SHADER
                            #ifdef USE_LIGHTING
                                #ifndef USE_CINEMATIC_RENDERING
                                    #ifdef USE_LIGHT_SCATTERING
                                        overlay = applyLighting(overlay, loc, viewRay, lightStrength);
                                    #else
                                        overlay = applyLighting(overlay, loc, viewRay, 1.0);
                                    #endif
                                #endif
                            #endif
                        #endif
                        blendColorToOutput(overlay);
                    #endif
        
                    priorOverlay = overlayVal;
                #endif
        
                if (!depthSet && gl_FragColor.a >= u_depthSensitivity) {
                    depthSet = true;
                    finalLoc = loc;
                }

                if (gl_FragColor.a >= 0.95) {
                    gl_FragColor.a = 1.0;
                    return finalLoc;
                }
        
                // Advance location deeper into the volume
                loc += step;
            }
        }
        
        vec3 renderSlicePlanes (vec3 startLoc, vec3 step, int nsteps, int maxSteps) {
        
            // Initial color and transparency
            gl_FragColor = vec4(0.0);
            vec4 color = vec4(0.0);
            vec3 loc = startLoc;
            float tol = 0.501 * u_relativeStepSize;
        
            for (int i = 0; i < maxSteps; i++) {
                if (i >= nsteps) {
                    return startLoc;
                }
        
                color = sampleTexture(loc);
                #ifdef USE_OVERLAY
                    vec4 overlay =  applyOverlayColormap(sampleOverlay(loc)); 
                    color.rgb = ( (1.0 - overlay.a) * color.rgb) + ( overlay.a * overlay.rgb );            
                #endif
                color.a = float(intersectSlice(texToLocal(loc), tol));
        
                blendColorToOutput(color);
        
                if (gl_FragColor.a >= 0.95) {
                    // Refine the slice plane location to get a more accurate
                    // sample and depth value.
                    // This breaks SwiftShader so we have a defines to include
                    // this only if SwiftShader is not used.
                    #ifdef HARDWARE_WEBGL
                        vec3 iloc = loc - 0.75 * step;
                        vec3 istep = step / float(refinementSteps);
                        float itol = tol / float(refinementSteps);
                        for (int i = 0; i < refinementSteps; i++) {
                            color = sampleTexture(iloc);
                            #ifdef USE_OVERLAY
                                color = sampleTexture(iloc);
                                vec4 overlay =  applyOverlayColormap(sampleOverlay(iloc)); 
                                color.rgb = ( (1.0 - overlay.a) * color.rgb) + ( overlay.a * overlay.rgb );
                            #endif
                            color.a = float(intersectSlice(texToLocal(iloc), itol));
                            if (color.a >= 0.95) {
                                gl_FragColor = color;
                                return iloc;
                            }
                            iloc += istep;
                        }
                    #else
                        return loc;
                    #endif
                }
                loc += step;
            }
        }
        
        vec3 renderIntensityProjection (vec3 startLoc, vec3 step, int nsteps, int maxSteps) {
        
            // define is used to share code between min intensity and max intensity projection.
            #ifdef USE_BLOCKED_RENDERING
                #ifdef USE_MAXIP
                    float maxVal = sampleDeferredTexture( gl_FragCoord.xy / u_viewportSize ).x;
                #else
                    float maxVal = 1.0 - sampleDeferredTexture( gl_FragCoord.xy / u_viewportSize ).x;
                #endif
                float newMax = 0.0;
                vec3 finalLoc = startLoc;
            #else
                #ifdef USE_MAXIP
                    float maxVal = -1e6;
                #else
                    float maxVal = 1e6;
                #endif
            #endif
            
            int projectionIndex = 0;
            vec3 loc = startLoc;
            #ifdef RGB_SHADER
                vec3 color;
            #endif
        
            // Enter the raycasting loop. In WebGL the loop index cannot be compared with
            // non-constant expression. We use a hard-coded max and an additional condition
            // inside the loop.
            for (int i = 0; i < maxSteps; i++) {
                if (i >= nsteps) {
                    break;
                }
                if ( clipped(loc) ) {
                    loc += step;
                    continue;
                }
        
                // Sample from the 3D texture
                float val = sampleIntensity(loc);
                // Apply MIP operation
                #ifdef USE_MAXIP
                    if ( val > maxVal ) {
                #else
                    if ( val < maxVal ) {
                #endif
                    maxVal = val;
                    projectionIndex = i;
                    #ifdef USE_BLOCKED_RENDERING
                        newMax = 1.0;
                        finalLoc = loc;
                    #endif
                }
                // Advance location deeper into the volume
                loc += step;
            }
        
            #ifndef USE_BLOCKED_RENDERING
                // Refine location, gives crispier images
                vec3 iloc = startLoc + step * (float(projectionIndex) - 0.5);
                vec3 finalLoc = iloc;
                vec3 istep = step / float(refinementSteps);
                for (int i = 0; i < refinementSteps; i++) {
                    if ( clipped(iloc) ) {
                        iloc += istep;
                        continue;
                    }
        
                    float val = sampleIntensity(iloc);
                    // Apply MIP operation at refined location
                    #ifdef USE_MAXIP
                        if ( val > maxVal ) {
                    #else
                        if ( val < maxVal ) {
                    #endif
                        maxVal = val;
                        finalLoc = iloc;
                    }
        
                    iloc += istep;
                }
            #endif
        
            #ifdef USE_BLOCKED_RENDERING
                // Write out final location in texture coordinates and the max value
                // This will be used as an input during the second pass
                #ifdef RGB_SHADER
                    gl_FragColor = sampleTexture(finalLoc);
                #else
                    gl_FragColor = applyColormap(maxVal, finalLoc);
                #endif
                gl_FragColor.a *= newMax;
                if (u_passNumber == 2) {
                    #ifdef USE_MAXIP
                        gl_FragColor = vec4(maxVal, 0.0, 0.0, 1.0);
                    #else
                        gl_FragColor = vec4(1.0 - maxVal, 0.0, 0.0, 1.0);
                    #endif
                }
            #else
                // Resolve final color
                #ifdef RGB_SHADER
                    gl_FragColor = sampleTexture(finalLoc);
                #else
                    gl_FragColor = applyColormap(maxVal, finalLoc);
                #endif
            #endif
        
            return finalLoc;
        }
        
        vec3 renderIsosurface (vec3 startLoc, vec3 step, int nsteps, vec3 viewRay, int maxSteps) {
            // Initial color and transparency
            vec4 color = vec4(0.0);
            vec3 loc = startLoc;
            float val = 0.0;
            #ifdef TRANSPARENT_ISOSURFACE
                #ifdef USE_BLOCKED_RENDERING
                    blendColorToOutput(sampleDeferredTexture( gl_FragCoord.xy / u_viewportSize ));
                #else
                    gl_FragColor = vec4(0.0);
                #endif
                float insideSurface = 0.0;
                vec3 finalLoc = startLoc;
                bool depthSet = false;
            #else
                gl_FragColor = vec4(0.0);
            #endif
        
            for (int i = 0; i < maxSteps; i++) {
                if (i >= nsteps) {
                    #ifdef TRANSPARENT_ISOSURFACE
                        return finalLoc;
                    #else
                        return startLoc;
                    #endif
                }
        
                val = sampleIntensity(loc);
        
                #ifdef TRANSPARENT_ISOSURFACE
                    if ( !clipped(loc) && abs(float(val > u_isovalue) - insideSurface) > TOLERANCE ) {
                        insideSurface = 1.0 - insideSurface;
                        #ifndef DEPTH_SHADER
                            #ifdef RGB_SHADER
                                color = sampleTexture(loc);
                            #else
                                color = applyColormap(val, loc);
                            #endif
                        #endif
                        color.a = u_isoalpha;
        
                        #ifndef DEPTH_SHADER
                            #ifdef USE_LIGHTING
                                color = applyLighting(color, loc, viewRay, 1.0);
                            #endif
                        #endif
        
                        blendColorToOutput(color);
        
                        if (!depthSet) {
                            depthSet = true;
                            finalLoc = loc;
                        }
        
                        if (gl_FragColor.a > 0.95) {
                            gl_FragColor.a = 1.0;
                            return finalLoc;
                        }
                    }
                #else
                    #ifdef HARDWARE_WEBGL
                        if (float(!clipped(loc)) * float(val > u_isovalue) >= 0.95) {
                            #ifdef REFINE_ISOSURFACE
                                vec3 iloc = loc - 0.5 * step;
                                vec3 istep = step / float(refinementSteps);
                                for (int i = 0; i < refinementSteps; i++) {
                                    val = sampleIntensity(iloc);
                                    if (float(!clipped(iloc)) * float(val > u_isovalue) >= 0.95) {
                                        #ifdef RGB_SHADER
                                            color = sampleTexture(iloc);
                                        #else
                                            color = applyColormap(val, iloc);
                                        #endif
                                        #ifndef DEPTH_SHADER
                                            #ifdef USE_LIGHTING
                                                gl_FragColor = applyLighting(color, iloc, viewRay, 1.0);
                                            #else
                                                gl_FragColor.rgb = color.rgb;
                                            #endif
                                        #endif
                                        gl_FragColor.a = 1.0;
                                        return iloc;
                                    }
                                    iloc += istep;
                                }
                            #else
                                #ifdef RGB_SHADER
                                    color = sampleTexture(loc);
                                #else
                                    color = applyColormap(val, loc);
                                #endif
                                #ifndef DEPTH_SHADER
                                    #ifdef USE_LIGHTING
                                        gl_FragColor = applyLighting(color, loc, viewRay, 1.0);
                                    #else
                                        gl_FragColor.rgb = color.rgb;
                                    #endif
                                #endif
                                gl_FragColor.a = 1.0;
                                return loc;
                            #endif
                        }
                    #else
                        #ifndef DEPTH_SHADER
                            #ifdef RGB_SHADER
                                color = sampleTexture(loc);
                            #else
                                color = applyColormap(val, loc);
                            #endif
                        #endif
                        color.a = float(!clipped(loc)) * float(val > u_isovalue);
                        gl_FragColor.a += (1.0 - gl_FragColor.a) * color.a;
        
                        if (gl_FragColor.a > 0.95) {
                            #ifndef DEPTH_SHADER
                                #ifdef USE_LIGHTING
                                    gl_FragColor = applyLighting(color, loc, viewRay, 1.0);
                                #else
                                    gl_FragColor.rgb = color.rgb;
                                #endif
                            #endif
                            return loc;
                        }
                    #endif
                #endif
        
                loc += step;
            }
        }
        
        //---------------------------------------------------------------------
        // Main function
        //---------------------------------------------------------------------
        void main() {
        
            // Normalize clipping plane info
            vec3 farpos = v_farpos.xyz / v_farpos.w;
            vec3 nearpos = v_nearpos.xyz / v_nearpos.w;
        
            // Calculate unit vector pointing in the view direction through this fragment.
            #ifdef USE_PERSPECTIVE_CAMERA
                vec3 viewRay = normalize(v_position - v_localCameraPosition);
                float dist = dot(v_localCameraPosition - v_position, viewRay);
            #else
                // This technique does not account for the projection matrix
                // Calculate unit vector pointing in the view direction through this fragment.
                vec3 viewRay = normalize(nearpos.xyz - farpos.xyz);
                float dist = dot(nearpos - v_position, viewRay);
            #endif
        
            // The maximum distance through our rendering volume is the length of the
            // cube diagonal in voxels
            int maxSteps = int(ceil(sqrt(pow(u_size.x,2.0) + pow(u_size.y,2.0) + pow(u_size.z,2.0))) / u_relativeStepSize);
        
            // Compute the (negative) distance to the front surface or near clipping plane.
            // v_position is the back face of the cuboid, so the initial distance calculated in the dot
            // product below is the distance from near clip plane to the back of the cuboid
            dist = max(dist, min((0.5 - v_position.x) / viewRay.x, (u_size.x + 0.5 - v_position.x) / viewRay.x));
            dist = max(dist, min((0.5 - v_position.y) / viewRay.y, (u_size.y + 0.5 - v_position.y) / viewRay.y));
            dist = max(dist, min((0.5 - v_position.z) / viewRay.z, (u_size.z + 0.5 - v_position.z) / viewRay.z));
        
            // Now we have the starting position on the front surface
            vec3 front = v_position + viewRay * dist;
        
            // Decide how many steps to take.
            int nsteps = int(-dist / u_relativeStepSize + 0.5);
            if ( nsteps < 1 ) {
                discard;
            }
        
            // Get starting location and step vector in texture coordinates
            vec3 step = ((v_position - front) / u_size) / float(nsteps);
            vec3 startLoc = localToTex(front);
            vec3 finalLoc = startLoc;
            nsteps += 1;
        
            // Trace the ray to render the object at this fragment
            #ifdef USE_VOLUME_RENDERING
                finalLoc = renderVolume(startLoc, step, nsteps, viewRay, maxSteps);
            #endif
        
            #ifdef USE_SLICE_PLANES
                finalLoc = renderSlicePlanes(startLoc, step, nsteps, maxSteps);
            #endif
        
            #ifdef USE_MAXIP
                finalLoc = renderIntensityProjection(startLoc, step, nsteps, maxSteps);
            #endif
        
            #ifdef USE_MINIP
                finalLoc = renderIntensityProjection(startLoc, step, nsteps, maxSteps);
            #endif
        
            #ifdef USE_ISOSURFACE
                finalLoc = renderIsosurface(startLoc, step, nsteps, viewRay, maxSteps);
            #endif
        
            if (gl_FragColor.a < 0.05) {
                discard;
            }
        
            #ifdef USE_VOLUME_RENDERING
                // Revert premultiplied alpha
                gl_FragColor.rgb = gl_FragColor.rgb / gl_FragColor.a;
            #endif
        
            #ifdef USE_ISOSURFACE
                #ifdef TRANSPARENT_ISOSURFACE
                    // Revert premultiplied alpha
                    gl_FragColor.rgb = gl_FragColor.rgb / gl_FragColor.a;
                #endif
            #endif
        
            #ifdef DEPTH_SHADER
                setDepth(finalLoc);
            #else
                #ifdef USE_CINEMATIC_RENDERING
                    // Apply light scattering at the final location
                    if (u_passNumber == 4) {
                        gl_FragColor = applyLighting(gl_FragColor, finalLoc, viewRay, lightTransmittance( finalLoc, viewRay ) );
                    }
                #endif
                if (u_passNumber == 1) {
                    testDepth(finalLoc);
                }
                gl_FragDepth = computeDepth(finalLoc);
            #endif
            
        }
        `}},R,W),R.exports=I},8695:(R,W,d)=>{var O,I;O=[d(40),d(2588)],I=d.dj.d(O,function(f,N){return class extends N{constructor(h,r){super(h,r),this.size=new f.Vector3(r.Size[0],r.Size[1],r.Size[2]),this._scale=new f.Vector3(r.Scale[0],r.Scale[1],r.Scale[2]),this._offset=new f.Vector3(r.Offset[0],r.Offset[1],r.Offset[2]),this.totalSize=new f.Vector3(r.TotalSize[0],r.TotalSize[1],r.TotalSize[2]),this.localOffset=new f.Vector3(r.LocalOffset[0],r.LocalOffset[1],r.LocalOffset[2]),this.numElements=r.Size[0]*r.Size[1]*r.Size[2],this._texture=null,this._overlayTexture=null,this._alphaTexture=null,this._matrix=new f.Matrix4;const o=new f.Matrix4,c=new f.Matrix4;o.makeScale(this._scale.x,this._scale.y,this._scale.z),c.setPosition(this._offset.x+.5,this._offset.y+.5,this._offset.z+.5),this._matrix.makeTranslation(-.5,-.5,-.5),this._matrix.premultiply(o),this._matrix.premultiply(c);const u=Math.sqrt(Math.pow(this.size.x,2)+Math.pow(this.size.y,2)+Math.pow(this.size.z,2));this._smallVolumeScaleFactor=u<50?u/100:1,this._smallVolumeDefines=this._smallVolumeScaleFactor<1?"#define USE_SMALL_VOLUME":""}load(h,r,o,c,u){if(this._mesh===null){const g=new f.BoxGeometry;g.scale(this.size.x,this.size.y,this.size.z),g.translate(this.size.x/2+.5,this.size.y/2+.5,this.size.z/2+.5),this._mesh=new f.Mesh(g,r.material.clone()),this._depthMesh=new f.Mesh(g,o.material.clone()),this._mesh.matrixAutoUpdate=!1,this._depthMesh.matrixAutoUpdate=!1,this._clearTransferFunctionTextures(),this._mesh.matrix=this._matrix,this._depthMesh!==null&&(this._depthMesh.matrix=this._matrix,this._depthMesh.matrixWorldNeedsUpdate=!0),this._mesh.matrixWorldNeedsUpdate=!0,this.copyGlobalUniforms(c),this._mesh.renderOrder=r.renderOrder,r.add(this._mesh),o.add(this._depthMesh)}else this._mesh.material.dispose(),this._depthMesh.material.dispose(),this._mesh.material=r.material.clone(),this._depthMesh.material=o.material.clone(),this.copyGlobalUniforms(c);this.copyUniforms(r.material.uniforms,u),this.memory=h.byteLength/1e6,this._initTextures(h,u),this.loaded=!0,this.visible=!0}_initTextures(h,r){this._clearTextures();const o=new Uint8Array(h);let c=0;r.UseData&&(c=r.NumChannels*this.size.x*this.size.y*this.size.z,this._initTexture(o.slice(0,c),this.size,r)),r.UseAlpha&&(this._initAlphaTexture(o.slice(c,c+this.size.x*this.size.y*this.size.z),this.size,r),c+=this.size.x*this.size.y*this.size.z),r.UseOverlay&&this._initOverlayTexture(o.slice(c,o.length),this.size,r),this._setTextures()}copyMaterial(h,r,o,c){super.copyMaterial(h,r,o,c),this._mesh!==null&&(this.copyGlobalUniforms(o),this._setTextures())}copyUniforms(h,r){this._mesh!==null&&(this._mesh.material.uniforms.u_transferFunction.value=h.u_transferFunction.value,this._mesh.material.uniforms.u_clim.value=h.u_clim.value,this._mesh.material.uniforms.u_overlayclim.value=h.u_overlayclim.value,this._mesh.material.uniforms.u_overlayTransferFunction.value=h.u_overlayTransferFunction.value,this._mesh.material.uniforms.u_isovalue.value=h.u_isovalue.value,this._mesh.material.uniforms.u_gradientOpacityLimits.value=h.u_gradientOpacityLimits.value,this._mesh.material.uniforms.u_relativeStepSize.value=h.u_relativeStepSize.value*this._smallVolumeScaleFactor,this._mesh.material.uniforms.u_interactionStarted.value=h.u_interactionStarted.value,this._mesh.material.uniforms.u_depthSensitivity.value=h.u_depthSensitivity.value,this._mesh.material.uniforms.u_specularStrength.value=h.u_specularStrength.value,this._mesh.material.uniforms.u_shininess.value=h.u_shininess.value,this._mesh.material.uniforms.u_anisotropy.value=h.u_anisotropy.value,this._mesh.material.uniforms.u_rgbAnchorColor.value=h.u_rgbAnchorColor.value,this._mesh.material.uniforms.worldCoordClippingPlanes.value=h.worldCoordClippingPlanes.value,this._mesh.material.uniforms.u_size.value.copy(this.size),this._mesh.material.uniforms.u_totalSize.value.copy(this.totalSize),this._mesh.material.uniforms.u_offset.value.copy(this.localOffset),this._depthMesh.material.uniforms.u_transferFunction.value=h.u_transferFunction.value,this._depthMesh.material.uniforms.u_clim.value=h.u_clim.value,this._depthMesh.material.uniforms.u_overlayTransferFunction.value=h.u_overlayTransferFunction.value,this._depthMesh.material.uniforms.u_isovalue.value=h.u_isovalue.value,this._depthMesh.material.uniforms.u_gradientOpacityLimits.value=h.u_gradientOpacityLimits.value,this._depthMesh.material.uniforms.u_relativeStepSize.value=h.u_relativeStepSize.value*this._smallVolumeScaleFactor,this._depthMesh.material.uniforms.u_interactionStarted.value=h.u_interactionStarted.value,this._depthMesh.material.uniforms.u_depthSensitivity.value=h.u_depthSensitivity.value,this._depthMesh.material.uniforms.u_anisotropy.value=h.u_anisotropy.value,this._depthMesh.material.uniforms.u_rgbAnchorColor.value=h.u_rgbAnchorColor.value,this._depthMesh.material.uniforms.worldCoordClippingPlanes.value=h.worldCoordClippingPlanes.value,this._depthMesh.material.uniforms.u_size.value.copy(this.size),this._depthMesh.material.uniforms.u_totalSize.value.copy(this.totalSize),this._depthMesh.material.uniforms.u_offset.value.copy(this.localOffset),this._slicePlanes(h.slicePlanes.value),this._interpolation(r))}_slicePlanes(h){let r=null;const o=h.length/4,c=new f.Matrix4,u=new f.Plane;if(o>0)if(this._scale.x>1||this._scale.y>1||this._scale.z>1){r=new Float32Array(h.length),c.makeScale(1/this._scale.x,1/this._scale.y,1/this._scale.z);for(let g=0;g<o;g++)u.setComponents(h[g*4],h[g*4+1],h[g*4+2],h[g*4+3]).applyMatrix4(c),r[g*4]=u.normal.x,r[g*4+1]=u.normal.y,r[g*4+2]=u.normal.z,r[g*4+3]=u.constant}else r=Array.from(h);this._mesh.material.uniforms.slicePlanes.value=r,this._depthMesh.material.uniforms.slicePlanes.value=r}copyGlobalUniforms(h){super.copyGlobalUniforms(h),this._mesh.material.uniforms.u_lightColor=h.u_lightColor,this._mesh.material.uniforms.u_primaryLight=h.u_primaryLight,this._mesh.material.uniforms.u_cameraTarget=h.u_cameraTarget,this._mesh.material.uniforms.u_ambientStrength=h.u_ambientStrength,this._mesh.material.uniforms.u_primaryLightIntensity=h.u_primaryLightIntensity,this._mesh.material.uniforms.u_lightRaySteps=h.u_lightRaySteps,this._mesh.material.uniforms.u_secondaryLight=h.u_secondaryLight,this._mesh.material.uniforms.u_secondaryLightIntensity=h.u_secondaryLightIntensity,this._mesh.material.uniforms.u_deferredTexture=h.u_deferredTexture}_initTexture(h,r,o){switch(this._texture=new f.DataTexture3D(h,r.x,r.y,r.z),this._texture.type=f.UnsignedByteType,this._texture.generateMipmaps=!1,this._texture.unpackAlignment=1,this._texture.minFilter=o.MinFilter,this._texture.magFilter=o.MagFilter,this._texture.wrapS=f.ClampToEdgeWrapping,this._texture.wrapT=f.ClampToEdgeWrapping,this._texture.wrapR=f.ClampToEdgeWrapping,o.NumChannels){case 1:this._texture.format=f.RedFormat;break;case 2:this._texture.format=f.RGFormat;break;case 3:this._texture.format=f.RGBFormat;break;case 4:this._texture.format=f.RGBAFormat;break}this._texture.needsUpdate=!0}_initOverlayTexture(h,r,o){this._overlayTexture=new f.DataTexture3D(h,r.x,r.y,r.z),this._overlayTexture.format=f.RedFormat,this._overlayTexture.type=f.UnsignedByteType,this._overlayTexture.minFilter=o.OverlayFilter,this._overlayTexture.magFilter=f.NearestFilter,this._overlayTexture.generateMipmaps=!1,this._overlayTexture.unpackAlignment=1,this._overlayTexture.needsUpdate=!0}_initAlphaTexture(h,r,o){this._alphaTexture=new f.DataTexture3D(h,r.x,r.y,r.z),this._alphaTexture.format=f.AlphaFormat,this._alphaTexture.type=f.UnsignedByteType,this._alphaTexture.minFilter=o.MinFilter,this._alphaTexture.magFilter=f.NearestFilter,this._alphaTexture.generateMipmaps=!1,this._alphaTexture.unpackAlignment=1,this._alphaTexture.needsUpdate=!0}_setTextures(){this._mesh.material.uniforms.u_data.value=this._texture,this._mesh.material.uniforms.u_alphaData.value=this._alphaTexture,this._mesh.material.uniforms.u_overlayData.value=this._overlayTexture,this._depthMesh.material.uniforms.u_data.value=this._texture,this._depthMesh.material.uniforms.u_alphaData.value=this._alphaTexture,this._depthMesh.material.uniforms.u_overlayData.value=this._overlayTexture}_interpolation(h){this._texture!==null&&(this._texture.minFilter!==h.MinFilter||this._texture.magFilter!==h.MagFilter)&&(this._texture.minFilter=h.MinFilter,this._texture.magFilter=h.MagFilter,this._texture.needsUpdate=!0),this._overlayTexture!==null&&this._overlayTexture.minFilter!==h.OverlayFilter&&(this._overlayTexture.minFilter=h.OverlayFilter,this._overlayTexture.needsUpdate=!0),this._alphaTexture!==null&&this._alphaTexture.minFilter!==h.MinFilter&&(this._alphaTexture.minFilter=h.MinFilter,this._alphaTexture.needsUpdate=!0)}_clearTextures(){this._texture!==null&&(this._texture.dispose(),this._texture=null),this._overlayTexture!==null&&(this._overlayTexture.dispose(),this._overlayTexture=null),this._alphaTexture!==null&&(this._alphaTexture.dispose(),this._alphaTexture=null)}_isCulled(h){if(h.numSlicePlanes>0){let r=!1;const o=new f.Plane;for(let c=0;c<h.numSlicePlanes;c++)o.setComponents(h.slicePlanes[c*4],h.slicePlanes[c*4+1],h.slicePlanes[c*4+2],h.slicePlanes[c*4+3]),o.applyMatrix4(h.tform),r=r||o.intersectsSphere(this._sphere);return super._isCulled(h)||!r}else return super._isCulled(h)}unload(){super.unload(),this.dispose()}dispose(){this._clearTransferFunctionTextures(),this._clearTextures(),super.dispose()}}},R,W),R.exports=I},3252:(R,W,d)=>{var O,I;O=[d(40),d(8855),d(7669),d(3734)],I=d.dj.d(O,function(f,N,b,h){return class extends N{refreshData(o,c){super.refreshData(o,c),this._memoryUsed=o.byteLength*2/1e6}crop(o,c){this._numCropBoxes=c===!0?1:0,this._cropDefines=o===!0?"#define CROP_EXCLUDE":"",this._cropTypeDefines=this._setCropTypeDefines(this._globalData.cropType),this._updateFragmentShader()}colorInBox(o){this._colorBoxDefines=o===!0?"#define COLOR_BOX":"",this._updateFragmentShader()}pick(o,c,u,g,m,y){if(this._pickable&&this._mesh!==null&&this._mesh.visible&&!this._clipped(u)){this._mesh.geometry.boundingSphere===null&&this._mesh.geometry.computeBoundingSphere();const x=this._mesh.geometry.boundingSphere.clone(),w=new f.Vector3,C=new f.Vector3,P=new f.Vector3,T=new f.Vector3,M=new f.Vector3,z=new f.Matrix4().copy(this._mesh.matrixWorld).invert(),Y=o.camera.position.clone().applyMatrix4(z),X=o.ray.clone().applyMatrix4(z);let S=Number.MAX_SAFE_INTEGER,F,k=1,G=!1,H=this._mesh.material.uniforms.lineWidth.value;if(this._worldCoordDefines!=="#define WORLD_UNITS"&&(H=Math.max(1.5*H,4),o.camera.type==="OrthographicCamera"?H*=x.radius/(Math.min(m.width,m.height)*o.camera.zoom):(G=!0,H*=Math.tan(o.camera.fov*Math.PI/360)/(m.height*o.camera.zoom))),x.applyMatrix4(this._mesh.matrixWorld),x.radius+=H,o.ray.intersectsSphere(x)===!1)return;H=H/((this._mesh.scale.x+this._mesh.scale.y+this._mesh.scale.z)/3);const q=H*H;let ce=!1,Q=-1;for(let ne=0;ne<this._mesh.geometry.attributes.instanceStart.count-1;ne++){w.fromBufferAttribute(this._mesh.geometry.attributes.instanceStart,ne),C.fromBufferAttribute(this._mesh.geometry.attributes.instanceStart,ne+1);const he=X.distanceSqToSegment(w,C,P,T);G&&(k=Y.distanceToSquared(T)),he<q*k&&(ce=!0,w.distanceToSquared(T)<C.distanceToSquared(T)?(F=w.applyMatrix4(this._mesh.matrixWorld).distanceTo(u),F<S&&(S=F,M.copy(w),Q=ne)):(F=C.applyMatrix4(this._mesh.matrixWorld).distanceTo(u),F<S&&(S=F,M.copy(C),Q=ne)))}ce&&c.push({point:M.toArray(),distance:F,object:y,picked:!0,id:Q})}}_constructProperties(o,c){super._constructProperties(o,c),this._shader=b,this._cropDefines=c.cropBoxExclude===!0?"#define CROP_EXCLUDE":"",this._cropTypeDefines=this._setCropTypeDefines(c.cropType),this._colorBoxDefines="",this._worldCoordDefines=o.WidthInWorldCoordinates===!0?"#define WORLD_UNITS":"",this._alphaCoverageDefines=o.AlphaToCoverage===!0?"#define USE_ALPHA_TO_COVERAGE":""}_constructMesh(o,c,u){const g=f.UniformsUtils.clone(this._shader.uniforms);this._setGlobalUniforms(g),this._mesh=new f.Mesh(o,this._initMaterial(!1,g,c,u)),this._depthMesh=new f.Mesh(o,this._initMaterial(!0,g,c,u))}_initMaterial(o,c,u,g){return new f.ShaderMaterial({transparent:!0,clipping:!0,uniforms:c,defines:this._shader.defines,vertexShader:this._getVertexShader(o),fragmentShader:this._getFragmentShader(o),premultipliedAlpha:o,clipIntersection:this._clipIntersection,blending:o===!0?f.NoBlending:f.NormalBlending,depthTest:!0,depthWrite:!0,side:f.FrontSide,vertexColors:!0})}_updateFragmentShader(){this._mesh.material.fragmentShader=this._getFragmentShader(!1),this._mesh.material.needsUpdate=!0,this._depthMesh!==null&&(this._depthMesh.material.fragmentShader=this._getFragmentShader(!0),this._depthMesh.material.needsUpdate=!0)}_updateVertexShader(){this._mesh.material.vertexShader=this._getVertexShader(!1),this._mesh.material.needsUpdate=!0,this._depthMesh!==null&&(this._depthMesh.material.vertexShader=this._getVertexShader(!0),this._depthMesh.material.needsUpdate=!0)}_getFragmentShader(o){let c=this._replaceConstants(this._shader.fragmentShader,this._numCropBoxes);return c=[this._worldCoordDefines,this._alphaCoverageDefines,this._cropDefines,this._colorBoxDefines,this._cropTypeDefines,c].join(`
`),o&&(c=["#define DEPTH_SHADER",c].join(`
`)),c}_getVertexShader(o){let c=[this._worldCoordDefines,this._alphaCoverageDefines,this._cropDefines,this._colorBoxDefines,this._shader.vertexShader].join(`
`);return o&&(c=["#define DEPTH_SHADER",c].join(`
`)),c}_replaceConstants(o,c){return o.replace(/NUM_CROP_BOXES/g,c)}_colorStyle(o,c){o===!1&&(this._mesh.material.uniforms.diffuse.value=c),this._colorByVertex!==o&&(this._setMaterialColor(o,c),this._colorByVertex=o)}_setMaterialColor(o,c){o?this._mesh.material.uniforms.diffuse.value=new f.Color(1,1,1):this._mesh.material.uniforms.diffuse.value=c,this._mesh.material.vertexColors=o,this._mesh.material.needsUpdate=!0}_setLineWidth(o){this._mesh.material.uniforms.lineWidth.value=o}_setAlphaToCoverage(o){const c=this._alphaCoverageDefines;this._alphaCoverageDefines=o===!0?"#define USE_ALPHA_TO_COVERAGE":"",c!==this._alphaCoverageDefines&&(this._needsUpdate=!0)}_setWorldCoords(o){const c=this._worldCoordDefines;this._worldCoordDefines=o===!0?"#define WORLD_UNITS":"",c!==this._worldCoordDefines&&(this._needsUpdate=!0)}_setProperties(o){this._needsUpdate=!1,super._setProperties(o),this._mesh.material.uniforms.opacity.value=o.Alpha,this._setLineWidth(o.LineWidth),this._setAlphaToCoverage(o.AlphaToCoverage),this._setWorldCoords(o.WidthInWorldCoordinates),this._needsUpdate&&(this._needsUpdate=!1,this._updateVertexShader(),this._updateFragmentShader())}_initGeometry(o,c,u,g){const m=new h;let y=0,x=0;c>0&&(y=g>0?3*(2*c-2*(g-1)):3*(2*c-2),x=(c-1)*3);const w=g,C=3*c+g,P=new Float32Array(y),T=new Float32Array(y);if(g>0)for(let M=0;M<g-1;M++){for(let z=3*o[M];z<3*(o[M+1]-1);z+=3)P[2*z-M*6]=o[z+w],P[2*z-M*6+1]=o[z+w+1],P[2*z-M*6+2]=o[z+w+2],P[2*z-M*6+3]=o[z+w+3],P[2*z-M*6+4]=o[z+w+4],P[2*z-M*6+5]=o[z+w+5];if(u)for(let z=3*o[M];z<3*(o[M+1]-1);z+=3)T[2*z-M*6]=o[z+C],T[2*z-M*6+1]=o[z+C+1],T[2*z-M*6+2]=o[z+C+2],T[2*z-M*6+3]=o[z+C+3],T[2*z-M*6+4]=o[z+C+4],T[2*z-M*6+5]=o[z+C+5]}else{for(let M=0;M<x;M+=3)P[2*M]=o[M+w],P[2*M+1]=o[M+w+1],P[2*M+2]=o[M+w+2],P[2*M+3]=o[M+w+3],P[2*M+4]=o[M+w+4],P[2*M+5]=o[M+w+5];if(u)for(let M=0;M<x;M+=3)T[2*M]=o[M+C],T[2*M+1]=o[M+C+1],T[2*M+2]=o[M+C+2],T[2*M+3]=o[M+C+3],T[2*M+4]=o[M+C+4],T[2*M+5]=o[M+C+5]}return u?(m.setPositions(P),m.setColors(T)):m.setPositions(P),m.computeBoundingBox(),m.computeBoundingSphere(),m}}},R,W),R.exports=I},7669:(R,W,d)=>{var O,I;O=[d(40)],I=d.dj.d(O,function(f){return{defines:{TOLERANCE:1e-6},uniforms:{opacity:{value:1},lineWidth:{value:1},diffuse:{value:new f.Vector3(1,1,1)},u_passNumber:{value:0},u_depthTexture:{value:null},u_previousTexture:{value:null},u_viewportSize:{value:new f.Vector2(1,1)},u_cropMin:{value:new f.Vector3(0,0,0)},u_cropMax:{value:new f.Vector3(1,1,1)}},vertexShader:`#include <common>
        #include <color_pars_vertex>
        #include <fog_pars_vertex>
        #include <logdepthbuf_pars_vertex>
        #include <clipping_planes_pars_vertex>
        
        uniform float lineWidth;
        uniform vec2 u_viewportSize;
        
        attribute vec3 instanceStart;
        attribute vec3 instanceEnd;
        
        attribute vec3 instanceColorStart;
        attribute vec3 instanceColorEnd;
        
        #ifdef WORLD_UNITS
            varying vec4 worldPos;
            varying vec3 worldStart;
            varying vec3 worldEnd;
        #else
            varying vec2 vUv;
        #endif
        
        varying vec3 vWorldCoords; 
        
        void trimSegment( const in vec4 start, inout vec4 end ) {
            // Trim end segment so it terminates between the camera plane and the near plane
            // conservative estimate of the near plane
            float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
            float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
            float nearEstimate = - 0.5 * b / a;
            float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );
        
            end.xyz = mix( start.xyz, end.xyz, alpha );
        }
        
        void main() {
        
            #ifdef USE_COLOR
                vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;
            #endif
        
            float aspect = u_viewportSize.x / u_viewportSize.y;
        
            // Camera space
            vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
            vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );
        
            // World space
            vec4 worldStartCoords = modelMatrix * vec4( instanceStart, 1.0 );
            vec4 worldEndCoords = modelMatrix * vec4( instanceEnd, 1.0 );
        
            #ifdef WORLD_UNITS
                worldStart = start.xyz;
                worldEnd = end.xyz;
            #else
                vUv = uv;
            #endif
        
            // Special case for perspective projection and segments that terminate either in, or behind, the camera plane
            bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column
        
            if ( perspective ) {
                if ( start.z < 0.0 && end.z >= 0.0 ) {
                    trimSegment( start, end );
                } else if ( end.z < 0.0 && start.z >= 0.0 ) {
                    trimSegment( end, start );
                }
            }
        
            // Clip space
            vec4 clipStart = projectionMatrix * start;
            vec4 clipEnd = projectionMatrix * end;
        
            // ndc space
            vec3 ndcStart = clipStart.xyz / clipStart.w;
            vec3 ndcEnd = clipEnd.xyz / clipEnd.w;
        
            // Direction
            vec2 dir = ndcEnd.xy - ndcStart.xy;
        
            // Account for clip-space aspect ratio
            dir.x *= aspect;
            dir = normalize( dir );
        
            #ifdef WORLD_UNITS
        
                // Get the offset direction as perpendicular to the view vector
                vec3 worldDir = normalize( end.xyz - start.xyz );
                vec3 offset;
                if ( position.y < 0.5 ) {
                    offset = normalize( cross( start.xyz, worldDir ) );
                } else {
                    offset = normalize( cross( end.xyz, worldDir ) );
                }
        
                // Sign flip
                if ( position.x < 0.0 ) {
                    offset *= - 1.0;
                }
        
                float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );
        
                // Extend the line bounds to encompass  endcaps
                start.xyz += - worldDir * lineWidth * 0.5;
                end.xyz += worldDir * lineWidth * 0.5;
        
                // Shift the position of the quad so it hugs the forward edge of the line
                offset.xy -= dir * forwardOffset;
                offset.z += 0.5;
        
                // End caps
                if ( position.y > 1.0 || position.y < 0.0 ) {
                    offset.xy += dir * 2.0 * forwardOffset;
                }
        
                // adjust for line width
                offset *= lineWidth * 0.5;
        
                // set the world position
                worldPos = ( position.y < 0.5 ) ? start : end;
                worldPos.xyz += offset;
        
                // Project the worldpos
                vec4 clip = projectionMatrix * worldPos;
        
                // Shift the depth of the projected points so the line
                // segments overlap neatly
                vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
                clip.z = clipPose.z * clip.w;
        
            #else
        
                vec2 offset = vec2( dir.y, - dir.x );
                // Undo aspect ratio adjustment
                dir.x /= aspect;
                offset.x /= aspect;
        
                // Sign flip
                if ( position.x < 0.0 ) {
                    offset *= - 1.0;
                }
        
                // End caps
                if ( position.y < 0.0 ) {
                    offset += - dir;
                } else if ( position.y > 1.0 ) {
                    offset += dir;
                }
        
                // Adjust for line width
                offset *= lineWidth;
        
                // Adjust for clip-space to screen-space conversion
                offset /= u_viewportSize.y;
        
                // Select end
                vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;
        
                // Back to clip space
                offset *= clip.w;
                clip.xy += offset;
        
            #endif
        
            gl_Position = clip;
        
            // Approximations for model view and world coordinates
            vec4 mvPosition = ( position.y < 0.5 ) ? start : end; 
            vWorldCoords = ( position.y < 0.5 ) ? worldStartCoords.xyz : worldEndCoords.xyz; 
        
            #include <logdepthbuf_vertex>
            #include <clipping_planes_vertex>
            #include <fog_vertex>
        
        }`,fragmentShader:`uniform vec3 diffuse;
        uniform float opacity;
        uniform float lineWidth;
        
        uniform sampler2D u_depthTexture;
        uniform int u_passNumber;
        uniform vec2 u_viewportSize;
        uniform sampler2D u_previousTexture;
        
        #ifdef WORLD_UNITS
            // Set line width in world units
            varying vec4 worldPos;
            varying vec3 worldStart;
            varying vec3 worldEnd;
        #else
            varying vec2 vUv;
        #endif
        
        varying vec3 vWorldCoords; 
        
        #if NUM_CROP_BOXES > 0
            uniform vec3 u_cropMin;
            uniform vec3 u_cropMax;
            uniform vec3 u_cropCenter;
            uniform float u_cropRadius;
            uniform float u_cropHeight;
        #endif
        
        #ifdef COLOR_BOX
            uniform mat4 u_colorBoxMatrix;
            uniform vec3 u_colorBoxColor;
        #endif
        
        #include <common>
        #include <color_pars_fragment>
        #include <fog_pars_fragment>
        #include <logdepthbuf_pars_fragment>
        #include <clipping_planes_pars_fragment>
        
        vec4 packDepthToRGBA( float depth ) {
            vec3 packFactors = vec3( 256.0 * 256.0 * 256.0, 256.0 * 256.0,  256.0 );
            float shiftRight8 = 1.0 / 256.0; // Handle overflow
            float packUpscale = 256.0 / 255.0; // fraction -> 0..1 (including 1)
            
            vec4 rgba = vec4( fract(depth * packFactors), depth);
            rgba.yzw -= rgba.xyz * shiftRight8;
            return rgba * packUpscale;
        }
        
        void setDepth () {
            if (u_passNumber == 2 ) {
                float prevDepth = texture(u_previousTexture, gl_FragCoord.xy / u_viewportSize).x;
                if (gl_FragCoord.z < prevDepth + TOLERANCE) {
                    discard;
                }
            }
            gl_FragColor = packDepthToRGBA(gl_FragCoord.z);
            gl_FragDepth = gl_FragCoord.z;
        }
        
        void testDepth () {
            if (u_passNumber == 1 ) {
                float priorDepth = texture( u_depthTexture, gl_FragCoord.xy / u_viewportSize ).x;
                float accumulatedDepth = texture( u_previousTexture, gl_FragCoord.xy / u_viewportSize ).x;
        
                // Should be between current depth and previous depth to be included
                if (gl_FragCoord.z > priorDepth + TOLERANCE  || gl_FragCoord.z < accumulatedDepth + TOLERANCE ) {
                    discard;
                }
            }
        }
        
        #ifdef COLOR_BOX
        
            vec4 colorInBox (vec4 color) {
                vec4 pos = u_colorBoxMatrix * vec4(vWorldCoords, 1.0);
                vec3 s = step(vec3(-0.5), pos.xyz) - step(vec3(0.5), pos.xyz);
                if ((s.x * s.y * s.z) > 0.0) {
                    color.rgb = u_colorBoxColor;
                }
                return color;
            }
        
        #endif
        
        bool outsideCropBox () {
            #if NUM_CROP_BOXES > 0
                
                #if CROP_TYPE == 0
                    vec3 s = step(u_cropMin, vWorldCoords) - step(u_cropMax, vWorldCoords);
                    #ifdef CROP_EXCLUDE
                        return bool(s.x * s.y * s.z);
                    #else
                        return bool(1.0 - (s.x * s.y * s.z));
                    #endif
                #endif
        
                // For a point p on the object and a point c as the center of the sphere,
                // Check if abs(p.xyz - r.xyz) > radius (distance of p from center is greater than radius)
                // If so, then the point lies outside the sphere. Otherwise it lies within the sphere.
        
                #if CROP_TYPE == 1
                    float dist = distance(vWorldCoords, u_cropCenter);
                    #ifdef CROP_EXCLUDE
                        return (dist <= u_cropRadius);
                    #else
                        return (dist > u_cropRadius);
                    #endif    
                #endif
        
                // For a point p on the object and a point c as the center of the cylinder,
                // Check if abs(p.xy - r.xy) > radius (distance of p from center is greater than radius)
                // If so, then the point lies outside the curved surface of the cylinder along the x-y plane. 
                // Otherwise it lies within the curved surface of the cylinder.
                // Check if abs(p.z - c.z) > height / 2.0f (distance of p from the center along the z-axis is greater than height of the cylinder/2)
                // If so, then the point lies outside the end caps of the cylinder.
                // If either of these conditions are met, then the point lies outside the cylinder.
        
                #if CROP_TYPE == 2
                    float distanceXYPlane = distance(vec2(vWorldCoords.x, vWorldCoords.y), vec2(u_cropCenter.x, u_cropCenter.y));
                    float distanceZAxis = abs(vWorldCoords.z - u_cropCenter.z);
                    #ifdef CROP_EXCLUDE
                        return (distanceXYPlane <= u_cropRadius && distanceZAxis <= (u_cropHeight / 2.0f));
                    #else
                        return (distanceXYPlane > u_cropRadius || distanceZAxis > (u_cropHeight / 2.0f));
                    #endif
                #endif
            #else
                return false;
            #endif
        }
        
        vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {
            float mua;
            float mub;
        
            vec3 p13 = p1 - p3;
            vec3 p43 = p4 - p3;
        
            vec3 p21 = p2 - p1;
        
            float d1343 = dot( p13, p43 );
            float d4321 = dot( p43, p21 );
            float d1321 = dot( p13, p21 );
            float d4343 = dot( p43, p43 );
            float d2121 = dot( p21, p21 );
        
            float denom = d2121 * d4343 - d4321 * d4321;
        
            float numer = d1343 * d4321 - d1321 * d4343;
        
            mua = numer / denom;
            mua = clamp( mua, 0.0, 1.0 );
            mub = ( d1343 + d4321 * ( mua ) ) / d4343;
            mub = clamp( mub, 0.0, 1.0 );
        
            return vec2( mua, mub );
        }
        
        void main() {
        
            #include <clipping_planes_fragment>
        
            #if NUM_CROP_BOXES > 0
                if (outsideCropBox()) {
                    discard;
                }
            #endif
        
            #ifdef DEPTH_SHADER
                setDepth();
            #else
                testDepth();
            #endif
        
            float alpha = opacity;
        
            #ifdef WORLD_UNITS
                // Find the closest points on the view ray and the line segment
                vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
                vec3 lineDir = worldEnd - worldStart;
                vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );
        
                vec3 p1 = worldStart + lineDir * params.x;
                vec3 p2 = rayEnd * params.y;
                vec3 delta = p1 - p2;
                float len = length( delta );
                float norm = len / lineWidth;
        
                #ifdef USE_ALPHA_TO_COVERAGE
                    float dnorm = fwidth( norm );
                    alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );
                #else
                    if ( norm > 0.5 ) {
                        discard;
                    }
                #endif
            #else
                #ifdef USE_ALPHA_TO_COVERAGE
                    // Artifacts appear on some hardware if a derivative is taken within a conditional
                    float a = vUv.x;
                    float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
                    float len2 = a * a + b * b;
                    float dlen = fwidth( len2 );
                    float deriv = float(abs( vUv.y ) > 1.0);
                    alpha = alpha * (1.0 - deriv) + ( (1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 )) * deriv);
                #else
                    if ( abs( vUv.y ) > 1.0 ) {
                        float a = vUv.x;
                        float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
                        float len2 = a * a + b * b;
                        if ( len2 > 1.0 ) {
                            discard;
                        }
                    }
                #endif
            #endif
        
            vec4 diffuseColor = vec4( diffuse, alpha );
        
            #include <logdepthbuf_fragment>
            #include <color_fragment>
        
            #ifdef COLOR_BOX
                gl_FragColor = colorInBox( vec4( diffuseColor.rgb, alpha ) );
            #else
                gl_FragColor = vec4( diffuseColor.rgb, alpha );
            #endif
        
            if (alpha < 0.05) {
                discard;
            }
        
            #include <tonemapping_fragment>
            gl_FragColor = linearToOutputTexel( gl_FragColor );
            #include <fog_fragment>
            #include <premultiplied_alpha_fragment>
        
        }`}},R,W),R.exports=I},738:(R,W,d)=>{var O,I;O=[d(40)],I=d.dj.d(O,function(f){return class extends f.EventDispatcher{constructor(b,h){super(),this._scene=b,this.objects=[],this._numObjects=0,this._annotationUniforms=h}clear(){this._numObjects=0}add(b,h,r,o,c,u){if(this._numObjects+=1,this._numObjects>this.objects.length){const g=this._newObject(o,this._annotationUniforms,c,u);this._scene.add(g),this.objects.push(g)}return this.objects[this._numObjects-1].setLabel(h),this.objects[this._numObjects-1].setPosition(b),this.objects[this._numObjects-1].setColor(r),this.objects[this._numObjects-1].ID=o,this.objects[this._numObjects-1].visible=!0,this._getObject(this._numObjects-1)}new(b,h,r){this._numObjects+=1;let o;return this._numObjects>this.objects.length?(o=this._newObject(r,this._annotationUniforms,0),this._scene.add(o),this.objects.push(o)):(o=this.objects[this._numObjects-1],o.clear(),o.ID=r),o.setColor(h),o.setLabel(b),o.visible=!0,o}setDepthTest(b){for(let h=0;h<this.objects.length;h++)this.objects[h].material.depthTest=b}setPickable(b){for(let h=0;h<this.objects.length;h++)this.objects[h].pickable=b}setTheme(b){for(let h=0;h<this.objects.length;h++)this.objects[h].setTheme(b)}setLabelVisible(){for(let b=0;b<this._numObjects;b++)this.objects[b].setLabelVisible()}refreshLabels(){for(let b=0;b<this._numObjects;b++)this.objects[b].visible&&this.objects[b].refreshLabel()}dispose(){this.clear();for(let b=0;b<this.objects.length;b++)this.objects[b].dispose()}_newObject(b,h,r){return[]}_getObject(b){return this.objects[b]}}},R,W),R.exports=I},7439:(R,W,d)=>{var O,I;O=[d(40),d(9052),d(990)],I=d.dj.d(O,function(f,N,b){return class extends N{constructor(r=0,o,c=0){super(r,o,c),this.type="Angle",this._labelType="angle",this.closed=!1}addPoint(r,o,c){if(this._clampPointToSceneLimits(r,o),this._createPoint(r),this._numPoints===1){const u=new Array(9);r.toArray(u,0),r.toArray(u,3),r.toArray(u,6),this.geometry.setAttribute("position",new f.Float32BufferAttribute(u,3)),this.geometry.setDrawRange(0,2)}else{const u=this.geometry.attributes.position.array;if(this._numPoints===2){const g=this._points[0].position.clone();this._points[0].position.copy(this._points[1].position),this._points[1].position.copy(g),c&&this._snapToAngle(r,g),r.toArray(u,0),g.toArray(u,3),r.toArray(u,6)}else{if(c){const g=new f.Vector3;g.fromArray(u,u.length-6),this._snapToAngle(r,g)}u[u.length-3]=r.x,u[u.length-2]=r.y,u[u.length-1]=r.z}this.geometry.setDrawRange(0,3),this.geometry.attributes.position.needsUpdate=!0}this.geometry.computeBoundingSphere(),this.refreshLabel()}follow(r,o,c,u){if(this._numPoints>1)super.follow(r,o,c,u);else{this._clampPointToSceneLimits(r,c);const g=this.geometry.attributes.position.array;if(u){const m=new f.Vector3;m.fromArray(g,g.length-6),this._snapToAngle(r,m)}g[g.length-6]=r.x,g[g.length-5]=r.y,g[g.length-4]=r.z,this.geometry.attributes.position.needsUpdate=!0,this.refreshLabel()}}close(){}setPosition(r){if(this._setPoints(r),this.closed===!0){const o=new Float32Array(r.length+3);o.set(r),o.set(r.slice(0,3),r.length),this.geometry.setAttribute("position",new f.Float32BufferAttribute(o,3))}else this.geometry.setAttribute("position",new f.Float32BufferAttribute(r,3));this.geometry.computeBoundingSphere(),this.refreshLabel()}refreshLabel(){if(this._showLabel!==!1&&this._numPoints>=2&&this._label!==null){const r=new f.Vector3;if(this._label.measurement===!0){this._label.style="angle",this._label.position.copy(this._points[1].position);const o=new f.Vector3;if(this._numPoints===3)o.subVectors(this._points[2].position,this._points[1].position);else{const u=[...this.geometry.getAttribute("position").array],g=new f.Vector3(u[u.length-3],u[u.length-2],u[u.length-1]);o.subVectors(g,this._points[1].position)}r.subVectors(this._points[0].position,this._points[1].position),this._label.setLabel(r.angleTo(o)*180/Math.PI,this._globalUniforms.units.value)}else this._numPoints===3&&(this._label.style="centered",r.copy(this._points[0].position).add(this._points[1].position).add(this._points[2].position).divideScalar(3),this._label.position.copy(r))}}}},R,W),R.exports=I},8017:(R,W,d)=>{var O,I;O=[d(738),d(7439)],I=d.dj.d(O,function(f,N){return class extends f{_newObject(h,r,o){return new N(h,r,o)}}},R,W),R.exports=I},9501:(R,W,d)=>{var O,I;O=[d(40),d(8380),d(9244),d(4097),d(8017),d(3476),d(2181),d(5290),d(2395),d(9631),d(5195),d(5423),d(9052),d(992),d(884),d(1649),d(8328),d(4935),d(7756)],I=d.dj.d(O,function(f,N,b,h,r,o,c,u,g,m,y,x,w,C,P,T,M,z,Y){return class extends f.EventDispatcher{constructor(S,F,k,G,H){super();const q=document.createElement("div");q.className="iptLabelContainer",F.appendChild(q),this._annotationUniforms={pointSize:{value:8},pointSizeHighlighted:{value:10},edgeColor:{value:new f.Color(1,1,1)},selectedColor:{value:new f.Color(1,.839,.039)},units:{value:""},depthTest:{value:H.DepthTest},pickable:{value:H.Pickable},labelVisible:{value:H.LabelVisible},clampToSceneLimits:{value:!1},container:{value:q},is3D:{value:!0},isDarkTheme:{value:!0},checkExtent:{value:!0}},this.updateRequested=!1,this.enabled=!0,this.contextMenuVisible=!1,this._hitObject=null,this._lastHitLabel=null,this._hitFace=null,this.depthRequired=!1,this._enableAnnotations=!0,this._interactionStarted=!1,this._color=[1,1,1],this._defaultLabel=null,this.continueAnnotating=!1,this.fillWithColor=!1,this._deletable=!0,this._selectable=!1,this._cuboidDefaultSize=new f.Vector3(.2,.2,.2),this._cuboidLastSize=new f.Vector3,this._cuboidRememberSize=!0,this._cuboidRotatable="all",this._paintBrushSize=15,this._paintBrushAlpha=.3141,this._paintBrushPoints=[],this._paintBrushEnabled=!1,this._raycaster=new f.Raycaster,this._scene=S,this._points=new b(S,this._annotationUniforms),this._lines=new h(S,this._annotationUniforms),this._angles=new r(S,this._annotationUniforms),this._polygons=new o(S,this._annotationUniforms),this._elevation=new c(S,this._annotationUniforms),this._cuboids=new u(S,this._annotationUniforms),this._rectangles=new g(S,this._annotationUniforms),this._freehands=new m(S,this._annotationUniforms),this._texts=new y(S,this._annotationUniforms),this._dataTips=new x(S,this._annotationUniforms),this._planes=new N(S,G),this._annotations=[],this._labelDictionary=[],this.clickCounter=0,this._drawingStarted=!1,this.drawing=!1,this._objectBeingDrawn=null,this._objectBeingEdited=null,this._blurHandler=this.stopEditing.bind(this),this._hoverHandler=this._onLabelHover.bind(this),this._clickHandler=this._onLabelClick.bind(this),this._sharedLine=new w(-1,this._annotationUniforms,0),S.add(this._sharedLine),this._sharedLine.visible=!1,this._sharedLine.pickable=!1,this._sharedMarker=new P(-1,this._annotationUniforms,0),S.add(this._sharedMarker),this._sharedMarker.visible=!1,this._sharedMarker.pickable=!1,this._sharedCuboid=new C(-1,this._annotationUniforms),S.add(this._sharedCuboid),this._sharedCuboid.visible=!1,this._sharedCuboid.pickable=!1,this._sharedRectangle=new T(-1,this._annotationUniforms),S.add(this._sharedRectangle),this._sharedRectangle.visible=!1,this._sharedRectangle.pickable=!1,this._crosshair=new M(k),S.add(this._crosshair),this._scissorsPoints=[],this._scissorsForCrop=!0,this._crop=new C(-1,this._annotationUniforms),this._crop.type="CropBox",this._crop.visible=!1,this._cropDeletable=!0,this._cropApplied=!1,S.add(this._crop),this._dataTips.addEventListener("pointerenter",this._hoverHandler),this._dataTips.addEventListener("pointerleave",this._hoverHandler),this._dataTips.addEventListener("pointerdown",this._clickHandler),this._cropSphere=new z(-1,this._annotationUniforms),this._cropSphere.visible=!1,S.add(this._cropSphere),this._cropCylinder=new Y(-1,this._annotationUniforms),this._cropCylinder.visible=!1,S.add(this._cropCylinder),this._cropType="box",this.updateInteractions(G,!1)}update(S){const F=new Float32Array(S);this.stopEditing();const k=F.length,G=F[0]>0,H=F[1];let q=2,ce,Q,ne=1,he=1,ve=6;if(H>0){this._texts.clear();for(let Ie=0;Ie<H;Ie++)ce=this._texts.add(F.slice(q+8,q+11-F[q+7]),this._getLabel(F[q+1]),F.slice(q+2,q+5),ne,1,F.slice(q+5,q+7)),q+=11-F[q+7]}if(G){for(this.clear();q<k;){switch(F[q]){case 0:ce=this._points.add(F.slice(q+5,q+8),this._getLabel(F[q+1]),F.slice(q+2,q+5),ne,1),q+=8;break;case 1:ce=this._lines.add(F.slice(q+5,q+11),this._getLabel(F[q+1]),F.slice(q+2,q+5),ne,2),q+=11;break;case 2:ce=this._angles.add(F.slice(q+5,q+14),this._getLabel(F[q+1]),F.slice(q+2,q+5),ne,3),q+=14;break;case 3:ce=this._elevation.add(F.slice(q+5,q+11),this._getLabel(F[q+1]),F.slice(q+2,q+5),ne,2),q+=11;break;case 4:ce=this._polygons.add(F.slice(q+7,q+7+F[q+5]),this._getLabel(F[q+1]),F.slice(q+2,q+5),ne,F[q+5]/3,F[q+6]===1),q+=7+F[q+5];break;case 5:ce=this._cuboids.add(F.slice(q+5,q+14),this._getLabel(F[q+1]),F.slice(q+2,q+5),ne),q+=14;break;case 6:ce=this._rectangles.add(F.slice(q+5,q+10),this._getLabel(F[q+1]),F.slice(q+2,q+5),ne),q+=10;break;case 7:ce=this._freehands.add(F.slice(q+6,q+6+F[q+5]),this._getLabel(F[q+1]),F.slice(q+2,q+5),ne,F[q+5]/3),q+=6+F[q+5];break;case 9:ce=this._dataTips.add(F.slice(q+1,q+4),"",this._dataTips.color,ne,1),q+=4;break}this._annotations.push(ce),ne++}this._annotationUniforms.checkExtent.value=!(this._annotations.length>10)}else for(;q<k;){switch(F[q+1]){case 0:Q=9,he=3,ve=6;break;case 1:Q=12,he=6,ve=6;break;case 2:Q=15,he=9,ve=6;break;case 3:Q=12,he=6,ve=6;break;case 4:Q=8+F[q+6],he=F[q+6],ve=8,this._annotations[F[q]-1].closed=F[q+7]===1;break;case 5:Q=15,he=9,ve=6;break;case 6:Q=11,he=5,ve=6;break;case 7:Q=7+F[q+6],he=F[q+6],ve=7;break;case 9:Q=5,he=3,ve=2;break}F[q+1]===9?this._annotations[F[q]-1].updateRequired=!0:(this._annotations[F[q]-1].setLabel(this._getLabel(F[q+2])),this._annotations[F[q]-1].setColor(F.slice(q+3,q+6))),this._annotations[F[q]-1].setPosition(F.slice(q+ve,q+ve+he)),this._annotations[F[q]-1].visible=!0,q+=Q}this.contextMenuVisible=!1,this._hitObject=null}setUnits(S){const F=this._annotationUniforms.units.value;S==="voxels"||S==="pixels"?this._annotationUniforms.units.value="":this._annotationUniforms.units.value=S,F!==this._annotationUniforms.units.value&&(this._points.refreshLabels(),this._lines.refreshLabels(),this._angles.refreshLabels(),this._polygons.refreshLabels(),this._elevation.refreshLabels(),this._cuboids.refreshLabels(),this._rectangles.refreshLabels(),this._freehands.refreshLabels(),this._dataTips.refreshLabels())}clear(){for(let S=0;S<this._annotations.length;S++)this._annotations[S].remove();this._annotations=[],this.refreshDataTipQueue(),this._annotationUniforms.checkExtent.value=!0,this._points.clear(),this._lines.clear(),this._angles.clear(),this._polygons.clear(),this._elevation.clear(),this._cuboids.clear(),this._rectangles.clear(),this._freehands.clear(),this._dataTips.clear()}enable(){this.enabled=!0,this._planes.enable()}disable(){this.enabled=!1,this._planes.disable()}renderText(S,F){this._texts.render(S,F),this._dataTips.render(S,F)}editAnnotation(S){this.contextMenuVisible=!1,this._objectBeingEdited=this._annotations[S],this._objectBeingEdited.editLabel(this._blurHandler)}stopEditing(){this._objectBeingEdited!==null&&(this._objectBeingEdited.stopEditing(this._blurHandler)&&this.dispatchEvent({type:"annotationEdited",message:{id:this._objectBeingEdited.ID,label:this._objectBeingEdited.getLabel()}}),this._objectBeingEdited=null)}copy(){const S=[];for(let F=0;F<this._annotations.length;F++)this._annotations[F].selected&&S.push(F+1);this.dispatchEvent({type:"annotationsCopied",message:S})}selectAll(){for(let S=0;S<this._annotations.length;S++)this._annotations[S].select(!1);this.updateRequested=!0}deselectAll(){for(let S=0;S<this._annotations.length;S++)this._annotations[S].deselect();this.updateRequested=!0}addDataTipToQueue(){this._hitObject!==null&&this._dataTips.addToQueue(this._hitObject.parent.type==="Scene"?this._hitObject:this._hitObject.parent)}refreshDataTipQueue(){this._dataTips.refreshAll()}isDataTipQueueEmpty(){return this._dataTips.isQueueEmpty()}updateDataTipQueue(S){this._dataTips.updateQueue(S)}popDataTipQueue(){return this._dataTips.popQueue()}updateCrop(S,F,k){switch(this._cropApplied=S,this._cropApplied&&this._disableCropVolumes(),k){case"box":{if(this._cropApplied){const G=new f.Vector3,H=new f.Vector3;G.fromArray(F[0]),H.fromArray(F[1]),this._crop.position.addVectors(G,H).multiplyScalar(.5),this._crop.scale.subVectors(H,G),this._crop.visible=this._crop.movable||this._cropDeletable,this._cropType="box",this._crop.visible&&this._crop.show()}else this._crop.visible=!1,this._crop.hide();break}case"sphere":{this._cropApplied?(this._cropSphere.position.set(F[0],F[1],F[2]),this._cropSphere.scale.set(F[3],F[3],F[3]),this._cropSphere.visible=this._cropSphere.movable||this._cropDeletable,this._cropType="sphere",this._cropSphere.visible&&this._cropSphere.show()):(this._cropSphere.visible=!1,this._cropSphere.hide());break}case"cylinder":{this._cropApplied?(this._cropCylinder.position.set(F[0],F[1],F[2]),this._cropCylinder.scale.set(F[3],F[4],F[3]),this._cropCylinder.visible=this._cropCylinder.movable||this._cropDeletable,this._cropType="cylinder",this._cropCylinder.visible&&this._cropCylinder.show()):(this._cropCylinder.visible=!1,this._cropCylinder.hide());break}}this.updateRequested=!0}_disableCropVolumes(){this._crop.visible=!1,this._crop.hide(),this._cropSphere.visible=!1,this._cropSphere.hide(),this._cropCylinder.visible=!1,this._cropCylinder.hide()}updateProjection(S,F,k){const G=S.position.clone().sub(F).normalize();this._sharedRectangle.setEye(G,k)}draw(S,F,k,G,H){this.drawing===!1&&this.startDrawing(S,k),this.clickCounter+=1,this._objectBeingDrawn===this._sharedLine?(this._scissorsPoints.push((F.x-.5)*2,(1-F.y-.5)*2),this._objectBeingDrawn.addPoint(S,G,H)):k==="zoom"||k==="rectangle"?this._objectBeingDrawn.start(S,F):k==="paint"?this._paintBrushPoints.push((F.x-.5)*2,(1-F.y-.5)*2):this.isMulticlickAnnotation(k)&&(this._objectBeingDrawn.addPoint(S,G,H),this._hitObject=this._objectBeingDrawn.getLastMarker()),this.updateRequested=!0}startDrawing(S,F){this.drawing=!0,this.clickCounter=0;let k;const G=this._annotations.length+1;switch(F){case"":case"scissors":this._startScissors(F),this._objectBeingDrawn=this._sharedLine;break;case"point":this._objectBeingDrawn=this._points.add(S.toArray(),this._defaultLabel,this._color,G,1),this._hitObject=this._objectBeingDrawn;break;case"line":k=S.toArray(),this._objectBeingDrawn=this._lines.add(k.concat(k),this._defaultLabel,this._color,G,2),this._hitObject=this._objectBeingDrawn.getLastMarker();break;case"elevation":k=S.toArray(),this._objectBeingDrawn=this._elevation.add(k.concat(k),this._defaultLabel,this._color,G,2),this._hitObject=this._objectBeingDrawn.getLastMarker();break;case"angle":this._objectBeingDrawn=this._angles.new(this._defaultLabel,this._color,G),this._hitObject=this._objectBeingDrawn.getLastMarker();break;case"polyline":this._objectBeingDrawn=this._polygons.new(this._defaultLabel,this._color,G),this._objectBeingDrawn.closed=!1,this._hitObject=this._objectBeingDrawn.getLastMarker();break;case"polygon":this._objectBeingDrawn=this._polygons.new(this._defaultLabel,this._color,G),this._objectBeingDrawn.closed=!0,this._hitObject=this._objectBeingDrawn.getLastMarker();break;case"cuboid":this._objectBeingDrawn=this._cuboids.new(this._defaultLabel,this._color,G),this._objectBeingDrawn.scale.copy(this._sharedCuboid.scale),this._objectBeingDrawn.setCenter(S.toArray()),this._cuboidRememberSize===!1&&this._cuboidLastSize.copy(this._cuboidDefaultSize),this._hitObject=null;break;case"rectangle":this._objectBeingDrawn=this._rectangles.new(this._defaultLabel,this._color,G),this._objectBeingDrawn._eye.copy(this._sharedRectangle._eye),this._objectBeingDrawn.up.copy(this._sharedRectangle.up),this._hitObject=this._objectBeingDrawn;break;case"freehand":this._objectBeingDrawn=this._freehands.new(this._defaultLabel,this._color,G),this._hitObject=this._objectBeingDrawn;break;case"data-tip":this._objectBeingDrawn=this._dataTips.add(S.toArray(),"",this._dataTips.color,G,1),this._hitObject=this._objectBeingDrawn.getLastMarker();break;case"zoom":this._setLineColor(this._sharedRectangle),this._objectBeingDrawn=this._sharedRectangle;break}}stopDrawing(){if(this.hideDrawingTools(),this._objectBeingDrawn!==null)this._objectBeingDrawn.close();else{this.cleanUpObject();return}this._objectBeingDrawn===this._sharedLine?(this._scissorsPoints.length>5&&this.dispatchEvent({type:"scissorsFinished",message:{position:this._scissorsPoints,crop:this._scissorsForCrop}}),this.cleanUpScissors()):this._objectBeingDrawn===this._sharedRectangle?this.cleanUpRectangle():((this._objectBeingDrawn.type==="Polyline"||this._objectBeingDrawn.type==="Freehand")&&!this._objectBeingDrawn.isLengthValid()?this._objectBeingDrawn.remove():(this._annotations.push(this._objectBeingDrawn),this._annotationUniforms.checkExtent.value=!(this._annotations.length>10)),this.cleanUpObject())}abortDrawing(){this._objectBeingDrawn!==null&&(this.hideDrawingTools(),this._objectBeingDrawn.remove(),this.cleanUpObject())}followDrawing(S,F,k,G){this.drawing===!0&&(this._objectBeingDrawn.follow(S,F,k,G),this.updateRequested=!0)}undoDrawing(){this.drawing===!0&&(this._objectBeingDrawn.removePoint(),this.updateRequested=!0)}showMarker(S){this._interactionStarted===!0?this.hideDrawingTools():(this.hideCuboid(),this.hidePaintBrush(),this._sharedMarker.visible===!1&&this._sharedMarker.setColor(this._color),this._sharedMarker.onPointerDown(),this._sharedMarker.visible=!0,this._sharedMarker.position.copy(S),this.updateRequested=!0)}showCuboid(S,F){this._interactionStarted===!0?this.hideDrawingTools():(this.hideMarker(),this.hidePaintBrush(),this._sharedCuboid.visible===!1&&(this._sharedCuboid.scale.copy(this._cuboidLastSize).multiplyScalar(2*F),this._sharedCuboid.setColor(this._color)),this._sharedCuboid.visible=!0,this._sharedCuboid.position.copy(S),this.updateRequested=!0)}showPaintBrush(){this.hideMarker(),this.hideCuboid(),this._paintBrushEnabled||(this._paintBrushEnabled=!0,this.dispatchEvent(this.getPaintBrushParameters(!0))),this.updateRequested=!0}scrollCuboid(S,F,k,G,H){F*=.001;const q=this._sharedCuboid.scale.clone();q.divideScalar(S*2),k===!0&&(q.x=q.x+F*q.x),G===!0&&(q.y=q.y+F*q.y),H===!0&&(q.z=q.z+F*q.z),q.clampScalar(0,1),this._cuboidLastSize.copy(q),q.multiplyScalar(S*2),this._sharedCuboid.scale.copy(q)}hideDrawingTools(){this.hideMarker(),this.hideCuboid(),this.hidePaintBrush()}clearCounter(){this.clickCounter=0}hideMarker(){this._sharedMarker.visible&&(this._sharedMarker.visible=!1,this.updateRequested=!0)}hideCuboid(){this._sharedCuboid.visible&&(this._sharedCuboid.visible=!1,this.updateRequested=!0)}hidePaintBrush(){this._paintBrushEnabled&&(this._paintBrushEnabled=!1,this.dispatchEvent(this.getPaintBrushParameters(!1)),this.updateRequested=!0)}setCrosshair(S){this._crosshair.setPosition(S)}getCrosshairPosition(){return new f.Vector3().fromArray(this._crosshair.getPosition())}getZoomBox(){return this._sharedRectangle.getScreenDimensions()}isMulticlickAnnotation(S){return this.isNclickAnnotation(S)||S==="angle"}isNclickAnnotation(S){return S==="polyline"||S==="polygon"||S==="freehand"||S==="scissors"}_startScissors(S){this._scissorsForCrop=S==="",this._setLineColor(this._sharedLine),this._sharedLine.visible=!0}_setLineColor(S){this._annotationUniforms.isDarkTheme.value?S.setColor([.8,.8,.8]):S.setColor([0,0,0])}setColor(S){this._planes.setColor(S);const F=this._annotationUniforms.isDarkTheme.value;this._annotationUniforms.isDarkTheme.value=S[0]+S[1]+S[2]<=2,this._setLineColor(this._crop),this._setLineColor(this._cropSphere),this._setLineColor(this._cropCylinder),this._annotationUniforms.isDarkTheme.value!==F&&(this._points.setTheme(this._annotationUniforms.isDarkTheme.value),this._lines.setTheme(this._annotationUniforms.isDarkTheme.value),this._angles.setTheme(this._annotationUniforms.isDarkTheme.value),this._polygons.setTheme(this._annotationUniforms.isDarkTheme.value),this._elevation.setTheme(this._annotationUniforms.isDarkTheme.value),this._cuboids.setTheme(this._annotationUniforms.isDarkTheme.value),this._rectangles.setTheme(this._annotationUniforms.isDarkTheme.value),this._freehands.setTheme(this._annotationUniforms.isDarkTheme.value),this._texts.setTheme(this._annotationUniforms.isDarkTheme.value),this._crosshair.setTheme(this._annotationUniforms.isDarkTheme.value),this._dataTips.setTheme(this._annotationUniforms.isDarkTheme.value))}cleanUpScissors(){this.drawing===!0&&(this.drawing=!1,this._scissorsPoints=[],this._sharedLine.clear(),this._objectBeingDrawn=null,this.clearCounter(),this.updateRequested=!0)}cleanUpRectangle(){this.drawing===!0&&(this.drawing=!1,this._sharedRectangle.visible=!1,this._objectBeingDrawn=null,this.clearCounter(),this.updateRequested=!0)}cleanUpPaintBrush(){const S={position:this._paintBrushPoints,size:this._paintBrushSize};return this._paintBrushPoints=[],this.drawing=!1,this.clearCounter(),S}getPaintBrushParameters(S){return{type:"paintBrushEnabled",enabled:S,color:this._color,opacity:this._paintBrushAlpha,brushSize:this._paintBrushSize}}cleanUpObject(){this.drawing=!1,this.clearCounter(),this._objectBeingDrawn=null,this.onPointerUp(!0)}isMouseOnObject(){return this._hitObject!==null}_getLabel(S){switch(S){case-1:return null;case 0:return"";default:return typeof this._labelDictionary=="string"?this._labelDictionary:this._labelDictionary[S-1]}}showContextMenu(S){if(this._drawingStarted===!0)return null;switch(this._selectable===!0&&(this.deselectAll(),this._hitObject.parent.type==="Scene"?this._hitObject.select(!1):this._isCullingObject(this._hitObject)||this._hitObject.parent.select(!1),this.updateRequested=!0),this._hitObject.type){case"InteractivePlane":return this._planes.isContextMenuAvailable()?(this.contextMenuVisible=!0,{type:"contextMenuClicked",message:{Position:[S.pageX,S.pageY],Type:this._hitObject.type,ID:this._hitObject.ID}}):null;case"Marker":return this._deletable===!0?(this.contextMenuVisible=!0,this._hitObject.parent.type==="Scene"?{type:"contextMenuClicked",message:{Position:[S.pageX,S.pageY],Type:this._hitObject.type,ID:this._hitObject.ID}}:{type:"contextMenuClicked",message:{Position:[S.pageX,S.pageY],Type:this._hitObject.parent.type,ID:this._hitObject.parent.ID}}):null;case"Face":if(this._hitObject.parent.type==="CropBox"){if(this._cropDeletable===!0)return this.contextMenuVisible=!0,{type:"contextMenuClicked",message:{Position:[S.pageX,S.pageY],Type:this._hitObject.parent.type,ID:0}}}else if(this._deletable===!0)return this.contextMenuVisible=!0,{type:"contextMenuClicked",message:{Position:[S.pageX,S.pageY],Type:this._hitObject.parent.type,ID:this._hitObject.parent.ID}};return null;case"CropSphere":return this._cropDeletable===!0?(this.contextMenuVisible=!0,{type:"contextMenuClicked",message:{Position:[S.pageX,S.pageY],Type:this._hitObject.type,ID:0}}):null;case"CropCylinder":return this._cropDeletable===!0?(this.contextMenuVisible=!0,{type:"contextMenuClicked",message:{Position:[S.pageX,S.pageY],Type:this._hitObject.type,ID:0}}):null;default:return null}}updateInteractions(S,F){switch(this._updateAnnotationInteractions(S.Annotate),this._planes.updateInteractions(S.Clipping,S.Slice,F),this._cropDeletable=S.Crop.Deletable,this._cropType){case"box":this._crop.movable=S.Crop.Movable;break;case"sphere":this._cropSphere.movable=S.Crop.Movable;break;case"cylinder":this._cropCylinder.movable=S.Crop.Movable;break;default:this._crop.movable=S.Crop.Movable;break}this._crop.pickable=this._cropDeletable||this._crop.movable,this._dataTips.objectInfoVisible(S.Select.DisplayObjectInfo),this._cropApplied?this._crop.visible=this._crop.pickable:this._crop.visible=!1}_updateAnnotationInteractions(S){this._color=Array.from(S.DefaultColor),this._sharedMarker.visible===!0&&this._sharedMarker.setColor(this._color),this._sharedCuboid.visible===!0&&this._sharedCuboid.setColor(this._color),typeof S.DefaultLabel=="object"?this._defaultLabel=null:this._defaultLabel=S.DefaultLabel;const F=this._cuboidDefaultSize.clone();this._cuboidDefaultSize.fromArray(S.CuboidDefaultSize),(this._cuboidRememberSize===!1||S.CuboidRememberSize===!1||this._cuboidLastSize.lengthSq()<1e-4||!this._cuboidDefaultSize.equals(F))&&this._cuboidLastSize.copy(this._cuboidDefaultSize),this._cuboidRememberSize=S.CuboidRememberSize,this._cuboidRotatable=S.CuboidRotatable,this._paintBrushSize=S.PaintBrushSize,this._paintBrushAlpha=S.PaintBrushAlpha,this._enableAnnotations=S.Enabled,this.continueAnnotating=S.ContinueAnnotating,this.fillWithColor=S.CuboidFillWithColor,this._deletable=S.Deletable,this._annotationUniforms.clampToSceneLimits.value=S.ClampToSceneLimits,this._annotationUniforms.is3D.value=S.View==="3d"}updateBoundingBox(S,F){this._planes.setPosition(S,F),this._crosshair.clamp()}updatePlanes(S,F,k,G,H){this._planes.update(S,F,k,G,H),this.contextMenuVisible=!1,this._hitObject=null}getSliceState(){return this._planes.state===this._planes.STATE.SLICE}getClipState(){return this._planes.state===this._planes.STATE.CLIPPING&&this._planes.numPlanes<6}hitObject(){return this.isMouseOnObject()||this._lastHitLabel!==null?this._hitObject.type==="InteractivePlane"?this._planes.enableRotate||this._planes.enableTranslate:!0:!1}getState(S,F){return this._hitObject===null?-1:this._lastHitLabel!==null?19:this._hitObject.type==="InteractivePlane"?this._planes.enableRotate&&this._planes.isMouseOnSphere(S,F,this._raycaster,this._hitObject)?10:this._planes.enableTranslate?9:-1:this._hitObject.type==="Marker"?(this.depthRequired=!0,this._hitObject.parent.type==="DataTip"?18:11):this._hitObject.type==="Face"?this._hitObject.parent.type==="CropBox"?14:13:this._hitObject.type==="Freehand"?(this.depthRequired=!0,11):this._hitObject.type==="Crosshair"?17:this._hitObject.type==="CropSphere"||this._hitObject.type==="CropCylinder"?14:-1}_onLabelHover(S){if(S.type==="pointerenter"){if(this._interactionStarted)return;this._lastHitLabel=S.message}else this._lastHitLabel===S.message&&(this._lastHitLabel=null)}_onLabelClick(S){this._interactionStarted||this.dispatchEvent(S)}applyTransformation(S,F,k,G,H,q,ce,Q,ne){if(this._hitObject!==null)switch(this._hitObject.type){case"CropSphere":this._hitObject.applyTransformation(G,H,ce,Q,ne);break;case"CropCylinder":this._hitObject.applyTransformation(S,G,H,ce,Q,this._hitFace,ne);break;default:this._hitObject.applyTransformation(S,F,k,G,H,q,ce)}}applyQuaternion(S,F){this._hitObject!==null&&this._hitObject.applyQuaternion(S,F,this._cuboidRotatable)}moveLabel(S,F,k){this._hitObject===null||this._hitObject.type!=="DataTip"||this._hitObject.moveLabel(S,F,k)}append(S){this._hitObject!==null&&this._hitObject.append(S)}onPointerDown(S,F){if(this._interactionStarted=!0,this._selectable===!0){if(S===!1&&F===!1&&this.deselectAll(),this._hitObject===null)return;this._hitObject.parent.type==="Scene"?this._hitObject.select(F):this._hitObject.parent.type!=="CropBox"&&this._hitObject.parent.select(F)}this._planes.onPointerDown(this._hitObject),this._hitObject!==null&&(this._hitObject.type==="Marker"||this._hitObject.type==="CropSphere"||this._hitObject.type==="CropCylinder")&&this._hitObject.onPointerDown()}onPointerLeave(){this.stopEditing(),this._lastHitLabel=null,this.contextMenuVisible===!1&&(this._dataTips.updateObjectInfo(""),this._planes.onPointerLeave()===!0&&(this.updateRequested=!0),this._crop.visible===!0&&(this._crop.hide(),this.updateRequested=!0),this._cropSphere.visible===!0&&(this._cropSphere.hide(),this.updateRequested=!0),this._cropCylinder.visible===!0&&(this._cropCylinder.hide(),this.updateRequested=!0)),this.hideDrawingTools()}onPointerEnter(){this.drawing===!0&&this._objectBeingDrawn!==null&&(this._hitObject=this._objectBeingDrawn.getLastMarker()),this.contextMenuVisible===!1&&(this._planes.onPointerEnter()===!0&&(this.updateRequested=!0),this._crop.visible===!0&&(this._crop.show(),this.updateRequested=!0),this._cropSphere.visible===!0&&(this._cropSphere.show(),this.updateRequested=!0),this._cropCylinder.visible===!0&&(this._cropCylinder.show(),this.updateRequested=!0))}onPointerUp(S=!0){this._interactionStarted=!1,this.depthRequired=!1,this._planes.onPointerUp(this._hitObject),this._hitObject!==null&&(this._hitObject.type==="Marker"||this._hitObject.type==="CropCylinder"||this._hitObject.type==="CropSphere")&&this._hitObject.onPointerUp(),S&&this._cleanUpHitObject(),this.updateRequested=!0}onPointerMove(S,F,k,G,H,q){if(!this.enabled||this.contextMenuVisible===!0||this._interactionStarted)return;if(!k){this._hitObject!==null&&(this._hitObject.show(),this._hitObject=null,this.updateRequested=!0);return}if(this._lastHitLabel!==null){this._hitObject!==this._lastHitLabel&&(this._hitObject!==null&&this._hitObject.show(),this._hitObject=this._lastHitLabel,this._hitObject.highlight(),this.updateRequested=!0);return}S.x=S.x*2-1,S.y=-S.y*2+1;let ce=2;this._hitObject!==null&&(this._hitObject.type==="Freehand"||this._hitObject.type==="InteractivePlane")&&(ce=this._annotationUniforms.pointSizeHighlighted.value),F.type==="OrthographicCamera"?(this._raycaster.params.Points.threshold=1.5*this._annotationUniforms.pointSizeHighlighted.value*H/(Math.min(q.width,q.height)*F.zoom),this._raycaster.params.Line.threshold=1.5*ce*H/(Math.min(q.width,q.height)*F.zoom)):(this._raycaster.params.Points.threshold=1.5*Math.tan(F.fov*Math.PI/360)*this._annotationUniforms.pointSizeHighlighted.value/(q.height*F.zoom),this._raycaster.params.Line.threshold=1.5*Math.tan(F.fov*Math.PI/360)*ce/(q.height*F.zoom)),this._raycaster.setFromCamera(S,F);const Q=this._raycaster.intersectObjects(this._scene.children);if(Q.length>0){let ne=null,he=null;for(let ve=0;ve<Q.length;ve++)if(!this._isCullingObject(Q[ve].object)){ne=Q[ve].object,he=Q[ve].face;break}if(ne===null)if(G){this._cleanUpHitObject();return}else ne=Q[0].object,he=Q[0].face;if(this._hitObject!==ne){if(this._hitObject){let ve=!1;if(!(this._isCullingObject(this._hitObject)&&!this._isCullingObject(ne))){for(let Ie=0;Ie<Q.length;Ie++)ve=Q[Ie].object===this._hitObject||Q[Ie].object.parent===this._hitObject?!0:ve;if(ve){this._hitObject.type==="Freehand"&&(this._hitObject.highlight(Q[0].point,Q[0].index),this.updateRequested=!0);return}}this._hitObject.show()}this._hitObject=ne,this._hitObject.type==="CropCylinder"||this._hitObject.type==="CropSphere"?this._hitFace=Q[0].face:this._hitFace=null,this._hitObject.highlight(Q[0].point,Q[0].index,this._hitFace),this.updateRequested=!0}else this._hitObject.type==="Freehand"?(this._hitObject.highlight(Q[0].point,Q[0].index),this._hitFace=null,this.updateRequested=!0):this._hitFace!==null&&Object.prototype.hasOwnProperty.call(this._hitFace,"materialIndex")&&Object.prototype.hasOwnProperty.call(he,"materialIndex")&&this._hitFace.materialIndex!==he.materialIndex&&(this._hitFace=Q[0].face,this._hitObject.highlight(Q[0].point,Q[0].index,he),this.updateRequested=!0);this.hideDrawingTools()}else this._cleanUpHitObject()}_cleanUpHitObject(){this._hitObject&&(this._hitObject.show(),this.updateRequested=!0),this._hitObject=null,this._hitFace=null}_isCullingObject(S){return S.type==="InteractivePlane"||S.type==="CropSphere"||S.type==="CropCylinder"||S.parent.type==="CropBox"}getInteractionEndedEventData(S){return this._objectBeingDrawn!==null?{type:"interactionEnded",name:"AnnotationMoved",redraw:S,message:{id:this._objectBeingDrawn.ID,position:this._objectBeingDrawn.getPosition(),type:this._objectBeingDrawn.type,closed:this._objectBeingDrawn.closed,label:this._defaultLabel,color:this._color}}:this._hitObject.type==="InteractivePlane"?{type:"interactionEnded",name:this._planes.state===this._planes.STATE.CLIPPING?"ClippingPlanesChanged":"SlicePlanesChanged",message:this._hitObject.ID}:this._hitObject.type==="Crosshair"?{type:"interactionEnded",name:"CrosshairMoved",message:this._hitObject.getPosition()}:this._hitObject.parent.type==="CropBox"?{type:"interactionEnded",name:"CropRegionChanged",message:this._hitObject.parent.ID}:this._hitObject.parent.type==="Scene"?{type:"interactionEnded",name:"AnnotationMoved",redraw:S,message:{id:this._hitObject.ID,position:this._hitObject.getPosition(),type:this._hitObject.type}}:{type:"interactionEnded",name:"AnnotationMoved",redraw:S,message:{id:this._hitObject.parent.ID,position:this._hitObject.parent.getPosition(),type:this._hitObject.parent.type}}}getPlaneChangeEventData(S){return{type:"interactionUpdating",name:this._planes.state===this._planes.STATE.CLIPPING?"ClippingPlanesChanging":"SlicePlanesChanging",notifyUser:S,message:{plane:this._hitObject.plane,id:this._hitObject.ID}}}getCropChangeEventData(S){switch(this._cropType){case"box":{const F=new f.Vector3,k=new f.Vector3,G=this._crop.scale.clone();return G.divideScalar(2),G.x=Math.abs(G.x),G.y=Math.abs(G.y),G.z=Math.abs(G.z),F.subVectors(this._crop.position,G),k.addVectors(this._crop.position,G),{type:"interactionUpdating",name:"CropRegionChanging",notifyUser:S,message:{cropMin:F,cropMax:k}}}case"sphere":return{type:"interactionUpdating",name:"CropRegionChanging",notifyUser:S,message:{center:new f.Vector3(this._cropSphere.position.x,this._cropSphere.position.y,this._cropSphere.position.z),radius:this._cropSphere.scale.x}};case"cylinder":return{type:"interactionUpdating",name:"CropRegionChanging",notifyUser:S,message:{center:new f.Vector3(this._cropCylinder.position.x,this._cropCylinder.position.y,this._cropCylinder.position.z),radius:this._cropCylinder.scale.x,height:this._cropCylinder.scale.y}}}return null}getAnnotationMovingEventData(S){return this._hitObject.type==="Crosshair"?{type:"interactionUpdating",name:"CrosshairMoving",notifyUser:S,message:this._hitObject.getPosition()}:this._hitObject.parent.type==="Scene"?{type:"interactionUpdating",name:"AnnotationMoving",notifyUser:S,message:{id:this._hitObject.ID,position:this._hitObject.getPosition(),type:this._hitObject.type}}:{type:"interactionUpdating",name:"AnnotationMoving",notifyUser:S,message:{id:this._hitObject.parent.ID,position:this._hitObject.parent.getPosition(),type:this._hitObject.parent.type}}}getColorFillEventData(S,F){const k=S===!0?this._hitObject.parent.scale.clone():this._sharedCuboid.scale.clone();k.divideScalar(2),k.x=Math.abs(k.x),k.y=Math.abs(k.y),k.z=Math.abs(k.z);const G=new f.Vector3,H=new f.Vector3,q=new f.Matrix4;return S===!0?(G.subVectors(this._hitObject.parent.position,k),H.addVectors(this._hitObject.parent.position,k),q.copy(this._hitObject.parent.matrixWorld)):(G.subVectors(this._sharedCuboid.position,k),H.addVectors(this._sharedCuboid.position,k),q.copy(this._sharedCuboid.matrixWorld)),q.invert(),{type:"colorBoxChanged",message:{boxMin:G,boxMax:H,boxMatrix:q,boxColor:S===!0?this._hitObject.parent.color:this._sharedCuboid.color,notifyUser:F}}}updateAnnotationSettings(S){S.DataUpdateRequired&&!S.DataUseBinaryChannel&&this.clear(),this._annotationUniforms.selectedColor.value.fromArray(S.SelectedColor),S.LabelUpdateRequired&&(this._labelDictionary=S.LabelDictionary);const F=this._selectable;this._selectable=S.Selectable,F===!0&&this._selectable===!1&&this.deselectAll(),S.SelectAllRequired&&this._selectable&&this.selectAll(),this._annotationUniforms.depthTest.value!==S.DepthTest&&(this._annotationUniforms.depthTest.value=S.DepthTest,this._lines.setDepthTest(S.DepthTest),this._angles.setDepthTest(S.DepthTest),this._polygons.setDepthTest(S.DepthTest),this._elevation.setDepthTest(S.DepthTest)),this._annotationUniforms.pickable.value!==S.Pickable&&(this._annotationUniforms.pickable.value=S.Pickable,this._lines.setPickable(S.Pickable),this._angles.setPickable(S.Pickable),this._polygons.setPickable(S.Pickable),this._elevation.setPickable(S.Pickable),this._cuboids.setPickable(S.Pickable),this._rectangles.setPickable(S.Pickable),this._freehands.setPickable(S.Pickable),this._points.setPickable(S.Pickable),this._dataTips.setPickable(S.Pickable)),this._annotationUniforms.labelVisible.value!==S.LabelVisible&&(this._annotationUniforms.labelVisible.value=S.LabelVisible,this._lines.setLabelVisible(),this._angles.setLabelVisible(),this._polygons.setLabelVisible(),this._elevation.setLabelVisible(),this._cuboids.setLabelVisible(),this._rectangles.setLabelVisible(),this._freehands.setLabelVisible(),this._points.setLabelVisible())}dispose(){this._lines.dispose(),this._angles.dispose(),this._polygons.dispose(),this._elevation.dispose(),this._cuboids.dispose(),this._rectangles.dispose(),this._freehands.dispose(),this._points.dispose(),this._dataTips.dispose(),this._dataTips.removeEventListener("labelenter",this._hoverHandler),this._dataTips.removeEventListener("labelleave",this._hoverHandler),this._dataTips.removeEventListener("labelclick",this._clickHandler)}}},R,W),R.exports=I},990:(R,W,d)=>{var O,I;O=[d(40)],I=d.dj.d(O,function(f){return class{constructor(b="location",h,r=!0){this.element=document.createElement("div"),this.element.className="iptLabel",this._format=new Intl.NumberFormat(navigator.language,{trailingZeroDisplay:"stripIfInteger"}),h.appendChild(this.element),this.position=new f.Vector3,this.visible=!1,this.measurement=!1,this.style=b,this.highlightColor="rgba(0, 0, 0, 1)",this.color="rgba(0, 0, 0, 0.5)",this.orientation="lower-left",this.setTheme(r)}setColor(b){this.element.style.borderColor=b.getStyle()}setTheme(b){this.highlightColor=b?"rgba(0, 0, 0, 0.8)":"rgba(255, 255, 255, 0.9)",this.color=b?"rgba(0, 0, 0, 0.5)":"rgba(255, 255, 255, 0.7)",this.element.style.backgroundColor=this.color,this.element.style.color=b?"#D9D9D9":"#212121"}setLabel(b,h,r=!0){let o;switch(typeof b){case"number":o=this._numToString(b,h),this.visible=!0;break;case"object":b.isVector2?o=this._numToString(b.x,h)+" x "+this._numToString(b.y,h):r?o="X "+this._numToString(b.x,h)+`
Y `+this._numToString(b.y,h)+`
Z `+this._numToString(b.z,h):o="X "+this._numToString(b.x,h)+`
Y `+this._numToString(b.y,h),this.visible=!0;break;case"string":o=b.replaceAll("\u21B5",` 
`),this.visible=b!=="";break}this.element.textContent=o,this.element.style.visibility=this.visible?"visible":"hidden"}highlight(){this.element.style.backgroundColor=this.highlightColor,this.element.style.zIndex="3"}show(b){this.element.style.backgroundColor=b===!0?this.highlightColor:this.color,this.element.style.zIndex=b===!0?"2":"1"}edit(b){this.element.style.cursor="text",this.element.style.userSelect="text",this.element.style.pointerEvents="auto",this.element.contentEditable="plaintext-only",this.priorText=this.element.textContent,this.setVisibility(!0);const h=document.createRange(),r=window.getSelection();r.removeAllRanges(),h.selectNodeContents(this.element),r.addRange(h),this.element.focus(),this.element.addEventListener("blur",b)}stopEditing(b){return this.element.removeEventListener("blur",b),this.element.style.cursor="none",this.element.style.userSelect="none",this.element.style.pointerEvents="none",this.element.contentEditable=!1,this.element.textContent===""&&this.setVisibility(!1),this.element.textContent!==this.priorText?(this.measurement=!1,!0):!1}getLabel(){return this.element.textContent}setOpacity(b){this.element.style.opacity=b}setVisibility(b){this.visible!==b&&(this.visible=b,this.element.style.visibility=this.visible?"visible":"hidden")}project(b,h,r=!1){const o=new f.Vector3;o.copy(this.position),o.project(h);const c=Math.round((o.x+1)*b.x/2),u=Math.round((o.y+1)*b.y/2),g=2;if(this.style==="distance")this.element.style.left=c+"px",this.element.style.bottom=u+"px",this.element.style.transform="translate(0, 50%)";else if(this.style==="volume"||this.style==="centered"||this.style==="dimension"||this.style==="centeredArea")this.element.style.left=c+"px",this.element.style.bottom=u+"px",this.element.style.transform="translate(-50%, 50%)";else if(r){const m=this.element.getBoundingClientRect();u+g+m.height>b.y?this.element.style.bottom=u-m.height-g+"px":this.element.style.bottom=u+g+"px",c+g+m.width>b.x?this.element.style.left=c-m.width-g+"px":this.element.style.left=c+g+"px"}else this.element.style.bottom=u+g+"px",this.element.style.left=c+g+"px"}unproject(b,h,r){const o=this.element.getBoundingClientRect(),c=3,u=(o.left+c)*2/b.x-1,g=(o.left+o.width-c)*2/b.x-1,m=1-(o.bottom-c)*2/b.y,y=1-(o.bottom-o.height+c)*2/b.y,x=new f.Vector3(u,m,0),w=new f.Vector3(g,m,0),C=new f.Vector3(u,y,0),P=new f.Vector3(g,y,0);x.unproject(h),w.unproject(h),C.unproject(h),P.unproject(h);const T=x.clone();let M=x.distanceToSquared(r);return w.distanceToSquared(r)<M&&(T.copy(w),M=w.distanceToSquared(r),this.orientation="lower-right"),C.distanceToSquared(r)<M&&(T.copy(C),M=C.distanceToSquared(r),this.orientation="upper-left"),P.distanceToSquared(r)<M&&(T.copy(P),this.orientation="upper-right"),T}projectCorner(b,h,r){h.project(r);const o=Math.round((h.x+1)*b.x/2),c=Math.round((h.y+1)*b.y/2),u=3,g=this.element.getBoundingClientRect();switch(this.orientation){case"lower-left":this.element.style.bottom=c-u+"px",this.element.style.left=o-u+"px";break;case"upper-left":this.element.style.bottom=c-g.height+u+"px",this.element.style.left=o-u+"px";break;case"lower-right":this.element.style.bottom=c-u+"px",this.element.style.left=o-g.width+u+"px";break;case"upper-right":this.element.style.bottom=c-g.height+u+"px",this.element.style.left=o-g.width+u+"px";break}}_numToString(b,h){let r;switch(this.style){case"angle":r="\xB0";break;case"volume":r=" "+h+"\xB3";break;case"area":case"centeredArea":r=" "+h+"\xB2";break;case"dimension":r=h;break;default:r=" "+h}h===""&&(r="");const o=Math.floor(Math.log10(b));return b===0?b+r:o>5||o<-2?b.toExponential(3)+r:this._format.format(b)+r}}},R,W),R.exports=I},8328:(R,W,d)=>{var O,I;O=[d(40)],I=d.dj.d(O,function(f){return class extends f.LineSegments{constructor(b){const h=new f.BufferGeometry,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=[1,0,0,1,0,0,0,1,0,0,1,0,0,0,1,0,0,1];h.setAttribute("position",new f.Float32BufferAttribute(r,3)),h.setAttribute("color",new f.Float32BufferAttribute(o,3));const c=new f.LineBasicMaterial({toneMapped:!1,transparent:!0,depthWrite:!1,depthTest:!1,opacity:.6,vertexColors:!0});super(h,c),this.type="Crosshair",this.visible=!1,this.pickable=!1,this._rawPosition=new f.Vector3,this._cleanPosition=new f.Vector3,this._color=new f.Color,this._boundingBox=b,this.setTheme(!0)}highlight(){this.material.opacity=1}show(){this.material.opacity=.6}hide(){this.material.opacity=.6}setTheme(b){const h=this.geometry.attributes.color.array;this._color.set(b===!1?12005676:16743028),this._color.toArray(h,0),this._color.toArray(h,3),this._color.set(b===!1?32787:9760644),this._color.toArray(h,6),this._color.toArray(h,9),this._color.set(b===!1?1463975:5551871),this._color.toArray(h,12),this._color.toArray(h,15),this.geometry.attributes.color.needsUpdate=!0}getPosition(){return this._cleanPosition.toArray()}setPosition(b){b.length>0?(this._rawPosition.fromArray(b,0),this.clamp(),this.visible=!0,this.pickable=!0):this.visible=!1}clamp(){this._boundingBox.clampPoint(this._rawPosition,this._cleanPosition);const b=this.geometry.attributes.position.array;b[0]=this._boundingBox.min.x,b[1]=this._cleanPosition.y,b[2]=this._cleanPosition.z,b[3]=this._boundingBox.max.x,b[4]=this._cleanPosition.y,b[5]=this._cleanPosition.z,b[6]=this._cleanPosition.x,b[7]=this._boundingBox.min.y,b[8]=this._cleanPosition.z,b[9]=this._cleanPosition.x,b[10]=this._boundingBox.max.y,b[11]=this._cleanPosition.z,b[12]=this._cleanPosition.x,b[13]=this._cleanPosition.y,b[14]=this._boundingBox.min.z,b[15]=this._cleanPosition.x,b[16]=this._cleanPosition.y,b[17]=this._boundingBox.max.z,this.geometry.attributes.position.needsUpdate=!0,this.geometry.computeBoundingSphere()}raycast(b,h){if(this.visible&&this.pickable){const r=b.params.Line.threshold;b.params.Line.threshold=r*3,super.raycast(b,h),b.params.Line.threshold=r}}close(){}clear(){}remove(){this.visible=!1}applyQuaternion(){}applyTransformation(b,h,r,o,c,u,g){this._rawPosition.sub(g),this.clamp()}getLastMarker(){return this}}},R,W),R.exports=I},992:(R,W,d)=>{var O,I;O=[d(40),d(1043),d(990)],I=d.dj.d(O,function(f,N,b){return class extends f.LineSegments{constructor(r=0,o){const c=new f.BufferGeometry,u=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),g=[.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5];c.setIndex(new f.BufferAttribute(u,1)),c.setAttribute("position",new f.Float32BufferAttribute(g,3)),c.computeBoundingSphere();const m=new f.Color(16777215),y=new f.LineBasicMaterial({color:m,toneMapped:!1,transparent:!0,depthWrite:!1});super(c,y),this.type="Cuboid",this.visible=!1,this._showLabel=!1,this.selected=!1,this.ID=r,this.color=m,this.pickable=o.pickable.value,this.movable=!0,this._labelType="volume",this._globalUniforms=o,this._quaternion=new f.Quaternion,this._faces=[],this._constructFaces(),this._label=null,this.onBeforeRender=this._updateLabelPosition.bind(this)}updateMatrixWorld(r){super.updateMatrixWorld(r);for(let o=0;o<6;o++)this._faces[o].visible=this.visible}highlight(){this.material.opacity=1;for(let r=0;r<6;r++)this._faces[r].highlight()}show(){this.material.opacity=1;for(let r=0;r<6;r++)this._faces[r].show()}hide(){this.material.opacity=0;for(let r=0;r<6;r++)this._faces[r].hide()}highlightLabel(){this._label!==null&&this._label.highlight()}select(r){this.selected===!0&&r===!0?this.deselect():(this.selected=!0,this.material.color.copy(this._globalUniforms.selectedColor.value),this._setLabelColor())}deselect(){this.selected=!1,this.material.color.copy(this.color),this._setLabelColor()}getPosition(){const r=new Array(9);return this.position.toArray(r,0),this.scale.toArray(r,3),r[6]=this.rotation.x,r[7]=this.rotation.y,r[8]=this.rotation.z,r}setTheme(r){this._label!==null&&this._label.setTheme(r)}setPosition(r){this.setSize(r.slice(3,6)),this.setRotation(r.slice(6,9)),this.setCenter(r.slice(0,3))}setLabel(r){if(this._globalUniforms.labelVisible.value===!1){this._showLabel=!1;return}r===null?(this._label===null&&this._constructLabels(),this._label.measurement=!0,this._showLabel=!0):r===""?(this._label!==null&&(this._label.setLabel("",this._globalUniforms.units.value),this._label.measurement=!1),this._showLabel=!1):(this._label===null&&this._constructLabels(),this._label.setLabel(r,this._globalUniforms.units.value),this._label.measurement=!1,this._showLabel=!0)}editLabel(r){this._label!==null&&this._label.edit(r)}stopEditing(r){return this._label!==null?this._label.stopEditing(r):!1}getLabel(){return this._label!==null?this._label.getLabel():null}setLabelVisible(){this._globalUniforms.labelVisible.value===!1&&(this._label!==null&&this._label.setVisibility(this._globalUniforms.labelVisible.value),this._showLabel=!1)}setCenter(r){this.position.fromArray(r),this.refreshLabel()}setSize(r){this.scale.fromArray(r)}setRotation(r){this.rotation.fromArray(r)}setColor(r){this.color.fromArray(r),this.selected?this.material.color.copy(this._globalUniforms.selectedColor.value):this.material.color.fromArray(r),this._setLabelColor(),this._setFaceColor()}raycast(r,o){if(this.visible&&this.pickable)for(let c=0;c<this._faces.length;c++)this._faces[c].raycast(r,o)}close(){}clear(){}remove(){this.visible=!1,this.selected=!1,this._label!==null&&this._label.setVisibility(!1)}applyQuaternion(){}applyTransformation(){}refreshLabel(){this._showLabel!==!1&&this._label!==null&&(this._label.position.copy(this.position),this._label.measurement===!0&&this._label.setLabel(this.scale.x*this.scale.y*this.scale.z,this._globalUniforms.units.value))}_setLabelColor(){this._label!==null&&(this._label.setColor(this.material.color),this._label.show(this.selected))}_setFaceColor(){for(let r=0;r<this._faces.length;r++)this._faces[r].material.color=this.material.color}_constructLabels(){this._label=new b(this._labelType,this._globalUniforms.container.value,this._globalUniforms.isDarkTheme.value),this._label.setColor(this.material.color)}_constructFaces(){let r,o;for(let c=0;c<6;c++){switch(c){case 0:o=[.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5];break;case 1:o=[-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,-.5];break;case 2:o=[-.5,.5,.5,.5,.5,.5,.5,.5,-.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,-.5];break;case 3:o=[.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5];break;case 4:o=[.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,.5];break;case 5:o=[-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5];break}r=new N(c,this.material.color,o),r.matrixAutoUpdate=!1,this.add(r),this._faces.push(r)}}_updateLabelPosition(r,o,c,u,g,m){if(this.visible===!0&&this._showLabel===!0&&this._label!==null){const y=new f.Vector3;r.getSize(y),this._label.project(y,c)}}}},R,W),R.exports=I},5290:(R,W,d)=>{var O,I;O=[d(738),d(992)],I=d.dj.d(O,function(f,N){return class extends f{_newObject(h,r){return new N(h,r)}}},R,W),R.exports=I},7756:(R,W,d)=>{var O,I;O=[d(40),d(990)],I=d.dj.d(O,function(f,N){return class extends f.Mesh{constructor(h=0,r){const o=new f.CylinderGeometry(1,1,1,32),c=new f.Color(16777215),u=new f.MeshBasicMaterial({color:c,toneMapped:!1,transparent:!0,depthWrite:!1,side:f.FrontSide,opacity:.1}),g=new f.MeshBasicMaterial({color:c,toneMapped:!1,transparent:!0,depthWrite:!1,side:f.FrontSide,opacity:.1}),m=[u,g,g],y=new f.EdgesGeometry(o,30),x=new f.LineBasicMaterial({color:c,toneMapped:!1,transparent:!0,depthWrite:!1,opacity:1}),w=new f.LineSegments(y,x);super(o,m),this.add(w),this.rotation.x+=1.57,this.type="CropCylinder",this.visible=!1,this._showLabel=!1,this.selected=!1,this.ID=h,this.color=c,this.pickable=r.pickable.value,this.movable=!0,this._labelType="volume",this._globalUniforms=r,this._quaternion=new f.Quaternion,this._interactionStarted=!0,this._initialDistance=0,this._initialDirection=new f.Vector2,this._previousEndPoint=new f.Vector2,this._scaleFactor=.03,this._label=null,this.onBeforeRender=this._updateLabelPosition.bind(this)}updateMatrixWorld(h){super.updateMatrixWorld(h)}highlight(h,r,o){const c=o.normal.dot(new f.Vector3(0,1,0));Math.abs(c)/o.normal.length()>=.95?(this.material[0].opacity=.1,this.material[1].opacity=.2,this.material[2].opacity=.2):(this.material[0].opacity=.2,this.material[1].opacity=.1,this.material[2].opacity=.1),this.children[0].material.opacity=1}show(){this.material[0].opacity=.1,this.material[1].opacity=.1,this.material[2].opacity=.1,this.children[0].material.opacity=1,this._setLabelColor()}hide(){this.material[0].opacity=0,this.material[1].opacity=0,this.material[2].opacity=0,this.children[0].material.opacity=0}highlightLabel(){this._label!==null&&this._label.highlight()}select(h){this.selected===!0&&h===!0?this.deselect():(this.selected=!0,this.material[0].color.copy(this._globalUniforms.selectedColor.value),this.material[1].color.copy(this._globalUniforms.selectedColor.value),this.material[2].color.copy(this._globalUniforms.selectedColor.value),this.children[0].material.color.copy(this._globalUniforms.selectedColor.value),this._setLabelColor())}deselect(){this.selected=!1,this.material[0].color.copy(this.color),this.material[1].color.copy(this.color),this.material[1].color.copy(this.color),this.children[0].material.color.copy(this.color),this._setLabelColor()}getPosition(){return[this.position.x,this.position.y,this.position.z,this.scale.x,this.scale.y,this.scale.z,this.rotation.x,this.rotation.y,this.rotation.z]}setTheme(h){this._label!==null&&this._label.setTheme(h)}setPosition(h){this.setSize(h.slice(3,6)),this.setRotation(h.slice(6,9)),this.setCenter(h.slice(0,3))}setLabel(h){if(this._globalUniforms.labelVisible.value===!1){this._showLabel=!1;return}h===null?(this._label===null&&this._constructLabels(),this._label.measurement=!0,this._showLabel=!0):h===""?(this._label!==null&&(this._label.setLabel("",this._globalUniforms.units.value),this._label.measurement=!1),this._showLabel=!1):(this._label===null&&this._constructLabels(),this._label.setLabel(h,this._globalUniforms.units.value),this._label.measurement=!1,this._showLabel=!0)}editLabel(h){this._label!==null&&this._label.edit(h)}stopEditing(h){return this._label!==null?this._label.stopEditing(h):!1}getLabel(){return this._label!==null?this._label.getLabel():null}setLabelVisible(){this._globalUniforms.labelVisible.value===!1&&(this._label!==null&&this._label.setVisibility(this._globalUniforms.labelVisible.value),this._showLabel=!1)}setCenter(h){this.position.fromArray(h),this.refreshLabel()}setSize(h){this.scale.fromArray(h)}setRotation(h){this.rotation.fromArray(h)}setColor(h){this.color.fromArray(h),this.selected?(this.material[0].color.copy(this._globalUniforms.selectedColor.value),this.material[1].color.copy(this._globalUniforms.selectedColor.value),this.material[2].color.copy(this._globalUniforms.selectedColor.value),this.children[0].material.color.copy(this._globalUniforms.selectedColor.value)):(this.material[0].color.fromArray(h),this.material[1].color.fromArray(h),this.material[2].color.fromArray(h),this.children[0].material.color.fromArray(h)),this._setLabelColor()}raycast(h,r){this.visible&&this.pickable&&super.raycast(h,r)}close(){}clear(){}remove(){this.visible=!1,this.selected=!1,this._label!==null&&this._label.setVisibility(!1)}applyQuaternion(){}onPointerDown(){this._interactionStarted=!0}onPointerUp(){this._interactionStarted=!1,this._initialDirection.set(0,0),this._previousEndPoint.set(0,0)}applyTransformation(h,r,o,c,u,g,m){if(r)this.position.sub(c);else{const y=g.normal.dot(new f.Vector3(0,1,0));if(Math.abs(y)/g.normal.length()>=.98){const w=this.position.clone(),C=w.clone().add(g.normal),P=new f.Matrix4;P.extractRotation(this.matrixWorld),C.applyMatrix4(P),w.applyMatrix4(P),C.project(o),w.project(o);const T=new f.Vector3;T.subVectors(C,w),T.setComponent(2,0).normalize(),h.y=-h.y;const M=h.dot(T),z=g.normal.clone();z.applyMatrix4(P).multiplyScalar(-M),z.divideScalar(2),this.position.sub(z),g.normal.dot(new f.Vector3(0,1,0))>0?z.copy(g.normal).multiplyScalar(-M):z.copy(g.normal).multiplyScalar(M),this.scale.sub(z)}else{const w=this.position.clone().project(o),C=new f.Vector2;C.x=(w.x+1)/2,C.y=1-(w.y+1)/2,this._interactionStarted&&(this._initialDistance=C.clone().sub(u.clone()),this._initialDirection=this._initialDistance.normalize(),this._interactionStarted=!1);const P=m.clone(),M=this._previousEndPoint.clone().sub(m.clone()).normalize();this._previousEndPoint.set(P.x,P.y),this._initialDirection.dot(M)<0?this.scale.set(this.scale.x*(1-this._scaleFactor),this.scale.y,this.scale.z*(1-this._scaleFactor)):this.scale.set(this.scale.x*(1+this._scaleFactor),this.scale.y,this.scale.z*(1+this._scaleFactor))}this.scale.x<0&&(this.scale.x=Number.EPSILON),this.scale.y<0&&(this.scale.y=Number.EPSILON),this.scale.z<0&&(this.scale.z=Number.EPSILON)}}refreshLabel(){this._showLabel!==!1&&this._label!==null&&(this._label.position.copy(this.position),this._label.measurement===!0&&this._label.setLabel(this.scale.x*this.scale.y*this.scale.z,this._globalUniforms.units.value))}_setLabelColor(){this._label!==null&&(this._label.setColor(this.material.color),this._label.show(this.selected))}_constructLabels(){this._label=new N(this._labelType,this._globalUniforms.container.value,this._globalUniforms.isDarkTheme.value),this._label.setColor(this.material.color)}_updateLabelPosition(h,r,o,c,u,g){if(this.visible===!0&&this._showLabel===!0&&this._label!==null){const m=new f.Vector3;h.getSize(m),this._label.project(m,o)}}}},R,W),R.exports=I},1005:(R,W,d)=>{var O,I;O=[d(40),d(9052),d(990)],I=d.dj.d(O,function(f,N,b){return class extends N{constructor(r=0,o){super(r,o,2),f.EventDispatcher.call(this),this.type="DataTip",this.updateRequired=!0,this._labelType="data-tip",this._points[1].visible=!1,this._customLabelLocation=!1,this._hoverHandler=this._onHover.bind(this),this._clickHandler=this._onClick.bind(this)}reset(){this.setLabel("")}refreshLabel(){this._showLabel!==!1&&this._label!==null&&(this._label.position.copy(this._points[1].position),this._label.measurement===!0&&this._label.setLabel(this._points[0].position,this._globalUniforms.units.value,this._globalUniforms.is3D.value))}setLabelPickable(r){this._label!==null&&(this._label.element.style.pointerEvents=r===!0?"visible":"none")}applyTranslation(r,o,c,u){this._clampPointToSceneLimits(r,c),this._customLabelLocation=!1;const g=this.geometry.attributes.position.array;g[0]=r.x,g[1]=r.y,g[2]=r.z,g[3]=r.x,g[4]=r.y,g[5]=r.z,this._points[0].position.copy(r),this._points[1].position.copy(r),this.geometry.attributes.position.needsUpdate=!0,this._computeBoundingSphere(),this._label!==null&&(this._label.orientation="lower-left"),this.refreshLabel()}getLastMarker(){return this._numPoints>0?this._points[0]:null}getPosition(){return this._points[0].position.toArray()}setPosition(r){this._setPoints(r),this._customLabelLocation=!1;const o=this.geometry.attributes.position.array;o[0]=r[0],o[1]=r[1],o[2]=r[2],o[3]=r[0],o[4]=r[1],o[5]=r[2],this._computeBoundingSphere(),this.refreshLabel()}_setPoints(r){const o=this._points[0].position.clone();this._points[0].position.fromArray(r),(!this._customLabelLocation||o.distanceTo(this._points[0].position)>1e-4)&&(this._customLabelLocation=!1,this._points[1].position.fromArray(r))}_onHover(r){this.dispatchEvent({type:r.type})}_onClick(r){this.dispatchEvent({type:r.type,pageX:r.pageX,pageY:r.pageY,button:r.button})}_setPointVisibility(){this._points[0].visible=this.visible&&this.pickable}moveLabel(r,o,c){this._points[1].position.sub(r),this.refreshLabel(),this._applyCustomLabelPosition(o,c,!0)}_applyCustomLabelPosition(r,o){this._customLabelLocation=!0;const c=this.geometry.attributes.position.array;if(this._globalUniforms.checkExtent.value){this._label.project(r,o,!1);const u=this._label.unproject(r,o,this._points[0].position);c[3]=u.x,c[4]=u.y,c[5]=u.z}else c[3]=this._points[1].position.x,c[4]=this._points[1].position.y,c[5]=this._points[1].position.z;this.geometry.attributes.position.needsUpdate=!0,this._computeBoundingSphere()}_updateLabelPosition(r,o,c,u,g,m){if(this.visible===!0&&this._showLabel===!0&&this._label!==null){const y=new f.Vector3;if(r.getSize(y),this._customLabelLocation){const x=new f.Vector3,w=this.geometry.attributes.position.array;x.fromArray(w,3),this._label.projectCorner(y,x,c)}else this._label.project(y,c,this._globalUniforms.checkExtent.value)}}_constructLabels(){super._constructLabels(),this._label.element.addEventListener("pointerenter",this._hoverHandler),this._label.element.addEventListener("pointerleave",this._hoverHandler),this._label.element.addEventListener("pointerdown",this._clickHandler),this.setLabelPickable(this.pickable),this.frustumCulled=!1}dispose(){super.dispose(),this._label.element.removeEventListener("pointerenter",this._hoverHandler),this._label.element.removeEventListener("pointerleave",this._hoverHandler),this._label.element.removeEventListener("pointerdown",this._clickHandler)}}},R,W),R.exports=I},5423:(R,W,d)=>{var O,I;O=[d(738),d(1005),d(3601)],I=d.dj.d(O,function(f,N,b){return class extends f{constructor(r,o){super(r,o),this._hoverHandler=this._onHover.bind(this),this._eventHandler=this._onEvent.bind(this),this._objectInfo=new b(-1,o),this._objectInfo.setPosition([0,0]),this._objectInfo.verticalAlignment=2,this._objectInfo.horizontalAlignment=0,this._objectInfo.element.style.margin="7px",this.color=[.1294,.1294,.1294],this._queue=[],this._poppedDataTip=null,this._waitingToSync=!1}addToQueue(r){(this.isQueueEmpty()||this._queue[this._queue.length-1]!==r)&&this._queue.push(r)}clearQueue(){this._queue=[],this._poppedDataTip=null}refreshQueue(){this._queue=[];for(let r=0;r<this._numObjects;r++)this.objects[r].updateRequired&&this._queue.push(this.objects[r])}refreshAll(){this.clearQueue();for(let r=0;r<this._numObjects;r++)this.objects[r].visible&&(this.objects[r].updateRequired=!0);this._waitingToSync||this.refreshQueue()}isQueueEmpty(){return this._queue.length===0}updateQueue(r){Object.prototype.hasOwnProperty.call(r,"ParsedText")&&(r.Index===-1?this.updateObjectInfo(r.ParsedText):this._poppedDataTip!==null&&(this._poppedDataTip.setLabel(r.ParsedText),this._poppedDataTip.setPosition(r.Position),this._poppedDataTip.updateRequired=!1,this.updateRequested=!0)),this.refreshQueue(),this._waitingToSync=!1}popQueue(){return this._waitingToSync?null:(this._waitingToSync=!0,this._poppedDataTip=this._queue.pop(),this._poppedDataTip)}_onHover(r){this.dispatchEvent({type:r.type,message:r.target})}_onEvent(r){this.dispatchEvent(r)}_newObject(r,o){const c=new N(r,o);return c.pickable=o.pickable.value,c.addEventListener("pointerenter",this._hoverHandler),c.addEventListener("pointerleave",this._hoverHandler),c.addEventListener("pointerdown",this._eventHandler),c.setLabelPickable(o.pickable.value),c}setPickable(r){for(let o=0;o<this.objects.length;o++)this.objects[o].pickable=r,this.objects[o].setLabelPickable(r)}setTheme(r){super.setTheme(r),this._objectInfo.setTheme(r)}updateObjectInfo(r){this._objectInfo.setLabel(r)}objectInfoVisible(r){this._objectInfo.setVisibility(r)}render(r,o){this._objectInfo.render(r,o)}_getObject(r){const o=this.objects[r];return o.updateRequired=!0,o}dispose(){this.clear();for(let r=0;r<this.objects.length;r++)this.objects[r].dispose(),this.objects[r].removeEventListener("pointerenter",this._hoverHandler),this.objects[r].removeEventListener("pointerleave",this._hoverHandler),this.objects[r].removeEventListener("pointerdown",this._eventHandler)}}},R,W),R.exports=I},4827:(R,W,d)=>{var O,I;O=[d(40),d(9052)],I=d.dj.d(O,function(f,N){return class extends N{constructor(h=0,r){super(h,r,2),this.type="Elevation",this.closed=!0}setPosition(h){for(let c=0;c<this._points.length;c++)this._points[c].position.fromArray(h,c*3);const r=h[2]>h[5]?[h[0],h[1],h[5],h[0],h[1],h[2]]:[h[3],h[4],h[2],h[0],h[1],h[2]],o=new Float32Array(12);o.set(h),o.set(r,h.length),this.geometry.setAttribute("position",new f.Float32BufferAttribute(o,3)),this.geometry.computeBoundingSphere(),this.refreshLabel()}applyTransformation(h,r){this._points[r].position.copy(h);const o=this.geometry.getAttribute("position");o.array[r*3]=h.x,o.array[r*3+1]=h.y,o.array[r*3+2]=h.z,o.array[2]>o.array[5]?(o.array[6]=o.array[0],o.array[7]=o.array[1],o.array[8]=o.array[5]):(o.array[6]=o.array[3],o.array[7]=o.array[4],o.array[8]=o.array[2]),o.array[9]=o.array[0],o.array[10]=o.array[1],o.array[11]=o.array[2],this.geometry.setAttribute("position",new f.Float32BufferAttribute(o.array,3)),this.geometry.computeBoundingSphere(),this.refreshLabel()}refreshLabel(){if(this._label!==null&&this._points.length===2){let h;this._points[0].position.z>this._points[1].position.z?(h=this._points[1].position.z+(this._points[0].position.z-this._points[1].position.z)/2,this._label.position.set(this._points[0].position.x,this._points[0].position.y,h)):(h=this._points[0].position.z+(this._points[1].position.z-this._points[0].position.z)/2,this._label.position.set(this._points[1].position.x,this._points[1].position.y,h)),this._label.measurement===!0&&this._label.setLabel(Math.abs(this._points[0].position.z-this._points[1].position.z),this._globalUniforms.units.value)}}}},R,W),R.exports=I},2181:(R,W,d)=>{var O,I;O=[d(738),d(4827)],I=d.dj.d(O,function(f,N){return class extends f{_newObject(h,r){return new N(h,r)}}},R,W),R.exports=I},1043:(R,W,d)=>{var O,I;O=[d(40)],I=d.dj.d(O,function(f){return class extends f.Mesh{constructor(b,h,r){const o=new f.BufferGeometry;o.setAttribute("position",new f.Float32BufferAttribute(r,3)),o.computeBoundingSphere();const c=new f.MeshBasicMaterial({color:h,opacity:.05,transparent:!0,depthWrite:!1,side:f.FrontSide,toneMapped:!1});switch(super(o,c),this.type="Face",this.ID=b,b){case 0:this.normal=new f.Vector3(1,0,0);break;case 1:this.normal=new f.Vector3(-1,0,0);break;case 2:this.normal=new f.Vector3(0,1,0);break;case 3:this.normal=new f.Vector3(0,-1,0);break;case 4:this.normal=new f.Vector3(0,0,1);break;case 5:this.normal=new f.Vector3(0,0,-1);break}}highlight(){this.material.opacity=.2,this.parent.highlightLabel()}show(){this.material.opacity=.05,this.parent._setLabelColor()}hide(){this.material.opacity=0}applyQuaternion(b,h,r){if(r==="none")return;const o=new f.Euler;r!=="all"&&(o.setFromQuaternion(b),r==="x"?(o.y=0,o.z=0):r==="y"?(o.x=0,o.z=0):(o.x=0,o.y=0),b.setFromEuler(o));const c=new f.Quaternion,u=new f.Matrix4;if(u.extractRotation(this.parent.matrixWorld),c.setFromRotationMatrix(u),c.premultiply(b),h){switch(this.parent._quaternion.premultiply(b),o.setFromQuaternion(this.parent._quaternion),r){case"all":o.x=Math.round(o.x*(12/Math.PI))*(Math.PI/12),o.y=Math.round(o.y*(12/Math.PI))*(Math.PI/12),o.z=Math.round(o.z*(12/Math.PI))*(Math.PI/12);break;case"x":o.x=Math.round(o.x*(12/Math.PI))*(Math.PI/12);break;case"y":o.y=Math.round(o.y*(12/Math.PI))*(Math.PI/12);break;case"z":o.z=Math.round(o.z*(12/Math.PI))*(Math.PI/12);break}c.setFromEuler(o)}else this.parent._quaternion.copy(c);this.parent.setRotationFromQuaternion(c),this.parent.refreshLabel()}applyTransformation(b,h,r,o,c,u,g){if(this.parent.movable!==!1){if(this.normal.dot(u)>.98)this.parent.position.sub(g);else{const m=this.parent.position.clone(),y=m.clone().add(this.normal),x=new f.Matrix4;x.extractRotation(this.parent.matrixWorld),y.applyMatrix4(x),m.applyMatrix4(x),y.project(c),m.project(c);const w=new f.Vector3;w.subVectors(y,m),w.setComponent(2,0).normalize(),b.y=-b.y;const C=b.dot(w),P=this.normal.clone();P.applyMatrix4(x).multiplyScalar(-C),o===!0?this.parent.position.sub(P):(P.divideScalar(2),this.parent.position.sub(P),this.ID===1||this.ID===3||this.ID===5?P.copy(this.normal).multiplyScalar(C):P.copy(this.normal).multiplyScalar(-C),this.parent.scale.sub(P),this.parent.scale.x<0&&(this.parent.scale.x=Number.EPSILON),this.parent.scale.y<0&&(this.parent.scale.y=Number.EPSILON),this.parent.scale.z<0&&(this.parent.scale.z=Number.EPSILON))}this.parent.refreshLabel()}}}},R,W),R.exports=I},4589:(R,W,d)=>{var O,I;O=[d(40),d(9052),d(990)],I=d.dj.d(O,function(f,N,b){return class extends N{constructor(r=0,o,c,u=!0){super(r,o,c),this.type="Freehand",this._labelType="centeredArea",this.closed=u,this.hit=!1,this._hitIndex=-1,this._raycastLine=!0,this._length=0,this._bufferStep=200,this._reshapeLimits=new f.Vector2(-1,-1),this._updateReshapeLimits=!0}refreshLabel(){if(this._showLabel!==!1&&this._numPoints>0&&this._label!==null){const r=this.geometry.getAttribute("position"),o=this._length;if(this._label.measurement===!0){let c=0;if(this.closed===!0){this._labelType="centeredArea",this._label.style="centeredArea";let u=0;if(o>2){for(let g=0;g<o;g++)u=(g+1)%o,c+=r.array[g*3]*r.array[u*3+1],c-=r.array[u*3]*r.array[g*3+1];c=Math.abs(c/2)}}else if(this._labelType="length",this._label.style="length",o>2)for(let u=1;u<o;u++)c+=Math.sqrt(r.array[u*3]*r.array[(u-1)*3]+r.array[u*3+1]*r.array[(u-1)*3+1]+r.array[u*3+2]*r.array[(u-1)*3+2]);this._label.setLabel(c,this._globalUniforms.units.value)}this.closed?this._label.position.copy(this.geometry.boundingSphere.center):this._label.position.fromArray(r.array)}}close(){if(this.closed){const r=this.geometry.attributes.position.array;r[this._length*3-3]=r[0],r[this._length*3-2]=r[1],r[this._length*3-1]=r[2],this.geometry.attributes.position.needsUpdate=!0,this._computeBoundingSphere()}this.refreshLabel()}addPoint(r,o,c){this._expandBuffer(),this._clampPointToSceneLimits(r,o);const u=this.geometry.attributes.position.array;if(this._length===0)this._length+=2;else if(this._length+=1,c){const g=new f.Vector3;g.fromArray(u,this._length*3-9),this._snapToAngle(r,g)}u[this._length*3-6]=r.x,u[this._length*3-5]=r.y,u[this._length*3-4]=r.z,u[this._length*3-3]=r.x,u[this._length*3-2]=r.y,u[this._length*3-1]=r.z,this.geometry.setDrawRange(0,this._length),this.geometry.attributes.position.needsUpdate=!0,this._computeBoundingSphere(),this.refreshLabel()}follow(r,o,c,u){this._clampPointToSceneLimits(r,c);const g=this.geometry.attributes.position.array;if(u){const m=new f.Vector3;m.fromArray(g,this._length*3-6),this._snapToAngle(r,m)}g[this._length*3-3]=r.x,g[this._length*3-2]=r.y,g[this._length*3-1]=r.z,this.geometry.attributes.position.needsUpdate=!0,this.refreshLabel()}isLengthValid(){return this.closed===!0?this._length>3:this._length>2}highlight(r,o){this.material.opacity=1,this.hit=!0,this._hitIndex!==o&&(this._updateReshapeLimits=!0),this._hitIndex=o;for(let c=0;c<this._numPoints;c++)this._points[c].position.copy(r),this._points[c].show();this.highlightLabel()}show(){this.material.opacity=1,this.hit=!1,this._hitIndex=-1,this._updateReshapeLimits=!0;for(let r=0;r<this._numPoints;r++)this._points[r].hide();this._label.show(this.selected)}hide(){this.material.opacity=0,this.hit=!1,this._hitIndex=-1,this._updateReshapeLimits=!0;for(let r=0;r<this._numPoints;r++)this._points[r].hide()}applyTransformation(r,o,c,u,g,m,y){const x=this.geometry.attributes.position.array;if(u){this._clampOffsetToSceneLimits(o,y);for(let w=0;w<this._length;w++)x[w*3]-=y.x,x[w*3+1]-=y.y,x[w*3+2]-=y.z}else if(this._hitIndex>-1){this._updateReshapeLimits&&(this._updateReshapeLimits=!1,this._setReshapeLimits()),x[this._hitIndex*3]-=y.x,x[this._hitIndex*3+1]-=y.y,x[this._hitIndex*3+2]-=y.z,this._hitIndex===this._length-1?(x[0]-=y.x,x[1]-=y.y,x[2]-=y.z):(x[(this._hitIndex+1)*3]-=y.x,x[(this._hitIndex+1)*3+1]-=y.y,x[(this._hitIndex+1)*3+2]-=y.z);let w=this._hitIndex,C=0;const P=new f.Vector3,T=y.clone();for(;C<this._reshapeLimits.x;)w===0?w=this._length-1:w--,T.copy(y).multiplyScalar((this._reshapeLimits.x-1-C)/this._reshapeLimits.x),P.fromArray(x,w*3).sub(T),P.toArray(x,w*3),C++;for(C=0,w=this._hitIndex+1,this._hitIndex===this._length-1?w=0:w=this._hitIndex+1;C<this._reshapeLimits.y;)w===this._length-1?w=0:w++,T.copy(y).multiplyScalar((this._reshapeLimits.y-1-C)/this._reshapeLimits.y),P.fromArray(x,w*3).sub(T),P.toArray(x,w*3),C++;this.closed&&(x[this._length*3-3]=x[0],x[this._length*3-2]=x[1],x[this._length*3-1]=x[2]),this._clampGeometryToSceneLimits(o)}this._points[0].position.sub(y),this._clampPointToSceneLimits(this._points[0].position,o),this.geometry.attributes.position.needsUpdate=!0,this._computeBoundingSphere(),this.refreshLabel()}_setReshapeLimits(){const r=this.geometry.attributes.position.array,o=this.geometry.boundingSphere.radius/2;let c=0,u=this._hitIndex-1,g=1;const m=this._length-1,y=new f.Vector3;for(this._reshapeLimits.set(Math.floor(m/2)-1,Math.ceil(m/2)),this._hitIndex===0?u=this._length-1:u=this._hitIndex-1;g<m;){if(u===0?u=this._length-1:u--,y.fromArray(r,u*3),c=y.distanceTo(this._points[0].position),c>o){this._reshapeLimits.x=g;break}g++}for(g=1,this._hitIndex===this._length-1?u=0:u=this._hitIndex+1;g<m;){if(u===this._length-1?u=0:u++,y.fromArray(r,u*3),c=y.distanceTo(this._points[0].position),c>o){this._reshapeLimits.y=g;break}g++}}getLastMarker(){return this}setPosition(r){this.closed?this._length=r.length/3+1:this._length=r.length/3,super.setPosition(r)}getPosition(){const r=this.geometry.getAttribute("position"),o=new Array(r.array.length);for(let c=0;c<r.array.length;c++)o[c]=r.array[c];return o}clear(){super.clear(),this._length=0}_setPointVisibility(){for(let r=0;r<this._numPoints;r++)this._points[r].visible=this.visible&&this.hit}_setPoints(r){}_createPoint(r){}_createPointArray(r){super._createPointArray(1),this._points[0].pickable=!1}_expandBuffer(){if(this._length===0)this.geometry.setAttribute("position",new f.Float32BufferAttribute(new Float32Array(this._bufferStep*3),3));else if((this._length+1)*3>this.geometry.attributes.position.count){const r=new Float32Array((this._length+this._bufferStep)*3),o=this.geometry.attributes.position.array;r.set(o,0),this.geometry.setAttribute("position",new f.Float32BufferAttribute(r,3))}}_clampGeometryToSceneLimits(r){if(this._globalUniforms.clampToSceneLimits.value){const o=this.geometry.attributes.position.array,c=new f.Vector3;for(let u=0;u<this._length;u++)c.fromArray(o,u*3),c.clamp(r.min,r.max),c.toArray(o,u*3)}}_computeBoundingSphere(){this.geometry.boundingSphere===null&&this.geometry.computeBoundingSphere();const r=this.geometry.attributes.position.array,o=new f.Box3,c=new f.Vector3;o.setFromArray(r.slice(0,this._length*3)),o.getCenter(this.geometry.boundingSphere.center);let u=0;for(let g=0;g<this._length;g++)c.fromArray(r,g*3),u=Math.max(u,this.geometry.boundingSphere.center.distanceToSquared(c));this.geometry.boundingSphere.radius=Math.sqrt(u)}_computeBoundingBox(){this.geometry.boundingBox===null&&(this.geometry.boundingBox=new f.Box3),this.geometry.boundingBox.makeEmpty();const r=this.geometry.attributes.position.array;this.geometry.boundingBox.setFromArray(r.slice(0,this._length*3))}}},R,W),R.exports=I},9631:(R,W,d)=>{var O,I;O=[d(738),d(4589)],I=d.dj.d(O,function(f,N){return class extends f{_newObject(h,r,o){return new N(h,r,o,!0)}}},R,W),R.exports=I},8800:(R,W,d)=>{var O,I;O=[d(40),d(6053)],I=d.dj.d(O,function(f,N){return class extends f.Line{constructor(h,r=0,o=16777215,c=16777215,u=0,g=0,m=1){h.normalize();const y=[1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0,1,1,0,1,1,0],x=new f.BufferGeometry;x.setAttribute("position",new f.Float32BufferAttribute(y,3)),x.computeBoundingSphere();const w=new f.LineBasicMaterial({color:o,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1,opacity:g===1?.5:0});super(x,w),this.MODE={NONE:0,CLIPPING:1,SLICE:2},this.mode=g,this._lineGeometry=x,this._lineMaterial=w,this.type="InteractivePlane",this.plane=h,this.size=m,this.ID=r,this.sceneCenter=new f.Vector3,this._color=o,this._alternateColor=c,this._xColor=new f.Color(12005676),this._yColor=new f.Color(32787),this._zColor=new f.Color(1463975),this._xNormal=new f.Vector3(1,0,0),this._yNormal=new f.Vector3(0,1,0),this._zNormal=new f.Vector3(0,0,1),this._matrix=new f.Matrix4,this.matrixAutoUpdate=this.mode!==this.MODE.SLICE,this._objectBoundingBox=new f.Box3,this._objectCenter=new f.Vector3,this._objectSize=1,this._boxEdges=[new f.Line3,new f.Line3,new f.Line3,new f.Line3,new f.Line3,new f.Line3,new f.Line3,new f.Line3,new f.Line3,new f.Line3,new f.Line3,new f.Line3],this._numVertices=4,this._vertices=[1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0,1,1,0],this._tempPlane=this.plane.clone(),this.pushPinVisible=!0;const C=new f.BufferGeometry;C.setAttribute("position",new f.Float32BufferAttribute(this._getDefaultFacePosition(),3)),C.computeBoundingSphere(),this._faceMaterial=new f.MeshBasicMaterial({color:this._color,opacity:this.mode===this.MODE.CLIPPING?.05:0,transparent:!0,depthTest:!1,depthWrite:!1,side:f.DoubleSide,toneMapped:!1}),this._faceGeometry=C,this._mesh=new f.Mesh(this._faceGeometry,this._faceMaterial),this._mesh.matrixAutoUpdate=this.mode!==this.MODE.SLICE,this.add(this._mesh);const P=new f.BufferGeometry;P.setAttribute("position",new f.Float32BufferAttribute([0,0,0,0,0,-.5],3)),P.computeBoundingSphere(),this._normalGeometry=P,this._normalMaterial=new f.LineBasicMaterial({visible:!1,color:this._color,toneMapped:!1,transparent:!1,depthTest:!1,depthWrite:!1}),this._normalLine=new f.Line(P,this._normalMaterial),this._normalLine.matrixAutoUpdate=this.mode!==this.MODE.SLICE,this.add(this._normalLine),this._addSphereGeometry(this._color),this.setColor(this._color,this._alternateColor,u)}updateMatrixWorld(h){if(this.visible){if(this.mode===this.MODE.CLIPPING){this.scale.set(.5*this.size,.5*this.size,.5*this.size);const r=this.plane.distanceToPoint(this.sceneCenter),o=this.plane.normal.clone();o.multiplyScalar(r),o.subVectors(this.sceneCenter,o),this.position.copy(o),this._sphere.position.set(0,0,-.5),this.lookAt(o.add(this.plane.normal))}else if(this.mode===this.MODE.SLICE)if(this.plane.intersectsBox(this._objectBoundingBox)){if(this._findIntersectionVertices(),this._setVertices(this._lineGeometry.attributes.position.array),this._lineGeometry.attributes.position.needsUpdate=!0,this._lineGeometry.applyMatrix4(this._matrix),this._lineGeometry.computeBoundingSphere(),this._faceGeometry.setAttribute("position",new f.Float32BufferAttribute(this._getFaceVertices(),3)),this._faceGeometry.applyMatrix4(this._matrix),this._faceGeometry.computeBoundingSphere(),this.pushPinVisible===!0){const r=this.plane.distanceToPoint(this._objectCenter),o=this.plane.normal.clone(),c=this.plane.normal.clone(),u=this.plane.normal.clone();o.multiplyScalar(r),o.subVectors(this._objectCenter,o);const g=this._matrix.clone();g.setPosition(0,0,0),u.applyMatrix4(g),c.multiplyScalar(.25*this._objectSize).divideScalar(u.length()),c.subVectors(o,c),this._objectBoundingBox.containsPoint(o)?(o.applyMatrix4(this._matrix),c.applyMatrix4(this._matrix),this._normalGeometry.attributes.position.array.set([o.x,o.y,o.z,c.x,c.y,c.z],0),this._normalGeometry.attributes.position.needsUpdate=!0,this._normalGeometry.computeBoundingSphere(),this._sphere.position.copy(c),this._sphere.visible=!0,this._normalLine.visible=!0):(this._sphere.visible=!1,this._normalLine.visible=!1)}}else this.hide();else return;super.updateMatrixWorld(h)}}raycast(h,r){if(this.visible){const o=[];this._mesh.raycast(h,o),this.pushPinVisible&&(this._sphere.raycast(h,o),this._normalLine.raycast(h,o)),Math.abs(h.ray.direction.dot(this.plane.normal))<.05&&super.raycast(h,o),o.length>0&&(o[0].object=this,r.push(o[0]))}}setColor(h,r,o){this._color=h,this._alternateColor=r,this._xColor.set(o<.7||o>2?12005676:16743028),this._yColor.set(o<.7||o>2?32787:9760644),this._zColor.set(o<.7||o>2?1463975:5551871),this._setColor()}setPlane(h){h.normalize(),!(this.mode===this.MODE.SLICE&&!h.intersectsBox(this._objectBoundingBox))&&(this._tempPlane.copy(h),this.plane=h,this._setColor())}setMode(h){this.mode=h,this.matrixAutoUpdate=this.mode!==this.MODE.SLICE,this._mesh.matrixAutoUpdate=this.mode!==this.MODE.SLICE,this._normalLine.matrixAutoUpdate=this.mode!==this.MODE.SLICE,this.mode===this.MODE.CLIPPING?(this._setDefaultLinePosition(this._lineGeometry.attributes.position.array),this._lineGeometry.attributes.position.needsUpdate=!0,this._lineGeometry.computeBoundingSphere(),this._faceGeometry.setAttribute("position",new f.Float32BufferAttribute(this._getDefaultFacePosition(),3)),this._faceGeometry.computeBoundingSphere(),this._normalGeometry.attributes.position.array.set([0,0,0,0,0,-.5],0),this._normalGeometry.attributes.position.needsUpdate=!0,this._normalGeometry.computeBoundingSphere()):this.mode===this.MODE.SLICE?(this.matrix.identity(),this._setVertices(this._lineGeometry.attributes.position.array),this._lineGeometry.attributes.position.needsUpdate=!0,this._lineGeometry.computeBoundingSphere(),this._faceGeometry.setAttribute("position",new f.Float32BufferAttribute(this._getFaceVertices(),3)),this._faceGeometry.computeBoundingSphere(),this.scale.set(1,1,1),this.position.set(0,0,0),this.lookAt(0,1,0),this.matrix.identity(),this.matrixWorldNeedsUpdate=!0):this.visible=!1}setBoundingBox(h){h.getCenter(this._objectCenter),h.min.subScalar(1e-10),h.max.addScalar(1e-10),this._objectBoundingBox.copy(h),this._setBoundingBoxEdges()}applyMatrix(h){if(this.mode===this.MODE.SLICE){const r=new f.Matrix4;r.set(h[0][0],h[1][0],h[2][0],h[3][0],h[0][1],h[1][1],h[2][1],h[3][1],h[0][2],h[1][2],h[2][2],h[3][2],h[0][3],h[1][3],h[2][3],h[3][3]),this._matrix=r;const o=this._objectBoundingBox.clone(),c=new f.Vector3;o.applyMatrix4(r).getSize(c),this._objectSize=c.length()}}show(){this.mode===this.MODE.CLIPPING?this._setOpacity(.05,.5,0,!1):this._setOpacity(0,0,0,!1)}hide(){this._setOpacity(0,0,0,!1)}highlight(){this.mode===this.MODE.CLIPPING?this._setOpacity(.1,1,.5,this.pushPinVisible):this._setOpacity(.05,1,.5,this.pushPinVisible)}select(){}applyTransformation(h,r,o,c,u){const g=this.position.clone(),m=g.clone().add(this.plane.normal);this.mode===this.MODE.SLICE&&(m.applyMatrix4(this._matrix),g.applyMatrix4(this._matrix)),m.project(u),g.project(u);const y=new f.Vector3;y.subVectors(m,g),y.setComponent(2,0).normalize(),h.y=-h.y;let x=-h.dot(y);if(this.mode===this.MODE.SLICE){this._tempPlane.copy(this.plane);const w=new f.Vector4(this._tempPlane.normal.x,this._tempPlane.normal.y,this._tempPlane.normal.z,0);w.applyMatrix4(this._matrix);const C=new f.Vector3(w.x,w.y,w.z),P=C.dot(C);x=x/P,P>1.01&&(x*=1.5),this._tempPlane.constant=this._tempPlane.constant+x,this._tempPlane.intersectsBox(this._objectBoundingBox)?this.plane.copy(this._tempPlane):this._tempPlane.copy(this.plane)}else this.plane.constant=this.plane.constant+x}applyQuaternion(h,r){const o=this._tempPlane.normal.clone(),c=this.plane.clone();o.applyQuaternion(h),o.normalize();const u=this.plane.normal.clone();if(this.mode===this.MODE.SLICE){const g=this.plane.distanceToPoint(this._objectCenter);u.multiplyScalar(g),u.subVectors(this._objectCenter,u),this._tempPlane.setFromNormalAndCoplanarPoint(o,u)}else this._tempPlane.setFromNormalAndCoplanarPoint(o,this.position);this._tempPlane.normalize(),this.plane.copy(this._tempPlane),r&&(this._snapToAngle(o),this.mode===this.MODE.SLICE?this.plane.setFromNormalAndCoplanarPoint(o,u):this.plane.setFromNormalAndCoplanarPoint(o,this.position),this.plane.normalize()),this.mode===this.MODE.SLICE&&(this.plane.intersectsBox(this._objectBoundingBox)||(this.plane.copy(c),this._tempPlane.copy(c))),this._setColor()}_setOpacity(h,r,o,c){this._faceMaterial.opacity=h,this._lineMaterial.opacity=r,this._sphereMaterial.uniforms.alpha.value=o,this._sphereMaterial.visible=c,this._normalMaterial.visible=c}_setColor(){let h=this.mode===this.MODE.SLICE?this._alternateColor:this._color;Math.abs(this.plane.normal.dot(this._xNormal))===1?h=this._xColor:Math.abs(this.plane.normal.dot(this._yNormal))===1?h=this._yColor:Math.abs(this.plane.normal.dot(this._zNormal))===1&&(h=this._zColor),this._lineMaterial.color=h,this._faceMaterial.color=h,this._normalMaterial.color=h,this._sphereMaterial.uniforms.color.value=h,this._sphereMaterial.uniforms.edgeColor.value=h}_getVertices(){const h=new Float32Array(21);return this._setVertices(h)}_setVertices(h){for(let r=0;r<this._numVertices*3;r++)h[r]=this._vertices[r];for(let r=0;r<7-this._numVertices;r++)h[r*3+this._numVertices*3]=this._vertices[0],h[r*3+this._numVertices*3+1]=this._vertices[1],h[r*3+this._numVertices*3+2]=this._vertices[2];return h}_getFaceVertices(){const h=this._getVertices();return[h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7],h[8],h[6],h[7],h[8],h[9],h[10],h[11],h[12],h[13],h[14],h[12],h[13],h[14],h[15],h[16],h[17],h[18],h[19],h[20],h[0],h[1],h[2],h[6],h[7],h[8],h[12],h[13],h[14]]}_findIntersectionVertices(){this._numVertices=0;const h=new f.Vector3,r=new Float32Array(18);for(let o=0;o<12;o++)this.plane.intersectsLine(this._boxEdges[o])&&(this.plane.intersectLine(this._boxEdges[o],h),r[this._numVertices*3]=h.x,r[this._numVertices*3+1]=h.y,r[this._numVertices*3+2]=h.z,this._numVertices=this._numVertices+1);this._vertices=this._sortVertices(r)}_sortVertices(h){const r=this.plane.distanceToPoint(this._objectCenter),o=this.plane.normal.clone();o.multiplyScalar(r),o.subVectors(this._objectCenter,o);const c=new f.Vector3(1,0,0),u=new f.Vector3(0,1,0),g=new f.Vector3(0,0,1),m=new f.Vector3,y=new f.Vector3,x=new f.Vector3,w=new f.Vector3,C=new f.Vector3,P=new f.Vector3,T=new f.Vector3,M=c.cross(this.plane.normal).lengthSq(),z=u.cross(this.plane.normal).lengthSq(),Y=g.cross(this.plane.normal).lengthSq();M>z?M>Y?m.copy(c):m.copy(g):z>Y?m.copy(u):m.copy(g),y.crossVectors(this.plane.normal,m);const X=new Float32Array(this._numVertices),S=new Float32Array(this._numVertices*3);for(let k=0;k<this._numVertices;k++)C.set(h[k*3],h[k*3+1],h[k*3+2]),X[k]=Math.atan2(this.plane.normal.dot(w.crossVectors(P.subVectors(C,o),y)),this.plane.normal.dot(x.crossVectors(T.subVectors(C,o),m)))*180/Math.PI;const F=Array.from(Array(X.length).keys()).sort((k,G)=>X[k]<X[G]?-1:X[G]<X[k]|0);for(let k=0;k<this._numVertices;k++)S[k*3]=h[F[k]*3],S[k*3+1]=h[F[k]*3+1],S[k*3+2]=h[F[k]*3+2];return S}_addSphereGeometry(h){const r=new f.BufferGeometry,o=[0,0,0];r.setAttribute("position",new f.Float32BufferAttribute(o,3)),r.computeBoundingSphere();const c=N,u=f.UniformsUtils.clone(c.uniforms);u.edgeColor.value=h,u.color.value=h,u.pointSize.value=10,this._sphereMaterial=new f.ShaderMaterial({visible:!1,transparent:!0,fog:!1,depthTest:!1,depthWrite:!1,uniforms:u,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader}),this._sphere=new f.Points(r,this._sphereMaterial),this.add(this._sphere)}_snapToAngle(h){const r=[0,0,1,0,0,-1,1,0,0,-1,0,0,0,1,0,0,-1,0,.5774,.5774,.5774,-.5774,-.5774,-.5774,.5774,-.5774,.5774,-.5774,.5774,-.5774,.5774,.5774,-.5774,-.5774,-.5774,.5774,-.5774,.5774,.5774,.5774,-.5774,-.5774,.7071,-.7071,0,-.7071,.7071,0,0,.7071,-.7071,0,-.7071,.7071,-.7071,0,.7071,.7071,0,-.7071,.7071,.7071,0,-.7071,-.7071,0,.7071,0,.7071,-.7071,0,-.7071,0,.7071,.7071,0,-.7071,-.7071],o=h.x,c=h.y,u=h.z;let g=0,m=0,y=0;for(let x=0;x<26;x++)y=o*r[x*3]+c*r[x*3+1]+u*r[x*3+2],y>g&&(g=y,m=x);h.set(r[m*3],r[m*3+1],r[m*3+2]).normalize()}_setBoundingBoxEdges(){this._boxEdges[0].start=new f.Vector3(this._objectBoundingBox.min.x,this._objectBoundingBox.min.y,this._objectBoundingBox.min.z),this._boxEdges[0].end=new f.Vector3(this._objectBoundingBox.max.x,this._objectBoundingBox.min.y,this._objectBoundingBox.min.z),this._boxEdges[1].start=new f.Vector3(this._objectBoundingBox.min.x,this._objectBoundingBox.max.y,this._objectBoundingBox.min.z),this._boxEdges[1].end=new f.Vector3(this._objectBoundingBox.max.x,this._objectBoundingBox.max.y,this._objectBoundingBox.min.z),this._boxEdges[2].start=new f.Vector3(this._objectBoundingBox.min.x,this._objectBoundingBox.min.y,this._objectBoundingBox.max.z),this._boxEdges[2].end=new f.Vector3(this._objectBoundingBox.max.x,this._objectBoundingBox.min.y,this._objectBoundingBox.max.z),this._boxEdges[3].start=new f.Vector3(this._objectBoundingBox.min.x,this._objectBoundingBox.max.y,this._objectBoundingBox.max.z),this._boxEdges[3].end=new f.Vector3(this._objectBoundingBox.max.x,this._objectBoundingBox.max.y,this._objectBoundingBox.max.z),this._boxEdges[4].start=new f.Vector3(this._objectBoundingBox.min.x,this._objectBoundingBox.min.y,this._objectBoundingBox.min.z),this._boxEdges[4].end=new f.Vector3(this._objectBoundingBox.min.x,this._objectBoundingBox.max.y,this._objectBoundingBox.min.z),this._boxEdges[5].start=new f.Vector3(this._objectBoundingBox.max.x,this._objectBoundingBox.min.y,this._objectBoundingBox.min.z),this._boxEdges[5].end=new f.Vector3(this._objectBoundingBox.max.x,this._objectBoundingBox.max.y,this._objectBoundingBox.min.z),this._boxEdges[6].start=new f.Vector3(this._objectBoundingBox.min.x,this._objectBoundingBox.min.y,this._objectBoundingBox.max.z),this._boxEdges[6].end=new f.Vector3(this._objectBoundingBox.min.x,this._objectBoundingBox.max.y,this._objectBoundingBox.max.z),this._boxEdges[7].start=new f.Vector3(this._objectBoundingBox.max.x,this._objectBoundingBox.min.y,this._objectBoundingBox.max.z),this._boxEdges[7].end=new f.Vector3(this._objectBoundingBox.max.x,this._objectBoundingBox.max.y,this._objectBoundingBox.max.z),this._boxEdges[8].start=new f.Vector3(this._objectBoundingBox.min.x,this._objectBoundingBox.min.y,this._objectBoundingBox.min.z),this._boxEdges[8].end=new f.Vector3(this._objectBoundingBox.min.x,this._objectBoundingBox.min.y,this._objectBoundingBox.max.z),this._boxEdges[9].start=new f.Vector3(this._objectBoundingBox.max.x,this._objectBoundingBox.min.y,this._objectBoundingBox.min.z),this._boxEdges[9].end=new f.Vector3(this._objectBoundingBox.max.x,this._objectBoundingBox.min.y,this._objectBoundingBox.max.z),this._boxEdges[10].start=new f.Vector3(this._objectBoundingBox.min.x,this._objectBoundingBox.max.y,this._objectBoundingBox.min.z),this._boxEdges[10].end=new f.Vector3(this._objectBoundingBox.min.x,this._objectBoundingBox.max.y,this._objectBoundingBox.max.z),this._boxEdges[11].start=new f.Vector3(this._objectBoundingBox.max.x,this._objectBoundingBox.max.y,this._objectBoundingBox.min.z),this._boxEdges[11].end=new f.Vector3(this._objectBoundingBox.max.x,this._objectBoundingBox.max.y,this._objectBoundingBox.max.z)}_getDefaultFacePosition(){return[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0]}_setDefaultLinePosition(h){return h.set([1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0,1,1,0,1,1,0],0)}}},R,W),R.exports=I},9052:(R,W,d)=>{var O,I;O=[d(40),d(884),d(990)],I=d.dj.d(O,function(f,N,b){return class extends f.Line{constructor(r=0,o,c=2){const u=new f.BufferGeometry,g=new Array(c*3).fill(0);u.setAttribute("position",new f.Float32BufferAttribute(g,3)),u.computeBoundingSphere();const m=new f.Color(16777215),y=new f.LineBasicMaterial({color:m,toneMapped:!1,transparent:!1,depthTest:o.depthTest.value,depthWrite:!1});super(u,y),this.type="Line",this.visible=!1,this._showLabel=!1,this.selected=!1,this.ID=r,this.color=m,this.pickable=o.pickable.value,this.closed=!1,this._labelType="distance",this._globalUniforms=o,this._raycastLine=!1,this._points=[],this._createPointArray(c),this._label=null,this.onBeforeRender=this._updateLabelPosition.bind(this)}updateMatrixWorld(r){super.updateMatrixWorld(r),this._setPointVisibility()}highlight(){this.material.opacity=1;for(let r=0;r<this._numPoints;r++)this._points[r].highlight()}show(){this.material.opacity=1;for(let r=0;r<this._numPoints;r++)this._points[r].show()}hide(){this.material.opacity=0;for(let r=0;r<this._numPoints;r++)this._points[r].hide()}highlightLabel(){this._label!==null&&this._label.highlight()}select(r){this.selected===!0&&r===!0?this.deselect():(this.selected=!0,this.material.color.copy(this._globalUniforms.selectedColor.value),this._setLabelColor())}deselect(){this.selected=!1,this.material.color.copy(this.color),this._setLabelColor()}setTheme(r){this._label!==null&&this._label.setTheme(r)}getPosition(){const r=new Array(this._numPoints*3);for(let o=0;o<this._numPoints;o++)this._points[o].position.toArray(r,o*3);return r}addPoint(r,o,c){this._clampPointToSceneLimits(r,o),this._createPoint(r);const u=this.geometry.getAttribute("position"),g=[...u.array];if(this._numPoints===1)g.push(r.x,r.y,r.z);else{if(c){const m=new f.Vector3;m.fromArray(u,u.length-6),this._snapToAngle(r,m)}g[g.length-3]=r.x,g[g.length-2]=r.y,g[g.length-1]=r.z}g.push(r.x,r.y,r.z),this.geometry.setAttribute("position",new f.Float32BufferAttribute(g,3)),this._computeBoundingSphere(),this.refreshLabel()}removePoint(){if(this._numPoints>1){this._numPoints-=1,this._points[this._numPoints].visible=!1;const o=[...this.geometry.getAttribute("position").array];o.splice(o.length-6,3),this.geometry.setAttribute("position",new f.Float32BufferAttribute(o,3)),this._computeBoundingSphere(),this.refreshLabel()}}follow(r,o,c,u){this._clampPointToSceneLimits(r,c);const g=this.geometry.attributes.position.array;if(u){const m=new f.Vector3;m.fromArray(g,g.length-6),this._snapToAngle(r,m)}g[g.length-3]=r.x,g[g.length-2]=r.y,g[g.length-1]=r.z,this.geometry.attributes.position.needsUpdate=!0,this.refreshLabel()}close(){if(this._numPoints<=1)return;const r=this.geometry.attributes.position.array;this._numPoints!==r.length/3&&(this._numPoints===2||this.closed===!0?(r[r.length-3]=r[0],r[r.length-2]=r[1],r[r.length-1]=r[2]):(r[r.length-3]=r[r.length-6],r[r.length-2]=r[r.length-5],r[r.length-1]=r[r.length-4]),this.geometry.attributes.position.needsUpdate=!0,this.refreshLabel())}clear(){const r=new Array(0).fill(0);this.geometry.setAttribute("position",new f.Float32BufferAttribute(r,3));for(let o=0;o<this._points.length;o++)this._points[o].visible=!1;this._numPoints=0,this.visible=!1}remove(){this.visible=!1,this.selected=!1,this._label!==null&&this._label.setVisibility(!1)}setLabel(r){if(this._globalUniforms.labelVisible.value===!1){this._showLabel=!1;return}r===null?(this._label===null&&this._constructLabels(),this._label.measurement=!0,this._showLabel=!0):r===""?(this._label!==null&&(this._label.setLabel("",this._globalUniforms.units.value),this._label.measurement=!1),this._showLabel=!1):(this._label===null&&this._constructLabels(),this._label.setLabel(r,this._globalUniforms.units.value),this._label.measurement=!1,this._showLabel=!0)}editLabel(r){this._label!==null&&this._label.edit(r)}stopEditing(r){return this._label!==null?this._label.stopEditing(r):!1}getLabel(){return this._label!==null?this._label.getLabel():null}setLabelVisible(){this._globalUniforms.labelVisible.value===!1&&(this._label!==null&&this._label.setVisibility(this._globalUniforms.labelVisible.value),this._showLabel=!1)}setPosition(r){if(this._setPoints(r),this.closed){const o=new Float32Array(r.length+3);o.set(r),o.set(r.slice(0,3),r.length),this.geometry.setAttribute("position",new f.Float32BufferAttribute(o,3))}else this.geometry.setAttribute("position",new f.Float32BufferAttribute(r,3));this._computeBoundingSphere(),this.refreshLabel()}setColor(r){this.color.fromArray(r),this.selected?this.material.color.copy(this._globalUniforms.selectedColor.value):this.material.color.fromArray(r),this._setLabelColor()}raycast(r,o){if(this.visible&&this.pickable){this._raycastLine&&super.raycast(r,o);for(let c=0;c<this._numPoints;c++)this._points[c].raycast(r,o)}}applyQuaternion(){}applyTransformation(r,o,c,u){this._clampPointToSceneLimits(r,c);const g=this.geometry.attributes.position.array;if(o===this._numPoints-1)if(this.closed===!0)g[(o+1)*3]=g[0],g[(o+1)*3+1]=g[1],g[(o+1)*3+2]=g[2];else{if(u){const m=new f.Vector3;m.fromArray(g,(o-1)*3),this._snapToAngle(r,m)}g[(o+1)*3]=r.x,g[(o+1)*3+1]=r.y,g[(o+1)*3+2]=r.z}else if(o===0){if(this.closed===!0)g[this._numPoints*3]=r.x,g[this._numPoints*3+1]=r.y,g[this._numPoints*3+2]=r.z;else if(u){const m=new f.Vector3;m.fromArray(g,3),this._snapToAngle(r,m)}}this._points[o].position.copy(r),g[o*3]=r.x,g[o*3+1]=r.y,g[o*3+2]=r.z,this.geometry.attributes.position.needsUpdate=!0,this._computeBoundingSphere(),this.refreshLabel()}applyUniformTranslation(r,o,c){this._clampOffsetToSceneLimits(o,c);const u=this.geometry.attributes.position.array;for(let g=0;g<this._numPoints;g++)this._points[g].position.sub(c);for(let g=0;g<u.length/3;g++)u[g*3]-=c.x,u[g*3+1]-=c.y,u[g*3+2]-=c.z;this.geometry.attributes.position.needsUpdate=!0,this._computeBoundingSphere(),this.refreshLabel()}refreshLabel(){this._showLabel!==!1&&this._label!==null&&(this._numPoints>1?(this._label.position.addVectors(this._points[0].position,this._points[1].position).divideScalar(2),this._label.measurement===!0&&this._label.setLabel(this._points[0].position.distanceTo(this._points[1].position),this._globalUniforms.units.value)):(this._label.position.copy(this._points[0].position),this._label.measurement===!0&&this._label.setLabel(0,this._globalUniforms.units.value)))}getLastMarker(){return this._numPoints>0?this._points[this._numPoints-1]:null}_setPointVisibility(){for(let r=0;r<this._numPoints;r++)this._points[r].visible=this.visible}_setPoints(r){const o=r.length/3;if(o>this._points.length){let c;for(let u=this._points.length;u<o;u++)c=new N(u,this._globalUniforms,0),c.material.uniforms.color.value=this.material.color,this.add(c),this._points.push(c);this._numPoints=o}else if(o<this._numPoints){for(let c=o;c<this._points.length;c++)this._points[o-1].visible=!1;this._numPoints=o}for(let c=0;c<this._numPoints;c++)this._points[c].position.fromArray(r,c*3)}_createPoint(r){if(this._numPoints+=1,this._numPoints>this._points.length){const o=new N(this._numPoints-1,this._globalUniforms,0);o.material.uniforms.color.value=this.material.color,this.add(o),this._points.push(o)}else if(this._numPoints<this._points.length)for(let o=this._numPoints;o<this._points.length;o++)this._points[this._numPoints-1].visible=!1;this._points[this._numPoints-1].position.copy(r),this._points[this._numPoints-1].visible=!0}_createPointArray(r){this._numPoints=r;let o;for(let c=0;c<r;c++)o=new N(c,this._globalUniforms,0),o.material.uniforms.color.value=this.material.color,this.add(o),this._points.push(o)}_setLabelColor(){this._label!==null&&(this._label.setColor(this.material.color),this._label.show(this.selected))}_constructLabels(){this._label=new b(this._labelType,this._globalUniforms.container.value,this._globalUniforms.isDarkTheme.value),this._label.setColor(this.material.color)}_updateLabelPosition(r,o,c,u,g,m){if(this.visible===!0&&this._showLabel===!0&&this._label!==null){const y=new f.Vector3;r.getSize(y),this._label.project(y,c)}}_clampPointToSceneLimits(r,o){this._globalUniforms.clampToSceneLimits.value&&r.clamp(o.min,o.max)}_clampOffsetToSceneLimits(r,o){if(this._globalUniforms.clampToSceneLimits.value){this._computeBoundingBox();const c=this.geometry.boundingBox.min.clone().sub(o),u=this.geometry.boundingBox.max.clone().sub(o);c.clamp(r.min,r.max).sub(this.geometry.boundingBox.min).add(o),u.clamp(r.min,r.max).sub(this.geometry.boundingBox.max).add(o),o.sub(c).sub(u)}}_snapToAngle(r,o){const c=r.distanceTo(o),u=new f.Vector3().subVectors(r,o).normalize(),g=12/Math.PI,m=new f.Spherical().setFromVector3(u);m.phi=Math.round(m.phi*g)/g,m.theta=Math.round(m.theta*g)/g,u.setFromSpherical(m).setLength(c),r.copy(o).add(u)}_computeBoundingBox(){this.geometry.computeBoundingBox()}_computeBoundingSphere(){this.geometry.computeBoundingSphere()}dispose(){this.material.dispose(),this.geometry.dispose();for(let r=0;r<this._numPoints;r++)this._points[r].dispose()}}},R,W),R.exports=I},4097:(R,W,d)=>{var O,I;O=[d(738),d(9052)],I=d.dj.d(O,function(f,N){return class extends f{_newObject(h,r){return new N(h,r,2)}}},R,W),R.exports=I},884:(R,W,d)=>{var O,I;O=[d(40),d(6053),d(990)],I=d.dj.d(O,function(f,N,b){return class extends f.Points{constructor(r=0,o,c=0){const u=new f.BufferGeometry,g=[0,0,0];u.setAttribute("position",new f.Float32BufferAttribute(g,3)),u.computeBoundingSphere();const m=N,y=f.UniformsUtils.clone(m.uniforms);y.edgeColor.value=o.edgeColor.value,y.pointSize.value=o.pointSize.value;const x=new f.ShaderMaterial({transparent:!0,fog:!1,depthTest:!1,depthWrite:!1,uniforms:y,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader});super(u,x),this.type="Marker",this.visible=!1,this._showLabel=!1,this.selected=!1,this.color=new f.Color(16777215),this.ID=r,this._globalUniforms=o,this.pickable=!0,this._label=null,c>0&&(this.onBeforeRender=this._updateLabelPosition.bind(this))}raycast(r,o){if(this.visible&&this.pickable)if(r.camera.type==="PerspectiveCamera"){const c=r.params.Points.threshold;r.params.Points.threshold=c*r.camera.position.distanceTo(this.position),super.raycast(r,o),r.params.Points.threshold=c}else super.raycast(r,o)}highlight(){this.material.opacity=1,this.material.uniforms.pointSize.value=this._globalUniforms.pointSizeHighlighted.value,this._label!==null?this._label.highlight():this.parent.type!=="Scene"&&this.parent.highlightLabel()}show(){this.material.opacity=1,this.material.uniforms.pointSize.value=this._globalUniforms.pointSize.value,this._label!==null?this._label.show(this.selected):this.parent.type!=="Scene"&&this.parent._setLabelColor()}hide(){this.material.opacity=0}select(r){this.selected===!0&&r===!0?this.deselect():(this.selected=!0,this.material.uniforms.color.value.copy(this._globalUniforms.selectedColor.value),this._setLabelColor(),this._label!==null&&this._label.highlight())}deselect(){this.selected=!1,this.material.uniforms.color.value.copy(this.color),this._setLabelColor()}setTheme(r){this._label!==null&&this._label.setTheme(r)}getPosition(){return this.position.toArray()}onPointerDown(){this.material.uniforms.interactive.value=1}onPointerUp(){this.material.uniforms.interactive.value=0}setPosition(r){this.position.fromArray(r),this.refreshLabel()}setColor(r){this.color.fromArray(r),this.selected?this.material.uniforms.color.value.copy(this._globalUniforms.selectedColor.value):this.material.uniforms.color.value.fromArray(r),this._setLabelColor()}setLabel(r){if(this._globalUniforms.labelVisible.value===!1){this._showLabel=!1;return}r===null?(this._label===null&&this._constructLabels(),this._label.measurement=!0,this._showLabel=!0):r===""?(this._label!==null&&(this._label.setLabel("",this._globalUniforms.units.value),this._label.measurement=!1),this._showLabel=!1):(this._label===null&&this._constructLabels(),this._label.setLabel(r,this._globalUniforms.units.value),this._label.measurement=!1,this._showLabel=!0)}editLabel(r){this._label!==null&&this._label.edit(r)}stopEditing(r){return this._label!==null?this._label.stopEditing(r):!1}getLabel(){return this._label!==null?this._label.getLabel():null}setLabelVisible(){this._globalUniforms.labelVisible.value===!1&&(this._label!==null&&this._label.setVisibility(this._globalUniforms.labelVisible.value),this._showLabel=!1)}clear(){}remove(){this.visible=!1,this.selected=!1,this._label!==null&&this._label.setVisibility(!1)}applyQuaternion(){}applyTransformation(r,o,c,u,g,m,y){this.parent.type==="Scene"?(u?this.position.sub(y):this.position.copy(r),this._clampPointToSceneLimits(this.position,o),this.refreshLabel()):u?this.parent.applyUniformTranslation(r,o,y):this.parent.applyTransformation(r,this.ID,o,c)}refreshLabel(){this._showLabel!==!1&&this._label!==null&&(this._label.position.copy(this.position),this._label.measurement===!0&&this._label.setLabel(this.position,this._globalUniforms.units.value,this._globalUniforms.is3D.value))}getLastMarker(){return this}close(){}_clampPointToSceneLimits(r,o){this._globalUniforms.clampToSceneLimits.value&&r.clamp(o.min,o.max)}_constructLabels(){this._label=new b("location",this._globalUniforms.container.value,this._globalUniforms.isDarkTheme.value),this.frustumCulled=!1}_setLabelColor(){this._label!==null&&(this._label.setColor(this.material.uniforms.color.value),this._label.show(this.selected))}_updateLabelPosition(r,o,c,u,g,m){if(this.visible===!0&&this._showLabel===!0&&this._label!==null){const y=new f.Vector3;r.getSize(y),this._label.project(y,c,this._globalUniforms.checkExtent.value)}}dispose(){this.material.dispose(),this.geometry.dispose()}}},R,W),R.exports=I},6053:(R,W,d)=>{var O,I;O=[d(40)],I=d.dj.d(O,function(f){return{uniforms:{pointSize:{value:8},edgeWidth:{value:4},color:{value:new f.Color},alpha:{value:1},edgeColor:{value:new f.Color},edgeAlpha:{value:.8},interactive:{value:0}},vertexShader:`
        uniform float edgeWidth;
        uniform float pointSize;

        void main() {
            vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
            gl_PointSize = (pointSize + edgeWidth);
            gl_Position = projectionMatrix * mvPosition;
        }`,fragmentShader:`
        uniform vec3 color;
        uniform vec3 edgeColor;
        uniform float edgeWidth;
        uniform float pointSize;
        uniform float alpha;
        uniform float edgeAlpha;
        uniform float interactive;

        void main() {
            float dist = length(2.0 * gl_PointCoord - 1.0);
            float totalWidth = pointSize + edgeWidth;
            float edgeStart = pointSize;
            float edgeMid = pointSize + (edgeWidth / 2.0);
            float edgeEnd = pointSize + edgeWidth;

            // Interpolate transitions from color to edgeColor and to transparency at edge
            float sEdge = smoothstep(edgeStart, edgeMid, dist * totalWidth);
            float sAlpha = smoothstep(edgeMid, edgeEnd, dist * totalWidth);

            // Transition from edgeColor to color along the edge
            float insideAlpha =  (1.0 - interactive) * alpha * (1.0 - sEdge);
            float outsideAlpha = ((1.0 - interactive) * (1.0 - sAlpha) * edgeAlpha) + (interactive * (1.0 - sAlpha) * edgeAlpha * sEdge);

            // Premultiply before blending
            vec3 outsideColor = mix(edgeColor,color,interactive) * outsideAlpha;
            vec3 insideColor = color * insideAlpha;

            // Blend colors
            gl_FragColor.a = insideAlpha + outsideAlpha * (1.0 - insideAlpha);
            gl_FragColor.rgb = insideColor + outsideColor * (1.0 - insideAlpha);

            // Correct premultiplied alpha
            gl_FragColor.rgb = gl_FragColor.rgb / gl_FragColor.a;
        }`}},R,W),R.exports=I},8380:(R,W,d)=>{var O,I;O=[d(40),d(8800)],I=d.dj.d(O,function(f,N){return class{constructor(h,r){this.enabled=!0,this.STATE={NONE:0,CLIPPING:1,SLICE:2},this.state=this.STATE.NONE,this._visible=!1,this._matrix=new f.Matrix4,this._clippingEnabled={add:!1,remove:!1,rotate:!1,translate:!1},this._sliceEnabled={add:!1,remove:!1,rotate:!1,translate:!1},this._sliceAllowed=!1,this._scene=h,this._planes=[],this._planeData=[],this._sliceData=[],this.numPlanes=0,this._color=new f.Color(1,1,1),this._alternateColor=new f.Color(.8,.8,.8),this._colorSum=0,this._size=1,this._sceneCenter=new f.Vector3,this.enableAdd=!1,this.enableRemove=!1,this.enableRotate=!1,this.enableTranslate=!1,this._objectBoundingBox=new f.Box3,this._scene.matrixAutoUpdate=!1,this.updateInteractions(r.Clipping,r.Slice,!1)}updateInteractions(h,r,o){this._clippingEnabled.add=h.Add,this._clippingEnabled.remove=h.Remove,this._clippingEnabled.rotate=h.Rotate,this._clippingEnabled.translate=h.Translate,this._sliceEnabled.add=r.Add,this._sliceEnabled.remove=r.Remove,this._sliceEnabled.rotate=r.Rotate,this._sliceEnabled.translate=r.Translate,o&&this._updateState()}enable(){if(this._visible&&(this.enableAdd||this.enableRemove||this.enableRotate||this.enableTranslate)){this.enabled=this.numPlanes>0;for(let h=0;h<this.numPlanes;h++)this._planes[h].visible=!0}else this.disable()}disable(){if(this.enabled){this.enabled=!1;for(let h=0;h<this._planes.length;h++)this._planes[h].visible=!1}}update(h,r,o,c,u){const g=new f.Vector3(u[0][0],u[0][1],u[0][2]),m=new f.Vector3(u[1][0],u[1][1],u[1][2]);this._objectBoundingBox.set(g,m),this._matrix=c,this._sliceAllowed=o,this._sliceData=r,this._planeData=h,this._updateState()}setPosition(h,r){this._sceneCenter=h,this._size=r;for(let o=0;o<this._planes.length;o++)this._planes[o].sceneCenter=this._sceneCenter,this._planes[o].size=this._size;this._scene.updateMatrixWorld(!0)}setColor(h){this._colorSum=h[0]+h[1]+h[2],this._colorSum>2?(this._color.setRGB(0,0,0),this._alternateColor.setRGB(this._colorSum/3-.2,this._colorSum/3-.2,this._colorSum/3-.2)):(this._color.setRGB(1,1,1),this._alternateColor.setRGB(1,1,1));for(let r=0;r<this._planes.length;r++)this._planes[r].setColor(this._color,this._alternateColor,this._colorSum)}isMouseOnSphere(h,r,o,c){h.x=h.x*2-1,h.y=-h.y*2+1,o.setFromCamera(h,r);const u=[];return c._sphere.raycast(o,u),u.length>0}isContextMenuAvailable(){return this.enableRotate||this.enableRemove}_updateState(){this._sliceAllowed&&(this._sliceEnabled.add||this._sliceEnabled.remove||this._sliceEnabled.rotate||this._sliceEnabled.translate)?(this.state=this.STATE.SLICE,this.enableAdd=this._sliceEnabled.add,this.enableRemove=this._sliceEnabled.remove,this.enableRotate=this._sliceEnabled.rotate,this.enableTranslate=this._sliceEnabled.translate):this._clippingEnabled.add||this._clippingEnabled.remove||this._clippingEnabled.rotate||this._clippingEnabled.translate?(this.state=this.STATE.CLIPPING,this.enableAdd=this._clippingEnabled.add,this.enableRemove=this._clippingEnabled.remove,this.enableRotate=this._clippingEnabled.rotate,this.enableTranslate=this._clippingEnabled.translate):(this.state=this.STATE.NONE,this.enableAdd=!1,this.enableRemove=!1,this.enableRotate=!1,this.enableTranslate=!1),this.state===this.STATE.CLIPPING?this._setPlanes(this._planeData):this.state===this.STATE.SLICE?this._setPlanes(this._sliceData):this.disable()}_setPlanes(h){if(h.length>this._planes.length){for(let r=0;r<this._planes.length;r++)this._planes[r].setMode(this.state),this._planes[r].pushPinVisible=this.enableRotate,this._planes[r].setBoundingBox(this._objectBoundingBox),this._planes[r].applyMatrix(this._matrix),this._planes[r].setPlane(h[r]),this._planes[r].show(),this._planes[r].visible=this._visible;for(let r=this._planes.length;r<h.length;r++)this._add(h[r],r)}else{for(let r=0;r<h.length;r++)this._planes[r].setMode(this.state),this._planes[r].pushPinVisible=this.enableRotate,this._planes[r].setBoundingBox(this._objectBoundingBox),this._planes[r].applyMatrix(this._matrix),this._planes[r].setPlane(h[r]),this._planes[r].show(),this._planes[r].visible=this._visible;if(h.length<this._planes.length)for(let r=h.length;r<this._planes.length;r++)this._planes[r].visible=!1}this.numPlanes=h.length,this.enable()}_add(h,r){const o=new N(h,r,this._color,this._alternateColor,this._colorSum,this.state);o.size=this._size,o.sceneCenter=this._sceneCenter,o.setBoundingBox(this._objectBoundingBox),o.applyMatrix(this._matrix),o.pushPinVisible=this.enableRotate,o.visible=this._visible,this._scene.add(o),this._planes.push(o)}onPointerDown(h){for(let r=0;r<this._planes.length;r++)this._planes[r]!==h&&this._planes[r].hide()}onPointerUp(h){for(let r=0;r<this.numPlanes;r++)this._planes[r]!==h&&this._planes[r].show()}onPointerLeave(){return this._visible===!0?(this._visible=!1,this.disable(),!0):!1}onPointerEnter(){return this._visible===!1?(this._visible=!0,this.enable(),!0):!1}}},R,W),R.exports=I},9244:(R,W,d)=>{var O,I;O=[d(738),d(884)],I=d.dj.d(O,function(f,N){return class extends f{_newObject(h,r){const o=new N(h,r,1);return o.pickable=r.pickable.value,o}}},R,W),R.exports=I},3476:(R,W,d)=>{var O,I;O=[d(738),d(5374)],I=d.dj.d(O,function(f,N){return class extends f{_newObject(h,r,o,c=!1){return new N(h,r,o,c)}}},R,W),R.exports=I},5374:(R,W,d)=>{var O,I;O=[d(40),d(9052),d(990)],I=d.dj.d(O,function(f,N,b){return class extends N{constructor(r=0,o,c,u=!1){super(r,o,c),this.type="Polyline",this._labelType="length",this.closed=u}refreshLabel(){if(this._showLabel!==!1&&this._numPoints>0&&this._label!==null){if(this._label.measurement===!0){let r=0;const o=this.geometry.getAttribute("position"),c=o.array.length/3;if(this.closed===!0){this._labelType="area",this._label.style="area";let u=0;if(c>2){for(let g=0;g<c;g++)u=(g+1)%c,r+=o.array[g*3]*o.array[u*3+1],r-=o.array[u*3]*o.array[g*3+1];r=Math.abs(r/2)}}else{this._labelType="length",this._label.style="length";for(let u=1;u<this._numPoints;u++)r+=this._points[u].position.distanceTo(this._points[u-1].position);if(c>this._numPoints){const u=new f.Vector3(o.array[o.array.length-3],o.array[o.array.length-2],o.array[o.array.length-1]);r+=this._points[this._numPoints-1].position.distanceTo(u)}}this._label.setLabel(r,this._globalUniforms.units.value)}this._label.position.copy(this._points[0].position)}}isLengthValid(){return this.closed===!0?this._numPoints>2:this._numPoints>1}_setPointVisibility(){for(let r=0;r<this._numPoints;r++)this._points[r].visible=this.visible&&this.pickable}_setPoints(r){this.pickable?super._setPoints(r):this._numPoints=0}_createPoint(r){this.pickable?super._createPoint(r):this._numPoints=0}_createPointArray(r){this.pickable?super._createPointArray(r):this._numPoints=0}}},R,W),R.exports=I},1649:(R,W,d)=>{var O,I;O=[d(40),d(1043),d(990)],I=d.dj.d(O,function(f,N,b){return class extends f.Line{constructor(r=0,o,c=0){const u=new f.BufferGeometry,g=[.5,.5,0,-.5,.5,0,-.5,-.5,0,.5,-.5,0,.5,.5,0];u.setAttribute("position",new f.Float32BufferAttribute(g,3)),u.computeBoundingSphere();const m=new f.Color(16777215),y=new f.LineBasicMaterial({color:m,toneMapped:!1,transparent:!0,depthWrite:!1,depthTest:!1});super(u,y),this.type="Rectangle",this.visible=!1,this._showLabel=!1,this.selected=!1,this.ID=r,this.color=m,this.pickable=o.pickable.value,this.movable=!0,this._labelType="dimension",this._globalUniforms=o,this._cornerA=new f.Vector3,this._cornerB=new f.Vector3,this._cornerScreenA=new f.Vector2,this._cornerScreenB=new f.Vector2,this._eye=new f.Vector3(0,0,1),this._view=new f.Vector3,this._rotationAngle=0,this._label=null,this._face=null,c>0&&(this._constructFace(),this.onBeforeRender=this._updateLabelPosition.bind(this))}updateMatrixWorld(r){super.updateMatrixWorld(r),this._face!==null&&(this._face.visible=this.visible)}highlight(){this.material.opacity=1,this._face!==null&&this._face.highlight()}show(){this.material.opacity=1,this._face!==null&&this._face.show()}hide(){this.material.opacity=0,this._face!==null&&this._face.hide()}highlightLabel(){this._label!==null&&this._label.highlight()}select(r){this.selected===!0&&r===!0?this.deselect():(this.selected=!0,this.material.color.copy(this._globalUniforms.selectedColor.value),this._setLabelColor())}deselect(){this.selected=!1,this.material.color.copy(this.color),this._setLabelColor()}setTheme(r){this._label!==null&&this._label.setTheme(r)}getPosition(){const r=new Array(5);return r[0]=this.position.x,r[1]=this.position.y,r[2]=Math.abs(this.scale.x),r[3]=Math.abs(this.scale.y),r[4]=this._rotationAngle,r}setPosition(r){this.position.x=r[0],this.position.y=r[1],this.position.z=.5,this.scale.x=r[2],this.scale.y=r[3],this.scale.z=1,this._rotationAngle=r[4],this.refreshLabel()}setLabel(r){if(this._globalUniforms.labelVisible.value===!1){this._showLabel=!1;return}r===null?(this._label===null&&this._constructLabels(),this._label.measurement=!0,this._showLabel=!0):r===""?(this._label!==null&&(this._label.setLabel("",this._globalUniforms.units.value),this._label.measurement=!1),this._showLabel=!1):(this._label===null&&this._constructLabels(),this._label.setLabel(r,this._globalUniforms.units.value),this._label.measurement=!1,this._showLabel=!0)}editLabel(r){this._label!==null&&this._label.edit(r)}stopEditing(r){return this._label!==null?this._label.stopEditing(r):!1}getLabel(){return this._label!==null?this._label.getLabel():null}setLabelVisible(){this._globalUniforms.labelVisible.value===!1&&(this._label!==null&&this._label.setVisibility(this._globalUniforms.labelVisible.value),this._showLabel=!1)}setColor(r){this.color.fromArray(r),this.selected?this.material.color.copy(this._globalUniforms.selectedColor.value):this.material.color.fromArray(r),this._setLabelColor(),this._setFaceColor()}raycast(r,o){this.visible&&this.pickable&&this._face!==null&&this._face.raycast(r,o)}setEye(r,o){this._eye.copy(r),this.up.copy(o).normalize()}start(r,o){this._cornerA.copy(r),this._cornerB.copy(r),this._cornerScreenA.copy(o),this._cornerScreenB.copy(o)}follow(r,o){this._cornerB.copy(r),this._cornerScreenB.copy(o);const c=this._cornerB.clone().sub(this._cornerA),u=this.up.clone();this.scale.y=Math.abs(c.dot(u)),u.cross(this._eye).normalize(),this.scale.x=Math.abs(c.dot(u)),this.position.lerpVectors(this._cornerA,this._cornerB,.5),this._view.copy(this.position).add(this._eye),this.lookAt(this._view),this.visible=!0,this.refreshLabel()}getScreenDimensions(){const r=new f.Vector4,o=new f.Vector2;return o.lerpVectors(this._cornerScreenA,this._cornerScreenB,.5),r.x=Math.abs(o.x),r.y=Math.abs(o.y),r.width=Math.abs(this._cornerScreenA.x-this._cornerScreenB.x),r.height=Math.abs(this._cornerScreenA.y-this._cornerScreenB.y),r}close(){}clear(){}remove(){this.visible=!1,this.selected=!1,this._label!==null&&this._label.setVisibility(!1)}applyQuaternion(){}applyTransformation(){}getLastMarker(){return this}refreshLabel(){if(this._showLabel!==!1&&this._label!==null&&(this._label.position.copy(this.position),this._label.measurement===!0)){const r=new f.Vector2(Math.abs(this.scale.x),Math.abs(this.scale.y));this._label.setLabel(r,this._globalUniforms.units.value)}}_setLabelColor(){this._label!==null&&(this._label.setColor(this.material.color),this._label.show(this.selected))}_setFaceColor(){this._face!==null&&(this._face.material.color=this.material.color)}_constructLabels(){this._label=new b(this._labelType,this._globalUniforms.container.value,this._globalUniforms.isDarkTheme.value),this._label.setColor(this.material.color)}_constructFace(){const r=[-.5,.5,0,.5,.5,0,.5,-.5,0,-.5,.5,0,.5,-.5,0,-.5,-.5,0];this._face=new N(5,this.material.color,r),this._face.matrixAutoUpdate=!1,this._face.material.side=f.DoubleSide,this.add(this._face)}_updateLabelPosition(r,o,c,u,g,m){if(this.visible===!0&&this._showLabel===!0&&this._label!==null){const y=new f.Vector3;r.getSize(y),this._label.project(y,c)}}}},R,W),R.exports=I},2395:(R,W,d)=>{var O,I;O=[d(738),d(1649)],I=d.dj.d(O,function(f,N){return class extends f{_newObject(h,r,o){return new N(h,r,1)}}},R,W),R.exports=I},4935:(R,W,d)=>{var O,I;O=[d(40),d(990)],I=d.dj.d(O,function(f,N){return class extends f.Mesh{constructor(h=0,r){const o=new f.SphereGeometry(1,32,16),c=new f.Color(16777215),u=new f.MeshBasicMaterial({color:c,toneMapped:!1,transparent:!0,depthWrite:!1,side:f.FrontSide,opacity:.1}),g=new f.RingGeometry(1,1,32),m=new f.LineBasicMaterial({color:16711680,transparent:!0,opacity:1}),y=new f.LineSegments(g,m),x=new f.RingGeometry(1,1,32),w=new f.LineBasicMaterial({color:65535,transparent:!0,opacity:1}),C=new f.LineSegments(x,w);C.rotation.y+=1.57;const P=new f.RingGeometry(1,1,32),T=new f.LineBasicMaterial({color:16777215,transparent:!0,opacity:1}),M=new f.LineSegments(P,T);M.rotation.x+=1.57,super(o,u),this.add(y),this.add(C),this.add(M),this.type="CropSphere",this.visible=!1,this._showLabel=!1,this.selected=!1,this.ID=h,this.color=c,this.pickable=r.pickable.value,this.movable=!0,this._labelType="volume",this._globalUniforms=r,this._quaternion=new f.Quaternion,this._label=null,this.onBeforeRender=this._updateLabelPosition.bind(this),this._interactionStarted=!1,this._initialDistance=new f.Vector2,this._previousEndPoint=new f.Vector2,this._initialDirection=new f.Vector2,this._scaleFactor=.03}updateMatrixWorld(h){super.updateMatrixWorld(h)}highlight(){this.material.opacity=.2,this.children[0].material.opacity=1,this.children[1].material.opacity=1,this.children[2].material.opacity=1}show(){this.material.opacity=.1,this.children[0].material.opacity=1,this.children[1].material.opacity=1,this.children[2].material.opacity=1,this._setLabelColor()}hide(){this.material.opacity=0,this.children[0].material.opacity=0,this.children[1].material.opacity=0,this.children[2].material.opacity=0}highlightLabel(){this._label!==null&&this._label.highlight()}select(h){this.selected===!0&&h===!0?this.deselect():(this.selected=!0,this.material.color.copy(this._globalUniforms.selectedColor.value),this.children[0].material.color.copy(this._globalUniforms.selectedColor.value),this.children[1].material.color.copy(this._globalUniforms.selectedColor.value),this.children[2].material.color.copy(this._globalUniforms.selectedColor.value),this._setLabelColor())}deselect(){this.selected=!1,this.material.color.copy(this.color),this.children[0].material.color.copy(this.color),this.children[1].material.color.copy(this.color),this.children[2].material.color.copy(this.color),this._setLabelColor()}getPosition(){return[this.position.x,this.position.y,this.position.z,this.scale.x,this.scale.y,this.scale.z,this.rotation.x,this.rotation.y,this.rotation.z]}setTheme(h){this._label!==null&&this._label.setTheme(h)}setPosition(h){this.setSize(h.slice(3,6)),this.setRotation(h.slice(6,9)),this.setCenter(h.slice(0,3))}setLabel(h){if(this._globalUniforms.labelVisible.value===!1){this._showLabel=!1;return}h===null?(this._label===null&&this._constructLabels(),this._label.measurement=!0,this._showLabel=!0):h===""?(this._label!==null&&(this._label.setLabel("",this._globalUniforms.units.value),this._label.measurement=!1),this._showLabel=!1):(this._label===null&&this._constructLabels(),this._label.setLabel(h,this._globalUniforms.units.value),this._label.measurement=!1,this._showLabel=!0)}editLabel(h){this._label!==null&&this._label.edit(h)}stopEditing(h){return this._label!==null?this._label.stopEditing(h):!1}getLabel(){return this._label!==null?this._label.getLabel():null}setLabelVisible(){this._globalUniforms.labelVisible.value===!1&&(this._label!==null&&this._label.setVisibility(this._globalUniforms.labelVisible.value),this._showLabel=!1)}setCenter(h){this.position.fromArray(h),this.refreshLabel()}setSize(h){this.scale.fromArray(h)}setRotation(h){this.rotation.fromArray(h)}setColor(h){this.color.fromArray(h),this.selected?(this.material.color.copy(this._globalUniforms.selectedColor.value),this.children[0].material.color.copy(this._globalUniforms.selectedColor.value),this.children[1].material.color.copy(this._globalUniforms.selectedColor.value),this.children[2].material.color.copy(this._globalUniforms.selectedColor.value)):(this.material.color.fromArray(h),this.children[0].material.color.fromArray(h),this.children[1].material.color.fromArray(h),this.children[2].material.color.fromArray(h)),this._setLabelColor()}raycast(h,r){this.visible&&this.pickable&&super.raycast(h,r)}close(){}clear(){}remove(){this.visible=!1,this.selected=!1,this._label!==null&&this._label.setVisibility(!1)}applyQuaternion(){}onPointerDown(){this._interactionStarted=!0}onPointerUp(){this._interactionStarted=!1,this._initialDirection.set(0,0),this._previousEndPoint.set(0,0)}applyTransformation(h,r,o,c,u){if(h)this.position.sub(o);else{if(this._interactionStarted){const x=this.position.clone().project(r),w=new f.Vector2;w.x=(x.x+1)/2,w.y=1-(x.y+1)/2,this._initialDistance=w.clone().sub(c.clone()),this._initialDirection=this._initialDistance.normalize(),this._interactionStarted=!1}const g=u.clone(),y=this._previousEndPoint.clone().sub(u.clone()).normalize();this._previousEndPoint.set(g.x,g.y),this._initialDirection.dot(y)<0?this.scale.multiplyScalar(1-this._scaleFactor):this.scale.multiplyScalar(1+this._scaleFactor),this.scale.x<0&&(this.scale.x=Number.EPSILON),this.scale.y<0&&(this.scale.y=Number.EPSILON),this.scale.z<0&&(this.scale.z=Number.EPSILON)}}refreshLabel(){this._showLabel!==!1&&this._label!==null&&(this._label.position.copy(this.position),this._label.measurement===!0&&this._label.setLabel(this.scale.x*this.scale.y*this.scale.z,this._globalUniforms.units.value))}_setLabelColor(){this._label!==null&&(this._label.setColor(this.material.color),this._label.show(this.selected))}_constructLabels(){this._label=new N(this._labelType,this._globalUniforms.container.value,this._globalUniforms.isDarkTheme.value),this._label.setColor(this.material.color)}_updateLabelPosition(h,r,o,c,u,g){if(this.visible===!0&&this._showLabel===!0&&this._label!==null){const m=new f.Vector3;h.getSize(m),this._label.project(m,o)}}}},R,W),R.exports=I},3601:(R,W,d)=>{var O,I;O=[d(40),d(990)],I=d.dj.d(O,function(f,N){return class extends N{constructor(h=0,r){super("text",r.container.value,r.isDarkTheme.value),this.ID=h,this._fixToViewport=!1,this.element.style.borderStyle="none"}render(h,r){let o="50%",c="0";if(this.verticalAlignment===2?o="0":this.verticalAlignment===1&&(o="100%"),this.horizontalAlignment===2?c="-50%":this.horizontalAlignment===1&&(c="-100%"),this._fixToViewport)this.element.style.left=this.position.x*r.width+"px",this.element.style.bottom=this.position.y*r.height+"px";else{const u=new f.Vector3;u.copy(this.position),u.project(h),this.element.style.left=Math.round((u.x+1)*r.width/2)+"px",this.element.style.bottom=Math.round((u.y+1)*r.height/2)+"px"}this.element.style.transform="translate("+c+", "+o+")"}setColor(h){const r=new f.Color;r.fromArray(h),super.setColor(r)}setPosition(h){h.length===2?(this.position.set(h[0],h[1],0),this._fixToViewport=!0):(this.position.fromArray(h),this._fixToViewport=!1)}setLabel(h){super.setLabel(h,"")}remove(){this.setVisibility(!1)}}},R,W),R.exports=I},5195:(R,W,d)=>{var O,I;O=[d(738),d(3601)],I=d.dj.d(O,function(f,N){return class extends f{render(h,r){for(let o=0;o<this._numObjects;o++)this.objects[o].render(h,r)}clear(h){if(h<this._numObjects)for(let r=h;r<this._numObjects;r++)this.objects[r].remove();this._numObjects=0}add(h,r,o,c,u,g){if(this._numObjects+=1,this._numObjects>this.objects.length){const m=this._newObject(c,this._annotationUniforms,u);this.objects.push(m)}return this.objects[this._numObjects-1].horizontalAlignment=g[0],this.objects[this._numObjects-1].verticalAlignment=g[1],this.objects[this._numObjects-1].setLabel(r),this.objects[this._numObjects-1].setPosition(h),this.objects[this._numObjects-1].setColor(o),this.objects[this._numObjects-1].ID=c,this.objects[this._numObjects-1].visible=!0,this.objects[this._numObjects-1].setVisibility(!0),this._getObject(this._numObjects-1)}_newObject(h,r,o){return new N(h,r)}}},R,W),R.exports=I},4121:(R,W,d)=>{var O,I;O=[d(40)],I=d.dj.d(O,function(f){return class extends f.LineSegments{constructor(b){const h=new f.BufferGeometry,r=new f.LineBasicMaterial({toneMapped:!1,transparent:!0,depthTest:!0,depthWrite:!1});super(h,r),this.type="Grid",this._empty=!0,this._color=new f.Color(1,1,1),this._boundingSphere=new f.Sphere,this._gridCenter=new f.Vector3,this._positionMode="auto",this._sizeMode="auto",this._positionNeedsUpdate=!1,this._update(b)}update(b){this._update(b)}setVisible(b){this._empty=b,this._visible&&!this._empty?this.visible=!0:this.visible=!1}setColor(b){b[0]+b[1]+b[2]>2?this.material.color.setRGB(0,0,0):this.material.color.setRGB(1,1,1)}setPosition(b){b.getCenter(this._gridCenter),b.getBoundingSphere(this._boundingSphere),this._gridCenter.z=b.min.z,this._sizeMode==="auto"&&(this._positionNeedsUpdate=!0)}_update(b){if(this.material.opacity=b.Alpha,this._visible=b.Visible,this._positionMode!==b.PositionMode&&(this._positionMode=b.PositionMode,this._positionNeedsUpdate=!0),this._sizeMode!==b.SizeMode&&(this._sizeMode=b.SizeMode,this._positionNeedsUpdate=!0),this._size!==b.Size&&(this._size=b.Size,this._sizeMode!=="auto"&&(this._positionNeedsUpdate=!0)),this._positionMode!=="auto"){const h=Array.from(b.Position);(h[0]!==this.position.x||h[1]!==this.position.y||h[2]!==this.position.z)&&(this._positionNeedsUpdate=!0),this.position.set(h[0],h[1],h[2])}this._numRadialDivisions!==b.NumRadialDivisions&&(this._numRadialDivisions=b.NumRadialDivisions,this._positionNeedsUpdate=!0),this._numDivisions!==b.NumDivisions&&(this._numDivisions=b.NumDivisions,this._positionNeedsUpdate=!0),this._style!==b.Style&&(this._style=b.Style,this._positionNeedsUpdate=!0)}updateMatrixWorld(b){if(this._positionNeedsUpdate){this._positionNeedsUpdate=!1,this._positionMode==="auto"&&this.position.copy(this._gridCenter);const h=[],r=this._sizeMode==="auto"?this._boundingSphere.radius:this._size;if(this._style==="cartesian"){if(this._numDivisions>0){const o=2*r/this._numDivisions,c=r;for(let u=0,g=-c;u<=this._numDivisions;u++,g+=o)h.push(-c,g,0,c,g,0),h.push(g,-c,0,g,c,0)}}else{if(this._numRadialDivisions>0)for(let o=0;o<this._numRadialDivisions;o++){const c=o/this._numRadialDivisions*(Math.PI*2),u=Math.sin(c)*r,g=Math.cos(c)*r;h.push(0,0,0),h.push(u,g,0)}if(this._numDivisions>0)for(let c=0;c<=this._numDivisions;c++){const u=r-r/this._numDivisions*c;for(let g=0;g<64;g++){let m=g/64*(Math.PI*2),y=Math.sin(m)*u,x=Math.cos(m)*u;h.push(y,x,0),m=(g+1)/64*(Math.PI*2),y=Math.sin(m)*u,x=Math.cos(m)*u,h.push(y,x,0)}}}this.geometry.setAttribute("position",new f.Float32BufferAttribute(h,3)),this.geometry.computeBoundingSphere()}super.updateMatrixWorld(b)}}},R,W),R.exports=I},2574:(R,W,d)=>{var O,I;O=[d(40)],I=d.dj.d(O,function(f){return class extends f.EventDispatcher{constructor(b){super(),this.enabled=!1,this.visible=!1,this._showFix=!1,this._colorSum=1,this._init(b)}show(){this.visible=!0,this._element.style.visibility="visible",this._closeElement.style.visibility="visible",this._showFix?(this._buttonElement.style.display="inline",this._buttonElement.style.visibility="visible"):(this._buttonElement.style.display="none",this._buttonElement.style.visibility="hidden")}hide(){this.visible&&(this.visible=!1,this._element.style.visibility="hidden",this._closeElement.style.visibility="hidden",this._buttonElement.style.visibility="hidden")}resize(b){this._element.style.width=b.width-26+"px"}update(b){this.enabled=b.Enabled,this.enabled?(this._showFix=b.ShowFix,this._textElement.innerHTML=b.Text+(this._showFix?" ":""),this._buttonElement.innerHTML=b.FixText,b.ForceDisplay?this.show():this.hide()):this.clear()}clear(){this._element.style.visibility="hidden",this._closeElement.style.visibility="hidden",this._buttonElement.style.visibility="hidden",this.visible=!1,this._textElement.innerHTML="",this._buttonElement.innerHTML=""}setColor(b){this._colorSum=b,b>2?(this._element.style.color="#212121",this._element.style.backgroundColor="white",this._closeElement.style.filter="invert(0%)"):(this._element.style.color="#D9D9D9",this._element.style.backgroundColor="#121212",this._closeElement.style.filter="invert(100%)")}dispose(){this._closeElement.removeEventListener("click",this._closeClicked.bind(this)),this._closeElement.removeEventListener("pointerenter",this._closeHovered.bind(this)),this._closeElement.removeEventListener("pointerleave",this._closeHovered.bind(this)),this._buttonElement.removeEventListener("click",this._applyFix.bind(this))}_closeClicked(){this.enabled=!1,this.clear(),this.dispatchEvent({type:"messageClosed",message:!1})}_applyFix(){this.enabled=!1,this.clear(),this.dispatchEvent({type:"messageClosed",message:!0})}_closeHovered(b){b.type==="pointerenter"?this._colorSum>2?this._closeElement.style.filter="invert(20%)":this._closeElement.style.filter="invert(75%)":this._colorSum>2?this._closeElement.style.filter="invert(0%)":this._closeElement.style.filter="invert(100%)"}_init(b){this._element=document.createElement("div"),this._element.className="iptInfo",b.appendChild(this._element),this._closeElement=document.createElement("div"),this._closeElement.className="iptInfoClose",b.appendChild(this._closeElement),this._textElement=document.createElement("div"),this._textElement.style.display="inline",this._element.appendChild(this._textElement),this._buttonElement=document.createElement("button"),this._buttonElement.style.display="inline",this._element.appendChild(this._buttonElement),this._closeElement.addEventListener("click",this._closeClicked.bind(this)),this._closeElement.addEventListener("pointerenter",this._closeHovered.bind(this)),this._closeElement.addEventListener("pointerleave",this._closeHovered.bind(this)),this._buttonElement.addEventListener("click",this._applyFix.bind(this))}}},R,W),R.exports=I},7198:(R,W,d)=>{var O,I;O=[d(40),d(7402)],I=d.dj.d(O,function(f,N){return class extends N{constructor(h){super(),this._xLabel=h.getElementsByClassName("iptOrientationAxesX")[0],this._yLabel=h.getElementsByClassName("iptOrientationAxesY")[0],this._zLabel=h.getElementsByClassName("iptOrientationAxesZ")[0],this._size=50,this._visible=!0,this._empty=!0,this._viewportSize=new f.Vector4(0,0,100,100),this._viewportPlaceholder=new f.Vector4,this._eye=new f.Vector3,this._line=null,this._xLocation=new f.Vector3,this._yLocation=new f.Vector3,this._zLocation=new f.Vector3,this.enabled=!1,this._scene=new f.Scene,this._camera=new f.OrthographicCamera(-this._size,this._size,this._size,-this._size,1,1e3),this.reset()}render(h,r,o,c){this._eye.subVectors(r.position,c.u_cameraTarget.value),this._eye.multiplyScalar(100/this._eye.length()),this._camera.position.copy(this._eye),this._camera.up.copy(r.up),this._camera.lookAt(this._scene.position),h.getViewport(this._viewportPlaceholder),h.setViewport(this._viewportSize),h.render(this._scene,this._camera);const u=new f.Vector3(this._size,0,0),g=new f.Vector3(0,this._size,0),m=new f.Vector3(0,0,this._size);u.project(this._camera).addScalar(1).multiplyScalar(this._size).round(),g.project(this._camera).addScalar(1).multiplyScalar(this._size).round(),m.project(this._camera).addScalar(1).multiplyScalar(this._size).round(),this._xLocation.copy(u),this._yLocation.copy(g),this._zLocation.copy(m),this.enabled&&(this._xLabel.style.visibility==="hidden"&&this._setLabelVisibility(!0),this._updateLabelLocation()),h.setViewport(this._viewportPlaceholder)}dispose(){this._setLabelVisibility(!1),this._line.material.dispose(),this._line.geometry.dispose(),this._scene.clear()}setLabels(h){this._xLabel.innerHTML=h[0],this._yLabel.innerHTML=h[1],this._zLabel.innerHTML=h[2]}setVisible(h,r,o,c){this._visible=h,this._empty=r,this._visible&&!this._empty?o>=2*this._size&&c>=2*this._size?this.enabled=!0:(this.enabled=!1,this._setLabelVisibility(!1)):(this.enabled=!1,this._setLabelVisibility(!1))}get visible(){return this._visible}reset(){const h=[0,0,0,this._size,0,0,0,0,0,0,this._size,0,0,0,0,0,0,this._size],r=[.72,.19,.17,1,.48,.45,0,.5,.07,.58,.94,.52,.09,.34,.65,.33,.71,1],o=new f.BufferGeometry;o.setAttribute("position",new f.Float32BufferAttribute(h,3)),o.setAttribute("color",new f.Float32BufferAttribute(r,3));const c=new f.LineBasicMaterial({vertexColors:!0,toneMapped:!1,depthTest:!1,depthWrite:!1});this._line=new f.LineSegments(o,c),this._scene.add(this._line)}_setLabelVisibility(h){h&&this.enabled?(this._updateLabelLocation(),this._xLabel.style.visibility="visible",this._yLabel.style.visibility="visible",this._zLabel.style.visibility="visible"):(this._xLabel.style.visibility="hidden",this._yLabel.style.visibility="hidden",this._zLabel.style.visibility="hidden")}_updateLabelLocation(){this._xLabel.style.left=Math.max(this._xLocation.x-10,0)+"px",this._yLabel.style.left=Math.max(this._yLocation.x-10,0)+"px",this._zLabel.style.left=Math.max(this._zLocation.x-10,0)+"px",this._xLabel.style.bottom=this._xLocation.y+"px",this._yLabel.style.bottom=this._yLocation.y+"px",this._zLabel.style.bottom=this._zLocation.y+"px"}}},R,W),R.exports=I},5989:(R,W,d)=>{var O,I;O=[],I=d.dj.d(O,function(){return class{constructor(N,b=!1){this.enabled=!b,this.visible=!1,this.value=100,this._indeterminantSpinner=document.createElement("div"),this._indeterminantSpinner.className="iptIndeterminantSpinner",N.appendChild(this._indeterminantSpinner),this._indeterminantSpinner.appendChild(document.createElement("div")),this._indeterminantSpinner.appendChild(document.createElement("div")),this._indeterminantSpinner.appendChild(document.createElement("div")),this._indeterminantSpinner.appendChild(document.createElement("div")),this._indeterminantSpinner.appendChild(document.createElement("div")),this._determinantSpinner=document.createElement("div"),this._determinantSpinner.className="iptDeterminantSpinner",N.appendChild(this._determinantSpinner),this._leftSide=document.createElement("div"),this._leftSide.className="iptDeterminantSpinnerLeft",this._determinantSpinner.appendChild(this._leftSide),this._rotateSide=document.createElement("div"),this._rotateSide.className="iptDeterminantSpinnerRotate",this._leftSide.appendChild(this._rotateSide),this._rightSide=document.createElement("div"),this._rightSide.className="iptDeterminantSpinnerRight",this._leftSide.appendChild(this._rightSide);const h=document.createElement("div");h.className="iptDeterminantSpinnerBackground",this._determinantSpinner.appendChild(h)}setDeterminant(N){this.enabled&&(N===0?(this.value=0,this.setIndeterminant(!0)):N>=100?(this.value=100,this.setIndeterminant(!1)):(this._rotateSide.style.transform="rotate("+N*3.6+"deg)",this._rightSide.style.visibility=N>50?"visible":"hidden",this._leftSide.style.clipPath=N>50?"none":"inset(0px 0px 0px 11px)",this._determinantSpinner.style.visibility="visible",this._showIndeterminant(!1),this.visible=!0))}setIndeterminant(N){this.enabled&&(this._showDeterminant(!1),this._showIndeterminant(N),this.visible=N)}_showIndeterminant(N){this._indeterminantSpinner.style.opacity=N===!0?1:0}_showDeterminant(N){this._determinantSpinner.style.visibility=N===!0?"visible":"hidden",this._rightSide.style.visibility=N===!0?"visible":"hidden"}}},R,W),R.exports=I},2554:(R,W,d)=>{var O,I;O=[d(40)],I=d.dj.d(O,function(f){return class extends f.EventDispatcher{constructor(b){super(),this._visible=!0,this._empty=!0,this.units="voxels",this._bar=null,this._label=null,this._updateRequired=!1,this._minWidth=170,this._minHeight=52,this._style="measure",this._valueEdited=!1,this._zoomValue="0",this._colorSum=1,this._init(b)}setStyle(b){this._style!==b&&(this._style=b,this._style==="measure"?(this._element.style.height="22px",this._label.style.pointerEvents="none",this._label.style.cursor="default",this._label.style.userSelect="none",this._label.contentEditable=!1,this._label.blur()):(this._element.style.height="16px",this._label.style.pointerEvents="auto",this._label.style.cursor="text",this._label.style.userSelect="text",this._label.contentEditable=!0))}setColor(b){this._colorSum=b[0]+b[1]+b[2],this._bar.style["background-color"]=this._colorSum>2?"rgb(0,0,0)":"rgb(255,255,255)",this._label.style.color=this._colorSum>2?"rgb(0,0,0)":"rgb(255,255,255)",this._background.style.backgroundColor=this._colorSum>2?"rgb(255,255,255)":"rgb(0,0,0)",this._bar.style.opacity=this._colorSum>2?"1.0":"0.8",this._label.style.opacity=this._colorSum>2?"1.0":"0.8"}setVisible(b,h,r){this._visible=b,this._empty=h,this._minWidth=r===!0?270:170,this._updateRequired=!0}get visible(){return this._visible}render(b,h,r){const o=this._empty===!1&&this._visible===!0;this._updateRequired===!0&&(this._updateRequired=!1,h>=this._minWidth&&r>=this._minHeight?(this._bar.style.visibility=o===!0&&this._style==="measure"?"visible":"hidden",this._label.style.visibility=o===!0?"visible":"hidden",this._background.style.visibility=o===!0?"visible":"hidden"):(this._bar.style.visibility="hidden",this._label.style.visibility="hidden",this._background.style.visibility="hidden")),o&&(this._style==="measure"?this._renderMeasure(b,h):this._renderZoom(b,h))}_renderMeasure(b,h){const r=(b.right-b.left)/b.zoom*(160/h),o=Math.floor(Math.log10(r));let c=Math.pow(10,o);c<r*.2&&(c=c*5);const u=c/r*160;if(this.units==="m"||this.units==="mm")this._customMetricSystemUnits(c,o);else if(Math.abs(o)>3)this._label.innerHTML=c.toExponential(1)+" "+this.units;else{let g=0;o===-3?g=3:o===-2?g=2:o===-1&&(g=1),c===1?this.units==="voxels"?this._label.innerHTML=c.toFixed(g)+" voxel":this.units==="pixels"?this._label.innerHTML=c.toFixed(g)+" pixel":this._label.innerHTML=c.toFixed(g)+" "+this.units:this._label.innerHTML=c.toFixed(g)+" "+this.units}this._bar.style.width=u+"px",u>100?(this._element.style.width=u+4+"px",this._label.style.right=2+u/2-50+"px",this._bar.style.right="2px"):(this._element.style.width="104px",this._label.style.right="2px",this._bar.style.right=2+(100-u)/2+"px")}_renderZoom(b,h){let r=100*(h*b.zoom)/(b.right-b.left);const o=Math.floor(Math.log10(r));r>=10?(r=Math.round(r),this._zoomValue=r.toFixed(0)):o<-2?this._zoomValue=r.toExponential(1):this._zoomValue=r.toFixed(Math.abs(Math.abs(o)+1)),this._label.innerHTML=this._zoomValue+"%",this._element.style.width="104px",this._label.style.right="2px"}_customMetricSystemUnits(b,h){if(this.units==="m")switch(h){case-11:b*=1e9,this._label.innerHTML=b.toFixed(2)+" nm";break;case-10:b*=1e9,this._label.innerHTML=b.toFixed(1)+" nm";break;case-9:case-8:case-7:b*=1e9,this._label.innerHTML=b.toFixed(0)+" nm";break;case-6:case-5:case-4:b*=1e6,this._label.innerHTML=b.toFixed(0)+" &mu;m";break;case-3:case-2:case-1:b*=1e3,this._label.innerHTML=b.toFixed(0)+" mm";break;case 0:case 1:case 2:this._label.innerHTML=b.toFixed(0)+" m";break;case 3:case 4:case 5:case 6:b/=1e3,this._label.innerHTML=b.toFixed(0)+" km";break;default:this._label.innerHTML=b.toExponential(1)+" "+this.units}else switch(h){case-8:b*=1e6,this._label.innerHTML=b.toFixed(2)+" nm";break;case-7:b*=1e6,this._label.innerHTML=b.toFixed(1)+" nm";break;case-6:case-5:case-4:b*=1e6,this._label.innerHTML=b.toFixed(0)+" nm";break;case-3:case-2:case-1:b*=1e3,this._label.innerHTML=b.toFixed(0)+" &mu;m";break;case 0:case 1:case 2:this._label.innerHTML=b.toFixed(0)+" mm";break;case 3:case 4:case 5:b/=1e3,this._label.innerHTML=b.toFixed(0)+" m";break;case 6:case 7:case 8:b/=1e6,this._label.innerHTML=b.toFixed(0)+" km";break;default:this._label.innerHTML=b.toExponential(1)+" "+this.units}}_onKeyPress(b){this._valueEdited=!0;const h=b.keyCode<=57&&b.keyCode>=48||b.keyCode<=105&&b.keyCode>=96,r=b.keyCode===110||b.keyCode===190||b.keyCode===8||b.keyCode===37||b.keyCode===39||b.keyCode===69;b.keyCode===13&&(b.preventDefault(),this._label.blur()),h||r?this._valueEdited=!0:b.preventDefault()}_onBlur(b){if(this._background.style.opacity=.4,this._label.style.textOverflow="ellipsis",this._valueEdited){if(this._valueEdited=!1,this._style==="measure")return;const h=parseFloat(this._label.innerHTML);isNaN(h)?this._label.innerHTML=this._zoomValue+"%":this.dispatchEvent({type:"scaleBarEdited",message:h})}}_onFocus(b){this._background.style.opacity=this._colorSum>2?.8:.6,this._label.style.textOverflow="clip";const h=document.createRange(),r=window.getSelection();r.removeAllRanges(),h.selectNodeContents(this._label),r.addRange(h)}_onHover(b){this._fadeScaleBar(b.type==="pointerenter")}_fadeScaleBar(b){const h=b===!0?this._colorSum>2?.8:.6:.4;this._background.style.opacity=h}_init(b){this._element=document.createElement("div"),this._element.className="iptScaleBar",b.appendChild(this._element),this._bar=document.createElement("div"),this._bar.className="iptScaleBarLine",this._background=document.createElement("div"),this._background.style.transitionProperty="opacity",this._background.style.transitionDuration="2s",this._background.style.transitionTimingFunction="ease-in-out",this._background.className="iptBackground",this._label=document.createElement("div"),this._label.className="iptScaleBarLabel",b.appendChild(this._label),this._label.innerHTML="",this._element.appendChild(this._background),this._element.appendChild(this._bar),this._element.appendChild(this._label),this._label.addEventListener("keydown",this._onKeyPress.bind(this)),this._label.addEventListener("blur",this._onBlur.bind(this)),this._label.addEventListener("focus",this._onFocus.bind(this)),this._label.addEventListener("pointerenter",this._onHover.bind(this)),this._label.addEventListener("pointerleave",this._onHover.bind(this))}}},R,W),R.exports=I},855:(R,W,d)=>{var O,I;O=[d(40)],I=d.dj.d(O,function(f){return class{constructor(b){this._visible=!0,this._empty=!0,this._lines=null,this._init(b)}setVisible(b,h){this._visible=b,this._empty=h,this._update()}get visible(){return this._visible}setColor(b){b[0]+b[1]+b[2]>2?this._lines.material.color.setRGB(0,0,0):this._lines.material.color.setRGB(.8,.8,.8)}setPosition(b){const h=[b.max.x,b.max.y,b.max.z,b.min.x,b.max.y,b.max.z,b.min.x,b.min.y,b.max.z,b.max.x,b.min.y,b.max.z,b.max.x,b.max.y,b.min.z,b.min.x,b.max.y,b.min.z,b.min.x,b.min.y,b.min.z,b.max.x,b.min.y,b.min.z];this._lines.geometry.setAttribute("position",new f.Float32BufferAttribute(h,3))}_update(){this._visible&&!this._empty?this._lines.visible=!0:this._lines.visible=!1}_init(b){const h=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],o=new f.BufferGeometry;o.setIndex(new f.BufferAttribute(h,1)),o.setAttribute("position",new f.Float32BufferAttribute(r,3));const c=new f.LineBasicMaterial({color:8947848,toneMapped:!1,depthWrite:!1,depthTest:!0});this._lines=new f.LineSegments(o,c),this._lines.visible=!1,b.add(this._lines)}}},R,W),R.exports=I},6254:(R,W,d)=>{var O,I;O=[d(40),d(7402),d(7736)],I=d.dj.d(O,function(f,N,b){return class extends N{constructor(r,o){super(),this._mesh=null,this._scene=new f.Scene,this._camera=new f.OrthographicCamera(-1,1,1,-1,-1,0),this.clearColor=r,this.clearAlpha=o!==void 0?o:0,this._defaultGradientColor=new f.Color(36863),this._gradientDefines="#define USE_GRADIENT",this._useGradient=!0,this._needsUpdate=!1,this._init(r)}update(r,o,c){const u=new f.Color(r[0],r[1],r[2]),g=new f.Color(o[0],o[1],o[2]);this._needsUpdate=this._useGradient!==c,this.clearColor=u,this.clearAlpha=0,this._defaultGradientColor=g,this._mesh.material.uniforms.u_outerColor.value=u,this._mesh.material.uniforms.u_innerColor.value=g,this._useGradient=c,this._gradientDefines=this._useGradient===!0?"#define USE_GRADIENT":"",this._needsUpdate&&this._updateFragmentShader()}render(r,o,c,u){r.setRenderTarget(null),r.setClearColor(this.clearColor,1),r.render(this._scene,this._camera)}dispose(){this._mesh.material.dispose(),this._mesh.geometry.dispose()}reset(){this._init(this.clearColor)}_updateFragmentShader(){this._mesh.material.fragmentShader=this._getFragmentShader(),this._mesh.material.needsUpdate=!0}_getFragmentShader(){return[this._gradientDefines,this._shader.fragmentShader].join(`
`)}_init(r){const o=new f.PlaneGeometry(2,2,1);this._shader=b;const c=f.UniformsUtils.clone(this._shader.uniforms),u=new f.Color(r);c.u_outerColor.value=u,c.u_innerColor.value=this._defaultGradientColor;const g=new f.ShaderMaterial({depthTest:!1,depthWrite:!1,uniforms:c,vertexShader:this._shader.vertexShader,fragmentShader:this._getFragmentShader(),side:f.DoubleSide});this._mesh=new f.Mesh(o,g),this._mesh.frustumCulled=!1,this._scene.add(this._mesh)}}},R,W),R.exports=I},2081:(R,W,d)=>{var O,I;O=[],I=d.dj.d(O,function(){return{defines:{TOLERANCE:1e-6},uniforms:{u_compositeA:{value:null},u_compositeB:{value:null},u_premultiplyAlpha:{value:!0},u_depthA:{value:null},u_depthB:{value:null},nearClip:{value:0},farClip:{value:1}},vertexShader:`varying vec2 vUv;
        void main() {
            vUv = uv;
            gl_Position = vec4( position.xy, 0.0, 1.0 );
        }`,fragmentShader:`precision highp sampler2D;
        varying vec2 vUv;
        uniform sampler2D u_compositeA;
        uniform sampler2D u_compositeB;
        uniform bool u_premultiplyAlpha;

        #ifdef WRITE_DEPTH
            uniform sampler2D u_depthA;
            uniform sampler2D u_depthB;
            uniform float nearClip;
            uniform float farClip;

            float linearizeDepth(float depth) {

                if (isOrthographic) {
                    return depth;
                } else {
                    float z = depth * 2.0 - 1.0;
                    return (2.0 * nearClip * farClip) / (farClip + nearClip - z * (farClip - nearClip));
                }
                
            }
        #endif

        void main() {
            vec4 src = texture(u_compositeA,vUv);
            vec4 dst = texture(u_compositeB,vUv);

            gl_FragColor.a = src.a + (dst.a * (1.0 - src.a));

            // When premultiplied by alpha, the RGB color represents the emission
            // of the pixel and the alpha represents the occlusion. This allows for correct blending
            // and for fully transparent pixels not leaking color information.
            // Premultiplication reduces relative precision of the blend operation, and
            // color loss may occur if blending very transparent colors
            if (u_premultiplyAlpha) {

                // Premultiply colors by alpha
                src.rgb = src.rgb * src.a;
                dst.rgb = dst.rgb * dst.a;

                // Composite premultiplied colors
                gl_FragColor.rgb = src.rgb + (dst.rgb * (1.0 - src.a));

                // Revert alpha multiplication
                gl_FragColor.rgb = gl_FragColor.rgb / gl_FragColor.a;

            } else {
                // Blend without premultiplication
                gl_FragColor.rgb = src.rgb + (dst.rgb * (1.0 - src.a));
            }

            #ifdef WRITE_DEPTH

                float depthA = linearizeDepth( texture(u_depthA,vUv).x );
                float depthB = linearizeDepth( texture(u_depthB,vUv).x );

                float finalDepth = 0.0;

                float maxDepth = max(depthA,depthB);
                float minDepth = min(depthA,depthB);

                if (maxDepth > TOLERANCE) {
                    finalDepth = mix(maxDepth, minDepth, float(minDepth > TOLERANCE));
                }

                if (isOrthographic) {
                    gl_FragDepth = finalDepth;
                } else {
                    gl_FragDepth = (2.0 * nearClip) / (farClip + nearClip - finalDepth * (farClip - nearClip));
                }

            #endif
        }`}},R,W),R.exports=I},1135:(R,W,d)=>{var O,I;O=[d(40),d(7402),d(4314),d(7359)],I=d.dj.d(O,function(f,N,b,h){return class extends N{constructor(){super(),this._denoise=!1,this.reset()}render(o,c,u,g,m,y){y===void 0?o.setRenderTarget(null):o.setRenderTarget(y),this._uniforms.tDiffuse.value=u.texture,this._uniforms.tDepth.value=g.texture,this._uniforms.screenRectangle.value=m.u_screenRectangle.value,this._quad.render(o)}blend(o,c,u,g,m,y,x){x===void 0?o.setRenderTarget(null):o.setRenderTarget(x),this._uniforms.tDiffuse.value=u.texture,this._uniforms.tDepth.value=g.texture,this._uniforms.tDeferred.value=m.texture,this._uniforms.tDeferredDepth.value=m.depthTexture,this._uniforms.screenRectangle.value=y.u_screenRectangle.value,this._blendQuad.render(o)}reset(){this._shader=h,this._uniforms=f.UniformsUtils.clone(this._shader.uniforms),this._material=new f.ShaderMaterial({transparent:!0,defines:Object.assign({USE_RECTANGLE:1,USE_DEPTH:1,UNPACK_DEPTH:1},this._shader.defines),uniforms:this._uniforms,depthTest:!0,depthWrite:!0,depthFunc:f.AlwaysDepth,vertexShader:this._shader.vertexShader,fragmentShader:this._getFragmentShader()}),this._blendMaterial=new f.ShaderMaterial({transparent:!0,defines:Object.assign({USE_RECTANGLE:1,USE_DEPTH:1,UNPACK_DEPTH:1},this._shader.defines),uniforms:this._uniforms,depthTest:!0,depthWrite:!0,depthFunc:f.AlwaysDepth,vertexShader:this._shader.vertexShader,fragmentShader:this._getBlendFragmentShader()}),this._quad=new b(this._material),this._blendQuad=new b(this._blendMaterial)}setDenoising(o,c,u){const g=this._denoise;this._denoise=o,this._uniforms.spatialSigma.value=c,this._uniforms.degreeOfSmoothing.value=u,this._denoise!==g&&this._updateFragmentShader()}_updateFragmentShader(){this._material.fragmentShader=this._getFragmentShader(),this._blendMaterial.fragmentShader=this._getBlendFragmentShader(),this._material.needsUpdate=!0,this._blendMaterial.needsUpdate=!0}_getFragmentShader(){return[this._denoise===!0?"#define DENOISE":"",this._shader.fragmentShader].join(`
`)}_getBlendFragmentShader(){return[this._denoise===!0?"#define DENOISE":"","#define BLEND_DEFERRED",this._shader.fragmentShader].join(`
`)}dispose(){this._material.dispose(),this._quad.dispose(),this._blendMaterial.dispose(),this._blendQuad.dispose()}}},R,W),R.exports=I},7359:(R,W,d)=>{var O,I;O=[d(40)],I=d.dj.d(O,function(f){return{uniforms:{tDiffuse:{value:null},tDepth:{value:null},tDeferred:{value:null},tDeferredDepth:{value:null},opacity:{value:.618},screenRectangle:{value:new f.Vector4(0,0,1,1)},degreeOfSmoothing:{value:.05},spatialSigma:{value:3}},vertexShader:`
        varying vec2 vUv;

        void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        precision highp sampler2D;
        #define INV_PI 0.31830988618379067153776752674503
        #define INV_SQRT2PI 0.39894228040143267793994605993439
        #define TOLERANCE 0.000001

        #ifdef BLEND_DEFERRED
            uniform sampler2D tDeferred;
            uniform sampler2D tDeferredDepth;
        #endif

        uniform float opacity;
        uniform sampler2D tDiffuse;

        #ifdef USE_RECTANGLE
            uniform vec4 screenRectangle;
        #endif

        #ifdef USE_DEPTH
            uniform sampler2D tDepth;
        #endif

        #ifdef DENOISE
            uniform float degreeOfSmoothing;
            uniform float spatialSigma;
        #endif

        varying vec2 vUv;

        const float UnpackDownscale = 255. / 256.;
        const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
        const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );

        #ifdef DENOISE
        vec4 denoise (vec4 centerPixel) {
            // Simplified version of bilateral filter. Precompute constants used
            // for approximating the gaussian kernel
            float sigmaSquared = spatialSigma * spatialSigma;
            float invSigma = 0.5 / sigmaSquared;
            float invSigma2PI = INV_PI * invSigma;
            float invThresholdSquared = 0.5 / (degreeOfSmoothing * degreeOfSmoothing);
            float invThresholdSqrt2PI = INV_SQRT2PI / degreeOfSmoothing;
            
            // Values used to compute final color
            float weightSum = 0.0;
            vec4 denoisedColor = vec4(0.0);
            #ifdef BLEND_DEFERRED
                vec2 size = vec2(textureSize( tDeferred, 0 ));
            #else
                vec2 size = vec2(textureSize( tDiffuse, 0 ));
            #endif
            
            for (float row = -spatialSigma; row <= spatialSigma; row++) {

                float pt = sqrt( sigmaSquared - row * row );

                for (float color = -pt; color <= pt; color++) {

                    vec2 d = vec2( row, color );
                    float blurFactor = exp( -dot( d, d ) * invSigma ) * invSigma2PI; 
                    
                    #ifdef BLEND_DEFERRED
                        vec4 neighborPixel =  texture( tDeferred, vUv+d / size );
                    #else
                        vec4 neighborPixel =  texture( tDiffuse, vUv+d / size );
                    #endif

                    vec4 diffVector = neighborPixel - centerPixel;
                    float intensityWeight = exp( -dot( diffVector, diffVector ) * invThresholdSquared) * blurFactor * INV_SQRT2PI / degreeOfSmoothing;
                                        
                    weightSum += intensityWeight;
                    denoisedColor += intensityWeight * neighborPixel;
                }
            }
            return denoisedColor / weightSum;
        }
        #endif

        float unpackRGBAToDepth( const in vec4 v ) {
            return dot( v, UnpackFactors );
        }

        void main () {
            #ifdef USE_DEPTH
                #ifdef UNPACK_DEPTH
                    float depth = unpackRGBAToDepth( texture2D( tDepth, vUv ) );
                #else
                    float depth = texture2D( tDepth, vUv ).x;
                #endif
            #endif

            #ifdef BLEND_DEFERRED

                float deferredDepth = texture2D( tDeferredDepth, vUv ).x;

                vec4 sceneColor = texture2D( tDiffuse, vUv );
                vec4 deferredColor = texture2D( tDeferred, vUv );
                vec4 color = vec4(0.0);

                #ifdef DENOISE
                    deferredColor = denoise(deferredColor);
                #endif

                // Premultiply colors
                sceneColor.rgb = sceneColor.rgb * sceneColor.a;
                deferredColor.rgb = deferredColor.rgb * deferredColor.a;

                if (deferredDepth > depth + TOLERANCE) {
                    // Render scene on top, composite premultiplied colors
                    color.rgb = sceneColor.rgb + (deferredColor.rgb * (1.0 - sceneColor.a));
                    color.a = sceneColor.a + (deferredColor.a * (1.0 - sceneColor.a));
                } else {
                    // Render deferred on top, composite premultiplied colors
                    color.rgb = deferredColor.rgb + (sceneColor.rgb * (1.0 - deferredColor.a));
                    color.a = deferredColor.a + (sceneColor.a * (1.0 - deferredColor.a));
                }

                color.rgb = color.rgb / color.a;

            #else

                vec4 color = texture2D( tDiffuse, vUv );
                #ifdef DENOISE
                    color = denoise(color);
                #endif

            #endif

            #ifdef USE_RECTANGLE
                float outsideRectangle = float(vUv.x < screenRectangle.x || vUv.y < screenRectangle.y || vUv.x > screenRectangle.z || vUv.y > screenRectangle.w);
                float appliedOpacity = 1.0 - (outsideRectangle * (1.0 - opacity));

                color.a *= appliedOpacity;
                gl_FragColor = color;                
            #else
                #ifdef USE_SSAA
                    // Used for applying supersampling antialiasing. The opacity is the weight of each pass
                    // and passes will be accumulated as an additive operation
                    gl_FragColor = color * opacity;
                #else
                    color.a *= opacity;
                    gl_FragColor = color;
                #endif
            #endif
            #ifdef USE_DEPTH
                gl_FragDepth = depth;
            #endif
        }`}},R,W),R.exports=I},6314:(R,W,d)=>{var O,I;O=[d(40),d(7402),d(4314),d(2081),d(7359),d(4194)],I=d.dj.d(O,function(f,N,b,h,r,o){return class extends N{constructor(u,g){super(),this._scene=u,this._overviewScene=g,this.compositeStyle="stencil",this.clearRequired=!1,this.reset()}render(u,g,m,y,x,w,C,P){switch(this.compositeStyle){case"direct":y.u_deferredTexture.value=null,u.setRenderTarget(m),u.render(this._scene,g);break;case"composite":y.u_deferredTexture.value=null,u.setRenderTarget(x),u.setClearColor(0,0),u.clear(),u.render(this._scene,g),u.setRenderTarget(C),u.setClearColor(0,0),u.clear(),this._uniforms.tDiffuse.value=m.texture,this._uniforms.tDepth.value=m.depthTexture,this._quad.render(u),this._compositeUniforms.u_compositeA.value=C.texture,this._compositeUniforms.u_compositeB.value=x.texture,this._compositeUniforms.u_depthA.value=C.depthTexture,this._compositeUniforms.u_depthB.value=x.depthTexture,this._compositeUniforms.farClip.value=g.far,this._compositeUniforms.nearClip.value=g.near,u.setRenderTarget(m),u.setClearColor(0,0),u.clear(),this._compositeQuad.render(u);break;case"stencil":y.u_deferredTexture.value=m.texture,this._stencil(u,g,m,y,P,x,w,!0);break;case"twopass":this.clearRequired===!0&&(u.setRenderTarget(x),u.setClearColor(0,0),u.clear(),this.clearRequired=!1),y.u_deferredTexture.value=x.texture,y.u_passNumber.value=0,this._stencil(u,g,m,y,P,w,!0),y.u_passNumber.value=2,this._stencil(u,g,x,y,P,w,!1),y.u_passNumber.value=0;break}}renderOverview(u,g,m,y){u.setRenderTarget(m),u.setClearColor(0,0),u.clear(),u.render(this._overviewScene,g)}_stencil(u,g,m,y,x,w,C){const P=u.getContext();u.setRenderTarget(x),u.setClearColor(0,0),u.clear(),P.enable(P.STENCIL_TEST),P.stencilOp(P.KEEP,P.KEEP,P.REPLACE),P.stencilFunc(P.ALWAYS,1,255),u.render(this._scene,g),C===!0&&(P.disable(P.STENCIL_TEST),u.setRenderTarget(w),this._maskUniforms.tDiffuse.value=x.texture,this._maskUniforms.threshold.value=.05,this._maskQuad.render(u),u.setRenderTarget(x),P.enable(P.STENCIL_TEST)),P.stencilFunc(P.EQUAL,0,255),P.stencilOp(P.KEEP,P.KEEP,P.KEEP),this._stencilUniforms.tDiffuse.value=m.texture,this._stencilQuad.render(u),P.disable(P.STENCIL_TEST),u.setRenderTarget(m),u.setClearColor(0,0),u.clear(),this._stencilUniforms.tDiffuse.value=x.texture,this._stencilQuad.render(u)}reset(){const u=h;this._compositeUniforms=f.UniformsUtils.clone(u.uniforms),this._compositeMaterial=new f.ShaderMaterial({transparent:!0,defines:Object.assign({WRITE_DEPTH:1},u.defines),uniforms:this._compositeUniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,blending:f.NoBlending,depthTest:!0,depthFunc:f.AlwaysDepth,depthWrite:!0}),this._compositeQuad=new b(this._compositeMaterial);const g=r;this._uniforms=f.UniformsUtils.clone(g.uniforms),this._uniforms.opacity.value=1,this._material=new f.ShaderMaterial({transparent:!0,defines:Object.assign({USE_DEPTH:1},g.defines),uniforms:this._uniforms,vertexShader:g.vertexShader,fragmentShader:g.fragmentShader,blending:f.NoBlending,depthTest:!0,depthFunc:f.AlwaysDepth,depthWrite:!0}),this._quad=new b(this._material);const m=r;this._stencilUniforms=f.UniformsUtils.clone(m.uniforms),this._stencilUniforms.opacity.value=1,this._stencilMaterial=new f.ShaderMaterial({transparent:!0,defines:Object.assign({},m.defines),uniforms:this._stencilUniforms,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,blending:f.NoBlending}),this._stencilQuad=new b(this._stencilMaterial);const y=o;this._maskUniforms=f.UniformsUtils.clone(y.uniforms),this._maskMaterial=new f.ShaderMaterial({transparent:!0,defines:Object.assign({},y.defines),uniforms:this._maskUniforms,vertexShader:y.vertexShader,fragmentShader:y.fragmentShader,blending:f.NoBlending}),this._maskQuad=new b(this._maskMaterial)}dispose(){this._material.dispose(),this._quad.dispose(),this._compositeMaterial.dispose(),this._compositeQuad.dispose(),this._stencilMaterial.dispose(),this._stencilQuad.dispose()}}},R,W),R.exports=I},9327:(R,W,d)=>{var O,I;O=[d(40),d(9546),d(3247),d(4314)],I=d.dj.d(O,function(f,N,b,h){return class extends N{constructor(o){super(),this._depthScene=o,this._bufferRequired=!0,this._peelRequired=!1,this._separatePassRequired=!1,this.clearBuffer=!0,this.reset()}render(o,c,u,g,m,y,x,w,C){!this._peelRequired&&!this._bufferRequired||(c.layers.enable(17),(this._peelRequired||this._separatePassRequired)&&(g.u_passNumber.value=0,o.setRenderTarget(w),this.clearBuffer&&o.clear(),o.render(this._depthScene,c)),o.setRenderTarget(C),this.clearBuffer&&(o.setClearColor(16777215,1),o.clear()),this._peelRequired||this._separatePassRequired?this._depthUniforms.tDiffuse.value=w.depthTexture:this._depthUniforms.tDiffuse.value=u.depthTexture,this._quad.render(o),c.layers.disable(17))}updateForPeel(o){this._peelRequired=o,this.enabled=this._peelRequired||this._bufferRequired}updateForBuffer(o,c){this._bufferRequired=o,this._separatePassRequired=c,this.enabled=this._peelRequired||this._bufferRequired}reset(){const o=b;this._depthUniforms=f.UniformsUtils.clone(o.uniforms),this._depthMaterial=new f.ShaderMaterial({uniforms:this._depthUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,depthTest:!0,depthWrite:!0,premultipliedAlpha:!0,transparent:!0,blending:f.NoBlending}),this._quad=new h(this._depthMaterial)}}},R,W),R.exports=I},4893:(R,W,d)=>{var O,I;O=[d(40),d(7402),d(4314),d(2081),d(3247)],I=d.dj.d(O,function(f,N,b,h,r){return class extends N{constructor(c,u,g,m,y){super(),this._scene=c,this._depthScene=u,this.maxPasses=100,this.useExitCondition=!0,this.exitCheckPeriod=3,this.exitTolerance=1e-4,this.viewDepth=0,this.minPasses=1e6,this.reset(g,m,y)}render(c,u,g,m,y,x,w,C){let P=Math.min(this.maxPasses,this.minPasses),T=this.useExitCondition&&this.minPasses>1e6,M=!1,z=0,Y=!0;this.viewDepth!==0&&(T=!1,P=this.viewDepth);const X=c.getClearColor,S=c.getClearAlpha;c.setClearColor(0,0),m.u_passNumber.value=1,m.u_depthTexture.value=C.depthTexture;const F=[y,x];c.setRenderTarget(F[0]),c.clear(),c.setRenderTarget(F[1]),c.clear(),P===1?c.setRenderTarget(g):T&&this._updateTextureCache(w.width*w.height),c.render(this._scene,u);for(let k=1;k<P;k++){const G=(k-1)%2,H=k%2;if(k===P-1&&(M=!0),c.setRenderTarget(this._depthRenderTarget),c.clear(),this._depthUniforms.tDiffuse.value=C.depthTexture,this._quad.render(c),m.u_previousTexture.value=this._depthRenderTarget.depthTexture,c.setRenderTarget(C),c.clear(),m.u_passNumber.value=2,c.render(this._depthScene,u),m.u_passNumber.value=1,m.u_depthTexture.value=C.depthTexture,c.setRenderTarget(w),c.clear(),c.render(this._scene,u),M?c.setRenderTarget(g):(c.setRenderTarget(F[G]),c.clear()),this._uniforms.u_compositeA.value=F[H].texture,this._uniforms.u_compositeB.value=w.texture,this._uniforms.u_premultiplyAlpha.value=this.minPasses<1e6,this._compositeQuad.render(c),M)break;if(T&&k%this.exitCheckPeriod===0){Y?c.readRenderTargetPixels(F[G],0,0,F[G].width,F[G].height,this._bufferA):c.readRenderTargetPixels(F[G],0,0,F[G].width,F[G].height,this._bufferB),Y=!Y,z=0;for(let q=0;q<this._bufferA.length/4;q++)(this._bufferA[q*4]!==this._bufferB[q*4]||this._bufferA[q*4+1]!==this._bufferB[q*4+1]||this._bufferA[q*4+2]!==this._bufferB[q*4+2]||this._bufferA[q*4+3]!==this._bufferB[q*4+3])&&(z=z+1);z/this._bufferA.length<this.exitTolerance&&(M=!0)}else T&&(k-1)%this.exitCheckPeriod===0&&(Y?c.readRenderTargetPixels(F[G],0,0,F[G].width,F[G].height,this._bufferA):c.readRenderTargetPixels(F[G],0,0,F[G].width,F[G].height,this._bufferB),Y=!Y)}this.viewDepth===0&&(m.u_depthTexture.value=null,m.u_previousTexture.value=null),m.u_passNumber.value=0,c.setClearColor(X,S)}setSize(c,u){this._depthRenderTarget.setSize(c,u)}dispose(){this._depthRenderTarget.dispose(),this._material.dispose(),this._depthMaterial.dispose(),this._quad.dispose(),this._compositeQuad.dispose()}reset(c,u,g){this._bufferA=[],this._bufferB=[],this._depthRenderTarget=new f.WebGLRenderTarget(u,g,{minFilter:f.LinearFilter,magFilter:f.LinearFilter,format:f.RGBAFormat,generateMipmaps:!1,stencilBuffer:!1,depthBuffer:!0}),this._depthRenderTarget.depthTexture=new f.DepthTexture,this._depthRenderTarget.depthTexture.type=f.FloatType;const m=h;this._uniforms=f.UniformsUtils.clone(m.uniforms),this._material=new f.ShaderMaterial({uniforms:this._uniforms,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blending:f.NoBlending}),this._compositeQuad=new b(this._material);const y=r;this._depthUniforms=f.UniformsUtils.clone(y.uniforms),this._depthUniforms.u_depthTexture=c.u_depthTexture,this._depthMaterial=new f.ShaderMaterial({uniforms:this._depthUniforms,vertexShader:y.vertexShader,fragmentShader:y.fragmentShader,depthTest:!0,depthWrite:!0}),this._quad=new b(this._depthMaterial)}_updateTextureCache(c){c*4!==this._bufferA.length?(this._bufferA=new Uint8Array(c*4),this._bufferB=new Uint8Array(c*4)):this._bufferB.fill(0)}}},R,W),R.exports=I},3247:(R,W,d)=>{var O,I;O=[],I=d.dj.d(O,function(){return{uniforms:{tDiffuse:{value:null}},vertexShader:`
        varying vec2 vUv;

        void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        uniform sampler2D tDiffuse;
        varying vec2 vUv;

        vec4 packDepthToRGBA( float depth ) {
            vec3 packFactors = vec3( 256.0 * 256.0 * 256.0, 256.0 * 256.0,  256.0 );
            float shiftRight8 = 1.0 / 256.0; // Handle overflow
            float packUpscale = 256.0 / 255.0; // fraction -> 0..1 (including 1)
            
            vec4 rgba = vec4( fract(depth * packFactors), depth);
            rgba.yzw -= rgba.xyz * shiftRight8;
            return rgba * packUpscale;
        }

        void main() {
            float depth = texture( tDiffuse, vUv ).x;
            if (depth == 1.0) {
                discard;
            }
            gl_FragColor = packDepthToRGBA( depth );
            gl_FragDepth = depth;
        }`}},R,W),R.exports=I},9546:(R,W,d)=>{var O,I;O=[d(40),d(7402),d(4314),d(1202)],I=d.dj.d(O,function(f,N,b,h){return class extends N{constructor(){super(),this.reset()}render(o,c,u,g){this._uniforms.tDiffuse.value=g.u_depthTexture.value,this._uniforms.cameraNear.value=c.near,this._uniforms.cameraFar.value=c.far,this._uniforms.isOrthographic.value=c.isOrthographicCamera===!0?1:0,o.setRenderTarget(u),o.clear(),this._quad.render(o),g.u_depthTexture.value=null,g.u_previousTexture.value=null}dispose(){this._material.dispose(),this._quad.dispose()}reset(){const o=h;this._uniforms=f.UniformsUtils.clone(o.uniforms),this._material=new f.ShaderMaterial({uniforms:this._uniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader}),this._quad=new b(this._material)}}},R,W),R.exports=I},1202:(R,W,d)=>{var O,I;O=[],I=d.dj.d(O,function(){return{uniforms:{tDiffuse:{value:null},cameraNear:{value:0},cameraFar:{value:1},isOrthographic:{value:!0}},vertexShader:`
        varying vec2 vUv;

        void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        uniform sampler2D tDiffuse;
        uniform float cameraNear;
        uniform float cameraFar;
        varying vec2 vUv;

        float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
            return ( viewZ + near ) / ( near - far );
        }

        float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
            return ( near * far ) / ( ( far - near ) * invClipZ - far );
        }

        float readDepth() {
            float fragCoordZ = texture2D( tDiffuse, vUv ).x;
            if ( isOrthographic ) {
                return fragCoordZ;
            } else {
                float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );
                return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );
            }
        }

        void main() {
            gl_FragColor = vec4( 1.0 - vec3( readDepth() ), 1.0 );
        }`}},R,W),R.exports=I},3289:(R,W,d)=>{var O,I;O=[d(40),d(7402),d(4314),d(9472),d(6230)],I=d.dj.d(O,function(f,N,b,h,r){return class extends N{constructor(c){super(),this._scene=c,this.numPasses=100,this.currentPass=1,this.reset()}render(c,u,g,m,y,x,w,C){if(!this.enabled){this.currentPass=this.numPasses;return}const P=m.u_primaryLight.value;this._enableLayer(u,1,16);const T=m.u_primaryLight.value.clone(),M=m.u_primaryLightIntensity;m.u_primaryLight.value=T;const z=new f.Vector3;z.subVectors(P,m.u_cameraTarget.value),this._setRandomLightPosition(T,z,m),this.currentPass===1&&(c.setRenderTarget(x),c.setClearColor(0,0),c.clear(),c.setRenderTarget(w),c.setClearColor(0,0),c.clear(),c.setRenderTarget(y),c.setClearColor(0,0),c.clear(),c.render(this._scene,u),this._packedLightUniforms.lightColor.value=m.u_lightColor.value,this._packedLightUniforms.ambientStrength.value=m.u_ambientStrength.value),m.u_passNumber.value=4,c.setRenderTarget(C),c.setClearColor(0,0),c.clear(),c.render(this._scene,u);const Y=this.currentPass%2;Y===1?(c.setRenderTarget(x),this._uniforms.accumulatedLightMap.value=w.texture):(c.setRenderTarget(w),this._uniforms.accumulatedLightMap.value=x.texture);const X=1/this.currentPass;this._uniforms.newLightMap.value=C.texture,this._uniforms.weight.value=X,this._quad.render(c),c.setRenderTarget(g),c.setClearColor(0,0),c.clear(),this._packedLightUniforms.tDiffuse.value=y.texture,this._packedLightUniforms.tDepth.value=y.depthTexture,Y===1?this._packedLightUniforms.lightMap.value=x.texture:this._packedLightUniforms.lightMap.value=w.texture,this._packedLightQuad.render(c),this.currentPass<this.numPasses&&(this.currentPass=this.currentPass+1),m.u_primaryLight.value=P,m.u_primaryLightIntensity=M,m.u_passNumber.value=0,this._disableLayer(u,1,16)}reset(){const c=h;this._uniforms=f.UniformsUtils.clone(c.uniforms),this._material=new f.ShaderMaterial({defines:Object.assign({},c.defines),uniforms:this._uniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:f.NoBlending,depthTest:!1,depthWrite:!1}),this._quad=new b(this._material);const u=r;this._packedLightUniforms=f.UniformsUtils.clone(u.uniforms),this._lightMaterial=new f.ShaderMaterial({defines:Object.assign({},u.defines),uniforms:this._packedLightUniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:f.NormalBlending,depthTest:!0,depthFunc:f.AlwaysDepth,depthWrite:!0}),this._packedLightQuad=new b(this._lightMaterial)}dispose(){this._material.dispose(),this._quad.dispose(),this._lightMaterial.dispose(),this._packedLightQuad.dispose()}_setRandomLightPosition(c,u,g){const m=this._getTotalIntensity(g);if(this.currentPass>1){const y=Math.random();let x=0;for(let w=0;w<g.lights.length;w++)if(g.lights[w].enabled&&(x+=g.lights[w].intensity/m.total,y<=x)){c.copy(g.lights[w].position),this._findLocationOnLight(c,u.length()*g.lights[w].size),g.u_primaryLightIntensity.value=m.primary;break}}else c.copy(g.lights[m.primaryIdx].position),g.u_primaryLightIntensity.value=g.lights[m.primaryIdx].intensity}_getTotalIntensity(c){let u=0,g=-1,m=0;for(let y=0;y<c.lights.length;y++)c.lights[y].enabled&&(m+=c.lights[y].intensity,c.lights[y].intensity>g&&(u=y,g=c.lights[y].intensity));return{total:m,primaryIdx:u,primary:g}}_findLocationOnLight(c,u){const g=this._randomVector();g.setLength(u),c.add(g)}_randomVector(){const c=(Math.random()-.5)*2,u=Math.random()*Math.PI*2,g=Math.sqrt(1-c**2);return new f.Vector3(g*Math.cos(u),g*Math.sin(u),c)}}},R,W),R.exports=I},9472:(R,W,d)=>{var O,I;O=[],I=d.dj.d(O,function(){return{uniforms:{accumulatedLightMap:{value:null},newLightMap:{value:null},weight:{value:1}},vertexShader:`
        varying vec2 vUv;

        void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        uniform float weight;
        uniform sampler2D accumulatedLightMap;
        uniform sampler2D newLightMap;
        varying vec2 vUv;

        const float packFactors = 256.0;
        const float shiftRight8 = 1.0 / 256.0;
        const float packUpscale = 256.0 / 255.0;
        const float unpackDownscale = 255.0 / 256.0;
        const vec2 unpackFactors = unpackDownscale / vec2( packFactors, 1.0 );

        vec4 packVec2ToRGBA( vec2 vals ) {
            vec4 rgba = vec4(fract(vals.x * packFactors), vals.x, fract(vals.y * packFactors), vals.y);
            rgba.g -= rgba.r * shiftRight8;
            rgba.a -= rgba.b * shiftRight8;
            return rgba * packUpscale;
        }

        vec2 unpackRGBAToVec2( vec4 rgba ) {
            return vec2(dot(rgba.xy, unpackFactors), dot(rgba.zw, unpackFactors));
        }

        void main() {

            // Read accumulated light map
            vec2 texel = unpackRGBAToVec2( texture2D( accumulatedLightMap, vUv ) );

            // Read new light map
            vec2 light = unpackRGBAToVec2( texture2D( newLightMap, vUv ) );

            // Find difference in light strength between new and accumulared light map
            vec2 color = light - texel;

            // Add the difference to the existing light map, scaled by the weight to
            // account for a cumulative average
            gl_FragColor = packVec2ToRGBA( texel + (color * weight) );

        }`}},R,W),R.exports=I},6230:(R,W,d)=>{var O,I;O=[d(40)],I=d.dj.d(O,function(f){return{uniforms:{tDiffuse:{value:null},lightColor:{value:new f.Vector4(1,1,1,1)},lightMap:{value:null},tDepth:{value:null},ambientStrength:{value:.3}},vertexShader:`
        varying vec2 vUv;

        void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        uniform sampler2D tDiffuse;
        uniform sampler2D tDepth;
        uniform float ambientStrength;
        uniform sampler2D lightMap;
        uniform vec4 lightColor;
        varying vec2 vUv;

        const float packFactors = 256.0;
        const float unpackDownscale = 255.0 / 256.0;
        const vec2 unpackFactors = unpackDownscale / vec2( packFactors, 1.0 );

        vec2 unpackRGBAToVec2( vec4 rgba ) {
            return vec2(dot(rgba.xy, unpackFactors), dot(rgba.zw, unpackFactors));
        }

        void main() {

            vec4 color = texture2D( tDiffuse, vUv );

            vec2 texel = unpackRGBAToVec2( texture2D( lightMap, vUv ) );
            float lambertTerm = texel.x;
            float specularTerm = texel.y;

            vec4 ambientColor = lightColor * ambientStrength;
            vec4 diffuseColor = lightColor * lambertTerm;
            vec4 specularColor = lightColor * specularTerm * lambertTerm;

            // Calculate final color by combining different components
            // Some implementations sum all three light components before multiplying
            // with the color. This keeps the color from getting saturated. If we
            // pull out the specularColor term and add it later, it can create a
            // color lighter than the original color, giving a glossy effect.
            vec4 finalColor = ( color * (ambientColor + diffuseColor) + specularColor );

            // Keep the previous transparency
            finalColor.a = color.a;
            gl_FragColor = finalColor;
            gl_FragDepth = texture2D( tDepth, vUv ).x;

        }`}},R,W),R.exports=I},4194:(R,W,d)=>{var O,I;O=[],I=d.dj.d(O,function(){return{uniforms:{tDiffuse:{value:null},threshold:{value:.05}},vertexShader:`
        varying vec2 vUv;

        void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        uniform float threshold;
        uniform sampler2D tDiffuse;
        varying vec2 vUv;

        void main() {
            vec4 texel = texture2D( tDiffuse, vUv );
            if ( texel.a < threshold ) {
                discard;
            }
            gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }`}},R,W),R.exports=I},6694:(R,W,d)=>{var O,I;O=[d(40),d(7402),d(4314),d(1966)],I=d.dj.d(O,function(f,N,b,h){return class extends N{constructor(o){super(),this.reset(),this.initialized=!1,this.activated=!1,this.clearRequired=!1,this._uniforms.currentLocation.value=o.u_currentPosition.value,this._uniforms.u_viewportSize.value=o.u_viewportSize.value}render(o,c,u,g,m,y,x){this.activated?(o.setRenderTarget(m),this._uniforms.tDepth.value=g.texture,this.initialized||this._uniforms.priorLocation.value.copy(y.u_currentPosition.value),this._quad.render(o),this._uniforms.priorLocation.value.copy(y.u_currentPosition.value),this.initialized=!0,this._setRenderTarget(o,x),this._uniforms.tDiffuse.value=m.texture,this._blendQuad.render(o)):this.initialized?(this._setRenderTarget(o,x),this._uniforms.tDiffuse.value=m.texture,this._blendQuad.render(o)):(this._setRenderTarget(o,x),this._uniforms.tDepth.value=g.texture,this._hoverQuad.render(o))}reset(){this._shader=h,this._uniforms=f.UniformsUtils.clone(this._shader.uniforms),this._material=new f.ShaderMaterial({transparent:!0,defines:Object.assign({USE_DEPTH:1,UNPACK_DEPTH:1},this._shader.defines),uniforms:this._uniforms,depthTest:!1,depthWrite:!1,vertexShader:this._shader.vertexShader,fragmentShader:this._shader.fragmentShader}),this._quad=new b(this._material),this._blendMaterial=new f.ShaderMaterial({transparent:!0,defines:Object.assign({APPLY_ACCUMULATION:1},this._shader.defines),uniforms:this._uniforms,depthTest:!1,depthWrite:!1,vertexShader:this._shader.vertexShader,fragmentShader:this._shader.fragmentShader}),this._blendQuad=new b(this._blendMaterial),this._hoverMaterial=new f.ShaderMaterial({transparent:!0,defines:Object.assign({USE_DEPTH:1,UNPACK_DEPTH:1,ON_HOVER:1},this._shader.defines),uniforms:this._uniforms,depthTest:!1,depthWrite:!1,vertexShader:this._shader.vertexShader,fragmentShader:this._shader.fragmentShader}),this._hoverQuad=new b(this._hoverMaterial)}_setRenderTarget(o,c){c===void 0?o.setRenderTarget(null):o.setRenderTarget(c)}initialize(o,c,u){this._uniforms.color.value.fromArray(o),this._uniforms.opacity.value=c,this._uniforms.brushSize.value=u}dispose(){this._material.dispose(),this._quad.dispose(),this._blendMaterial.dispose(),this._blendQuad.dispose(),this._hoverMaterial.dispose(),this._hoverQuad.dispose()}}},R,W),R.exports=I},1966:(R,W,d)=>{var O,I;O=[d(40)],I=d.dj.d(O,function(f){return{uniforms:{tDiffuse:{value:null},tDepth:{value:null},color:{value:new f.Vector3(1,1,1)},opacity:{value:.3141},brushSize:{value:15},currentLocation:{value:new f.Vector2(0,0)},priorLocation:{value:new f.Vector2(0,0)},u_viewportSize:{value:new f.Vector2(1,1)}},vertexShader:`
        varying vec2 vUv;

        void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        precision highp sampler2D;
        #define TOLERANCE 0.000001

        #ifdef USE_DEPTH
            uniform sampler2D tDepth;
        #endif

        #ifdef APPLY_ACCUMULATION
            uniform sampler2D tDiffuse;
        #endif

        uniform float opacity;
        uniform vec3 color;  
        uniform float brushSize;

        uniform vec2 currentLocation;
        uniform vec2 priorLocation;
        uniform vec2 u_viewportSize;

        varying vec2 vUv;

        const float UnpackDownscale = 255. / 256.;
        const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
        const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );

        float unpackRGBAToDepth( const in vec4 v ) {
            return dot( v, UnpackFactors );
        }

        float distanceSquared(vec2 pointA, vec2 pointB) {
            vec2 dist = pointA - pointB;
            return dot(dist, dist);
        }

        float pointLineDistanceSquared(vec2 point, vec2 lineStart, vec2 lineEnd) {
            vec2 line = lineEnd - lineStart + 1e-10;
            vec2 toPoint = point - lineStart;
            float t = max(0.0, min(1.0, dot(toPoint, line) / dot(line, line)));
            vec2 projection = lineStart + t * line;
            return distanceSquared(projection, point);
        }

        void main () {

            #ifdef USE_DEPTH
                #ifdef UNPACK_DEPTH
                    float depth = unpackRGBAToDepth( texture2D( tDepth, vUv ) );
                #else
                    float depth = texture2D( tDepth, vUv ).x;
                #endif

                #ifdef ON_HOVER
                    float depthFactor = 1.0 - (0.5 * float(depth > 1.0 - TOLERANCE));
                #else
                    float depthFactor = 1.0 - float(depth > 1.0 - TOLERANCE);
                #endif
            #else
                float depthFactor = 1.0;
            #endif

            #ifdef APPLY_ACCUMULATION
                float mixFactor = texture2D( tDiffuse, vUv ).x;
                vec4 appliedColor = vec4(color, opacity);
            #else
                #ifdef ON_HOVER
                    float distSq = distanceSquared(gl_FragCoord.xy, currentLocation * u_viewportSize);
                    vec4 appliedColor = vec4(color, opacity * depthFactor);
                #else
                    float distSq = pointLineDistanceSquared(gl_FragCoord.xy, currentLocation * u_viewportSize, priorLocation * u_viewportSize);
                    vec4 appliedColor = vec4(depthFactor);
                #endif

                float mixFactor = step(distSq, brushSize * brushSize);
            #endif

            gl_FragColor = mix(vec4(0.0, 0.0, 0.0, 0.0), appliedColor, mixFactor);
        }`}},R,W),R.exports=I},7402:(R,W,d)=>{var O,I;O=[],I=d.dj.d(O,function(){return class{constructor(){this.enabled=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){}reset(){}_enableLayer(N,b,h){N.layers.disable(0),N.layers.disable(b),N.layers.enable(b+h)}_disableLayer(N,b,h){N.layers.enable(0),N.layers.enable(b),N.layers.disable(b+h)}}},R,W),R.exports=I},5050:(R,W,d)=>{var O,I;O=[d(40),d(7402),d(4314),d(7359)],I=d.dj.d(O,function(f,N,b,h){return class extends N{constructor(o){super(),this._scene=o,this.antialias=!1,this.duringInteraction=!1,this.sampleLevel=5,this.unbiased=!0,this._jitterOffset=this._getJitterVectors(),this.reset()}render(o,c,u,g,m){this.renderToScreen?o.setRenderTarget(null):(g.u_passNumber.value=0,o.setRenderTarget(u),o.clear()),this.antialias&&!this.duringInteraction?this.renderSSAA(o,c,u,g,m):o.render(this._scene,c)}renderSSAA(o,c,u,g,m){const y=this._jitterOffset[Math.max(0,Math.min(this.sampleLevel,5))],x=1/y.length,w=1/32,C={fullWidth:u.width,fullHeight:u.height,offsetX:0,offsetY:0,width:u.width,height:u.height},P=new f.Color;o.getClearColor(P);const T=o.getClearAlpha();o.setClearColor(0,0),o.setRenderTarget(u),o.clear(),o.setRenderTarget(m),o.clear(),this._uniforms.tDiffuse.value=m.texture;for(let M=0;M<y.length;M++){const z=y[M];c.setViewOffset(C.fullWidth,C.fullHeight,C.offsetX+z[0]*.0625,C.offsetY+z[1]*.0625,C.width,C.height);let Y=x;if(this.unbiased){const X=-.5+(M+.5)/y.length;Y+=w*X}o.setRenderTarget(m),o.clear(),o.render(this._scene,c),o.setRenderTarget(u),this._uniforms.opacity.value=Y,this._quad.render(o)}c.clearViewOffset(),o.setClearColor(P,T)}reset(){const o=h;this._uniforms=f.UniformsUtils.clone(o.uniforms),this._material=new f.ShaderMaterial({defines:Object.assign({USE_SSAA:1},o.defines),uniforms:this._uniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:f.AdditiveBlending,depthTest:!1,depthWrite:!1}),this._quad=new b(this._material)}dispose(){this._material.dispose(),this._quad.dispose()}_getJitterVectors(){return[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]]}}},R,W),R.exports=I},773:(R,W,d)=>{var O,I;O=[d(40),d(1135),d(6254),d(6314),d(5050),d(9327),d(4893),d(9546),d(3289),d(6694),d(7198)],I=d.dj.d(O,function(f,N,b,h,r,o,c,u,g,m,y){return class{constructor(w,C,P,T,M,z,Y,X,S,F,k){this._antialias=!1,this._renderer=w,this._init(),this._middlePasses=[],this._frontPasses=[],this._maxWidth=3840,this._maxHeight=2160,this._pixelScaleFactor=1,this._deferredBufferInUse=!1,this.clearOverview=!1,this.depthPeelAllowed=!1,this.iterativeRendering=!1,this.outOfCoreRendering=!1,this._renderToScreen=new N,this._background=new b(P,1),this._deferredPass=new h(Y,X),this._orientationAxes=new y(C),this._renderPass=new r(T),this.addPass(this._renderPass),this._depthPass=new o(M),this._depthPass.enabled=!1,this.addPass(this._depthPass),this._depthPeelPass=new c(T,M,F.uniforms,k.width,k.height),this._depthPeelPass.enabled=!1,this.addPass(this._depthPeelPass),this._depthViewPass=new u,this._depthViewPass.enabled=!1,this.addPass(this._depthViewPass),this._iterativePass=new g(T),this._iterativePass.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio),this._paint=new m(F.uniforms),this._paint.enabled=!1;const G=new r(S);G.renderToScreen=!0,this.addFrontPass(G);const H=new r(z);H.renderToScreen=!0,this.addFrontPass(H)}addPass(w){this._middlePasses.push(w),w.setSize(Math.round(this._width*this._pixelRatio),Math.round(this._height*this._pixelRatio))}addFrontPass(w){this._frontPasses.push(w),w.setSize(this._width,this._height)}render(w,C){this._clearPaintBrush(),C.u_viewportSize.value.set(this._sceneBuffer.width,this._sceneBuffer.height),this._renderer.setClearColor(this._background.clearColor,this._background.clearAlpha),this._clearDeferredBuffer(),this._renderer.setRenderTarget(this._sceneBuffer),this._renderer.clear();for(let P=0,T=this._middlePasses.length;P<T;P++){const M=this._middlePasses[P];M.enabled!==!1&&M.render(this._renderer,w,this._sceneBuffer,C,this._renderTarget1,this._renderTarget2,this._renderTarget3,this._depthBuffer,this._depthRenderTarget)}this.outOfCoreRendering===!0&&this._deferredPass.renderOverview(this._renderer,w,this._renderTarget2,C),this.iterativeRendering===!0?(this._iterativePass.currentPass=1,this.renderIterativeLayer(w,C)):this.renderOverlay(w,C)}renderDeferredLayer(w,C){this._renderer.setRenderTarget(null),this._renderer.clear(),this._deferredBufferInUse===!1&&(this._deferredPass.clearRequired=!0),this._renderer.setRenderTarget(this._deferredBuffer),this._deferredBufferInUse=!0,this._deferredPass.render(this._renderer,w,this._deferredBuffer,C,this._renderTarget1,this._renderTarget2,this._renderTarget3,this._stencilTarget),this.clearOverview&&(this.clearOverview=!1,this._renderer.setRenderTarget(this._renderTarget2),this._renderer.clear()),this._depthPass.enabled&&(this._depthPass.clearBuffer=!1,this._depthPass.render(this._renderer,w,this._sceneBuffer,C,this._renderTarget1,this._renderTarget2,this._renderTarget3,this._depthBuffer,this._depthRenderTarget),this._depthPass.clearBuffer=!0),this.renderOverlay(w,C)}renderOverlay(w,C){this._renderBackground(w,C),this.outOfCoreRendering&&this._renderToScreen.render(this._renderer,w,this._renderTarget2,this._depthRenderTarget,C),this._deferredBufferInUse?this.iterativeRendering||this._deferredPass.compositeStyle==="composite"?this._renderToScreen.blend(this._renderer,w,this._sceneBuffer,this._depthRenderTarget,this._deferredBuffer,C):(this._renderToScreen.render(this._renderer,w,this._deferredBuffer,this._depthRenderTarget,C),this._renderToScreen.render(this._renderer,w,this._sceneBuffer,this._depthRenderTarget,C)):this._renderToScreen.render(this._renderer,w,this._sceneBuffer,this._depthRenderTarget,C),this._paint.enabled&&this._paint.render(this._renderer,w,this._sceneBuffer,this._depthRenderTarget,this._renderTarget3,C),this._renderFrontLayer(w,C)}renderIterativeLayer(w,C){this._deferredBufferInUse=!0,this._iterativePass.render(this._renderer,w,this._deferredBuffer,C,this._renderTarget1,this._renderTarget2,this._renderTarget3,this._stencilTarget),this.renderOverlay(w,C)}_renderFrontLayer(w,C){this._orientationAxes.enabled===!0&&this._orientationAxes.render(this._renderer,w,this._sceneBuffer,C);for(let P=0,T=this._frontPasses.length;P<T;P++){const M=this._frontPasses[P];M.enabled!==!1&&M.render(this._renderer,w,this._sceneBuffer,C)}}_renderBackground(w,C){this._renderer.setRenderTarget(null),this._renderer.clear(),this._background.render(this._renderer,w,this._sceneBuffer,C)}_clearDeferredBuffer(){this._deferredBufferInUse&&(this._renderer.setRenderTarget(this._deferredBuffer),this._renderer.clear(),this._deferredBufferInUse=!1,this._deferredPass.clearRequired=!0)}_clearPaintBrush(){this._paint.clearRequired&&(this._paint.clearRequired=!1,this._renderer.setRenderTarget(this._renderTarget3),this._renderer.setClearColor(0,0),this._renderer.clear())}dispose(){this.iterativeRendering=!1,this._sceneBuffer!==void 0&&this._sceneBuffer.dispose(),this._deferredBuffer!==void 0&&this._deferredBuffer.dispose(),this._stencilTarget!==void 0&&this._stencilTarget.dispose(),this._renderTarget1!==void 0&&this._renderTarget1.dispose(),this._renderTarget2!==void 0&&this._renderTarget2.dispose(),this._renderTarget3!==void 0&&this._renderTarget3.dispose(),this._depthBuffer!==void 0&&this._depthBuffer.dispose(),this._depthRenderTarget!==void 0&&this._depthRenderTarget.dispose(),this._background.dispose(),this._renderToScreen.dispose(),this._deferredPass.dispose(),this._iterativePass.dispose(),this._orientationAxes.dispose(),this._renderPass.dispose(),this._depthPeelPass.dispose(),this._depthViewPass.dispose()}reset(){this._init(),this._background.reset(),this._renderToScreen.reset(),this._paint.reset()}setAntialiasing(w){let C=!1;switch(w){case"msaa":this._renderPass.antialias=!1,C=!0;break;case"ssaa":this._renderPass.antialias=!0,C=!1;break;default:this._renderPass.antialias=!1,C=!1;break}this._antialias!==C&&(this._antialias=C,this.reset())}getDepthAtLocation(w,C){let P=Math.max(Math.ceil(w.x*this._depthRenderTarget.width)-1,0),T=Math.max(Math.ceil((1-w.y)*this._depthRenderTarget.height)-1,0),M=C;if(C>1){const G=Math.round(M/2);P-G<0||T-G<0||P+G>this._depthRenderTarget.width-1||T+G>this._depthRenderTarget.height-1?M=1:(P-=G,T-=G)}const z=new Uint8Array(4*M*M);let Y=0;const X=Math.round((M*M-1)/2);if(this._renderer.readRenderTargetPixels(this._depthRenderTarget,P,T,M,M,z),M>1){const G=X-1;if(z[G*4]<255||z[G*4+1]<255||z[G*4+2]<255||z[G*4+3]<255)Y=G*4;else{const H=Math.round((M+1)/2),q=new f.Vector2(H,H),ce=new f.Vector2,Q=new f.Vector2;let ne=Number.MAX_VALUE,he=0,ve=!1;for(let Ie=0;Ie<M*M;Ie++)(z[Ie*4]<255||z[Ie*4+1]<255||z[Ie*4+2]<255||z[Ie*4+3]<255)&&(Q.set(Ie%M+1,(Ie-Ie%M)/M+1),he=Q.distanceTo(q),he<ne&&(ce.copy(Q),ne=he,Y=Ie*4,ve=!0));ve===!0&&(ce.sub(q),w.x=w.x+ce.x/this._depthRenderTarget.width,w.y=w.y-ce.y/this._depthRenderTarget.height)}}const S=255/256,F=new f.Vector4,k=new f.Vector4(S/(256*256*256),S/(256*256),S/256,S);return F.fromArray(z,Y).multiplyScalar(.00392156862745098).dot(k)}setDepthPeel(w,C){this.depthPeelAllowed=w,this._depthViewPass.enabled=w&&C!==0,this._iterativePass.enabled=C===0,this._depthPeelPass.viewDepth=C}setDepth(w,C,P){this._depthPeelPass.minPasses=w,this._depthPass.updateForBuffer(C,P)}setQualityParameters(w,C,P,T){this._depthPeelPass.maxPasses=w,this._depthPeelPass.useExitCondition=C,this._depthPeelPass.exitTolerance=P,this._depthPeelPass.enabled=T,this._renderPass.enabled=!T,this._depthPass.updateForPeel(T)}setDenoising(w,C,P){this._renderToScreen.setDenoising(w,C,P)}enablePaintPass(w,C,P,T){this._paint.initialize(C,P,T),this._paint.enabled=w}activatePaintPass(w){this._paint.activated=w}clearPaintPass(){this._paint.initialized&&(this._paint.clearRequired=!0,this._paint.initialized=!1)}setDeferredStyle(w,C){this._deferredPass.compositeStyle=w,this.outOfCoreRendering=C}getIterativeProgress(){return Math.floor(this._iterativePass.currentPass/this._iterativePass.numPasses*100)}setColor(w,C,P){this._background.update(w,C,P)}setMaxSize(w,C){(w[0]!==this._maxWidth||w[1]!==this._maxHeight)&&(this._maxWidth=w[0],this._maxHeight=w[1],this.setSize(this._width,this._height),this.setPixelRatio(C))}setAxesVisibility(w,C,P,T){this._orientationAxes.setVisible(w,C,P,T)}getAxesVisibility(){return this._orientationAxes.visible}setAxesLabels(w){this._orientationAxes.setLabels(w)}setIterativeControls(w,C){this._iterativePass.numPasses=C>1e3?1e3:C,this.iterativeRendering=w}updateOnInteraction(w){this._renderPass.duringInteraction=w}setSize(w,C){this._width=w,this._height=C,this._validateCanvasSize();const P=Math.round(this._width*this._pixelRatio),T=Math.round(this._height*this._pixelRatio);this._sceneBuffer.setSize(P,T),this._deferredBuffer.setSize(P,T),this._renderTarget1.setSize(P,T),this._renderTarget2.setSize(P,T),this._renderTarget3.setSize(P,T),this._stencilTarget.setSize(P,T),this._depthBuffer.setSize(P,T),this._depthRenderTarget.setSize(P,T),this._renderer.setSize(this._width,this._height),this._background.setSize(P,T),this._renderToScreen.setSize(P,T),this._deferredPass.setSize(P,T),this._iterativePass.setSize(P,T);for(let M=0;M<this._middlePasses.length;M++)this._middlePasses[M].setSize(P,T);for(let M=0;M<this._frontPasses.length;M++)this._frontPasses[M].setSize(this._width,this._height)}setPixelRatio(w){this._pixelRatio=window.devicePixelRatio/(w*this._pixelScaleFactor),this.setSize(this._width,this._height)}_init(){const w=this._renderer.getSize(new f.Vector2);this._pixelRatio=this._renderer.getPixelRatio(),this._width=w.width,this._height=w.height,this._antialias?this._sceneBuffer=new f.WebGLMultisampleRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,{minFilter:f.LinearFilter,magFilter:f.LinearFilter,format:f.RGBAFormat}):this._sceneBuffer=new f.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,{minFilter:f.LinearFilter,magFilter:f.LinearFilter,format:f.RGBAFormat}),this._sceneBuffer.depthTexture=new f.DepthTexture,this._sceneBuffer.depthTexture.type=f.FloatType,this._deferredBuffer=new f.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,{minFilter:f.LinearFilter,magFilter:f.LinearFilter,format:f.RGBAFormat,depthBuffer:!0}),this._deferredBuffer.depthTexture=new f.DepthTexture,this._deferredBuffer.depthTexture.type=f.FloatType,this._stencilTarget=new f.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,{minFilter:f.LinearFilter,magFilter:f.LinearFilter,format:f.RGBAFormat,generateMipmaps:!1,stencilBuffer:!0,depthBuffer:!0}),this._renderTarget1=new f.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,{minFilter:f.LinearFilter,magFilter:f.LinearFilter,format:f.RGBAFormat,generateMipmaps:!1,stencilBuffer:!1,depthBuffer:!0}),this._renderTarget1.depthTexture=new f.DepthTexture,this._renderTarget1.depthTexture.type=f.FloatType,this._renderTarget2=this._renderTarget1.clone(),this._renderTarget3=this._renderTarget1.clone(),this._renderTarget3.depthTexture=new f.DepthTexture,this._renderTarget3.depthTexture.type=f.FloatType,this._depthBuffer=new f.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,{minFilter:f.NearestFilter,magFilter:f.NearestFilter,format:f.RGBAFormat,generateMipmaps:!1,stencilBuffer:!1,depthBuffer:!0}),this._depthRenderTarget=new f.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,{minFilter:f.NearestFilter,magFilter:f.NearestFilter,format:f.RGBAFormat,generateMipmaps:!1,stencilBuffer:!1,depthBuffer:!1}),this._depthBuffer.depthTexture=new f.DepthTexture,this._depthBuffer.depthTexture.type=f.FloatType}_validateCanvasSize(){this._width<=this._maxWidth&&this._height<=this._maxHeight?this._pixelScaleFactor=1:this._pixelScaleFactor=Math.pow(2,Math.ceil(Math.max(Math.log(this._width/this._maxWidth)/Math.log(2),Math.log(this._height/this._maxHeight)/Math.log(2))))}}},R,W),R.exports=I},4314:(R,W,d)=>{var O,I;O=[d(40)],I=d.dj.d(O,function(f){const N=new f.OrthographicCamera(-1,1,1,-1,0,1),b=new f.BufferGeometry;return b.setAttribute("position",new f.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),b.setAttribute("uv",new f.Float32BufferAttribute([0,2,0,0,2,0],2)),class{constructor(r){this._mesh=new f.Mesh(b,r)}dispose(){this._mesh.geometry.dispose()}render(r){r.render(this._mesh,N)}get material(){return this._mesh.material}set material(r){this._mesh.material=r}}},R,W),R.exports=I},757:(R,W,d)=>{var O,I;O=[d(2670)],I=d.dj.d(O,function(f){return{start:()=>{const N=new URLSearchParams(window.location.search);return new f(N.get("clientid"))}}},R,W),R.exports=I}},__webpack_module_cache__={};function __webpack_require__(R){var W=__webpack_module_cache__[R];if(W!==void 0)return W.exports;var d=__webpack_module_cache__[R]={id:R,loaded:!1,exports:{}};return __webpack_modules__[R](d,d.exports,__webpack_require__),d.loaded=!0,d.exports}__webpack_require__.m=__webpack_modules__,function(){function R(T,M){for(var z in M)T[z]=M[z];return T}function W(T,M,z){return b(T,M,z,0,W)}function d(T){if(!T)return W;var M=T.absMid;if(!M&&W.absMidsById[T.id]&&(M=W.absMidsById[T.id]),!M)return W;var z=function(X,S,F){return b(X,S,F,M,W)};for(var Y in W)W.hasOwnProperty(Y)&&(z[Y]=W[Y]);return z.toUrl=function(X){return C(X,M?{mid:M}:null)},z.toAbsMid=function(X){return w(X,M?{mid:M}:null)},W.undef&&(z.undef=function(X){W.undef(X,M)}),z}function O(T){for(var M in T)W.absMids[M]=T[M],W.absMidsById[T[M]]||(W.absMidsById[T[M]]=M)}function I(T){var M=f("dojo/has",null,!1),z=M.normalize(T,function(Y){return Y});return z&&__webpack_require__(z)||void 0}function f(T,M,z,Y){T=T.split("!").map(function(F){var k=F.charAt(0)===".";return k&&!M?F:w(F,M?{mid:M}:null)}).join("!");var X;if(T in W.absMids&&__webpack_require__.m[W.absMids[T]])if(z){var S=__webpack_module_cache__[W.absMids[T]];X=S&&(Y?S:S.exports)}else X=__webpack_require__(W.absMids[T]);if(!X)throw new Error("Module not found: "+T);return X}function N(T){if(T.absMid)return T;var M={i:T.id},z=W.absMidsById[T.id];return z&&(M.id=M.absMid=z),Object.defineProperty(M,"exports",{get:function(){return T.exports},set:function(Y){T.exports=Y},enumerable:!0,configurable:!0}),M}function b(T,M,z,Y,X){var S={}.toString.call(T);if(S==="[object String]"){var F=z!==!1,k=f(T,Y,F);if(typeof k=="object"&&k.__DOJO_WEBPACK_DEFINE_PROMISE__)throw new Error("Module not found: "+T);return k}else if(S==="[object Object]")throw new Error("Require config is not supported by WebPack");if(S==="[object Array]"){var G=[],H=M,q=[];if(T.forEach(function(Q){try{G.push(f(Q,Y))}catch(ne){q.push({mid:Q,error:ne})}}),q.length===0)H&&(o(G)?Promise.all(h(G)).then(function(Q){H.apply(this,r(Q))}.bind(this)).catch(function(Q){console.error(Q)}):H.apply(this,G));else{var ce=new Error("findModules");ce.src="dojo-webpack-plugin",ce.info=q,X.signal("error",ce)}return X}else throw new Error("Unsupported require call")}W.toUrl=C,W.toAbsMid=w,W.absMids={},W.absMidsById=[],W.async=1;function h(T){var M=(Array.isArray(T)?T:[T]).map(function(z){return z&&typeof z.then=="function"&&!z.__DOJO_WEBPACK_DEFINE_PROMISE__?{__DOJO_WEBPACK_PROMISE_VALUE__:z}:z});return Array.isArray(T)?M:M[0]}function r(T){var M=(Array.isArray(T)?T:[T]).map(function(z){return z&&z.__DOJO_WEBPACK_PROMISE_VALUE__||z});return Array.isArray(T)?M:M[0]}function o(T){return(Array.isArray(T)?T:[T]).some(function(M){return typeof M=="object"&&M.__DOJO_WEBPACK_DEFINE_PROMISE__})}function c(T,M,z,Y){function X(F){return F.__DOJO_WEBPACK_DEFINE_PROMISE__=!0,F}function S(F){z&&(z.exports=Y);var k=M.apply(null,F);return typeof z=="function"?z(k):k!==void 0?z.exports=k:k=z.exports,k}return o(T)?X(Promise.all(T).then(function(F){return h(S(r(F)))})):S(T)}var u=this||window;if(O({"images-threejs-ui/js/start":757,"images-threejs-ui/js/MainPane":2670,"images-threejs-ui/js/Viewer":2119,"mw-messageservice/MessageService":1711,"mw-messageservice/messageserviceimpl/createMessageServiceDefaultInstance":9478,"dojo/_base/lang":1873,"dojo/_base/kernel":9424,"dojo/global":8455,"dojo/has":9178,"dojo/_base/config":6723,"dojo/sniff":3994,"dojo/aspect":3660,"dojo/on":1929,"mw-messageservice/messageserviceimpl/MessageServiceBase":6963,"dojo/_base/declare":1203,"dojo/Deferred":4371,"dojo/errors/CancelError":7800,"dojo/errors/create":5062,"dojo/promise/Promise":2749,"mw-log/Log":3073,"mw-log/impl/Modes":5818,"mw-log/impl/Levels":587,"mw-log/impl/Type":8556,"mw-log/impl/Backlog":133,"mw-log/util/LogUtils":245,"mw-messageservice/messageserviceimpl/MessageServiceState":3933,"dojo/Evented":3543,"mw-statemachine/StateMachine":6363,"mw-statemachine/statemachineimpl/State":9687,"mw-statemachine/statemachineimpl/EventTrigger":9376,"mw-statemachine/statemachineimpl/Trigger":4410,"mw-statemachine/statemachineimpl/MessageTrigger":6441,"dojo/topic":7505,"mw-statemachine/statemachineimpl/RemoteTrigger":9240,"mw-remote/Remote":8199,"dojo/_base/Deferred":5642,"dojo/when":1636,"mw-remote/iframeproxy/IframeProxyClient":7581,"dojo/_base/connect":5135,"dojo/_base/event":4409,"dojo/dom-geometry":8771,"dojo/_base/window":8145,"dojo/dom":3458,"dojo/dom-style":2442,"dojo/mouse":4905,"dojo/_base/sniff":8609,"dojo/keys":3720,"dojo/dom-construct":2490,"dojo/dom-attr":4348,"dojo/dom-prop":1502,"mw-remote/iframeproxy/CheckUrlService":5662,"dojo/request/script":5665,"dojo/request/watch":1563,"dojo/request/util":3638,"dojo/errors/RequestError":5867,"dojo/io-query":7841,"dojo/_base/array":640,"dojo/errors/RequestTimeoutError":6930,"mw-remote/impl/FaultManager":9889,"mw-remote/impl/RequestManager":8194,"mw-remote/RemoteEndPointsManager":1422,"mw-remote/EndPointsManager":9984,"mw-remote/utils/SecurityUtils":8504,"mw-remote/defaultMessageMapping":6423,"mw-remote/impl/Transaction":8168,"mw-utils/Utils":3957,"mw-deprecation-utils/deprecation":4653,"mw-remote/impl/ResponseManager":1830,"mw-remote/impl/AutoDetectedTransaction":1967,"mw-remote/impl/JsonTransaction":582,"dojo/_base/xhr":8519,"dojo/dom-form":2693,"dojo/json":2570,"dojo/_base/json":5747,"dojo/request/xhr":9810,"dojo/request/handlers":819,"mw-remote/utils/SendMessageUtil":5530,"mw-remote/UploadToWorker":6051,"mw-html-utils/HtmlUtils":3716,"mw-html-utils/_parseHtml/sanitize":7199,"mw-remote/ReplaceUploadIframe":508,"mw-remote/utils/RemoteUrlUtils":9863,"mw-remote/serviceRegistryLookup!":2084,"mw-remote/serviceRegistryLookup":8787,"mw-statemachine/statemachineimpl/TimeoutTrigger":3629,"mw-statemachine/statemachineimpl/Transition":9359,"mw-messageservice/messageserviceimpl/isValidChannel":5413,"cometd/cometd":792,"mw-messageservice/messageserviceimpl/transportEnums":8213,"mw-messageservice/messageserviceimpl/MessageServiceAsync":5528,"cometd/AckExtension":5094,"mw-messageservice/messageserviceimpl/instanceEnums":981,"mw-messageservice/messageserviceimpl/messageServiceFactory":7114,"images-threejs-ui/js/decorations/ProgressSpinner":5989,"images-threejs-ui/js/CameraControls":1240,"images-threejs-ui/js/Toolbar":2426,"images-threejs-ui/js/Animation":3375,"images-threejs-ui/js/decorations/Message":2574,"mw-tooltip/Tooltips":3460,"mw-tooltip/impl/Tooltip":3282,"mw-tooltip/impl/Content":88,"mw-tooltip/impl/enum/TypeEnum":5714,"mw-tooltip/utils/ContentUtils":2764,"mw-tooltip/impl/TooltipDepot":5690,"mw-tooltip/impl/TooltipState":5309,"mw-tooltip/impl/enum/StateEnum":6011,"mw-tooltip/impl/enum/DefaultsEnum":7228,"mw-tooltip/utils/TooltipUtils":3846,"mw-ui-themes/UIThemeManager":3902,"mw-ui-themes/ThemeEnum":8554,"mw-tooltip/impl/enum/ThemeEnum":5163,"images-threejs-ui/js/annotations/AnnotationControls":9501,"images-threejs-ui/js/annotations/PlaneControls":8380,"images-threejs-ui/js/annotations/InteractivePlane":8800,"images-threejs-ui/js/annotations/MarkerShader":6053,"images-threejs-ui/js/annotations/PointPool":9244,"images-threejs-ui/js/annotations/AbstractPool":738,"images-threejs-ui/js/annotations/Marker":884,"images-threejs-ui/js/annotations/CSSLabel":990,"images-threejs-ui/js/annotations/LinePool":4097,"images-threejs-ui/js/annotations/Line":9052,"images-threejs-ui/js/annotations/AnglePool":8017,"images-threejs-ui/js/annotations/Angle":7439,"images-threejs-ui/js/annotations/PolygonPool":3476,"images-threejs-ui/js/annotations/Polyline":5374,"images-threejs-ui/js/annotations/ElevationPool":2181,"images-threejs-ui/js/annotations/Elevation":4827,"images-threejs-ui/js/annotations/CuboidPool":5290,"images-threejs-ui/js/annotations/Cuboid":992,"images-threejs-ui/js/annotations/Face":1043,"images-threejs-ui/js/annotations/RectanglePool":2395,"images-threejs-ui/js/annotations/Rectangle":1649,"images-threejs-ui/js/annotations/FreehandPool":9631,"images-threejs-ui/js/annotations/Freehand":4589,"images-threejs-ui/js/annotations/TextPool":5195,"images-threejs-ui/js/annotations/Text":3601,"images-threejs-ui/js/annotations/DataTipPool":5423,"images-threejs-ui/js/annotations/DataTip":1005,"images-threejs-ui/js/annotations/Crosshair":8328,"images-threejs-ui/js/annotations/Sphere":4935,"images-threejs-ui/js/annotations/Cylinder":7756,"images-threejs-ui/js/Volume":3771,"images-threejs-ui/js/Container":1082,"images-threejs-ui/js/Image":4868,"images-threejs-ui/js/ImageShader":9925,"images-threejs-ui/js/VolumeShader":678,"images-threejs-ui/js/Surface":9242,"images-threejs-ui/js/Points":1374,"images-threejs-ui/js/BlockedPoints":6250,"images-threejs-ui/js/PointBlockController":2642,"images-threejs-ui/js/BlockController":1600,"images-threejs-ui/js/ImageTile":1952,"images-threejs-ui/js/Block":2588,"images-threejs-ui/js/VolumeTile":8695,"images-threejs-ui/js/PointBlock":1270,"images-threejs-ui/js/PriorityQueue":562,"images-threejs-ui/js/LeastRecentUsedCache":7086,"images-threejs-ui/js/BlockedVolume":3215,"images-threejs-ui/js/OverviewVolume":4544,"images-threejs-ui/js/BlockedImage":664,"images-threejs-ui/js/Line":8855,"images-threejs-ui/js/WideLine":3252,"images-threejs-ui/js/WideLineShader":7669,"images-threejs-ui/js/InstancedLineGeometry":3734,"images-threejs-ui/js/decorations/ScaleBar":2554,"images-threejs-ui/js/decorations/Wireframe":855,"images-threejs-ui/js/decorations/Grid":4121,"images-threejs-ui/js/LightControls":4191,"images-threejs-ui/js/postprocessing/RenderingComposer":773,"images-threejs-ui/js/postprocessing/CopyPass":1135,"images-threejs-ui/js/postprocessing/Pass":7402,"images-threejs-ui/js/postprocessing/ViewportQuad":4314,"images-threejs-ui/js/postprocessing/CopyShader":7359,"images-threejs-ui/js/postprocessing/BackgroundPass":6254,"images-threejs-ui/js/BackgroundShader":7736,"images-threejs-ui/js/postprocessing/DeferredRenderPass":6314,"images-threejs-ui/js/postprocessing/CompositeShader":2081,"images-threejs-ui/js/postprocessing/MaskShader":4194,"images-threejs-ui/js/postprocessing/RenderPass":5050,"images-threejs-ui/js/postprocessing/DepthPass":9327,"images-threejs-ui/js/postprocessing/DepthViewPass":9546,"images-threejs-ui/js/postprocessing/DepthViewShader":1202,"images-threejs-ui/js/postprocessing/DepthShader":3247,"images-threejs-ui/js/postprocessing/DepthPeelPass":4893,"images-threejs-ui/js/postprocessing/IterativeRenderPass":3289,"images-threejs-ui/js/postprocessing/LightMapShader":9472,"images-threejs-ui/js/postprocessing/LightingShader":6230,"images-threejs-ui/js/postprocessing/PaintPass":6694,"images-threejs-ui/js/postprocessing/PaintShader":1966,"images-threejs-ui/js/decorations/OrientationAxes":7198,"images-threejs-ui/js/MemoryControls":6116,"mw-binarystream/BinaryStreamFactory":1919,"mw-binarystream/BinaryStream":7049,"mw-binarystream/impl/BinaryStreamTransport":1155,"mw-binarystream/impl/BinaryStreamWebSocket":8681,"mw-binarystream/impl/BinaryStreamFraming":9876,"dojo/domReady!":5880,"dojo/domReady":7207}),u.require=W,(self.webpackChunk=self.webpackChunk||[]).registerAbsMids=O,__webpack_require__.dj&&__webpack_require__.dj.name!=="dojo-webpack-plugin")throw new Error("__webpack_require__.dj name collision.");__webpack_require__.dj={name:"dojo-webpack-plugin",r:W,c:d,m:N,h:I,d:c,w:h,u:r};var g=Object.create(u,{document:{value:u.document}});Object.defineProperties(g,{window:{value:g},global:{value:g}}),g.define=g.require=void 0,u.dojoConfig=u.dojoConfig||{};var m=R(u.dojoConfig,{baseUrl:".",packages:[{name:"dojo",location:"release/derived/3p/ui/dojo",lib:"."},{name:"custom-elements",location:"release/derived/ui/custom-elements",lib:"."},{name:"lit",location:"release/derived/3p/ui/lit",lib:"."},{name:"mw-widget-api",location:"release/derived/ui/mw-widget-api",lib:"."},{name:"mw-progress-indicator",location:"release/derived/ui/mw-progress-indicator",lib:"."},{name:"mw-log",location:"release/derived/ui/mw-log",lib:"."},{name:"dijit",location:"release/derived/3p/ui/dijit",lib:"."},{name:"mw-utils",location:"release/derived/ui/mw-utils",lib:"."},{name:"cometd",location:"release/derived/3p/ui/cometd",lib:"."},{name:"mw-deprecation-utils",location:"release/derived/ui/mw-deprecation-utils",lib:"."},{name:"mw-html-utils",location:"release/derived/ui/mw-html-utils",lib:"."},{name:"dojox",location:"release/derived/3p/ui/dojox",lib:"."},{name:"mw-remote",location:"release/derived/ui/mw-remote",lib:"."},{name:"mw-statemachine",location:"release/derived/ui/mw-statemachine",lib:"."},{name:"mw-messageservice",location:"release/derived/ui/mw-messageservice",lib:"."},{name:"mw-ddux",location:"release/derived/ui/mw-ddux",lib:"."},{name:"mw-ui-themes",location:"release/derived/ui/mw-ui-themes",lib:"."},{name:"mw-dom-utils",location:"release/derived/ui/mw-dom-utils",lib:"."},{name:"mw-event-utils",location:"release/derived/ui/mw-event-utils",lib:"."},{name:"mw-icons",location:"release/derived/ui/mw-icons",lib:"."},{name:"mw-form",location:"release/derived/ui/mw-form",lib:"."},{name:"mw-dialogs",location:"release/derived/ui/mw-dialogs",lib:"."},{name:"mw-notifications",location:"release/derived/ui/mw-notifications",lib:"."},{name:"mw-browser-utils",location:"release/derived/ui/mw-browser-utils",lib:"."},{name:"antlrv4-runtime-js",location:"release/derived/3p/ui/antlrv4-runtime-js",lib:"."},{name:"mw-module-loader",location:"release/derived/ui/mw-module-loader",lib:"."},{name:"put-selector",location:"release/derived/3p/ui/put-selector",lib:"."},{name:"xstyle",location:"release/derived/3p/ui/xstyle",lib:"."},{name:"mw-clipboard",location:"release/derived/ui/mw-clipboard",lib:"."},{name:"mw-navigationbar",location:"release/derived/ui/mw-navigationbar",lib:"."},{name:"mw-scrollbar-slider",location:"release/derived/ui/mw-scrollbar-slider",lib:"."},{name:"mw-perf",location:"release/derived/ui/mw-perf",lib:"."},{name:"mw-lock",location:"release/derived/ui/mw-lock",lib:"."},{name:"filesystem-js-utils",location:"release/toolbox/matlab/filesystem/js_utils/js",lib:"."},{name:"filesystem-events",location:"release/toolbox/matlab/filesystem/events/js",lib:"."},{name:"mw-gesture",location:"release/derived/ui/mw-gesture",lib:"."},{name:"ui_core_utils",location:"release/ui/core/utils/js",lib:"."},{name:"element_core",location:"release/ui/core/element_core/js",lib:"."},{name:"searchfield",location:"release/ui/search/searchfield/js",lib:"."},{name:"prefdir",location:"release/toolbox/matlab/prefdir_service/src/js/prefdir",lib:"."},{name:"react",location:"release/derived/3p/ui/react",lib:"."},{name:"mw-filename-utils",location:"release/derived/ui/mw-filename-utils",lib:"."},{name:"popper",location:"release/derived/3p/ui/popper",lib:"."},{name:"Tippy",location:"release/derived/3p/ui/Tippy",lib:"."},{name:"mw-tooltip",location:"release/derived/ui/mw-tooltip",lib:"."},{name:"mw-deferred-utils",location:"release/derived/ui/mw-deferred-utils",lib:"."},{name:"mw-peermodel",location:"release/derived/ui/mw-peermodel",lib:"."},{name:"regenerator-runtime",location:"release/derived/3p/ui/regenerator-runtime",lib:"."},{name:"mw-promise",location:"release/derived/ui/mw-promise",lib:"."},{name:"uuid",location:"release/derived/3p/ui/uuid",lib:"."},{name:"lodash",location:"release/derived/3p/ui/lodash",lib:"."},{name:"object-hash",location:"release/derived/3p/ui/object-hash",lib:"."},{name:"performance",location:"release/derived/toolbox/performance/web",lib:"."},{name:"mf0",location:"release/derived/toolbox/modeling/mf0/web",lib:"."},{name:"mf0_sync",location:"release/derived/toolbox/modeling/mf0_sync/web",lib:"."},{name:"mw-binarystream",location:"release/derived/ui/mw-binarystream",lib:"."},{name:"viewmodel_zml",location:"release/toolbox/shared/viewmodel/zml/json",lib:"."},{name:"mw-popout",location:"release/derived/ui/mw-popout",lib:"."},{name:"maven_component_ui",location:"release/derived/ui/maven_component_ui",lib:"."},{name:"mw-slider",location:"release/derived/ui/mw-slider",lib:"."},{name:"mw-mda",location:"release/derived/toolbox/mw_mda",lib:"."},{name:"settings",location:"release/toolbox/matlab/settings_service/src/js/settings",lib:"."},{name:"sidebar",location:"release/ui/layout/sidebar/js",lib:"."},{name:"mw-actiondataservice",location:"release/derived/ui/mw-actiondataservice",lib:"."},{name:"mw-dnd",location:"release/derived/ui/mw-dnd",lib:"."},{name:"dgrid",location:"release/derived/3p/ui/dgrid",lib:"."},{name:"cajsservice",location:"release/toolbox/matlab/codeanalysis/jsapi/cajsservice",lib:"."},{name:"mw-store-utils",location:"release/derived/ui/mw-store-utils",lib:"."},{name:"filesystem-datamodel-base",location:"release/derived/toolbox/matlab/filesystem/datamodel/base",lib:"."},{name:"reflectionserviceAPI",location:"release/toolbox/matlab/reflectionserviceAPI",lib:"."},{name:"commandwindowservices",location:"release/toolbox/matlab/commandwindowservices",lib:"."},{name:"mw-fctrl",location:"release/ui/fctrl/fctrl_js-lib",lib:"."},{name:"mw-mvm",location:"release/toolbox/mvm_javascript/mw-mvm/mw-mvm-lib",lib:"."},{name:"userexecutionservice",location:"release/toolbox/matlab/userexecutionservice",lib:"."},{name:"registration_framework_js",location:"release/toolbox/matlab/registration_framework/reg_fw_js",lib:"."},{name:"mw-app-module-plugins",location:"release/ui/app-module-plugins/mw-app-module-plugins",lib:"."},{name:"filesystem-datamodel-sourcecontrol",location:"release/derived/toolbox/matlab/filesystem/datamodel/sourcecontrol",lib:"."},{name:"fsui-config",location:"release/toolbox/matlab/filesystem/fsui_config/js",lib:"."},{name:"mw-dialog-utils",location:"release/derived/ui/mw-dialog-utils",lib:"."},{name:"mw-keybindings",location:"release/derived/ui/mw-keybindings",lib:"."},{name:"mw-filebrowser",location:"release/derived/ui/mw-filebrowser",lib:"."},{name:"filesystem_services",location:"release/toolbox/matlab/filesystem/services/client",lib:"."},{name:"mw-event-emitter",location:"release/derived/ui/mw-event-emitter",lib:"."},{name:"viewmodel",location:"release/toolbox/shared/viewmodel/web/viewmodel",lib:"."},{name:"spinner",location:"release/derived/3p/ui/spinner",lib:"."},{name:"mw-datepicker",location:"release/derived/ui/mw-datepicker",lib:"."},{name:"mw-webwindow-dialogs",location:"release/derived/ui/mw-webwindow-dialogs",lib:"."},{name:"editor_application_interface",location:"release/toolbox/matlab/editor/application_interface/js",lib:"."},{name:"mw-overlay-utils",location:"release/derived/ui/mw-overlay-utils",lib:"."},{name:"mw-dom-snapshot-utils",location:"release/derived/ui/mw-dom-snapshot-utils",lib:"."},{name:"mw-colorpicker",location:"release/derived/ui/mw-colorpicker",lib:"."},{name:"mw-string-utils",location:"release/derived/ui/mw-string-utils",lib:"."},{name:"webwidgets_css",location:"release/ui/webwidgets/src/css",lib:"."},{name:"images",location:"release/ui/webwidgets/src/images",lib:"."},{name:"MW",location:"release/ui/webwidgets/src/js/MW",lib:"."},{name:"l10n",location:"release/ui/webwidgets/src/l10n",lib:"."},{name:"mw-help-staticcontent",location:"release/toolbox/matlab/helptools_js/help_static_content/mw-help-staticcontent",lib:"."},{name:"htmltext",location:"release/ui/lightweightbrowser/htmltext/htmltext",lib:"."},{name:"InstallServiceHandler",location:"release/install/installservicehandler/web/installservicehandler",lib:"."},{name:"matlab_login",location:"release/toolbox/matlab/matlab_login/web/matlab_login",lib:"."},{name:"THREE",location:"release/derived/3p/ui/threejs",lib:"."},{name:"images-threejs-ui",location:"release/toolbox/images/ui/viewer3d/images-threejs-ui",lib:"."}],deps:["bootstrap"],async:!1,has:{"config-deferredInstrumentation":!1},supportedLocales:["ja-jp","ko-kr","zh-cn","en-us"]}),y={hasCache:{webpack:1,"host-browser":1,dom:1,"dojo-loader":1,"dojo-has-api":1,"dojo-dom-ready-api":1,"dojo-sniff":1,"dojo-test-sniff":1,"config-deferredInstrumentation":1,"config-tlmSiblingOfDojo":1}},x=__webpack_require__(4405);x.call(g,m,y,g,g),Object.keys(g.require.packs).forEach(function(T){var M=g.require.packs[T];(/(^\/)|(\:)/.test(M.main)||M.main.split("/").reduce(function(z,Y){return z<0||Y==="."?z:Y===".."?--z:++z},0)<=0)&&typeof M.realMain>"u"&&(M.realMain=M.main,M.main="")});function w(T,M){var z=g.require.originalToAbsMid(T,M);if(z.indexOf("/")===z.length-1){var Y=z.substring(0,z.length-1),X=g.require.packs[Y];X&&X.realMain&&(z=Y)}return z}function C(T,M){var z=g.require.originalToUrl(T,M),Y=g.require.packs[T];if(Y&&Y.realMain){var X=z.split("?");/(^\/)|(\:)/.test(Y.realMain)?X[0]=Y.realMain:X[0]=X[0]+"/"+Y.realMain,z=X.join("?")}return z}g.require.originalToAbsMid=g.require.toAbsMid,g.require.originalToUrl=g.require.toUrl,g.require.toAbsMid=w,g.require.toUrl=C,["baseUrl","has","rawConfig","on","signal"].forEach(function(T){W[T]=g.require[T]});var P=u.webpackChunk.absMidsWaiting;P&&(P.forEach(O),delete u.webpackChunk.absMidsWaiting)}();var __webpack_exports__=__webpack_require__(1723)})();
